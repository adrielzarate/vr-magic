<!doctype html>
<!--
Copyright 2018 The Immersive Web Community Group
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<html>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'>
    <meta name='mobile-web-app-capable' content='yes'>
    <meta name='apple-mobile-web-app-capable' content='yes'>
    <!-- Origin Trial Token, feature = WebXR Device API, origin = https://immersive-web.github.io, expires = 2018-08-28 -->
    <meta http-equiv="origin-trial" data-feature="WebXR Device API" data-expires="2018-08-28" content="AnNpu7ceXvLew05ccD8Zr1OZsdZiB2hLQKK82kTTMDwF7oRKtP3QEJ4RzkeHrmB8Sq0vSV6ZNmszpBCZ0I8p9gAAAABceyJvcmlnaW4iOiJodHRwczovL2ltbWVyc2l2ZS13ZWIuZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJXZWJYUkRldmljZSIsImV4cGlyeSI6MTUzNTQxNDQwMH0=">
    <title>Phone AR</title>
    <style>
      body {
        background-color: #F0F0F0;
        font: 1rem/1.4 -apple-system, BlinkMacSystemFont,
          Segoe UI, Roboto, Oxygen,
          Ubuntu, Cantarell, Fira Sans,
          Droid Sans, Helvetica Neue, sans-serif;
      }

      header {
        position: relative;
        z-index: 2;
        left: 0px;
        text-align: left;
        max-width: 420px;
        padding: 0.5em;
        background-color: rgba(255, 255, 255, 0.90);
        margin-bottom: 0.5em;
        border-radius: 2px;
      }

      details summary {
        font-size: 1.0em;
        font-weight: bold;
      }

      details[open] summary {
        font-size: 1.4em;
        font-weight: bold;
      }

      header h1 {
        margin-top: 0px;
      }

      canvas {
        position: absolute;
        z-index: 0;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: 0;
        touch-action: none;
      }

      .back {
        float: right;
        text-decoration: none;
      }

      .back:hover {
        text-decoration: underline;
      }

      .back::before {
        display: inline-block;
        content: attr(data-index) '<';
        font-weight: bold;
        white-space: nowrap;
        margin-right: 0.2em;
        margin-left: 0.2em;
      }
    </style>
    <!--The polyfill is not needed for browser that have native API support,
        but is linked by these samples for wider compatibility.-->
    <!--script src='https://cdn.jsdelivr.net/npm/webxr-polyfill@latest/build/webxr-polyfill.js'></script-->
    <!-- <script src='js/webxr-polyfill.js'></script> -->
    <script>
/**
 * @license
 * webxr-polyfill
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @license
 * cardboard-vr-display
 * Copyright (c) 2015-2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @license
 * webvr-polyfill-dpdb
 * Copyright (c) 2017 Google
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * @license
 * wglu-preserve-state
 * Copyright (c) 2016, Brandon Jones.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/**
 * @license
 * nosleep.js
 * Copyright (c) 2017, Rich Tibbett
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global.WebXRPolyfill = factory());
}(this, (function () { 'use strict';

var _global = typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : typeof window !== 'undefined' ? window : {};

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();









var inherits = function (subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
  }

  subClass.prototype = Object.create(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
};











var possibleConstructorReturn = function (self, call) {
  if (!self) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return call && (typeof call === "object" || typeof call === "function") ? call : self;
};

var PRIVATE = Symbol('@@webxr-polyfill/EventTarget');
var EventTarget = function () {
  function EventTarget() {
    classCallCheck(this, EventTarget);
    this[PRIVATE] = {
      listeners: new Map()
    };
  }
  createClass(EventTarget, [{
    key: 'addEventListener',
    value: function addEventListener(type, listener) {
      if (typeof type !== 'string') {
        throw new Error('`type` must be a string');
      }
      if (typeof listener !== 'function') {
        throw new Error('`listener` must be a function');
      }
      var typedListeners = this[PRIVATE].listeners.get(type) || [];
      typedListeners.push(listener);
      this[PRIVATE].listeners.set(type, typedListeners);
    }
  }, {
    key: 'removeEventListener',
    value: function removeEventListener(type, listener) {
      if (typeof type !== 'string') {
        throw new Error('`type` must be a string');
      }
      if (typeof listener !== 'function') {
        throw new Error('`listener` must be a function');
      }
      var typedListeners = this[PRIVATE].listeners.get(type) || [];
      for (var i = typedListeners.length; i >= 0; i--) {
        if (typedListeners[i] === listener) {
          typedListeners.pop();
        }
      }
    }
  }, {
    key: 'dispatchEvent',
    value: function dispatchEvent(type, event) {
      var typedListeners = this[PRIVATE].listeners.get(type) || [];
      var queue = [];
      for (var i = 0; i < typedListeners.length; i++) {
        queue[i] = typedListeners[i];
      }
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;
      try {
        for (var _iterator = queue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var listener = _step.value;
          listener(event);
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
      if (typeof this['on' + type] === 'function') {
        this['on' + type](event);
      }
    }
  }]);
  return EventTarget;
}();

var PRIVATE$1 = Symbol('@@webxr-polyfill/XR');
var XR = function (_EventTarget) {
  inherits(XR, _EventTarget);
  function XR(device) {
    classCallCheck(this, XR);
    var _this = possibleConstructorReturn(this, (XR.__proto__ || Object.getPrototypeOf(XR)).call(this));
    _this[PRIVATE$1] = {
      device: device
    };
    return _this;
  }
  createClass(XR, [{
    key: 'requestDevice',
    value: function requestDevice() {
      return new Promise(function ($return, $error) {
        var device;
        return Promise.resolve(this[PRIVATE$1].device).then(function ($await_1) {
          try {
            device = $await_1;
            if (device) {
              return $return(device);
            }
            return $error(new Error('NotFoundError'));
          } catch ($boundEx) {
            return $error($boundEx);
          }
        }.bind(this), $error);
      }.bind(this));
    }
  }]);
  return XR;
}(EventTarget);

var now = void 0;
if ('performance' in _global === false) {
  var startTime = Date.now();
  now = function now() {
    return Date.now() - startTime;
  };
} else {
  now = function now() {
    return performance.now();
  };
}
var now$1 = now;

var PRIVATE$2 = Symbol('@@webxr-polyfill/XRPresentationContext');
var XRPresentationContext = function () {
  function XRPresentationContext(canvas, ctx, glAttribs) {
    classCallCheck(this, XRPresentationContext);
    this[PRIVATE$2] = { canvas: canvas, ctx: ctx, glAttribs: glAttribs };
    Object.assign(this, ctx);
  }
  createClass(XRPresentationContext, [{
    key: 'canvas',
    get: function get$$1() {
      return this[PRIVATE$2].canvas;
    }
  }]);
  return XRPresentationContext;
}();

var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;


var degree = Math.PI / 180;

function create() {
  var out = new ARRAY_TYPE(16);
  out[0] = 1;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  out[4] = 0;
  out[5] = 1;
  out[6] = 0;
  out[7] = 0;
  out[8] = 0;
  out[9] = 0;
  out[10] = 1;
  out[11] = 0;
  out[12] = 0;
  out[13] = 0;
  out[14] = 0;
  out[15] = 1;
  return out;
}

function copy(out, a) {
  out[0] = a[0];
  out[1] = a[1];
  out[2] = a[2];
  out[3] = a[3];
  out[4] = a[4];
  out[5] = a[5];
  out[6] = a[6];
  out[7] = a[7];
  out[8] = a[8];
  out[9] = a[9];
  out[10] = a[10];
  out[11] = a[11];
  out[12] = a[12];
  out[13] = a[13];
  out[14] = a[14];
  out[15] = a[15];
  return out;
}


function identity(out) {
  out[0] = 1;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  out[4] = 0;
  out[5] = 1;
  out[6] = 0;
  out[7] = 0;
  out[8] = 0;
  out[9] = 0;
  out[10] = 1;
  out[11] = 0;
  out[12] = 0;
  out[13] = 0;
  out[14] = 0;
  out[15] = 1;
  return out;
}

function invert(out, a) {
  var a00 = a[0],
      a01 = a[1],
      a02 = a[2],
      a03 = a[3];
  var a10 = a[4],
      a11 = a[5],
      a12 = a[6],
      a13 = a[7];
  var a20 = a[8],
      a21 = a[9],
      a22 = a[10],
      a23 = a[11];
  var a30 = a[12],
      a31 = a[13],
      a32 = a[14],
      a33 = a[15];
  var b00 = a00 * a11 - a01 * a10;
  var b01 = a00 * a12 - a02 * a10;
  var b02 = a00 * a13 - a03 * a10;
  var b03 = a01 * a12 - a02 * a11;
  var b04 = a01 * a13 - a03 * a11;
  var b05 = a02 * a13 - a03 * a12;
  var b06 = a20 * a31 - a21 * a30;
  var b07 = a20 * a32 - a22 * a30;
  var b08 = a20 * a33 - a23 * a30;
  var b09 = a21 * a32 - a22 * a31;
  var b10 = a21 * a33 - a23 * a31;
  var b11 = a22 * a33 - a23 * a32;
  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;
  if (!det) {
    return null;
  }
  det = 1.0 / det;
  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;
  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;
  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;
  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;
  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;
  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;
  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;
  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;
  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;
  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;
  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;
  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;
  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;
  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;
  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;
  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;
  return out;
}


function multiply(out, a, b) {
  var a00 = a[0],
      a01 = a[1],
      a02 = a[2],
      a03 = a[3];
  var a10 = a[4],
      a11 = a[5],
      a12 = a[6],
      a13 = a[7];
  var a20 = a[8],
      a21 = a[9],
      a22 = a[10],
      a23 = a[11];
  var a30 = a[12],
      a31 = a[13],
      a32 = a[14],
      a33 = a[15];
  var b0 = b[0],
      b1 = b[1],
      b2 = b[2],
      b3 = b[3];
  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
  b0 = b[4];b1 = b[5];b2 = b[6];b3 = b[7];
  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
  b0 = b[8];b1 = b[9];b2 = b[10];b3 = b[11];
  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
  b0 = b[12];b1 = b[13];b2 = b[14];b3 = b[15];
  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;
  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;
  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;
  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;
  return out;
}












function fromRotationTranslation(out, q, v) {
  var x = q[0],
      y = q[1],
      z = q[2],
      w = q[3];
  var x2 = x + x;
  var y2 = y + y;
  var z2 = z + z;
  var xx = x * x2;
  var xy = x * y2;
  var xz = x * z2;
  var yy = y * y2;
  var yz = y * z2;
  var zz = z * z2;
  var wx = w * x2;
  var wy = w * y2;
  var wz = w * z2;
  out[0] = 1 - (yy + zz);
  out[1] = xy + wz;
  out[2] = xz - wy;
  out[3] = 0;
  out[4] = xy - wz;
  out[5] = 1 - (xx + zz);
  out[6] = yz + wx;
  out[7] = 0;
  out[8] = xz + wy;
  out[9] = yz - wx;
  out[10] = 1 - (xx + yy);
  out[11] = 0;
  out[12] = v[0];
  out[13] = v[1];
  out[14] = v[2];
  out[15] = 1;
  return out;
}

function getTranslation(out, mat) {
  out[0] = mat[12];
  out[1] = mat[13];
  out[2] = mat[14];
  return out;
}

function getRotation(out, mat) {
  var trace = mat[0] + mat[5] + mat[10];
  var S = 0;
  if (trace > 0) {
    S = Math.sqrt(trace + 1.0) * 2;
    out[3] = 0.25 * S;
    out[0] = (mat[6] - mat[9]) / S;
    out[1] = (mat[8] - mat[2]) / S;
    out[2] = (mat[1] - mat[4]) / S;
  } else if (mat[0] > mat[5] && mat[0] > mat[10]) {
    S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;
    out[3] = (mat[6] - mat[9]) / S;
    out[0] = 0.25 * S;
    out[1] = (mat[1] + mat[4]) / S;
    out[2] = (mat[8] + mat[2]) / S;
  } else if (mat[5] > mat[10]) {
    S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;
    out[3] = (mat[8] - mat[2]) / S;
    out[0] = (mat[1] + mat[4]) / S;
    out[1] = 0.25 * S;
    out[2] = (mat[6] + mat[9]) / S;
  } else {
    S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;
    out[3] = (mat[1] - mat[4]) / S;
    out[0] = (mat[8] + mat[2]) / S;
    out[1] = (mat[6] + mat[9]) / S;
    out[2] = 0.25 * S;
  }
  return out;
}




function perspective(out, fovy, aspect, near, far) {
  var f = 1.0 / Math.tan(fovy / 2);
  var nf = 1 / (near - far);
  out[0] = f / aspect;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  out[4] = 0;
  out[5] = f;
  out[6] = 0;
  out[7] = 0;
  out[8] = 0;
  out[9] = 0;
  out[10] = (far + near) * nf;
  out[11] = -1;
  out[12] = 0;
  out[13] = 0;
  out[14] = 2 * far * near * nf;
  out[15] = 0;
  return out;
}

var PRIVATE$3 = Symbol('@@webxr-polyfill/XRDevicePose');
var XRDevicePose = function () {
  function XRDevicePose(polyfill) {
    classCallCheck(this, XRDevicePose);
    this[PRIVATE$3] = {
      polyfill: polyfill,
      leftViewMatrix: identity(new Float32Array(16)),
      rightViewMatrix: identity(new Float32Array(16)),
      poseModelMatrix: identity(new Float32Array(16))
    };
  }
  createClass(XRDevicePose, [{
    key: 'getViewMatrix',
    value: function getViewMatrix(view) {
      switch (view.eye) {
        case 'left':
          return this[PRIVATE$3].leftViewMatrix;
        case 'right':
          return this[PRIVATE$3].rightViewMatrix;
      }
      throw new Error('view is not a valid XREye');
    }
  }, {
    key: 'updateFromFrameOfReference',
    value: function updateFromFrameOfReference(frameOfRef) {
      var pose = this[PRIVATE$3].polyfill.getBasePoseMatrix();
      var leftViewMatrix = this[PRIVATE$3].polyfill.getBaseViewMatrix('left');
      var rightViewMatrix = this[PRIVATE$3].polyfill.getBaseViewMatrix('right');
      if (pose) {
        frameOfRef.transformBasePoseMatrix(this[PRIVATE$3].poseModelMatrix, pose);
      }
      if (leftViewMatrix && rightViewMatrix) {
        frameOfRef.transformBaseViewMatrix(this[PRIVATE$3].leftViewMatrix, leftViewMatrix, this[PRIVATE$3].poseModelMatrix);
        frameOfRef.transformBaseViewMatrix(this[PRIVATE$3].rightViewMatrix, rightViewMatrix, this[PRIVATE$3].poseModelMatrix);
      }
    }
  }, {
    key: 'poseModelMatrix',
    get: function get$$1() {
      return this[PRIVATE$3].poseModelMatrix;
    }
  }]);
  return XRDevicePose;
}();

var PRIVATE$4 = Symbol('@@webxr-polyfill/XRViewport');
var XRViewport = function () {
  function XRViewport(target) {
    classCallCheck(this, XRViewport);
    this[PRIVATE$4] = { target: target };
  }
  createClass(XRViewport, [{
    key: 'x',
    get: function get$$1() {
      return this[PRIVATE$4].target.x;
    }
  }, {
    key: 'y',
    get: function get$$1() {
      return this[PRIVATE$4].target.y;
    }
  }, {
    key: 'width',
    get: function get$$1() {
      return this[PRIVATE$4].target.width;
    }
  }, {
    key: 'height',
    get: function get$$1() {
      return this[PRIVATE$4].target.height;
    }
  }]);
  return XRViewport;
}();

var XREyes = ['left', 'right'];
var PRIVATE$5 = Symbol('@@webxr-polyfill/XRView');
var XRView = function () {
  function XRView(polyfill, eye, sessionId) {
    classCallCheck(this, XRView);
    if (!XREyes.includes(eye)) {
      throw new Error('XREye must be one of: ' + XREyes);
    }
    var temp = Object.create(null);
    var viewport = new XRViewport(temp);
    this[PRIVATE$5] = {
      polyfill: polyfill,
      eye: eye,
      viewport: viewport,
      temp: temp,
      sessionId: sessionId
    };
  }
  createClass(XRView, [{
    key: '_getViewport',
    value: function _getViewport(layer) {
      var viewport = this[PRIVATE$5].viewport;
      if (this[PRIVATE$5].polyfill.getViewport(this[PRIVATE$5].sessionId, this.eye, layer, this[PRIVATE$5].temp)) {
        return this[PRIVATE$5].viewport;
      }
      return undefined;
    }
  }, {
    key: 'eye',
    get: function get$$1() {
      return this[PRIVATE$5].eye;
    }
  }, {
    key: 'projectionMatrix',
    get: function get$$1() {
      return this[PRIVATE$5].polyfill.getProjectionMatrix(this.eye);
    }
  }]);
  return XRView;
}();

var PRIVATE$6 = Symbol('@@webxr-polyfill/XRFrame');
var XRFrame = function () {
  function XRFrame(polyfill, session, sessionId) {
    classCallCheck(this, XRFrame);
    var devicePose = new XRDevicePose(polyfill);
    var views = [new XRView(polyfill, 'left', sessionId)];
    if (session.immersive) {
      views.push(new XRView(polyfill, 'right', sessionId));
    }
    this[PRIVATE$6] = {
      polyfill: polyfill,
      devicePose: devicePose,
      views: views,
      session: session
    };
  }
  createClass(XRFrame, [{
    key: 'getDevicePose',
    value: function getDevicePose(coordinateSystem) {
      this[PRIVATE$6].devicePose.updateFromFrameOfReference(coordinateSystem);
      return this[PRIVATE$6].devicePose;
    }
  }, {
    key: 'getInputPose',
    value: function getInputPose(inputSource, coordinateSystem) {
      return this[PRIVATE$6].polyfill.getInputPose(inputSource, coordinateSystem);
    }
  }, {
    key: 'session',
    get: function get$$1() {
      return this[PRIVATE$6].session;
    }
  }, {
    key: 'views',
    get: function get$$1() {
      return this[PRIVATE$6].views;
    }
  }]);
  return XRFrame;
}();

var PRIVATE$7 = Symbol('@@webxr-polyfill/XRStageBoundsPoint');
var XRStageBoundsPoint = function () {
  function XRStageBoundsPoint(x, z) {
    classCallCheck(this, XRStageBoundsPoint);
    this[PRIVATE$7] = { x: x, z: z };
  }
  createClass(XRStageBoundsPoint, [{
    key: 'x',
    get: function get$$1() {
      return this[PRIVATE$7].x;
    }
  }, {
    key: 'z',
    get: function get$$1() {
      return this[PRIVATE$7].z;
    }
  }]);
  return XRStageBoundsPoint;
}();

var PRIVATE$8 = Symbol('@@webxr-polyfill/XRStageBounds');
var XRStageBounds = function () {
  function XRStageBounds(boundsData) {
    classCallCheck(this, XRStageBounds);
    var geometry = [];
    for (var i = 0; i < boundsData.length; i += 2) {
      geometry.push(new XRStageBoundsPoint(boundsData[i], boundsData[i + 1]));
    }
    this[PRIVATE$8] = { geometry: geometry };
  }
  createClass(XRStageBounds, [{
    key: 'geometry',
    get: function get$$1() {
      return this[PRIVATE$8].geometry;
    }
  }]);
  return XRStageBounds;
}();

var XRCoordinateSystem = function () {
  function XRCoordinateSystem() {
    classCallCheck(this, XRCoordinateSystem);
  }
  createClass(XRCoordinateSystem, [{
    key: 'getTransformTo',
    value: function getTransformTo(other) {
      throw new Error('Not yet supported');
    }
  }]);
  return XRCoordinateSystem;
}();

var DEFAULT_EMULATION_HEIGHT = 1.6;
var PRIVATE$9 = Symbol('@@webxr-polyfill/XRFrameOfReference');
var XRFrameOfReferenceTypes = ['head-model', 'eye-level', 'stage'];
var XRFrameOfReferenceOptions = Object.freeze({
  disableStageEmulation: false,
  stageEmulationHeight: 0
});
var XRFrameOfReference = function (_XRCoordinateSystem) {
  inherits(XRFrameOfReference, _XRCoordinateSystem);
  function XRFrameOfReference(polyfill, type, options, transform, bounds) {
    classCallCheck(this, XRFrameOfReference);
    options = Object.assign({}, XRFrameOfReferenceOptions, options);
    if (!XRFrameOfReferenceTypes.includes(type)) {
      throw new Error('XRFrameOfReferenceType must be one of ' + XRFrameOfReferenceTypes);
    }
    var _this = possibleConstructorReturn(this, (XRFrameOfReference.__proto__ || Object.getPrototypeOf(XRFrameOfReference)).call(this));
    if (type === 'stage' && options.disableStageEmulation && !transform) {
      throw new Error('XRFrameOfReference cannot use \'stage\' type, if disabling emulation and platform does not provide');
    }
    var _options = options,
        disableStageEmulation = _options.disableStageEmulation,
        stageEmulationHeight = _options.stageEmulationHeight;
    var emulatedHeight = 0;
    if (type === 'stage' && !transform) {
      emulatedHeight = stageEmulationHeight !== 0 ? stageEmulationHeight : DEFAULT_EMULATION_HEIGHT;
    }
    if (type === 'stage' && !transform) {
      transform = identity(new Float32Array(16));
      transform[13] = emulatedHeight;
    }
    _this[PRIVATE$9] = {
      disableStageEmulation: disableStageEmulation,
      stageEmulationHeight: stageEmulationHeight,
      emulatedHeight: emulatedHeight,
      type: type,
      transform: transform,
      polyfill: polyfill,
      bounds: bounds
    };
    _this.onboundschange = undefined;
    return _this;
  }
  createClass(XRFrameOfReference, [{
    key: 'transformBasePoseMatrix',
    value: function transformBasePoseMatrix(out, pose) {
      if (this[PRIVATE$9].transform) {
        multiply(out, this[PRIVATE$9].transform, pose);
        return;
      }
      switch (this.type) {
        case 'head-model':
          if (out !== pose) {
            copy(out, pose);
          }
          out[12] = out[13] = out[14] = 0;
          return;
        case 'eye-level':
          if (out !== pose) {
            copy(out, pose);
          }
          return;
      }
    }
  }, {
    key: 'transformBaseViewMatrix',
    value: function transformBaseViewMatrix(out, view) {
      var frameOfRef = this[PRIVATE$9].transform;
      if (frameOfRef) {
        invert(out, frameOfRef);
        multiply(out, view, out);
      }
      else if (this.type === 'head-model') {
          invert(out, view);
          out[12] = 0;
          out[13] = 0;
          out[14] = 0;
          invert(out, out);
          return out;
        }
        else {
            copy(out, view);
          }
      return out;
    }
  }, {
    key: 'bounds',
    get: function get$$1() {
      return this[PRIVATE$9].bounds;
    }
  }, {
    key: 'emulatedHeight',
    get: function get$$1() {
      return this[PRIVATE$9].emulatedHeight;
    }
  }, {
    key: 'type',
    get: function get$$1() {
      return this[PRIVATE$9].type;
    }
  }]);
  return XRFrameOfReference;
}(XRCoordinateSystem);

var PRIVATE$10 = Symbol('@@webxr-polyfill/XRSession');
var XRSessionCreationOptions = Object.freeze({
  immersive: false,
  outputContext: undefined
});
var validateSessionOptions = function validateSessionOptions(options) {
  var immersive = options.immersive,
      outputContext = options.outputContext;
  if (!immersive && !outputContext) {
    return false;
  }
  if (outputContext !== undefined && !(outputContext instanceof XRPresentationContext)) {
    return false;
  }
  return true;
};
var XRSession = function (_EventTarget) {
  inherits(XRSession, _EventTarget);
  function XRSession(polyfill, device, sessionOptions, id) {
    classCallCheck(this, XRSession);
    sessionOptions = Object.assign({}, XRSessionCreationOptions, sessionOptions);
    var _this = possibleConstructorReturn(this, (XRSession.__proto__ || Object.getPrototypeOf(XRSession)).call(this));
    var _sessionOptions = sessionOptions,
        immersive = _sessionOptions.immersive,
        outputContext = _sessionOptions.outputContext;
    _this[PRIVATE$10] = {
      polyfill: polyfill,
      device: device,
      immersive: immersive,
      outputContext: outputContext,
      ended: false,
      suspended: false,
      suspendedCallback: null,
      id: id
    };
    var frame = new XRFrame(polyfill, _this, _this[PRIVATE$10].id);
    _this[PRIVATE$10].frame = frame;
    _this[PRIVATE$10].onPresentationEnd = function (sessionId) {
      if (sessionId !== _this[PRIVATE$10].id) {
        _this[PRIVATE$10].suspended = false;
        _this.dispatchEvent('focus', { session: _this });
        var suspendedCallback = _this[PRIVATE$10].suspendedCallback;
        _this[PRIVATE$10].suspendedCallback = null;
        if (suspendedCallback) {
          _this.requestAnimationFrame(suspendedCallback);
        }
        return;
      }
      _this[PRIVATE$10].ended = true;
      polyfill.removeEventListener('@webvr-polyfill/vr-present-end', _this[PRIVATE$10].onPresentationEnd);
      polyfill.removeEventListener('@webvr-polyfill/vr-present-start', _this[PRIVATE$10].onPresentationStart);
      polyfill.removeEventListener('@@webvr-polyfill/input-select-start', _this[PRIVATE$10].onSelectStart);
      polyfill.removeEventListener('@@webvr-polyfill/input-select-end', _this[PRIVATE$10].onSelectEnd);
      _this.dispatchEvent('end', { session: _this });
    };
    polyfill.addEventListener('@@webxr-polyfill/vr-present-end', _this[PRIVATE$10].onPresentationEnd);
    _this[PRIVATE$10].onPresentationStart = function (sessionId) {
      if (sessionId === _this[PRIVATE$10].id) {
        return;
      }
      _this[PRIVATE$10].suspended = true;
      _this.dispatchEvent('blur', { session: _this });
    };
    polyfill.addEventListener('@@webxr-polyfill/vr-present-start', _this[PRIVATE$10].onPresentationStart);
    _this[PRIVATE$10].onSelectStart = function (evt) {
      if (evt.sessionId !== _this[PRIVATE$10].id) {
        return;
      }
      _this.dispatchEvent('selectstart', {
        frame: _this[PRIVATE$10].frame,
        inputSource: evt.inputSource
      });
    };
    polyfill.addEventListener('@@webxr-polyfill/input-select-start', _this[PRIVATE$10].onSelectStart);
    _this[PRIVATE$10].onSelectEnd = function (evt) {
      if (evt.sessionId !== _this[PRIVATE$10].id) {
        return;
      }
      _this.dispatchEvent('selectend', {
        frame: _this[PRIVATE$10].frame,
        inputSource: evt.inputSource
      });
      _this.dispatchEvent('select', {
        frame: _this[PRIVATE$10].frame,
        inputSource: evt.inputSource
      });
    };
    polyfill.addEventListener('@@webxr-polyfill/input-select-end', _this[PRIVATE$10].onSelectEnd);
    _this.onblur = undefined;
    _this.onfocus = undefined;
    _this.onresetpose = undefined;
    _this.onend = undefined;
    _this.onselect = undefined;
    _this.onselectstart = undefined;
    _this.onselectend = undefined;
    return _this;
  }
  createClass(XRSession, [{
    key: 'requestFrameOfReference',
    value: function requestFrameOfReference(type) {
      var $args = arguments;return new Promise(function ($return, $error) {
        var options, transform, bounds;
        options = $args.length > 1 && $args[1] !== undefined ? $args[1] : {};
        if (this[PRIVATE$10].ended) {
          return $return();
        }
        options = Object.assign({}, XRFrameOfReferenceOptions, options);
        if (!XRFrameOfReferenceTypes.includes(type)) {
          return $error(new TypeError('XRFrameOfReferenceType must be one of ' + XRFrameOfReferenceTypes));
        }
        transform = null;
        bounds = null;
        var $Try_1_Post = function () {
          try {
            if (type === 'stage' && transform) {
              bounds = this[PRIVATE$10].polyfill.requestStageBounds();
              if (bounds) {
                bounds = new XRStageBounds(bounds);
              }
            }
            return $return(new XRFrameOfReference(this[PRIVATE$10].polyfill, type, options, transform, bounds));
          } catch ($boundEx) {
            return $error($boundEx);
          }
        }.bind(this);var $Try_1_Catch = function (e) {
          try {
            if (type !== 'stage' || options.disableStageEmulation) {
              throw e;
            }
            return $Try_1_Post();
          } catch ($boundEx) {
            return $error($boundEx);
          }
        }.bind(this);
        try {
          return Promise.resolve(this[PRIVATE$10].polyfill.requestFrameOfReferenceTransform(type, options)).then(function ($await_2) {
            try {
              transform = $await_2;
              return $Try_1_Post();
            } catch ($boundEx) {
              return $Try_1_Catch($boundEx);
            }
          }.bind(this), $Try_1_Catch);
        } catch (e) {
          $Try_1_Catch(e);
        }
      }.bind(this));
    }
  }, {
    key: 'requestAnimationFrame',
    value: function requestAnimationFrame(callback) {
      var _this2 = this;
      if (this[PRIVATE$10].ended) {
        return;
      }
      if (this[PRIVATE$10].suspended && this[PRIVATE$10].suspendedCallback) {
        return;
      }
      if (this[PRIVATE$10].suspended && !this[PRIVATE$10].suspendedCallback) {
        this[PRIVATE$10].suspendedCallback = callback;
      }
      return this[PRIVATE$10].polyfill.requestAnimationFrame(function () {
        _this2[PRIVATE$10].polyfill.onFrameStart(_this2[PRIVATE$10].id);
        callback(now$1(), _this2[PRIVATE$10].frame);
        _this2[PRIVATE$10].polyfill.onFrameEnd(_this2[PRIVATE$10].id);
      });
    }
  }, {
    key: 'cancelAnimationFrame',
    value: function cancelAnimationFrame(handle) {
      if (this[PRIVATE$10].ended) {
        return;
      }
      this[PRIVATE$10].polyfill.cancelAnimationFrame(handle);
    }
  }, {
    key: 'getInputSources',
    value: function getInputSources() {
      return this[PRIVATE$10].polyfill.getInputSources();
    }
  }, {
    key: 'end',
    value: function end() {
      return new Promise(function ($return, $error) {
        if (this[PRIVATE$10].ended) {
          return $return();
        }
        if (!this.immersive) {
          this[PRIVATE$10].ended = true;
          this[PRIVATE$10].polyfill.removeEventListener('@@webvr-polyfill/vr-present-start', this[PRIVATE$10].onPresentationStart);
          this[PRIVATE$10].polyfill.removeEventListener('@@webvr-polyfill/vr-present-end', this[PRIVATE$10].onPresentationEnd);
          this[PRIVATE$10].polyfill.removeEventListener('@@webvr-polyfill/input-select-start', this[PRIVATE$10].onSelectStart);
          this[PRIVATE$10].polyfill.removeEventListener('@@webvr-polyfill/input-select-end', this[PRIVATE$10].onSelectEnd);
          this.dispatchEvent('end', { session: this });
        }
        return $return(this[PRIVATE$10].polyfill.endSession(this[PRIVATE$10].id));
      }.bind(this));
    }
  }, {
    key: 'device',
    get: function get$$1() {
      return this[PRIVATE$10].device;
    }
  }, {
    key: 'immersive',
    get: function get$$1() {
      return this[PRIVATE$10].immersive;
    }
  }, {
    key: 'outputContext',
    get: function get$$1() {
      return this[PRIVATE$10].outputContext;
    }
  }, {
    key: 'depthNear',
    get: function get$$1() {
      return this[PRIVATE$10].polyfill.depthNear;
    }
    ,
    set: function set$$1(value) {
      this[PRIVATE$10].polyfill.depthNear = value;
    }
  }, {
    key: 'depthFar',
    get: function get$$1() {
      return this[PRIVATE$10].polyfill.depthFar;
    }
    ,
    set: function set$$1(value) {
      this[PRIVATE$10].polyfill.depthFar = value;
    }
  }, {
    key: 'environmentBlendMode',
    get: function get$$1() {
      return this[PRIVATE$10].polyfill.environmentBlendMode || 'opaque';
    }
  }, {
    key: 'baseLayer',
    get: function get$$1() {
      return this[PRIVATE$10].baseLayer;
    }
    ,
    set: function set$$1(value) {
      if (this[PRIVATE$10].ended) {
        return;
      }
      this[PRIVATE$10].baseLayer = value;
      this[PRIVATE$10].polyfill.onBaseLayerSet(this[PRIVATE$10].id, value);
    }
  }]);
  return XRSession;
}(EventTarget);

var PRIVATE$11 = Symbol('@@webxr-polyfill/XRDevice');
var XRDevice = function (_EventTarget) {
  inherits(XRDevice, _EventTarget);
  function XRDevice(polyfill) {
    classCallCheck(this, XRDevice);
    if (!polyfill) {
      throw new Error('XRDevice must receive a PolyfilledXRDevice.');
    }
    var _this = possibleConstructorReturn(this, (XRDevice.__proto__ || Object.getPrototypeOf(XRDevice)).call(this));
    _this[PRIVATE$11] = {
      polyfill: polyfill,
      immersiveSession: null,
      nonImmersiveSessions: new Set()
    };
    _this.ondeactive = undefined;
    return _this;
  }
  createClass(XRDevice, [{
    key: 'supportsSession',
    value: function supportsSession() {
      var $args = arguments;return new Promise(function ($return, $error) {
        var sessionOptions = $args.length > 0 && $args[0] !== undefined ? $args[0] : {};
        sessionOptions = Object.assign({}, XRSessionCreationOptions, sessionOptions);
        if (!validateSessionOptions(sessionOptions)) {
          return $return(Promise.reject(null));
        }
        if (!this[PRIVATE$11].polyfill.supportsSession(sessionOptions)) {
          return $return(Promise.reject(null));
        }
        return $return(null);
      }.bind(this));
    }
  }, {
    key: 'requestSession',
    value: function requestSession(sessionOptions) {
      return new Promise(function ($return, $error) {
        var _this2, sessionId, session, onSessionEnd;
        _this2 = this;
        sessionOptions = Object.assign({}, XRSessionCreationOptions, sessionOptions);
        if (!validateSessionOptions(sessionOptions)) {
          return $error(new Error('NotSupportedError'));
        }
        if (this[PRIVATE$11].immersiveSession && sessionOptions.immersive) {
          return $error(new Error('InvalidStateError'));
        }
        return Promise.resolve(this[PRIVATE$11].polyfill.requestSession(sessionOptions)).then(function ($await_1) {
          try {
            sessionId = $await_1;
            session = new XRSession(this[PRIVATE$11].polyfill, this, sessionOptions, sessionId);
            if (sessionOptions.immersive) {
              this[PRIVATE$11].immersiveSession = session;
            } else {
              this[PRIVATE$11].nonImmersiveSessions.add(session);
            }
            onSessionEnd = function onSessionEnd() {
              if (session.immersive) {
                _this2[PRIVATE$11].immersiveSession = null;
              } else {
                _this2[PRIVATE$11].nonImmersiveSessions.delete(session);
              }
              session.removeEventListener('end', onSessionEnd);
            };
            session.addEventListener('end', onSessionEnd);
            return $return(session);
          } catch ($boundEx) {
            return $error($boundEx);
          }
        }.bind(this), $error);
      }.bind(this));
    }
  }]);
  return XRDevice;
}(EventTarget);

var domPointROExport = 'DOMPointReadOnly' in _global ? DOMPointReadOnly : null;
if (!domPointROExport) {
  var PRIVATE$12 = Symbol('@@webxr-polyfill/DOMPointReadOnly');
  domPointROExport = function () {
    function DOMPointReadOnly(x, y, z, w) {
      classCallCheck(this, DOMPointReadOnly);
      if (arguments.length === 1) {
        this[PRIVATE$12] = {
          x: x.x,
          y: x.y,
          z: x.z,
          w: x.w
        };
      } else if (arguments.length === 4) {
        this[PRIVATE$12] = {
          x: x,
          y: y,
          z: z,
          w: w
        };
      } else {
        throw new TypeError('Must supply either 1 or 4 arguments');
      }
    }
    createClass(DOMPointReadOnly, [{
      key: 'x',
      get: function get$$1() {
        return this[PRIVATE$12].x;
      }
    }, {
      key: 'y',
      get: function get$$1() {
        return this[PRIVATE$12].y;
      }
    }, {
      key: 'z',
      get: function get$$1() {
        return this[PRIVATE$12].z;
      }
    }, {
      key: 'w',
      get: function get$$1() {
        return this[PRIVATE$12].w;
      }
    }]);
    return DOMPointReadOnly;
  }();
}
var DOMPointReadOnly$1 = domPointROExport;

var XRRay =
function XRRay() {
  var origin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : new DOMPointReadOnly$1(0, 0, 0, 1);
  var direction = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : new DOMPointReadOnly$1(0, 0, -1, 0);
  var transformMatrix = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : new Float32Array(16);
  classCallCheck(this, XRRay);
  if (!(origin instanceof DOMPointReadOnly$1)) {
    throw new Error('origin must be a DOMPointReadOnly');
  }
  if (!(direction instanceof DOMPointReadOnly$1)) {
    throw new Error('direction must be a DOMPointReadOnly');
  }
  if (!(transformMatrix instanceof Float32Array)) {
    throw new Error('transformMatrix must be a Float32Array');
  }
  Object.defineProperties(this, {
    origin: {
      value: origin,
      writable: false
    },
    direction: {
      value: direction,
      writable: false
    },
    transformMatrix: {
      value: transformMatrix,
      writable: false
    }
  });
};

var PRIVATE$13 = Symbol('@@webxr-polyfill/XRInputPose');
var XRInputPose = function () {
  function XRInputPose(inputSourceImpl, hasGripMatrix) {
    classCallCheck(this, XRInputPose);
    this[PRIVATE$13] = {
      inputSourceImpl: inputSourceImpl,
      targetRay: new XRRay(),
      gripMatrix: hasGripMatrix ? create() : null
    };
  }
  createClass(XRInputPose, [{
    key: 'targetRay',
    get: function get$$1() {
      return this[PRIVATE$13].targetRay;
    }
    ,
    set: function set$$1(value) {
      this[PRIVATE$13].targetRay = value;
    }
  }, {
    key: 'emulatedPosition',
    get: function get$$1() {
      return this[PRIVATE$13].inputSourceImpl.emulatedPosition;
    }
  }, {
    key: 'gripMatrix',
    get: function get$$1() {
      return this[PRIVATE$13].gripMatrix;
    }
  }]);
  return XRInputPose;
}();

var PRIVATE$14 = Symbol('@@webxr-polyfill/XRInputSource');
var XRInputSource = function () {
  function XRInputSource(impl) {
    classCallCheck(this, XRInputSource);
    this[PRIVATE$14] = {
      impl: impl
    };
  }
  createClass(XRInputSource, [{
    key: 'handedness',
    get: function get$$1() {
      return this[PRIVATE$14].impl.handedness;
    }
  }, {
    key: 'targetRayMode',
    get: function get$$1() {
      return this[PRIVATE$14].impl.targetRayMode;
    }
  }]);
  return XRInputSource;
}();

var XRLayer = function () {
  function XRLayer() {
    classCallCheck(this, XRLayer);
  }
  createClass(XRLayer, [{
    key: "getViewport",
    value: function getViewport(view) {
      return view._getViewport(this);
    }
  }]);
  return XRLayer;
}();

var POLYFILLED_COMPATIBLE_XR_DEVICE = Symbol('@@webxr-polyfill/polyfilled-compatible-xr-device');
var COMPATIBLE_XR_DEVICE = Symbol('@@webxr-polyfill/compatible-xr-device');

var PRIVATE$15 = Symbol('@@webxr-polyfill/XRWebGLLayer');
var XRWebGLLayerInit = Object.freeze({
  antialias: true,
  depth: false,
  stencil: false,
  alpha: true,
  multiview: false,
  framebufferScaleFactor: 0
});
var XRWebGLLayer = function (_XRLayer) {
  inherits(XRWebGLLayer, _XRLayer);
  function XRWebGLLayer(session, context) {
    var layerInit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    classCallCheck(this, XRWebGLLayer);
    var config = Object.assign({}, XRWebGLLayerInit, layerInit);
    if (!(session instanceof XRSession)) {
      throw new Error('session must be a XRSession');
    }
    if (session.ended) {
      throw new Error('InvalidStateError');
    }
    if (context[POLYFILLED_COMPATIBLE_XR_DEVICE]) {
      if (context[COMPATIBLE_XR_DEVICE] !== session.device) {
        throw new Error('InvalidStateError');
      }
    }
    var framebuffer = context.getParameter(context.FRAMEBUFFER_BINDING);
    var _this = possibleConstructorReturn(this, (XRWebGLLayer.__proto__ || Object.getPrototypeOf(XRWebGLLayer)).call(this));
    _this[PRIVATE$15] = {
      context: context,
      config: config,
      framebuffer: framebuffer
    };
    return _this;
  }
  createClass(XRWebGLLayer, [{
    key: 'requestViewportScaling',
    value: function requestViewportScaling(viewportScaleFactor) {
      console.warn('requestViewportScaling is not yet implemented');
    }
  }, {
    key: 'context',
    get: function get$$1() {
      return this[PRIVATE$15].context;
    }
  }, {
    key: 'antialias',
    get: function get$$1() {
      return this[PRIVATE$15].config.antialias;
    }
  }, {
    key: 'depth',
    get: function get$$1() {
      return this[PRIVATE$15].config.depth;
    }
  }, {
    key: 'stencil',
    get: function get$$1() {
      return this[PRIVATE$15].config.stencil;
    }
  }, {
    key: 'alpha',
    get: function get$$1() {
      return this[PRIVATE$15].config.alpha;
    }
  }, {
    key: 'multiview',
    get: function get$$1() {
      return false;
    }
  }, {
    key: 'framebuffer',
    get: function get$$1() {
      return this[PRIVATE$15].framebuffer;
    }
  }, {
    key: 'framebufferWidth',
    get: function get$$1() {
      return this[PRIVATE$15].context.drawingBufferWidth;
    }
  }, {
    key: 'framebufferHeight',
    get: function get$$1() {
      return this[PRIVATE$15].context.drawingBufferHeight;
    }
  }]);
  return XRWebGLLayer;
}(XRLayer);

var API = {
  XR: XR,
  XRDevice: XRDevice,
  XRSession: XRSession,
  XRFrame: XRFrame,
  XRView: XRView,
  XRViewport: XRViewport,
  XRDevicePose: XRDevicePose,
  XRLayer: XRLayer,
  XRWebGLLayer: XRWebGLLayer,
  XRPresentationContext: XRPresentationContext,
  XRCoordinateSystem: XRCoordinateSystem,
  XRFrameOfReference: XRFrameOfReference,
  XRStageBounds: XRStageBounds,
  XRStageBoundsPoint: XRStageBoundsPoint,
  XRInputPose: XRInputPose,
  XRInputSource: XRInputSource,
  XRRay: XRRay
};

var extendContextCompatibleXRDevice = function extendContextCompatibleXRDevice(Context) {
  if (typeof Context.prototype.setCompatibleXRDevice === 'function') {
    return false;
  }
  Context.prototype.setCompatibleXRDevice = function (xrDevice) {
    var _this = this;
    return new Promise(function (resolve, reject) {
      if (xrDevice && typeof xrDevice.requestSession === 'function') {
        resolve();
      } else {
        reject();
      }
    }).then(function () {
      return _this[COMPATIBLE_XR_DEVICE] = xrDevice;
    });
  };
  return true;
};
var extendGetContext = function extendGetContext(Canvas) {
  var getContext = HTMLCanvasElement.prototype.getContext;
  HTMLCanvasElement.prototype.getContext = function (contextType, glAttribs) {
    if (contextType === 'xrpresent') {
      var _ctx = getContext.call(this, '2d', glAttribs);
      return new XRPresentationContext(this, _ctx, glAttribs);
    }
    var ctx = getContext.call(this, contextType, glAttribs);
    ctx[POLYFILLED_COMPATIBLE_XR_DEVICE] = true;
    if (glAttribs && 'compatibleXRDevice' in glAttribs) {
      ctx[COMPATIBLE_XR_DEVICE] = glAttribs.compatibleXRDevice;
    }
    return ctx;
  };
};

function create$1() {
  var out = new ARRAY_TYPE(3);
  out[0] = 0;
  out[1] = 0;
  out[2] = 0;
  return out;
}
function clone$1(a) {
  var out = new ARRAY_TYPE(3);
  out[0] = a[0];
  out[1] = a[1];
  out[2] = a[2];
  return out;
}
function length(a) {
  var x = a[0];
  var y = a[1];
  var z = a[2];
  return Math.sqrt(x * x + y * y + z * z);
}
function fromValues$1(x, y, z) {
  var out = new ARRAY_TYPE(3);
  out[0] = x;
  out[1] = y;
  out[2] = z;
  return out;
}
function copy$1(out, a) {
  out[0] = a[0];
  out[1] = a[1];
  out[2] = a[2];
  return out;
}
function set$2(out, x, y, z) {
  out[0] = x;
  out[1] = y;
  out[2] = z;
  return out;
}
function add$1(out, a, b) {
  out[0] = a[0] + b[0];
  out[1] = a[1] + b[1];
  out[2] = a[2] + b[2];
  return out;
}
function subtract$1(out, a, b) {
  out[0] = a[0] - b[0];
  out[1] = a[1] - b[1];
  out[2] = a[2] - b[2];
  return out;
}







function scale$1(out, a, b) {
  out[0] = a[0] * b;
  out[1] = a[1] * b;
  out[2] = a[2] * b;
  return out;
}






function normalize(out, a) {
  var x = a[0];
  var y = a[1];
  var z = a[2];
  var len = x * x + y * y + z * z;
  if (len > 0) {
    len = 1 / Math.sqrt(len);
    out[0] = a[0] * len;
    out[1] = a[1] * len;
    out[2] = a[2] * len;
  }
  return out;
}
function dot(a, b) {
  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];
}
function cross(out, a, b) {
  var ax = a[0],
      ay = a[1],
      az = a[2];
  var bx = b[0],
      by = b[1],
      bz = b[2];
  out[0] = ay * bz - az * by;
  out[1] = az * bx - ax * bz;
  out[2] = ax * by - ay * bx;
  return out;
}




function transformMat4(out, a, m) {
  var x = a[0],
      y = a[1],
      z = a[2];
  var w = m[3] * x + m[7] * y + m[11] * z + m[15];
  w = w || 1.0;
  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;
  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;
  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;
  return out;
}

function transformQuat(out, a, q) {
  var qx = q[0],
      qy = q[1],
      qz = q[2],
      qw = q[3];
  var x = a[0],
      y = a[1],
      z = a[2];
  var uvx = qy * z - qz * y,
      uvy = qz * x - qx * z,
      uvz = qx * y - qy * x;
  var uuvx = qy * uvz - qz * uvy,
      uuvy = qz * uvx - qx * uvz,
      uuvz = qx * uvy - qy * uvx;
  var w2 = qw * 2;
  uvx *= w2;
  uvy *= w2;
  uvz *= w2;
  uuvx *= 2;
  uuvy *= 2;
  uuvz *= 2;
  out[0] = x + uvx + uuvx;
  out[1] = y + uvy + uuvy;
  out[2] = z + uvz + uuvz;
  return out;
}



function angle(a, b) {
  var tempA = fromValues$1(a[0], a[1], a[2]);
  var tempB = fromValues$1(b[0], b[1], b[2]);
  normalize(tempA, tempA);
  normalize(tempB, tempB);
  var cosine = dot(tempA, tempB);
  if (cosine > 1.0) {
    return 0;
  } else if (cosine < -1.0) {
    return Math.PI;
  } else {
    return Math.acos(cosine);
  }
}



var sub$1 = subtract$1;




var len = length;

var forEach = function () {
  var vec = create$1();
  return function (a, stride, offset, count, fn, arg) {
    var i = void 0,
        l = void 0;
    if (!stride) {
      stride = 3;
    }
    if (!offset) {
      offset = 0;
    }
    if (count) {
      l = Math.min(count * stride + offset, a.length);
    } else {
      l = a.length;
    }
    for (i = offset; i < l; i += stride) {
      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];
      fn(vec, vec, arg);
      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];
    }
    return a;
  };
}();

var poseMatrixToXRRay = function poseMatrixToXRRay(poseMatrix) {
  var rayOrigin = [];
  var rayDirection = [];
  set$2(rayOrigin, 0, 0, 0);
  transformMat4(rayOrigin, rayOrigin, poseMatrix);
  set$2(rayDirection, 0, 0, -1);
  transformMat4(rayDirection, rayDirection, poseMatrix);
  sub$1(rayDirection, rayDirection, rayOrigin);
  normalize(rayDirection, rayDirection);
  return new XRRay(new DOMPointReadOnly$1(rayOrigin[0], rayOrigin[1], rayOrigin[2], 1.0), new DOMPointReadOnly$1(rayDirection[0], rayDirection[1], rayDirection[2], 0.0), poseMatrix);
};
var isMobile = function isMobile(global) {
  var check = false;
  (function (a) {
    if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
  })(global.navigator.userAgent || global.navigator.vendor || global.opera);
  return check;
};
var applyCanvasStylesForMinimalRendering = function applyCanvasStylesForMinimalRendering(canvas) {
  canvas.style.display = 'block';
  canvas.style.position = 'absolute';
  canvas.style.width = canvas.style.height = '1px';
  canvas.style.top = canvas.style.left = '0px';
};

var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};



function unwrapExports (x) {
  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
}

function createCommonjsModule(fn, module) {
  return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var cardboardVrDisplay = createCommonjsModule(function (module, exports) {
(function (global, factory) {
  module.exports = factory();
}(commonjsGlobal, (function () { var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};
var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }
  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();
var slicedToArray = function () {
  function sliceIterator(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;
    try {
      for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);
        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i["return"]) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }
    return _arr;
  }
  return function (arr, i) {
    if (Array.isArray(arr)) {
      return arr;
    } else if (Symbol.iterator in Object(arr)) {
      return sliceIterator(arr, i);
    } else {
      throw new TypeError("Invalid attempt to destructure non-iterable instance");
    }
  };
}();
var MIN_TIMESTEP = 0.001;
var MAX_TIMESTEP = 1;
var base64 = function base64(mimeType, _base) {
  return 'data:' + mimeType + ';base64,' + _base;
};
var lerp = function lerp(a, b, t) {
  return a + (b - a) * t;
};
var isIOS = function () {
  var isIOS = /iPad|iPhone|iPod/.test(navigator.platform);
  return function () {
    return isIOS;
  };
}();
var isWebViewAndroid = function () {
  var isWebViewAndroid = navigator.userAgent.indexOf('Version') !== -1 && navigator.userAgent.indexOf('Android') !== -1 && navigator.userAgent.indexOf('Chrome') !== -1;
  return function () {
    return isWebViewAndroid;
  };
}();
var isSafari = function () {
  var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  return function () {
    return isSafari;
  };
}();
var isFirefoxAndroid = function () {
  var isFirefoxAndroid = navigator.userAgent.indexOf('Firefox') !== -1 && navigator.userAgent.indexOf('Android') !== -1;
  return function () {
    return isFirefoxAndroid;
  };
}();
var getChromeVersion = function () {
  var match = navigator.userAgent.match(/.*Chrome\/([0-9]+)/);
  var value = match ? parseInt(match[1], 10) : null;
  return function () {
    return value;
  };
}();
var isChromeWithoutDeviceMotion = function () {
  var value = false;
  if (getChromeVersion() === 65) {
    var match = navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);
    if (match) {
      var _match$1$split = match[1].split('.'),
          _match$1$split2 = slicedToArray(_match$1$split, 4),
          major = _match$1$split2[0],
          minor = _match$1$split2[1],
          branch = _match$1$split2[2],
          build = _match$1$split2[3];
      value = parseInt(branch, 10) === 3325 && parseInt(build, 10) < 148;
    }
  }
  return function () {
    return value;
  };
}();
var isR7 = function () {
  var isR7 = navigator.userAgent.indexOf('R7 Build') !== -1;
  return function () {
    return isR7;
  };
}();
var isLandscapeMode = function isLandscapeMode() {
  var rtn = window.orientation == 90 || window.orientation == -90;
  return isR7() ? !rtn : rtn;
};
var isTimestampDeltaValid = function isTimestampDeltaValid(timestampDeltaS) {
  if (isNaN(timestampDeltaS)) {
    return false;
  }
  if (timestampDeltaS <= MIN_TIMESTEP) {
    return false;
  }
  if (timestampDeltaS > MAX_TIMESTEP) {
    return false;
  }
  return true;
};
var getScreenWidth = function getScreenWidth() {
  return Math.max(window.screen.width, window.screen.height) * window.devicePixelRatio;
};
var getScreenHeight = function getScreenHeight() {
  return Math.min(window.screen.width, window.screen.height) * window.devicePixelRatio;
};
var requestFullscreen = function requestFullscreen(element) {
  if (isWebViewAndroid()) {
    return false;
  }
  if (element.requestFullscreen) {
    element.requestFullscreen();
  } else if (element.webkitRequestFullscreen) {
    element.webkitRequestFullscreen();
  } else if (element.mozRequestFullScreen) {
    element.mozRequestFullScreen();
  } else if (element.msRequestFullscreen) {
    element.msRequestFullscreen();
  } else {
    return false;
  }
  return true;
};
var exitFullscreen = function exitFullscreen() {
  if (document.exitFullscreen) {
    document.exitFullscreen();
  } else if (document.webkitExitFullscreen) {
    document.webkitExitFullscreen();
  } else if (document.mozCancelFullScreen) {
    document.mozCancelFullScreen();
  } else if (document.msExitFullscreen) {
    document.msExitFullscreen();
  } else {
    return false;
  }
  return true;
};
var getFullscreenElement = function getFullscreenElement() {
  return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
};
var linkProgram = function linkProgram(gl, vertexSource, fragmentSource, attribLocationMap) {
  var vertexShader = gl.createShader(gl.VERTEX_SHADER);
  gl.shaderSource(vertexShader, vertexSource);
  gl.compileShader(vertexShader);
  var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);
  gl.shaderSource(fragmentShader, fragmentSource);
  gl.compileShader(fragmentShader);
  var program = gl.createProgram();
  gl.attachShader(program, vertexShader);
  gl.attachShader(program, fragmentShader);
  for (var attribName in attribLocationMap) {
    gl.bindAttribLocation(program, attribLocationMap[attribName], attribName);
  }gl.linkProgram(program);
  gl.deleteShader(vertexShader);
  gl.deleteShader(fragmentShader);
  return program;
};
var getProgramUniforms = function getProgramUniforms(gl, program) {
  var uniforms = {};
  var uniformCount = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);
  var uniformName = '';
  for (var i = 0; i < uniformCount; i++) {
    var uniformInfo = gl.getActiveUniform(program, i);
    uniformName = uniformInfo.name.replace('[0]', '');
    uniforms[uniformName] = gl.getUniformLocation(program, uniformName);
  }
  return uniforms;
};
var orthoMatrix = function orthoMatrix(out, left, right, bottom, top, near, far) {
  var lr = 1 / (left - right),
      bt = 1 / (bottom - top),
      nf = 1 / (near - far);
  out[0] = -2 * lr;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  out[4] = 0;
  out[5] = -2 * bt;
  out[6] = 0;
  out[7] = 0;
  out[8] = 0;
  out[9] = 0;
  out[10] = 2 * nf;
  out[11] = 0;
  out[12] = (left + right) * lr;
  out[13] = (top + bottom) * bt;
  out[14] = (far + near) * nf;
  out[15] = 1;
  return out;
};
var isMobile = function isMobile() {
  var check = false;
  (function (a) {
    if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
  })(navigator.userAgent || navigator.vendor || window.opera);
  return check;
};
var extend = function extend(dest, src) {
  for (var key in src) {
    if (src.hasOwnProperty(key)) {
      dest[key] = src[key];
    }
  }
  return dest;
};
var safariCssSizeWorkaround = function safariCssSizeWorkaround(canvas) {
  if (isIOS()) {
    var width = canvas.style.width;
    var height = canvas.style.height;
    canvas.style.width = parseInt(width) + 1 + 'px';
    canvas.style.height = parseInt(height) + 'px';
    setTimeout(function () {
      canvas.style.width = width;
      canvas.style.height = height;
    }, 100);
  }
  window.canvas = canvas;
};
var frameDataFromPose = function () {
  var piOver180 = Math.PI / 180.0;
  var rad45 = Math.PI * 0.25;
  function mat4_perspectiveFromFieldOfView(out, fov, near, far) {
    var upTan = Math.tan(fov ? fov.upDegrees * piOver180 : rad45),
        downTan = Math.tan(fov ? fov.downDegrees * piOver180 : rad45),
        leftTan = Math.tan(fov ? fov.leftDegrees * piOver180 : rad45),
        rightTan = Math.tan(fov ? fov.rightDegrees * piOver180 : rad45),
        xScale = 2.0 / (leftTan + rightTan),
        yScale = 2.0 / (upTan + downTan);
    out[0] = xScale;
    out[1] = 0.0;
    out[2] = 0.0;
    out[3] = 0.0;
    out[4] = 0.0;
    out[5] = yScale;
    out[6] = 0.0;
    out[7] = 0.0;
    out[8] = -((leftTan - rightTan) * xScale * 0.5);
    out[9] = (upTan - downTan) * yScale * 0.5;
    out[10] = far / (near - far);
    out[11] = -1.0;
    out[12] = 0.0;
    out[13] = 0.0;
    out[14] = far * near / (near - far);
    out[15] = 0.0;
    return out;
  }
  function mat4_fromRotationTranslation(out, q, v) {
    var x = q[0],
        y = q[1],
        z = q[2],
        w = q[3],
        x2 = x + x,
        y2 = y + y,
        z2 = z + z,
        xx = x * x2,
        xy = x * y2,
        xz = x * z2,
        yy = y * y2,
        yz = y * z2,
        zz = z * z2,
        wx = w * x2,
        wy = w * y2,
        wz = w * z2;
    out[0] = 1 - (yy + zz);
    out[1] = xy + wz;
    out[2] = xz - wy;
    out[3] = 0;
    out[4] = xy - wz;
    out[5] = 1 - (xx + zz);
    out[6] = yz + wx;
    out[7] = 0;
    out[8] = xz + wy;
    out[9] = yz - wx;
    out[10] = 1 - (xx + yy);
    out[11] = 0;
    out[12] = v[0];
    out[13] = v[1];
    out[14] = v[2];
    out[15] = 1;
    return out;
  }
  function mat4_translate(out, a, v) {
    var x = v[0],
        y = v[1],
        z = v[2],
        a00,
        a01,
        a02,
        a03,
        a10,
        a11,
        a12,
        a13,
        a20,
        a21,
        a22,
        a23;
    if (a === out) {
      out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];
      out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];
      out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];
      out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];
    } else {
      a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];
      a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];
      a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];
      out[0] = a00;out[1] = a01;out[2] = a02;out[3] = a03;
      out[4] = a10;out[5] = a11;out[6] = a12;out[7] = a13;
      out[8] = a20;out[9] = a21;out[10] = a22;out[11] = a23;
      out[12] = a00 * x + a10 * y + a20 * z + a[12];
      out[13] = a01 * x + a11 * y + a21 * z + a[13];
      out[14] = a02 * x + a12 * y + a22 * z + a[14];
      out[15] = a03 * x + a13 * y + a23 * z + a[15];
    }
    return out;
  }
  function mat4_invert(out, a) {
    var a00 = a[0],
        a01 = a[1],
        a02 = a[2],
        a03 = a[3],
        a10 = a[4],
        a11 = a[5],
        a12 = a[6],
        a13 = a[7],
        a20 = a[8],
        a21 = a[9],
        a22 = a[10],
        a23 = a[11],
        a30 = a[12],
        a31 = a[13],
        a32 = a[14],
        a33 = a[15],
        b00 = a00 * a11 - a01 * a10,
        b01 = a00 * a12 - a02 * a10,
        b02 = a00 * a13 - a03 * a10,
        b03 = a01 * a12 - a02 * a11,
        b04 = a01 * a13 - a03 * a11,
        b05 = a02 * a13 - a03 * a12,
        b06 = a20 * a31 - a21 * a30,
        b07 = a20 * a32 - a22 * a30,
        b08 = a20 * a33 - a23 * a30,
        b09 = a21 * a32 - a22 * a31,
        b10 = a21 * a33 - a23 * a31,
        b11 = a22 * a33 - a23 * a32,
    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;
    if (!det) {
      return null;
    }
    det = 1.0 / det;
    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;
    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;
    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;
    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;
    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;
    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;
    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;
    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;
    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;
    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;
    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;
    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;
    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;
    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;
    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;
    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;
    return out;
  }
  var defaultOrientation = new Float32Array([0, 0, 0, 1]);
  var defaultPosition = new Float32Array([0, 0, 0]);
  function updateEyeMatrices(projection, view, pose, fov, offset, vrDisplay) {
    mat4_perspectiveFromFieldOfView(projection, fov || null, vrDisplay.depthNear, vrDisplay.depthFar);
    var orientation = pose.orientation || defaultOrientation;
    var position = pose.position || defaultPosition;
    mat4_fromRotationTranslation(view, orientation, position);
    if (offset) mat4_translate(view, view, offset);
    mat4_invert(view, view);
  }
  return function (frameData, pose, vrDisplay) {
    if (!frameData || !pose) return false;
    frameData.pose = pose;
    frameData.timestamp = pose.timestamp;
    updateEyeMatrices(frameData.leftProjectionMatrix, frameData.leftViewMatrix, pose, vrDisplay._getFieldOfView("left"), vrDisplay._getEyeOffset("left"), vrDisplay);
    updateEyeMatrices(frameData.rightProjectionMatrix, frameData.rightViewMatrix, pose, vrDisplay._getFieldOfView("right"), vrDisplay._getEyeOffset("right"), vrDisplay);
    return true;
  };
}();
var isInsideCrossOriginIFrame = function isInsideCrossOriginIFrame() {
  var isFramed = window.self !== window.top;
  var refOrigin = getOriginFromUrl(document.referrer);
  var thisOrigin = getOriginFromUrl(window.location.href);
  return isFramed && refOrigin !== thisOrigin;
};
var getOriginFromUrl = function getOriginFromUrl(url) {
  var domainIdx;
  var protoSepIdx = url.indexOf("://");
  if (protoSepIdx !== -1) {
    domainIdx = protoSepIdx + 3;
  } else {
    domainIdx = 0;
  }
  var domainEndIdx = url.indexOf('/', domainIdx);
  if (domainEndIdx === -1) {
    domainEndIdx = url.length;
  }
  return url.substring(0, domainEndIdx);
};
var getQuaternionAngle = function getQuaternionAngle(quat) {
  if (quat.w > 1) {
    console.warn('getQuaternionAngle: w > 1');
    return 0;
  }
  var angle = 2 * Math.acos(quat.w);
  return angle;
};
var warnOnce = function () {
  var observedWarnings = {};
  return function (key, message) {
    if (observedWarnings[key] === undefined) {
      console.warn('webvr-polyfill: ' + message);
      observedWarnings[key] = true;
    }
  };
}();
var deprecateWarning = function deprecateWarning(deprecated, suggested) {
  var alternative = suggested ? 'Please use ' + suggested + ' instead.' : '';
  warnOnce(deprecated, deprecated + ' has been deprecated. ' + 'This may not work on native WebVR displays. ' + alternative);
};
function WGLUPreserveGLState(gl, bindings, callback) {
  if (!bindings) {
    callback(gl);
    return;
  }
  var boundValues = [];
  var activeTexture = null;
  for (var i = 0; i < bindings.length; ++i) {
    var binding = bindings[i];
    switch (binding) {
      case gl.TEXTURE_BINDING_2D:
      case gl.TEXTURE_BINDING_CUBE_MAP:
        var textureUnit = bindings[++i];
        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31) {
          console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");
          boundValues.push(null, null);
          break;
        }
        if (!activeTexture) {
          activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);
        }
        gl.activeTexture(textureUnit);
        boundValues.push(gl.getParameter(binding), null);
        break;
      case gl.ACTIVE_TEXTURE:
        activeTexture = gl.getParameter(gl.ACTIVE_TEXTURE);
        boundValues.push(null);
        break;
      default:
        boundValues.push(gl.getParameter(binding));
        break;
    }
  }
  callback(gl);
  for (var i = 0; i < bindings.length; ++i) {
    var binding = bindings[i];
    var boundValue = boundValues[i];
    switch (binding) {
      case gl.ACTIVE_TEXTURE:
        break;
      case gl.ARRAY_BUFFER_BINDING:
        gl.bindBuffer(gl.ARRAY_BUFFER, boundValue);
        break;
      case gl.COLOR_CLEAR_VALUE:
        gl.clearColor(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);
        break;
      case gl.COLOR_WRITEMASK:
        gl.colorMask(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);
        break;
      case gl.CURRENT_PROGRAM:
        gl.useProgram(boundValue);
        break;
      case gl.ELEMENT_ARRAY_BUFFER_BINDING:
        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, boundValue);
        break;
      case gl.FRAMEBUFFER_BINDING:
        gl.bindFramebuffer(gl.FRAMEBUFFER, boundValue);
        break;
      case gl.RENDERBUFFER_BINDING:
        gl.bindRenderbuffer(gl.RENDERBUFFER, boundValue);
        break;
      case gl.TEXTURE_BINDING_2D:
        var textureUnit = bindings[++i];
        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31)
          break;
        gl.activeTexture(textureUnit);
        gl.bindTexture(gl.TEXTURE_2D, boundValue);
        break;
      case gl.TEXTURE_BINDING_CUBE_MAP:
        var textureUnit = bindings[++i];
        if (textureUnit < gl.TEXTURE0 || textureUnit > gl.TEXTURE31)
          break;
        gl.activeTexture(textureUnit);
        gl.bindTexture(gl.TEXTURE_CUBE_MAP, boundValue);
        break;
      case gl.VIEWPORT:
        gl.viewport(boundValue[0], boundValue[1], boundValue[2], boundValue[3]);
        break;
      case gl.BLEND:
      case gl.CULL_FACE:
      case gl.DEPTH_TEST:
      case gl.SCISSOR_TEST:
      case gl.STENCIL_TEST:
        if (boundValue) {
          gl.enable(binding);
        } else {
          gl.disable(binding);
        }
        break;
      default:
        console.log("No GL restore behavior for 0x" + binding.toString(16));
        break;
    }
    if (activeTexture) {
      gl.activeTexture(activeTexture);
    }
  }
}
var glPreserveState = WGLUPreserveGLState;
var distortionVS = ['attribute vec2 position;', 'attribute vec3 texCoord;', 'varying vec2 vTexCoord;', 'uniform vec4 viewportOffsetScale[2];', 'void main() {', '  vec4 viewport = viewportOffsetScale[int(texCoord.z)];', '  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;', '  gl_Position = vec4( position, 1.0, 1.0 );', '}'].join('\n');
var distortionFS = ['precision mediump float;', 'uniform sampler2D diffuse;', 'varying vec2 vTexCoord;', 'void main() {', '  gl_FragColor = texture2D(diffuse, vTexCoord);', '}'].join('\n');
function CardboardDistorter(gl, cardboardUI, bufferScale, dirtySubmitFrameBindings) {
  this.gl = gl;
  this.cardboardUI = cardboardUI;
  this.bufferScale = bufferScale;
  this.dirtySubmitFrameBindings = dirtySubmitFrameBindings;
  this.ctxAttribs = gl.getContextAttributes();
  this.meshWidth = 20;
  this.meshHeight = 20;
  this.bufferWidth = gl.drawingBufferWidth;
  this.bufferHeight = gl.drawingBufferHeight;
  this.realBindFramebuffer = gl.bindFramebuffer;
  this.realEnable = gl.enable;
  this.realDisable = gl.disable;
  this.realColorMask = gl.colorMask;
  this.realClearColor = gl.clearColor;
  this.realViewport = gl.viewport;
  if (!isIOS()) {
    this.realCanvasWidth = Object.getOwnPropertyDescriptor(gl.canvas.__proto__, 'width');
    this.realCanvasHeight = Object.getOwnPropertyDescriptor(gl.canvas.__proto__, 'height');
  }
  this.isPatched = false;
  this.lastBoundFramebuffer = null;
  this.cullFace = false;
  this.depthTest = false;
  this.blend = false;
  this.scissorTest = false;
  this.stencilTest = false;
  this.viewport = [0, 0, 0, 0];
  this.colorMask = [true, true, true, true];
  this.clearColor = [0, 0, 0, 0];
  this.attribs = {
    position: 0,
    texCoord: 1
  };
  this.program = linkProgram(gl, distortionVS, distortionFS, this.attribs);
  this.uniforms = getProgramUniforms(gl, this.program);
  this.viewportOffsetScale = new Float32Array(8);
  this.setTextureBounds();
  this.vertexBuffer = gl.createBuffer();
  this.indexBuffer = gl.createBuffer();
  this.indexCount = 0;
  this.renderTarget = gl.createTexture();
  this.framebuffer = gl.createFramebuffer();
  this.depthStencilBuffer = null;
  this.depthBuffer = null;
  this.stencilBuffer = null;
  if (this.ctxAttribs.depth && this.ctxAttribs.stencil) {
    this.depthStencilBuffer = gl.createRenderbuffer();
  } else if (this.ctxAttribs.depth) {
    this.depthBuffer = gl.createRenderbuffer();
  } else if (this.ctxAttribs.stencil) {
    this.stencilBuffer = gl.createRenderbuffer();
  }
  this.patch();
  this.onResize();
}
CardboardDistorter.prototype.destroy = function () {
  var gl = this.gl;
  this.unpatch();
  gl.deleteProgram(this.program);
  gl.deleteBuffer(this.vertexBuffer);
  gl.deleteBuffer(this.indexBuffer);
  gl.deleteTexture(this.renderTarget);
  gl.deleteFramebuffer(this.framebuffer);
  if (this.depthStencilBuffer) {
    gl.deleteRenderbuffer(this.depthStencilBuffer);
  }
  if (this.depthBuffer) {
    gl.deleteRenderbuffer(this.depthBuffer);
  }
  if (this.stencilBuffer) {
    gl.deleteRenderbuffer(this.stencilBuffer);
  }
  if (this.cardboardUI) {
    this.cardboardUI.destroy();
  }
};
CardboardDistorter.prototype.onResize = function () {
  var gl = this.gl;
  var self = this;
  var glState = [gl.RENDERBUFFER_BINDING, gl.TEXTURE_BINDING_2D, gl.TEXTURE0];
  glPreserveState(gl, glState, function (gl) {
    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, null);
    if (self.scissorTest) {
      self.realDisable.call(gl, gl.SCISSOR_TEST);
    }
    self.realColorMask.call(gl, true, true, true, true);
    self.realViewport.call(gl, 0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
    self.realClearColor.call(gl, 0, 0, 0, 1);
    gl.clear(gl.COLOR_BUFFER_BIT);
    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.framebuffer);
    gl.bindTexture(gl.TEXTURE_2D, self.renderTarget);
    gl.texImage2D(gl.TEXTURE_2D, 0, self.ctxAttribs.alpha ? gl.RGBA : gl.RGB, self.bufferWidth, self.bufferHeight, 0, self.ctxAttribs.alpha ? gl.RGBA : gl.RGB, gl.UNSIGNED_BYTE, null);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, self.renderTarget, 0);
    if (self.ctxAttribs.depth && self.ctxAttribs.stencil) {
      gl.bindRenderbuffer(gl.RENDERBUFFER, self.depthStencilBuffer);
      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, self.bufferWidth, self.bufferHeight);
      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, self.depthStencilBuffer);
    } else if (self.ctxAttribs.depth) {
      gl.bindRenderbuffer(gl.RENDERBUFFER, self.depthBuffer);
      gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, self.bufferWidth, self.bufferHeight);
      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, self.depthBuffer);
    } else if (self.ctxAttribs.stencil) {
      gl.bindRenderbuffer(gl.RENDERBUFFER, self.stencilBuffer);
      gl.renderbufferStorage(gl.RENDERBUFFER, gl.STENCIL_INDEX8, self.bufferWidth, self.bufferHeight);
      gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.STENCIL_ATTACHMENT, gl.RENDERBUFFER, self.stencilBuffer);
    }
    if (!gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE) {
      console.error('Framebuffer incomplete!');
    }
    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.lastBoundFramebuffer);
    if (self.scissorTest) {
      self.realEnable.call(gl, gl.SCISSOR_TEST);
    }
    self.realColorMask.apply(gl, self.colorMask);
    self.realViewport.apply(gl, self.viewport);
    self.realClearColor.apply(gl, self.clearColor);
  });
  if (this.cardboardUI) {
    this.cardboardUI.onResize();
  }
};
CardboardDistorter.prototype.patch = function () {
  if (this.isPatched) {
    return;
  }
  var self = this;
  var canvas = this.gl.canvas;
  var gl = this.gl;
  if (!isIOS()) {
    canvas.width = getScreenWidth() * this.bufferScale;
    canvas.height = getScreenHeight() * this.bufferScale;
    Object.defineProperty(canvas, 'width', {
      configurable: true,
      enumerable: true,
      get: function get() {
        return self.bufferWidth;
      },
      set: function set(value) {
        self.bufferWidth = value;
        self.realCanvasWidth.set.call(canvas, value);
        self.onResize();
      }
    });
    Object.defineProperty(canvas, 'height', {
      configurable: true,
      enumerable: true,
      get: function get() {
        return self.bufferHeight;
      },
      set: function set(value) {
        self.bufferHeight = value;
        self.realCanvasHeight.set.call(canvas, value);
        self.onResize();
      }
    });
  }
  this.lastBoundFramebuffer = gl.getParameter(gl.FRAMEBUFFER_BINDING);
  if (this.lastBoundFramebuffer == null) {
    this.lastBoundFramebuffer = this.framebuffer;
    this.gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);
  }
  this.gl.bindFramebuffer = function (target, framebuffer) {
    self.lastBoundFramebuffer = framebuffer ? framebuffer : self.framebuffer;
    self.realBindFramebuffer.call(gl, target, self.lastBoundFramebuffer);
  };
  this.cullFace = gl.getParameter(gl.CULL_FACE);
  this.depthTest = gl.getParameter(gl.DEPTH_TEST);
  this.blend = gl.getParameter(gl.BLEND);
  this.scissorTest = gl.getParameter(gl.SCISSOR_TEST);
  this.stencilTest = gl.getParameter(gl.STENCIL_TEST);
  gl.enable = function (pname) {
    switch (pname) {
      case gl.CULL_FACE:
        self.cullFace = true;break;
      case gl.DEPTH_TEST:
        self.depthTest = true;break;
      case gl.BLEND:
        self.blend = true;break;
      case gl.SCISSOR_TEST:
        self.scissorTest = true;break;
      case gl.STENCIL_TEST:
        self.stencilTest = true;break;
    }
    self.realEnable.call(gl, pname);
  };
  gl.disable = function (pname) {
    switch (pname) {
      case gl.CULL_FACE:
        self.cullFace = false;break;
      case gl.DEPTH_TEST:
        self.depthTest = false;break;
      case gl.BLEND:
        self.blend = false;break;
      case gl.SCISSOR_TEST:
        self.scissorTest = false;break;
      case gl.STENCIL_TEST:
        self.stencilTest = false;break;
    }
    self.realDisable.call(gl, pname);
  };
  this.colorMask = gl.getParameter(gl.COLOR_WRITEMASK);
  gl.colorMask = function (r, g, b, a) {
    self.colorMask[0] = r;
    self.colorMask[1] = g;
    self.colorMask[2] = b;
    self.colorMask[3] = a;
    self.realColorMask.call(gl, r, g, b, a);
  };
  this.clearColor = gl.getParameter(gl.COLOR_CLEAR_VALUE);
  gl.clearColor = function (r, g, b, a) {
    self.clearColor[0] = r;
    self.clearColor[1] = g;
    self.clearColor[2] = b;
    self.clearColor[3] = a;
    self.realClearColor.call(gl, r, g, b, a);
  };
  this.viewport = gl.getParameter(gl.VIEWPORT);
  gl.viewport = function (x, y, w, h) {
    self.viewport[0] = x;
    self.viewport[1] = y;
    self.viewport[2] = w;
    self.viewport[3] = h;
    self.realViewport.call(gl, x, y, w, h);
  };
  this.isPatched = true;
  safariCssSizeWorkaround(canvas);
};
CardboardDistorter.prototype.unpatch = function () {
  if (!this.isPatched) {
    return;
  }
  var gl = this.gl;
  var canvas = this.gl.canvas;
  if (!isIOS()) {
    Object.defineProperty(canvas, 'width', this.realCanvasWidth);
    Object.defineProperty(canvas, 'height', this.realCanvasHeight);
  }
  canvas.width = this.bufferWidth;
  canvas.height = this.bufferHeight;
  gl.bindFramebuffer = this.realBindFramebuffer;
  gl.enable = this.realEnable;
  gl.disable = this.realDisable;
  gl.colorMask = this.realColorMask;
  gl.clearColor = this.realClearColor;
  gl.viewport = this.realViewport;
  if (this.lastBoundFramebuffer == this.framebuffer) {
    gl.bindFramebuffer(gl.FRAMEBUFFER, null);
  }
  this.isPatched = false;
  setTimeout(function () {
    safariCssSizeWorkaround(canvas);
  }, 1);
};
CardboardDistorter.prototype.setTextureBounds = function (leftBounds, rightBounds) {
  if (!leftBounds) {
    leftBounds = [0, 0, 0.5, 1];
  }
  if (!rightBounds) {
    rightBounds = [0.5, 0, 0.5, 1];
  }
  this.viewportOffsetScale[0] = leftBounds[0];
  this.viewportOffsetScale[1] = leftBounds[1];
  this.viewportOffsetScale[2] = leftBounds[2];
  this.viewportOffsetScale[3] = leftBounds[3];
  this.viewportOffsetScale[4] = rightBounds[0];
  this.viewportOffsetScale[5] = rightBounds[1];
  this.viewportOffsetScale[6] = rightBounds[2];
  this.viewportOffsetScale[7] = rightBounds[3];
};
CardboardDistorter.prototype.submitFrame = function () {
  var gl = this.gl;
  var self = this;
  var glState = [];
  if (!this.dirtySubmitFrameBindings) {
    glState.push(gl.CURRENT_PROGRAM, gl.ARRAY_BUFFER_BINDING, gl.ELEMENT_ARRAY_BUFFER_BINDING, gl.TEXTURE_BINDING_2D, gl.TEXTURE0);
  }
  glPreserveState(gl, glState, function (gl) {
    self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, null);
    if (self.cullFace) {
      self.realDisable.call(gl, gl.CULL_FACE);
    }
    if (self.depthTest) {
      self.realDisable.call(gl, gl.DEPTH_TEST);
    }
    if (self.blend) {
      self.realDisable.call(gl, gl.BLEND);
    }
    if (self.scissorTest) {
      self.realDisable.call(gl, gl.SCISSOR_TEST);
    }
    if (self.stencilTest) {
      self.realDisable.call(gl, gl.STENCIL_TEST);
    }
    self.realColorMask.call(gl, true, true, true, true);
    self.realViewport.call(gl, 0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
    if (self.ctxAttribs.alpha || isIOS()) {
      self.realClearColor.call(gl, 0, 0, 0, 1);
      gl.clear(gl.COLOR_BUFFER_BIT);
    }
    gl.useProgram(self.program);
    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, self.indexBuffer);
    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);
    gl.enableVertexAttribArray(self.attribs.position);
    gl.enableVertexAttribArray(self.attribs.texCoord);
    gl.vertexAttribPointer(self.attribs.position, 2, gl.FLOAT, false, 20, 0);
    gl.vertexAttribPointer(self.attribs.texCoord, 3, gl.FLOAT, false, 20, 8);
    gl.activeTexture(gl.TEXTURE0);
    gl.uniform1i(self.uniforms.diffuse, 0);
    gl.bindTexture(gl.TEXTURE_2D, self.renderTarget);
    gl.uniform4fv(self.uniforms.viewportOffsetScale, self.viewportOffsetScale);
    gl.drawElements(gl.TRIANGLES, self.indexCount, gl.UNSIGNED_SHORT, 0);
    if (self.cardboardUI) {
      self.cardboardUI.renderNoState();
    }
    self.realBindFramebuffer.call(self.gl, gl.FRAMEBUFFER, self.framebuffer);
    if (!self.ctxAttribs.preserveDrawingBuffer) {
      self.realClearColor.call(gl, 0, 0, 0, 0);
      gl.clear(gl.COLOR_BUFFER_BIT);
    }
    if (!self.dirtySubmitFrameBindings) {
      self.realBindFramebuffer.call(gl, gl.FRAMEBUFFER, self.lastBoundFramebuffer);
    }
    if (self.cullFace) {
      self.realEnable.call(gl, gl.CULL_FACE);
    }
    if (self.depthTest) {
      self.realEnable.call(gl, gl.DEPTH_TEST);
    }
    if (self.blend) {
      self.realEnable.call(gl, gl.BLEND);
    }
    if (self.scissorTest) {
      self.realEnable.call(gl, gl.SCISSOR_TEST);
    }
    if (self.stencilTest) {
      self.realEnable.call(gl, gl.STENCIL_TEST);
    }
    self.realColorMask.apply(gl, self.colorMask);
    self.realViewport.apply(gl, self.viewport);
    if (self.ctxAttribs.alpha || !self.ctxAttribs.preserveDrawingBuffer) {
      self.realClearColor.apply(gl, self.clearColor);
    }
  });
  if (isIOS()) {
    var canvas = gl.canvas;
    if (canvas.width != self.bufferWidth || canvas.height != self.bufferHeight) {
      self.bufferWidth = canvas.width;
      self.bufferHeight = canvas.height;
      self.onResize();
    }
  }
};
CardboardDistorter.prototype.updateDeviceInfo = function (deviceInfo) {
  var gl = this.gl;
  var self = this;
  var glState = [gl.ARRAY_BUFFER_BINDING, gl.ELEMENT_ARRAY_BUFFER_BINDING];
  glPreserveState(gl, glState, function (gl) {
    var vertices = self.computeMeshVertices_(self.meshWidth, self.meshHeight, deviceInfo);
    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
    if (!self.indexCount) {
      var indices = self.computeMeshIndices_(self.meshWidth, self.meshHeight);
      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, self.indexBuffer);
      gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW);
      self.indexCount = indices.length;
    }
  });
};
CardboardDistorter.prototype.computeMeshVertices_ = function (width, height, deviceInfo) {
  var vertices = new Float32Array(2 * width * height * 5);
  var lensFrustum = deviceInfo.getLeftEyeVisibleTanAngles();
  var noLensFrustum = deviceInfo.getLeftEyeNoLensTanAngles();
  var viewport = deviceInfo.getLeftEyeVisibleScreenRect(noLensFrustum);
  var vidx = 0;
  for (var e = 0; e < 2; e++) {
    for (var j = 0; j < height; j++) {
      for (var i = 0; i < width; i++, vidx++) {
        var u = i / (width - 1);
        var v = j / (height - 1);
        var s = u;
        var t = v;
        var x = lerp(lensFrustum[0], lensFrustum[2], u);
        var y = lerp(lensFrustum[3], lensFrustum[1], v);
        var d = Math.sqrt(x * x + y * y);
        var r = deviceInfo.distortion.distortInverse(d);
        var p = x * r / d;
        var q = y * r / d;
        u = (p - noLensFrustum[0]) / (noLensFrustum[2] - noLensFrustum[0]);
        v = (q - noLensFrustum[3]) / (noLensFrustum[1] - noLensFrustum[3]);
        u = (viewport.x + u * viewport.width - 0.5) * 2.0;
        v = (viewport.y + v * viewport.height - 0.5) * 2.0;
        vertices[vidx * 5 + 0] = u;
        vertices[vidx * 5 + 1] = v;
        vertices[vidx * 5 + 2] = s;
        vertices[vidx * 5 + 3] = t;
        vertices[vidx * 5 + 4] = e;
      }
    }
    var w = lensFrustum[2] - lensFrustum[0];
    lensFrustum[0] = -(w + lensFrustum[0]);
    lensFrustum[2] = w - lensFrustum[2];
    w = noLensFrustum[2] - noLensFrustum[0];
    noLensFrustum[0] = -(w + noLensFrustum[0]);
    noLensFrustum[2] = w - noLensFrustum[2];
    viewport.x = 1 - (viewport.x + viewport.width);
  }
  return vertices;
};
CardboardDistorter.prototype.computeMeshIndices_ = function (width, height) {
  var indices = new Uint16Array(2 * (width - 1) * (height - 1) * 6);
  var halfwidth = width / 2;
  var halfheight = height / 2;
  var vidx = 0;
  var iidx = 0;
  for (var e = 0; e < 2; e++) {
    for (var j = 0; j < height; j++) {
      for (var i = 0; i < width; i++, vidx++) {
        if (i == 0 || j == 0) continue;
        if (i <= halfwidth == j <= halfheight) {
          indices[iidx++] = vidx;
          indices[iidx++] = vidx - width - 1;
          indices[iidx++] = vidx - width;
          indices[iidx++] = vidx - width - 1;
          indices[iidx++] = vidx;
          indices[iidx++] = vidx - 1;
        } else {
          indices[iidx++] = vidx - 1;
          indices[iidx++] = vidx - width;
          indices[iidx++] = vidx;
          indices[iidx++] = vidx - width;
          indices[iidx++] = vidx - 1;
          indices[iidx++] = vidx - width - 1;
        }
      }
    }
  }
  return indices;
};
CardboardDistorter.prototype.getOwnPropertyDescriptor_ = function (proto, attrName) {
  var descriptor = Object.getOwnPropertyDescriptor(proto, attrName);
  if (descriptor.get === undefined || descriptor.set === undefined) {
    descriptor.configurable = true;
    descriptor.enumerable = true;
    descriptor.get = function () {
      return this.getAttribute(attrName);
    };
    descriptor.set = function (val) {
      this.setAttribute(attrName, val);
    };
  }
  return descriptor;
};
var uiVS = ['attribute vec2 position;', 'uniform mat4 projectionMat;', 'void main() {', '  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );', '}'].join('\n');
var uiFS = ['precision mediump float;', 'uniform vec4 color;', 'void main() {', '  gl_FragColor = color;', '}'].join('\n');
var DEG2RAD = Math.PI / 180.0;
var kAnglePerGearSection = 60;
var kOuterRimEndAngle = 12;
var kInnerRimBeginAngle = 20;
var kOuterRadius = 1;
var kMiddleRadius = 0.75;
var kInnerRadius = 0.3125;
var kCenterLineThicknessDp = 4;
var kButtonWidthDp = 28;
var kTouchSlopFactor = 1.5;
function CardboardUI(gl) {
  this.gl = gl;
  this.attribs = {
    position: 0
  };
  this.program = linkProgram(gl, uiVS, uiFS, this.attribs);
  this.uniforms = getProgramUniforms(gl, this.program);
  this.vertexBuffer = gl.createBuffer();
  this.gearOffset = 0;
  this.gearVertexCount = 0;
  this.arrowOffset = 0;
  this.arrowVertexCount = 0;
  this.projMat = new Float32Array(16);
  this.listener = null;
  this.onResize();
}
CardboardUI.prototype.destroy = function () {
  var gl = this.gl;
  if (this.listener) {
    gl.canvas.removeEventListener('click', this.listener, false);
  }
  gl.deleteProgram(this.program);
  gl.deleteBuffer(this.vertexBuffer);
};
CardboardUI.prototype.listen = function (optionsCallback, backCallback) {
  var canvas = this.gl.canvas;
  this.listener = function (event) {
    var midline = canvas.clientWidth / 2;
    var buttonSize = kButtonWidthDp * kTouchSlopFactor;
    if (event.clientX > midline - buttonSize && event.clientX < midline + buttonSize && event.clientY > canvas.clientHeight - buttonSize) {
      optionsCallback(event);
    }
    else if (event.clientX < buttonSize && event.clientY < buttonSize) {
        backCallback(event);
      }
  };
  canvas.addEventListener('click', this.listener, false);
};
CardboardUI.prototype.onResize = function () {
  var gl = this.gl;
  var self = this;
  var glState = [gl.ARRAY_BUFFER_BINDING];
  glPreserveState(gl, glState, function (gl) {
    var vertices = [];
    var midline = gl.drawingBufferWidth / 2;
    var physicalPixels = Math.max(screen.width, screen.height) * window.devicePixelRatio;
    var scalingRatio = gl.drawingBufferWidth / physicalPixels;
    var dps = scalingRatio * window.devicePixelRatio;
    var lineWidth = kCenterLineThicknessDp * dps / 2;
    var buttonSize = kButtonWidthDp * kTouchSlopFactor * dps;
    var buttonScale = kButtonWidthDp * dps / 2;
    var buttonBorder = (kButtonWidthDp * kTouchSlopFactor - kButtonWidthDp) * dps;
    vertices.push(midline - lineWidth, buttonSize);
    vertices.push(midline - lineWidth, gl.drawingBufferHeight);
    vertices.push(midline + lineWidth, buttonSize);
    vertices.push(midline + lineWidth, gl.drawingBufferHeight);
    self.gearOffset = vertices.length / 2;
    function addGearSegment(theta, r) {
      var angle = (90 - theta) * DEG2RAD;
      var x = Math.cos(angle);
      var y = Math.sin(angle);
      vertices.push(kInnerRadius * x * buttonScale + midline, kInnerRadius * y * buttonScale + buttonScale);
      vertices.push(r * x * buttonScale + midline, r * y * buttonScale + buttonScale);
    }
    for (var i = 0; i <= 6; i++) {
      var segmentTheta = i * kAnglePerGearSection;
      addGearSegment(segmentTheta, kOuterRadius);
      addGearSegment(segmentTheta + kOuterRimEndAngle, kOuterRadius);
      addGearSegment(segmentTheta + kInnerRimBeginAngle, kMiddleRadius);
      addGearSegment(segmentTheta + (kAnglePerGearSection - kInnerRimBeginAngle), kMiddleRadius);
      addGearSegment(segmentTheta + (kAnglePerGearSection - kOuterRimEndAngle), kOuterRadius);
    }
    self.gearVertexCount = vertices.length / 2 - self.gearOffset;
    self.arrowOffset = vertices.length / 2;
    function addArrowVertex(x, y) {
      vertices.push(buttonBorder + x, gl.drawingBufferHeight - buttonBorder - y);
    }
    var angledLineWidth = lineWidth / Math.sin(45 * DEG2RAD);
    addArrowVertex(0, buttonScale);
    addArrowVertex(buttonScale, 0);
    addArrowVertex(buttonScale + angledLineWidth, angledLineWidth);
    addArrowVertex(angledLineWidth, buttonScale + angledLineWidth);
    addArrowVertex(angledLineWidth, buttonScale - angledLineWidth);
    addArrowVertex(0, buttonScale);
    addArrowVertex(buttonScale, buttonScale * 2);
    addArrowVertex(buttonScale + angledLineWidth, buttonScale * 2 - angledLineWidth);
    addArrowVertex(angledLineWidth, buttonScale - angledLineWidth);
    addArrowVertex(0, buttonScale);
    addArrowVertex(angledLineWidth, buttonScale - lineWidth);
    addArrowVertex(kButtonWidthDp * dps, buttonScale - lineWidth);
    addArrowVertex(angledLineWidth, buttonScale + lineWidth);
    addArrowVertex(kButtonWidthDp * dps, buttonScale + lineWidth);
    self.arrowVertexCount = vertices.length / 2 - self.arrowOffset;
    gl.bindBuffer(gl.ARRAY_BUFFER, self.vertexBuffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
  });
};
CardboardUI.prototype.render = function () {
  var gl = this.gl;
  var self = this;
  var glState = [gl.CULL_FACE, gl.DEPTH_TEST, gl.BLEND, gl.SCISSOR_TEST, gl.STENCIL_TEST, gl.COLOR_WRITEMASK, gl.VIEWPORT, gl.CURRENT_PROGRAM, gl.ARRAY_BUFFER_BINDING];
  glPreserveState(gl, glState, function (gl) {
    gl.disable(gl.CULL_FACE);
    gl.disable(gl.DEPTH_TEST);
    gl.disable(gl.BLEND);
    gl.disable(gl.SCISSOR_TEST);
    gl.disable(gl.STENCIL_TEST);
    gl.colorMask(true, true, true, true);
    gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);
    self.renderNoState();
  });
};
CardboardUI.prototype.renderNoState = function () {
  var gl = this.gl;
  gl.useProgram(this.program);
  gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer);
  gl.enableVertexAttribArray(this.attribs.position);
  gl.vertexAttribPointer(this.attribs.position, 2, gl.FLOAT, false, 8, 0);
  gl.uniform4f(this.uniforms.color, 1.0, 1.0, 1.0, 1.0);
  orthoMatrix(this.projMat, 0, gl.drawingBufferWidth, 0, gl.drawingBufferHeight, 0.1, 1024.0);
  gl.uniformMatrix4fv(this.uniforms.projectionMat, false, this.projMat);
  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
  gl.drawArrays(gl.TRIANGLE_STRIP, this.gearOffset, this.gearVertexCount);
  gl.drawArrays(gl.TRIANGLE_STRIP, this.arrowOffset, this.arrowVertexCount);
};
function Distortion(coefficients) {
  this.coefficients = coefficients;
}
Distortion.prototype.distortInverse = function (radius) {
  var r0 = 0;
  var r1 = 1;
  var dr0 = radius - this.distort(r0);
  while (Math.abs(r1 - r0) > 0.0001             ) {
    var dr1 = radius - this.distort(r1);
    var r2 = r1 - dr1 * ((r1 - r0) / (dr1 - dr0));
    r0 = r1;
    r1 = r2;
    dr0 = dr1;
  }
  return r1;
};
Distortion.prototype.distort = function (radius) {
  var r2 = radius * radius;
  var ret = 0;
  for (var i = 0; i < this.coefficients.length; i++) {
    ret = r2 * (ret + this.coefficients[i]);
  }
  return (ret + 1) * radius;
};
var degToRad = Math.PI / 180;
var radToDeg = 180 / Math.PI;
var Vector3 = function Vector3(x, y, z) {
  this.x = x || 0;
  this.y = y || 0;
  this.z = z || 0;
};
Vector3.prototype = {
  constructor: Vector3,
  set: function set(x, y, z) {
    this.x = x;
    this.y = y;
    this.z = z;
    return this;
  },
  copy: function copy(v) {
    this.x = v.x;
    this.y = v.y;
    this.z = v.z;
    return this;
  },
  length: function length() {
    return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
  },
  normalize: function normalize() {
    var scalar = this.length();
    if (scalar !== 0) {
      var invScalar = 1 / scalar;
      this.multiplyScalar(invScalar);
    } else {
      this.x = 0;
      this.y = 0;
      this.z = 0;
    }
    return this;
  },
  multiplyScalar: function multiplyScalar(scalar) {
    this.x *= scalar;
    this.y *= scalar;
    this.z *= scalar;
  },
  applyQuaternion: function applyQuaternion(q) {
    var x = this.x;
    var y = this.y;
    var z = this.z;
    var qx = q.x;
    var qy = q.y;
    var qz = q.z;
    var qw = q.w;
    var ix = qw * x + qy * z - qz * y;
    var iy = qw * y + qz * x - qx * z;
    var iz = qw * z + qx * y - qy * x;
    var iw = -qx * x - qy * y - qz * z;
    this.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;
    this.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;
    this.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;
    return this;
  },
  dot: function dot(v) {
    return this.x * v.x + this.y * v.y + this.z * v.z;
  },
  crossVectors: function crossVectors(a, b) {
    var ax = a.x,
        ay = a.y,
        az = a.z;
    var bx = b.x,
        by = b.y,
        bz = b.z;
    this.x = ay * bz - az * by;
    this.y = az * bx - ax * bz;
    this.z = ax * by - ay * bx;
    return this;
  }
};
var Quaternion = function Quaternion(x, y, z, w) {
  this.x = x || 0;
  this.y = y || 0;
  this.z = z || 0;
  this.w = w !== undefined ? w : 1;
};
Quaternion.prototype = {
  constructor: Quaternion,
  set: function set(x, y, z, w) {
    this.x = x;
    this.y = y;
    this.z = z;
    this.w = w;
    return this;
  },
  copy: function copy(quaternion) {
    this.x = quaternion.x;
    this.y = quaternion.y;
    this.z = quaternion.z;
    this.w = quaternion.w;
    return this;
  },
  setFromEulerXYZ: function setFromEulerXYZ(x, y, z) {
    var c1 = Math.cos(x / 2);
    var c2 = Math.cos(y / 2);
    var c3 = Math.cos(z / 2);
    var s1 = Math.sin(x / 2);
    var s2 = Math.sin(y / 2);
    var s3 = Math.sin(z / 2);
    this.x = s1 * c2 * c3 + c1 * s2 * s3;
    this.y = c1 * s2 * c3 - s1 * c2 * s3;
    this.z = c1 * c2 * s3 + s1 * s2 * c3;
    this.w = c1 * c2 * c3 - s1 * s2 * s3;
    return this;
  },
  setFromEulerYXZ: function setFromEulerYXZ(x, y, z) {
    var c1 = Math.cos(x / 2);
    var c2 = Math.cos(y / 2);
    var c3 = Math.cos(z / 2);
    var s1 = Math.sin(x / 2);
    var s2 = Math.sin(y / 2);
    var s3 = Math.sin(z / 2);
    this.x = s1 * c2 * c3 + c1 * s2 * s3;
    this.y = c1 * s2 * c3 - s1 * c2 * s3;
    this.z = c1 * c2 * s3 - s1 * s2 * c3;
    this.w = c1 * c2 * c3 + s1 * s2 * s3;
    return this;
  },
  setFromAxisAngle: function setFromAxisAngle(axis, angle) {
    var halfAngle = angle / 2,
        s = Math.sin(halfAngle);
    this.x = axis.x * s;
    this.y = axis.y * s;
    this.z = axis.z * s;
    this.w = Math.cos(halfAngle);
    return this;
  },
  multiply: function multiply(q) {
    return this.multiplyQuaternions(this, q);
  },
  multiplyQuaternions: function multiplyQuaternions(a, b) {
    var qax = a.x,
        qay = a.y,
        qaz = a.z,
        qaw = a.w;
    var qbx = b.x,
        qby = b.y,
        qbz = b.z,
        qbw = b.w;
    this.x = qax * qbw + qaw * qbx + qay * qbz - qaz * qby;
    this.y = qay * qbw + qaw * qby + qaz * qbx - qax * qbz;
    this.z = qaz * qbw + qaw * qbz + qax * qby - qay * qbx;
    this.w = qaw * qbw - qax * qbx - qay * qby - qaz * qbz;
    return this;
  },
  inverse: function inverse() {
    this.x *= -1;
    this.y *= -1;
    this.z *= -1;
    this.normalize();
    return this;
  },
  normalize: function normalize() {
    var l = Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
    if (l === 0) {
      this.x = 0;
      this.y = 0;
      this.z = 0;
      this.w = 1;
    } else {
      l = 1 / l;
      this.x = this.x * l;
      this.y = this.y * l;
      this.z = this.z * l;
      this.w = this.w * l;
    }
    return this;
  },
  slerp: function slerp(qb, t) {
    if (t === 0) return this;
    if (t === 1) return this.copy(qb);
    var x = this.x,
        y = this.y,
        z = this.z,
        w = this.w;
    var cosHalfTheta = w * qb.w + x * qb.x + y * qb.y + z * qb.z;
    if (cosHalfTheta < 0) {
      this.w = -qb.w;
      this.x = -qb.x;
      this.y = -qb.y;
      this.z = -qb.z;
      cosHalfTheta = -cosHalfTheta;
    } else {
      this.copy(qb);
    }
    if (cosHalfTheta >= 1.0) {
      this.w = w;
      this.x = x;
      this.y = y;
      this.z = z;
      return this;
    }
    var halfTheta = Math.acos(cosHalfTheta);
    var sinHalfTheta = Math.sqrt(1.0 - cosHalfTheta * cosHalfTheta);
    if (Math.abs(sinHalfTheta) < 0.001) {
      this.w = 0.5 * (w + this.w);
      this.x = 0.5 * (x + this.x);
      this.y = 0.5 * (y + this.y);
      this.z = 0.5 * (z + this.z);
      return this;
    }
    var ratioA = Math.sin((1 - t) * halfTheta) / sinHalfTheta,
        ratioB = Math.sin(t * halfTheta) / sinHalfTheta;
    this.w = w * ratioA + this.w * ratioB;
    this.x = x * ratioA + this.x * ratioB;
    this.y = y * ratioA + this.y * ratioB;
    this.z = z * ratioA + this.z * ratioB;
    return this;
  },
  setFromUnitVectors: function () {
    var v1, r;
    var EPS = 0.000001;
    return function (vFrom, vTo) {
      if (v1 === undefined) v1 = new Vector3();
      r = vFrom.dot(vTo) + 1;
      if (r < EPS) {
        r = 0;
        if (Math.abs(vFrom.x) > Math.abs(vFrom.z)) {
          v1.set(-vFrom.y, vFrom.x, 0);
        } else {
          v1.set(0, -vFrom.z, vFrom.y);
        }
      } else {
        v1.crossVectors(vFrom, vTo);
      }
      this.x = v1.x;
      this.y = v1.y;
      this.z = v1.z;
      this.w = r;
      this.normalize();
      return this;
    };
  }()
};
function Device(params) {
  this.width = params.width || getScreenWidth();
  this.height = params.height || getScreenHeight();
  this.widthMeters = params.widthMeters;
  this.heightMeters = params.heightMeters;
  this.bevelMeters = params.bevelMeters;
}
var DEFAULT_ANDROID = new Device({
  widthMeters: 0.110,
  heightMeters: 0.062,
  bevelMeters: 0.004
});
var DEFAULT_IOS = new Device({
  widthMeters: 0.1038,
  heightMeters: 0.0584,
  bevelMeters: 0.004
});
var Viewers = {
  CardboardV1: new CardboardViewer({
    id: 'CardboardV1',
    label: 'Cardboard I/O 2014',
    fov: 40,
    interLensDistance: 0.060,
    baselineLensDistance: 0.035,
    screenLensDistance: 0.042,
    distortionCoefficients: [0.441, 0.156],
    inverseCoefficients: [-0.4410035, 0.42756155, -0.4804439, 0.5460139, -0.58821183, 0.5733938, -0.48303202, 0.33299083, -0.17573841, 0.0651772, -0.01488963, 0.001559834]
  }),
  CardboardV2: new CardboardViewer({
    id: 'CardboardV2',
    label: 'Cardboard I/O 2015',
    fov: 60,
    interLensDistance: 0.064,
    baselineLensDistance: 0.035,
    screenLensDistance: 0.039,
    distortionCoefficients: [0.34, 0.55],
    inverseCoefficients: [-0.33836704, -0.18162185, 0.862655, -1.2462051, 1.0560602, -0.58208317, 0.21609078, -0.05444823, 0.009177956, -9.904169E-4, 6.183535E-5, -1.6981803E-6]
  })
};
function DeviceInfo(deviceParams, additionalViewers) {
  this.viewer = Viewers.CardboardV2;
  this.updateDeviceParams(deviceParams);
  this.distortion = new Distortion(this.viewer.distortionCoefficients);
  for (var i = 0; i < additionalViewers.length; i++) {
    var viewer = additionalViewers[i];
    Viewers[viewer.id] = new CardboardViewer(viewer);
  }
}
DeviceInfo.prototype.updateDeviceParams = function (deviceParams) {
  this.device = this.determineDevice_(deviceParams) || this.device;
};
DeviceInfo.prototype.getDevice = function () {
  return this.device;
};
DeviceInfo.prototype.setViewer = function (viewer) {
  this.viewer = viewer;
  this.distortion = new Distortion(this.viewer.distortionCoefficients);
};
DeviceInfo.prototype.determineDevice_ = function (deviceParams) {
  if (!deviceParams) {
    if (isIOS()) {
      console.warn('Using fallback iOS device measurements.');
      return DEFAULT_IOS;
    } else {
      console.warn('Using fallback Android device measurements.');
      return DEFAULT_ANDROID;
    }
  }
  var METERS_PER_INCH = 0.0254;
  var metersPerPixelX = METERS_PER_INCH / deviceParams.xdpi;
  var metersPerPixelY = METERS_PER_INCH / deviceParams.ydpi;
  var width = getScreenWidth();
  var height = getScreenHeight();
  return new Device({
    widthMeters: metersPerPixelX * width,
    heightMeters: metersPerPixelY * height,
    bevelMeters: deviceParams.bevelMm * 0.001
  });
};
DeviceInfo.prototype.getDistortedFieldOfViewLeftEye = function () {
  var viewer = this.viewer;
  var device = this.device;
  var distortion = this.distortion;
  var eyeToScreenDistance = viewer.screenLensDistance;
  var outerDist = (device.widthMeters - viewer.interLensDistance) / 2;
  var innerDist = viewer.interLensDistance / 2;
  var bottomDist = viewer.baselineLensDistance - device.bevelMeters;
  var topDist = device.heightMeters - bottomDist;
  var outerAngle = radToDeg * Math.atan(distortion.distort(outerDist / eyeToScreenDistance));
  var innerAngle = radToDeg * Math.atan(distortion.distort(innerDist / eyeToScreenDistance));
  var bottomAngle = radToDeg * Math.atan(distortion.distort(bottomDist / eyeToScreenDistance));
  var topAngle = radToDeg * Math.atan(distortion.distort(topDist / eyeToScreenDistance));
  return {
    leftDegrees: Math.min(outerAngle, viewer.fov),
    rightDegrees: Math.min(innerAngle, viewer.fov),
    downDegrees: Math.min(bottomAngle, viewer.fov),
    upDegrees: Math.min(topAngle, viewer.fov)
  };
};
DeviceInfo.prototype.getLeftEyeVisibleTanAngles = function () {
  var viewer = this.viewer;
  var device = this.device;
  var distortion = this.distortion;
  var fovLeft = Math.tan(-degToRad * viewer.fov);
  var fovTop = Math.tan(degToRad * viewer.fov);
  var fovRight = Math.tan(degToRad * viewer.fov);
  var fovBottom = Math.tan(-degToRad * viewer.fov);
  var halfWidth = device.widthMeters / 4;
  var halfHeight = device.heightMeters / 2;
  var verticalLensOffset = viewer.baselineLensDistance - device.bevelMeters - halfHeight;
  var centerX = viewer.interLensDistance / 2 - halfWidth;
  var centerY = -verticalLensOffset;
  var centerZ = viewer.screenLensDistance;
  var screenLeft = distortion.distort((centerX - halfWidth) / centerZ);
  var screenTop = distortion.distort((centerY + halfHeight) / centerZ);
  var screenRight = distortion.distort((centerX + halfWidth) / centerZ);
  var screenBottom = distortion.distort((centerY - halfHeight) / centerZ);
  var result = new Float32Array(4);
  result[0] = Math.max(fovLeft, screenLeft);
  result[1] = Math.min(fovTop, screenTop);
  result[2] = Math.min(fovRight, screenRight);
  result[3] = Math.max(fovBottom, screenBottom);
  return result;
};
DeviceInfo.prototype.getLeftEyeNoLensTanAngles = function () {
  var viewer = this.viewer;
  var device = this.device;
  var distortion = this.distortion;
  var result = new Float32Array(4);
  var fovLeft = distortion.distortInverse(Math.tan(-degToRad * viewer.fov));
  var fovTop = distortion.distortInverse(Math.tan(degToRad * viewer.fov));
  var fovRight = distortion.distortInverse(Math.tan(degToRad * viewer.fov));
  var fovBottom = distortion.distortInverse(Math.tan(-degToRad * viewer.fov));
  var halfWidth = device.widthMeters / 4;
  var halfHeight = device.heightMeters / 2;
  var verticalLensOffset = viewer.baselineLensDistance - device.bevelMeters - halfHeight;
  var centerX = viewer.interLensDistance / 2 - halfWidth;
  var centerY = -verticalLensOffset;
  var centerZ = viewer.screenLensDistance;
  var screenLeft = (centerX - halfWidth) / centerZ;
  var screenTop = (centerY + halfHeight) / centerZ;
  var screenRight = (centerX + halfWidth) / centerZ;
  var screenBottom = (centerY - halfHeight) / centerZ;
  result[0] = Math.max(fovLeft, screenLeft);
  result[1] = Math.min(fovTop, screenTop);
  result[2] = Math.min(fovRight, screenRight);
  result[3] = Math.max(fovBottom, screenBottom);
  return result;
};
DeviceInfo.prototype.getLeftEyeVisibleScreenRect = function (undistortedFrustum) {
  var viewer = this.viewer;
  var device = this.device;
  var dist = viewer.screenLensDistance;
  var eyeX = (device.widthMeters - viewer.interLensDistance) / 2;
  var eyeY = viewer.baselineLensDistance - device.bevelMeters;
  var left = (undistortedFrustum[0] * dist + eyeX) / device.widthMeters;
  var top = (undistortedFrustum[1] * dist + eyeY) / device.heightMeters;
  var right = (undistortedFrustum[2] * dist + eyeX) / device.widthMeters;
  var bottom = (undistortedFrustum[3] * dist + eyeY) / device.heightMeters;
  return {
    x: left,
    y: bottom,
    width: right - left,
    height: top - bottom
  };
};
DeviceInfo.prototype.getFieldOfViewLeftEye = function (opt_isUndistorted) {
  return opt_isUndistorted ? this.getUndistortedFieldOfViewLeftEye() : this.getDistortedFieldOfViewLeftEye();
};
DeviceInfo.prototype.getFieldOfViewRightEye = function (opt_isUndistorted) {
  var fov = this.getFieldOfViewLeftEye(opt_isUndistorted);
  return {
    leftDegrees: fov.rightDegrees,
    rightDegrees: fov.leftDegrees,
    upDegrees: fov.upDegrees,
    downDegrees: fov.downDegrees
  };
};
DeviceInfo.prototype.getUndistortedFieldOfViewLeftEye = function () {
  var p = this.getUndistortedParams_();
  return {
    leftDegrees: radToDeg * Math.atan(p.outerDist),
    rightDegrees: radToDeg * Math.atan(p.innerDist),
    downDegrees: radToDeg * Math.atan(p.bottomDist),
    upDegrees: radToDeg * Math.atan(p.topDist)
  };
};
DeviceInfo.prototype.getUndistortedViewportLeftEye = function () {
  var p = this.getUndistortedParams_();
  var viewer = this.viewer;
  var device = this.device;
  var eyeToScreenDistance = viewer.screenLensDistance;
  var screenWidth = device.widthMeters / eyeToScreenDistance;
  var screenHeight = device.heightMeters / eyeToScreenDistance;
  var xPxPerTanAngle = device.width / screenWidth;
  var yPxPerTanAngle = device.height / screenHeight;
  var x = Math.round((p.eyePosX - p.outerDist) * xPxPerTanAngle);
  var y = Math.round((p.eyePosY - p.bottomDist) * yPxPerTanAngle);
  return {
    x: x,
    y: y,
    width: Math.round((p.eyePosX + p.innerDist) * xPxPerTanAngle) - x,
    height: Math.round((p.eyePosY + p.topDist) * yPxPerTanAngle) - y
  };
};
DeviceInfo.prototype.getUndistortedParams_ = function () {
  var viewer = this.viewer;
  var device = this.device;
  var distortion = this.distortion;
  var eyeToScreenDistance = viewer.screenLensDistance;
  var halfLensDistance = viewer.interLensDistance / 2 / eyeToScreenDistance;
  var screenWidth = device.widthMeters / eyeToScreenDistance;
  var screenHeight = device.heightMeters / eyeToScreenDistance;
  var eyePosX = screenWidth / 2 - halfLensDistance;
  var eyePosY = (viewer.baselineLensDistance - device.bevelMeters) / eyeToScreenDistance;
  var maxFov = viewer.fov;
  var viewerMax = distortion.distortInverse(Math.tan(degToRad * maxFov));
  var outerDist = Math.min(eyePosX, viewerMax);
  var innerDist = Math.min(halfLensDistance, viewerMax);
  var bottomDist = Math.min(eyePosY, viewerMax);
  var topDist = Math.min(screenHeight - eyePosY, viewerMax);
  return {
    outerDist: outerDist,
    innerDist: innerDist,
    topDist: topDist,
    bottomDist: bottomDist,
    eyePosX: eyePosX,
    eyePosY: eyePosY
  };
};
function CardboardViewer(params) {
  this.id = params.id;
  this.label = params.label;
  this.fov = params.fov;
  this.interLensDistance = params.interLensDistance;
  this.baselineLensDistance = params.baselineLensDistance;
  this.screenLensDistance = params.screenLensDistance;
  this.distortionCoefficients = params.distortionCoefficients;
  this.inverseCoefficients = params.inverseCoefficients;
}
DeviceInfo.Viewers = Viewers;
var format = 1;
var last_updated = "2018-02-20T22:55:10Z";
var devices = [{"type":"android","rules":[{"mdmh":"asus/*/Nexus 7/*"},{"ua":"Nexus 7"}],"dpi":[320.8,323],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"asus/*/ASUS_Z00AD/*"},{"ua":"ASUS_Z00AD"}],"dpi":[403,404.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Google/*/Pixel XL/*"},{"ua":"Pixel XL"}],"dpi":[537.9,533],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Google/*/Pixel/*"},{"ua":"Pixel"}],"dpi":[432.6,436.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"HTC/*/HTC6435LVW/*"},{"ua":"HTC6435LVW"}],"dpi":[449.7,443.3],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"HTC/*/HTC One XL/*"},{"ua":"HTC One XL"}],"dpi":[315.3,314.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"htc/*/Nexus 9/*"},{"ua":"Nexus 9"}],"dpi":289,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"HTC/*/HTC One M9/*"},{"ua":"HTC One M9"}],"dpi":[442.5,443.3],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"HTC/*/HTC One_M8/*"},{"ua":"HTC One_M8"}],"dpi":[449.7,447.4],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"HTC/*/HTC One/*"},{"ua":"HTC One"}],"dpi":472.8,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Huawei/*/Nexus 6P/*"},{"ua":"Nexus 6P"}],"dpi":[515.1,518],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LENOVO/*/Lenovo PB2-690Y/*"},{"ua":"Lenovo PB2-690Y"}],"dpi":[457.2,454.713],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"LGE/*/Nexus 5X/*"},{"ua":"Nexus 5X"}],"dpi":[422,419.9],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/LGMS345/*"},{"ua":"LGMS345"}],"dpi":[221.7,219.1],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"LGE/*/LG-D800/*"},{"ua":"LG-D800"}],"dpi":[422,424.1],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"LGE/*/LG-D850/*"},{"ua":"LG-D850"}],"dpi":[537.9,541.9],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"LGE/*/VS985 4G/*"},{"ua":"VS985 4G"}],"dpi":[537.9,535.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/Nexus 5/*"},{"ua":"Nexus 5 B"}],"dpi":[442.4,444.8],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/Nexus 4/*"},{"ua":"Nexus 4"}],"dpi":[319.8,318.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/LG-P769/*"},{"ua":"LG-P769"}],"dpi":[240.6,247.5],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/LGMS323/*"},{"ua":"LGMS323"}],"dpi":[206.6,204.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"LGE/*/LGLS996/*"},{"ua":"LGLS996"}],"dpi":[403.4,401.5],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Micromax/*/4560MMX/*"},{"ua":"4560MMX"}],"dpi":[240,219.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Micromax/*/A250/*"},{"ua":"Micromax A250"}],"dpi":[480,446.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Micromax/*/Micromax AQ4501/*"},{"ua":"Micromax AQ4501"}],"dpi":240,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/G5/*"},{"ua":"Moto G (5) Plus"}],"dpi":[403.4,403],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/DROID RAZR/*"},{"ua":"DROID RAZR"}],"dpi":[368.1,256.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT830C/*"},{"ua":"XT830C"}],"dpi":[254,255.9],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT1021/*"},{"ua":"XT1021"}],"dpi":[254,256.7],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/XT1023/*"},{"ua":"XT1023"}],"dpi":[254,256.7],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/XT1028/*"},{"ua":"XT1028"}],"dpi":[326.6,327.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT1034/*"},{"ua":"XT1034"}],"dpi":[326.6,328.4],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/XT1053/*"},{"ua":"XT1053"}],"dpi":[315.3,316.1],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT1562/*"},{"ua":"XT1562"}],"dpi":[403.4,402.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/Nexus 6/*"},{"ua":"Nexus 6 B"}],"dpi":[494.3,489.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT1063/*"},{"ua":"XT1063"}],"dpi":[295,296.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/XT1064/*"},{"ua":"XT1064"}],"dpi":[295,295.6],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/XT1092/*"},{"ua":"XT1092"}],"dpi":[422,424.1],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"motorola/*/XT1095/*"},{"ua":"XT1095"}],"dpi":[422,423.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"motorola/*/G4/*"},{"ua":"Moto G (4)"}],"dpi":401,"bw":4,"ac":1000},{"type":"android","rules":[{"mdmh":"OnePlus/*/A0001/*"},{"ua":"A0001"}],"dpi":[403.4,401],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"OnePlus/*/ONE E1005/*"},{"ua":"ONE E1005"}],"dpi":[442.4,441.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"OnePlus/*/ONE A2005/*"},{"ua":"ONE A2005"}],"dpi":[391.9,405.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"OnePlus/*/ONEPLUS A5000/*"},{"ua":"ONEPLUS A5000 "}],"dpi":[403.411,399.737],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"OnePlus/*/ONE A5010/*"},{"ua":"ONEPLUS A5010"}],"dpi":[403,400],"bw":2,"ac":1000},{"type":"android","rules":[{"mdmh":"OPPO/*/X909/*"},{"ua":"X909"}],"dpi":[442.4,444.1],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9082/*"},{"ua":"GT-I9082"}],"dpi":[184.7,185.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G360P/*"},{"ua":"SM-G360P"}],"dpi":[196.7,205.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/Nexus S/*"},{"ua":"Nexus S"}],"dpi":[234.5,229.8],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9300/*"},{"ua":"GT-I9300"}],"dpi":[304.8,303.9],"bw":5,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-T230NU/*"},{"ua":"SM-T230NU"}],"dpi":216,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SGH-T399/*"},{"ua":"SGH-T399"}],"dpi":[217.7,231.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SGH-M919/*"},{"ua":"SGH-M919"}],"dpi":[440.8,437.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N9005/*"},{"ua":"SM-N9005"}],"dpi":[386.4,387],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SAMSUNG-SM-N900A/*"},{"ua":"SAMSUNG-SM-N900A"}],"dpi":[386.4,387.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9500/*"},{"ua":"GT-I9500"}],"dpi":[442.5,443.3],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9505/*"},{"ua":"GT-I9505"}],"dpi":439.4,"bw":4,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G900F/*"},{"ua":"SM-G900F"}],"dpi":[415.6,431.6],"bw":5,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G900M/*"},{"ua":"SM-G900M"}],"dpi":[415.6,431.6],"bw":5,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G800F/*"},{"ua":"SM-G800F"}],"dpi":326.8,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G906S/*"},{"ua":"SM-G906S"}],"dpi":[562.7,572.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9300/*"},{"ua":"GT-I9300"}],"dpi":[306.7,304.8],"bw":5,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-T535/*"},{"ua":"SM-T535"}],"dpi":[142.6,136.4],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N920C/*"},{"ua":"SM-N920C"}],"dpi":[515.1,518.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N920P/*"},{"ua":"SM-N920P"}],"dpi":[386.3655,390.144],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N920W8/*"},{"ua":"SM-N920W8"}],"dpi":[515.1,518.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9300I/*"},{"ua":"GT-I9300I"}],"dpi":[304.8,305.8],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-I9195/*"},{"ua":"GT-I9195"}],"dpi":[249.4,256.7],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SPH-L520/*"},{"ua":"SPH-L520"}],"dpi":[249.4,255.9],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SAMSUNG-SGH-I717/*"},{"ua":"SAMSUNG-SGH-I717"}],"dpi":285.8,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SPH-D710/*"},{"ua":"SPH-D710"}],"dpi":[217.7,204.2],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/GT-N7100/*"},{"ua":"GT-N7100"}],"dpi":265.1,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SCH-I605/*"},{"ua":"SCH-I605"}],"dpi":265.1,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/Galaxy Nexus/*"},{"ua":"Galaxy Nexus"}],"dpi":[315.3,314.2],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N910H/*"},{"ua":"SM-N910H"}],"dpi":[515.1,518],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-N910C/*"},{"ua":"SM-N910C"}],"dpi":[515.2,520.2],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G130M/*"},{"ua":"SM-G130M"}],"dpi":[165.9,164.8],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G928I/*"},{"ua":"SM-G928I"}],"dpi":[515.1,518.4],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G920F/*"},{"ua":"SM-G920F"}],"dpi":580.6,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G920P/*"},{"ua":"SM-G920P"}],"dpi":[522.5,577],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G925F/*"},{"ua":"SM-G925F"}],"dpi":580.6,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G925V/*"},{"ua":"SM-G925V"}],"dpi":[522.5,576.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G930F/*"},{"ua":"SM-G930F"}],"dpi":576.6,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G935F/*"},{"ua":"SM-G935F"}],"dpi":533,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G950F/*"},{"ua":"SM-G950F"}],"dpi":[562.707,565.293],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"samsung/*/SM-G955U/*"},{"ua":"SM-G955U"}],"dpi":[522.514,525.762],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"Sony/*/C6903/*"},{"ua":"C6903"}],"dpi":[442.5,443.3],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"Sony/*/D6653/*"},{"ua":"D6653"}],"dpi":[428.6,427.6],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Sony/*/E6653/*"},{"ua":"E6653"}],"dpi":[428.6,425.7],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Sony/*/E6853/*"},{"ua":"E6853"}],"dpi":[403.4,401.9],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Sony/*/SGP321/*"},{"ua":"SGP321"}],"dpi":[224.7,224.1],"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{"ua":"ALCATEL ONE TOUCH Fierce"}],"dpi":[240,247.5],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"THL/*/thl 5000/*"},{"ua":"thl 5000"}],"dpi":[480,443.3],"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"Fly/*/IQ4412/*"},{"ua":"IQ4412"}],"dpi":307.9,"bw":3,"ac":1000},{"type":"android","rules":[{"mdmh":"ZTE/*/ZTE Blade L2/*"},{"ua":"ZTE Blade L2"}],"dpi":240,"bw":3,"ac":500},{"type":"android","rules":[{"mdmh":"BENEVE/*/VR518/*"},{"ua":"VR518"}],"dpi":480,"bw":3,"ac":500},{"type":"ios","rules":[{"res":[640,960]}],"dpi":[325.1,328.4],"bw":4,"ac":1000},{"type":"ios","rules":[{"res":[640,1136]}],"dpi":[317.1,320.2],"bw":3,"ac":1000},{"type":"ios","rules":[{"res":[750,1334]}],"dpi":326.4,"bw":4,"ac":1000},{"type":"ios","rules":[{"res":[1242,2208]}],"dpi":[453.6,458.4],"bw":4,"ac":1000},{"type":"ios","rules":[{"res":[1125,2001]}],"dpi":[410.9,415.4],"bw":4,"ac":1000},{"type":"ios","rules":[{"res":[1125,2436]}],"dpi":458,"bw":4,"ac":1000}];
var DPDB_CACHE = {
  format: format,
  last_updated: last_updated,
  devices: devices
};
function Dpdb(url, onDeviceParamsUpdated) {
  this.dpdb = DPDB_CACHE;
  this.recalculateDeviceParams_();
  if (url) {
    this.onDeviceParamsUpdated = onDeviceParamsUpdated;
    var xhr = new XMLHttpRequest();
    var obj = this;
    xhr.open('GET', url, true);
    xhr.addEventListener('load', function () {
      obj.loading = false;
      if (xhr.status >= 200 && xhr.status <= 299) {
        obj.dpdb = JSON.parse(xhr.response);
        obj.recalculateDeviceParams_();
      } else {
        console.error('Error loading online DPDB!');
      }
    });
    xhr.send();
  }
}
Dpdb.prototype.getDeviceParams = function () {
  return this.deviceParams;
};
Dpdb.prototype.recalculateDeviceParams_ = function () {
  var newDeviceParams = this.calcDeviceParams_();
  if (newDeviceParams) {
    this.deviceParams = newDeviceParams;
    if (this.onDeviceParamsUpdated) {
      this.onDeviceParamsUpdated(this.deviceParams);
    }
  } else {
    console.error('Failed to recalculate device parameters.');
  }
};
Dpdb.prototype.calcDeviceParams_ = function () {
  var db = this.dpdb;
  if (!db) {
    console.error('DPDB not available.');
    return null;
  }
  if (db.format != 1) {
    console.error('DPDB has unexpected format version.');
    return null;
  }
  if (!db.devices || !db.devices.length) {
    console.error('DPDB does not have a devices section.');
    return null;
  }
  var userAgent = navigator.userAgent || navigator.vendor || window.opera;
  var width = getScreenWidth();
  var height = getScreenHeight();
  if (!db.devices) {
    console.error('DPDB has no devices section.');
    return null;
  }
  for (var i = 0; i < db.devices.length; i++) {
    var device = db.devices[i];
    if (!device.rules) {
      console.warn('Device[' + i + '] has no rules section.');
      continue;
    }
    if (device.type != 'ios' && device.type != 'android') {
      console.warn('Device[' + i + '] has invalid type.');
      continue;
    }
    if (isIOS() != (device.type == 'ios')) continue;
    var matched = false;
    for (var j = 0; j < device.rules.length; j++) {
      var rule = device.rules[j];
      if (this.matchRule_(rule, userAgent, width, height)) {
        matched = true;
        break;
      }
    }
    if (!matched) continue;
    var xdpi = device.dpi[0] || device.dpi;
    var ydpi = device.dpi[1] || device.dpi;
    return new DeviceParams({ xdpi: xdpi, ydpi: ydpi, bevelMm: device.bw });
  }
  console.warn('No DPDB device match.');
  return null;
};
Dpdb.prototype.matchRule_ = function (rule, ua, screenWidth, screenHeight) {
  if (!rule.ua && !rule.res) return false;
  if (rule.ua && ua.indexOf(rule.ua) < 0) return false;
  if (rule.res) {
    if (!rule.res[0] || !rule.res[1]) return false;
    var resX = rule.res[0];
    var resY = rule.res[1];
    if (Math.min(screenWidth, screenHeight) != Math.min(resX, resY) || Math.max(screenWidth, screenHeight) != Math.max(resX, resY)) {
      return false;
    }
  }
  return true;
};
function DeviceParams(params) {
  this.xdpi = params.xdpi;
  this.ydpi = params.ydpi;
  this.bevelMm = params.bevelMm;
}
function SensorSample(sample, timestampS) {
  this.set(sample, timestampS);
}
SensorSample.prototype.set = function (sample, timestampS) {
  this.sample = sample;
  this.timestampS = timestampS;
};
SensorSample.prototype.copy = function (sensorSample) {
  this.set(sensorSample.sample, sensorSample.timestampS);
};
function ComplementaryFilter(kFilter, isDebug) {
  this.kFilter = kFilter;
  this.isDebug = isDebug;
  this.currentAccelMeasurement = new SensorSample();
  this.currentGyroMeasurement = new SensorSample();
  this.previousGyroMeasurement = new SensorSample();
  if (isIOS()) {
    this.filterQ = new Quaternion(-1, 0, 0, 1);
  } else {
    this.filterQ = new Quaternion(1, 0, 0, 1);
  }
  this.previousFilterQ = new Quaternion();
  this.previousFilterQ.copy(this.filterQ);
  this.accelQ = new Quaternion();
  this.isOrientationInitialized = false;
  this.estimatedGravity = new Vector3();
  this.measuredGravity = new Vector3();
  this.gyroIntegralQ = new Quaternion();
}
ComplementaryFilter.prototype.addAccelMeasurement = function (vector, timestampS) {
  this.currentAccelMeasurement.set(vector, timestampS);
};
ComplementaryFilter.prototype.addGyroMeasurement = function (vector, timestampS) {
  this.currentGyroMeasurement.set(vector, timestampS);
  var deltaT = timestampS - this.previousGyroMeasurement.timestampS;
  if (isTimestampDeltaValid(deltaT)) {
    this.run_();
  }
  this.previousGyroMeasurement.copy(this.currentGyroMeasurement);
};
ComplementaryFilter.prototype.run_ = function () {
  if (!this.isOrientationInitialized) {
    this.accelQ = this.accelToQuaternion_(this.currentAccelMeasurement.sample);
    this.previousFilterQ.copy(this.accelQ);
    this.isOrientationInitialized = true;
    return;
  }
  var deltaT = this.currentGyroMeasurement.timestampS - this.previousGyroMeasurement.timestampS;
  var gyroDeltaQ = this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample, deltaT);
  this.gyroIntegralQ.multiply(gyroDeltaQ);
  this.filterQ.copy(this.previousFilterQ);
  this.filterQ.multiply(gyroDeltaQ);
  var invFilterQ = new Quaternion();
  invFilterQ.copy(this.filterQ);
  invFilterQ.inverse();
  this.estimatedGravity.set(0, 0, -1);
  this.estimatedGravity.applyQuaternion(invFilterQ);
  this.estimatedGravity.normalize();
  this.measuredGravity.copy(this.currentAccelMeasurement.sample);
  this.measuredGravity.normalize();
  var deltaQ = new Quaternion();
  deltaQ.setFromUnitVectors(this.estimatedGravity, this.measuredGravity);
  deltaQ.inverse();
  if (this.isDebug) {
    console.log('Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)', radToDeg * getQuaternionAngle(deltaQ), this.estimatedGravity.x.toFixed(1), this.estimatedGravity.y.toFixed(1), this.estimatedGravity.z.toFixed(1), this.measuredGravity.x.toFixed(1), this.measuredGravity.y.toFixed(1), this.measuredGravity.z.toFixed(1));
  }
  var targetQ = new Quaternion();
  targetQ.copy(this.filterQ);
  targetQ.multiply(deltaQ);
  this.filterQ.slerp(targetQ, 1 - this.kFilter);
  this.previousFilterQ.copy(this.filterQ);
};
ComplementaryFilter.prototype.getOrientation = function () {
  return this.filterQ;
};
ComplementaryFilter.prototype.accelToQuaternion_ = function (accel) {
  var normAccel = new Vector3();
  normAccel.copy(accel);
  normAccel.normalize();
  var quat = new Quaternion();
  quat.setFromUnitVectors(new Vector3(0, 0, -1), normAccel);
  quat.inverse();
  return quat;
};
ComplementaryFilter.prototype.gyroToQuaternionDelta_ = function (gyro, dt) {
  var quat = new Quaternion();
  var axis = new Vector3();
  axis.copy(gyro);
  axis.normalize();
  quat.setFromAxisAngle(axis, gyro.length() * dt);
  return quat;
};
function PosePredictor(predictionTimeS, isDebug) {
  this.predictionTimeS = predictionTimeS;
  this.isDebug = isDebug;
  this.previousQ = new Quaternion();
  this.previousTimestampS = null;
  this.deltaQ = new Quaternion();
  this.outQ = new Quaternion();
}
PosePredictor.prototype.getPrediction = function (currentQ, gyro, timestampS) {
  if (!this.previousTimestampS) {
    this.previousQ.copy(currentQ);
    this.previousTimestampS = timestampS;
    return currentQ;
  }
  var axis = new Vector3();
  axis.copy(gyro);
  axis.normalize();
  var angularSpeed = gyro.length();
  if (angularSpeed < degToRad * 20) {
    if (this.isDebug) {
      console.log('Moving slowly, at %s deg/s: no prediction', (radToDeg * angularSpeed).toFixed(1));
    }
    this.outQ.copy(currentQ);
    this.previousQ.copy(currentQ);
    return this.outQ;
  }
  var predictAngle = angularSpeed * this.predictionTimeS;
  this.deltaQ.setFromAxisAngle(axis, predictAngle);
  this.outQ.copy(this.previousQ);
  this.outQ.multiply(this.deltaQ);
  this.previousQ.copy(currentQ);
  this.previousTimestampS = timestampS;
  return this.outQ;
};
function FusionPoseSensor(kFilter, predictionTime, yawOnly, isDebug) {
  this.yawOnly = yawOnly;
  this.accelerometer = new Vector3();
  this.gyroscope = new Vector3();
  this.filter = new ComplementaryFilter(kFilter, isDebug);
  this.posePredictor = new PosePredictor(predictionTime, isDebug);
  this.isFirefoxAndroid = isFirefoxAndroid();
  this.isIOS = isIOS();
  var chromeVersion = getChromeVersion();
  this.isDeviceMotionInRadians = !this.isIOS && chromeVersion && chromeVersion < 66;
  this.isWithoutDeviceMotion = isChromeWithoutDeviceMotion();
  this.filterToWorldQ = new Quaternion();
  if (isIOS()) {
    this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), Math.PI / 2);
  } else {
    this.filterToWorldQ.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);
  }
  this.inverseWorldToScreenQ = new Quaternion();
  this.worldToScreenQ = new Quaternion();
  this.originalPoseAdjustQ = new Quaternion();
  this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0, 0, 1), -window.orientation * Math.PI / 180);
  this.setScreenTransform_();
  if (isLandscapeMode()) {
    this.filterToWorldQ.multiply(this.inverseWorldToScreenQ);
  }
  this.resetQ = new Quaternion();
  this.orientationOut_ = new Float32Array(4);
  this.start();
}
FusionPoseSensor.prototype.getPosition = function () {
  return null;
};
FusionPoseSensor.prototype.getOrientation = function () {
  var orientation = void 0;
  if (this.isWithoutDeviceMotion && this._deviceOrientationQ) {
    this.deviceOrientationFixQ = this.deviceOrientationFixQ || function () {
      var z = new Quaternion().setFromAxisAngle(new Vector3(0, 0, -1), 0);
      var y = new Quaternion();
      if (window.orientation === -90) {
        y.setFromAxisAngle(new Vector3(0, 1, 0), Math.PI / -2);
      } else {
        y.setFromAxisAngle(new Vector3(0, 1, 0), Math.PI / 2);
      }
      return z.multiply(y);
    }();
    this.deviceOrientationFilterToWorldQ = this.deviceOrientationFilterToWorldQ || function () {
      var q = new Quaternion();
      q.setFromAxisAngle(new Vector3(1, 0, 0), -Math.PI / 2);
      return q;
    }();
    orientation = this._deviceOrientationQ;
    var out = new Quaternion();
    out.copy(orientation);
    out.multiply(this.deviceOrientationFilterToWorldQ);
    out.multiply(this.resetQ);
    out.multiply(this.worldToScreenQ);
    out.multiplyQuaternions(this.deviceOrientationFixQ, out);
    if (this.yawOnly) {
      out.x = 0;
      out.z = 0;
      out.normalize();
    }
    this.orientationOut_[0] = out.x;
    this.orientationOut_[1] = out.y;
    this.orientationOut_[2] = out.z;
    this.orientationOut_[3] = out.w;
    return this.orientationOut_;
  } else {
    var filterOrientation = this.filter.getOrientation();
    orientation = this.posePredictor.getPrediction(filterOrientation, this.gyroscope, this.previousTimestampS);
  }
  var out = new Quaternion();
  out.copy(this.filterToWorldQ);
  out.multiply(this.resetQ);
  out.multiply(orientation);
  out.multiply(this.worldToScreenQ);
  if (this.yawOnly) {
    out.x = 0;
    out.z = 0;
    out.normalize();
  }
  this.orientationOut_[0] = out.x;
  this.orientationOut_[1] = out.y;
  this.orientationOut_[2] = out.z;
  this.orientationOut_[3] = out.w;
  return this.orientationOut_;
};
FusionPoseSensor.prototype.resetPose = function () {
  this.resetQ.copy(this.filter.getOrientation());
  this.resetQ.x = 0;
  this.resetQ.y = 0;
  this.resetQ.z *= -1;
  this.resetQ.normalize();
  if (isLandscapeMode()) {
    this.resetQ.multiply(this.inverseWorldToScreenQ);
  }
  this.resetQ.multiply(this.originalPoseAdjustQ);
};
FusionPoseSensor.prototype.onDeviceOrientation_ = function (e) {
  this._deviceOrientationQ = this._deviceOrientationQ || new Quaternion();
  var alpha = e.alpha,
      beta = e.beta,
      gamma = e.gamma;
  alpha = (alpha || 0) * Math.PI / 180;
  beta = (beta || 0) * Math.PI / 180;
  gamma = (gamma || 0) * Math.PI / 180;
  this._deviceOrientationQ.setFromEulerYXZ(beta, alpha, -gamma);
};
FusionPoseSensor.prototype.onDeviceMotion_ = function (deviceMotion) {
  this.updateDeviceMotion_(deviceMotion);
};
FusionPoseSensor.prototype.updateDeviceMotion_ = function (deviceMotion) {
  var accGravity = deviceMotion.accelerationIncludingGravity;
  var rotRate = deviceMotion.rotationRate;
  var timestampS = deviceMotion.timeStamp / 1000;
  var deltaS = timestampS - this.previousTimestampS;
  if (deltaS < 0) {
    warnOnce('fusion-pose-sensor:invalid:non-monotonic', 'Invalid timestamps detected: non-monotonic timestamp from devicemotion');
    this.previousTimestampS = timestampS;
    return;
  } else if (deltaS <= MIN_TIMESTEP || deltaS > MAX_TIMESTEP) {
    warnOnce('fusion-pose-sensor:invalid:outside-threshold', 'Invalid timestamps detected: Timestamp from devicemotion outside expected range.');
    this.previousTimestampS = timestampS;
    return;
  }
  this.accelerometer.set(-accGravity.x, -accGravity.y, -accGravity.z);
  if (isR7()) {
    this.gyroscope.set(-rotRate.beta, rotRate.alpha, rotRate.gamma);
  } else {
    this.gyroscope.set(rotRate.alpha, rotRate.beta, rotRate.gamma);
  }
  if (!this.isDeviceMotionInRadians) {
    this.gyroscope.multiplyScalar(Math.PI / 180);
  }
  this.filter.addAccelMeasurement(this.accelerometer, timestampS);
  this.filter.addGyroMeasurement(this.gyroscope, timestampS);
  this.previousTimestampS = timestampS;
};
FusionPoseSensor.prototype.onOrientationChange_ = function (screenOrientation) {
  this.setScreenTransform_();
};
FusionPoseSensor.prototype.onMessage_ = function (event) {
  var message = event.data;
  if (!message || !message.type) {
    return;
  }
  var type = message.type.toLowerCase();
  if (type !== 'devicemotion') {
    return;
  }
  this.updateDeviceMotion_(message.deviceMotionEvent);
};
FusionPoseSensor.prototype.setScreenTransform_ = function () {
  this.worldToScreenQ.set(0, 0, 0, 1);
  switch (window.orientation) {
    case 0:
      break;
    case 90:
      this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), -Math.PI / 2);
      break;
    case -90:
      this.worldToScreenQ.setFromAxisAngle(new Vector3(0, 0, 1), Math.PI / 2);
      break;
    case 180:
      break;
  }
  this.inverseWorldToScreenQ.copy(this.worldToScreenQ);
  this.inverseWorldToScreenQ.inverse();
};
FusionPoseSensor.prototype.start = function () {
  this.onDeviceMotionCallback_ = this.onDeviceMotion_.bind(this);
  this.onOrientationChangeCallback_ = this.onOrientationChange_.bind(this);
  this.onMessageCallback_ = this.onMessage_.bind(this);
  this.onDeviceOrientationCallback_ = this.onDeviceOrientation_.bind(this);
  if (isIOS() && isInsideCrossOriginIFrame()) {
    window.addEventListener('message', this.onMessageCallback_);
  }
  window.addEventListener('orientationchange', this.onOrientationChangeCallback_);
  if (this.isWithoutDeviceMotion) {
    window.addEventListener('deviceorientation', this.onDeviceOrientationCallback_);
  } else {
    window.addEventListener('devicemotion', this.onDeviceMotionCallback_);
  }
};
FusionPoseSensor.prototype.stop = function () {
  window.removeEventListener('devicemotion', this.onDeviceMotionCallback_);
  window.removeEventListener('deviceorientation', this.onDeviceOrientationCallback_);
  window.removeEventListener('orientationchange', this.onOrientationChangeCallback_);
  window.removeEventListener('message', this.onMessageCallback_);
};
var SENSOR_FREQUENCY = 60;
var X_AXIS = new Vector3(1, 0, 0);
var Z_AXIS = new Vector3(0, 0, 1);
var orientation = {};
if (screen.orientation) {
  orientation = screen.orientation;
} else if (screen.msOrientation) {
  orientation = screen.msOrientation;
} else {
  Object.defineProperty(orientation, 'angle', {
    get: function get$$1() {
      return window.orientation || 0;
    }
  });
}
var SENSOR_TO_VR = new Quaternion();
SENSOR_TO_VR.setFromAxisAngle(X_AXIS, -Math.PI / 2);
SENSOR_TO_VR.multiply(new Quaternion().setFromAxisAngle(Z_AXIS, Math.PI / 2));
var PoseSensor = function () {
  function PoseSensor(config) {
    classCallCheck(this, PoseSensor);
    this.config = config;
    this.sensor = null;
    this.fusionSensor = null;
    this._out = new Float32Array(4);
    this.api = null;
    this.errors = [];
    this._sensorQ = new Quaternion();
    this._worldToScreenQ = new Quaternion();
    this._outQ = new Quaternion();
    this._onSensorRead = this._onSensorRead.bind(this);
    this._onSensorError = this._onSensorError.bind(this);
    this._onOrientationChange = this._onOrientationChange.bind(this);
    this._onOrientationChange();
    this.init();
  }
  createClass(PoseSensor, [{
    key: 'init',
    value: function init() {
      var sensor = null;
      try {
        sensor = new RelativeOrientationSensor({ frequency: SENSOR_FREQUENCY });
        sensor.addEventListener('error', this._onSensorError);
      } catch (error) {
        this.errors.push(error);
        if (error.name === 'SecurityError') {
          console.error('Cannot construct sensors due to the Feature Policy');
          console.warn('Attempting to fall back using "devicemotion"; however this will ' + 'fail in the future without correct permissions.');
          this.useDeviceMotion();
        } else if (error.name === 'ReferenceError') {
          this.useDeviceMotion();
        } else {
          console.error(error);
        }
      }
      if (sensor) {
        this.api = 'sensor';
        this.sensor = sensor;
        this.sensor.addEventListener('reading', this._onSensorRead);
        this.sensor.start();
      }
      window.addEventListener('orientationchange', this._onOrientationChange);
    }
  }, {
    key: 'useDeviceMotion',
    value: function useDeviceMotion() {
      this.api = 'devicemotion';
      this.fusionSensor = new FusionPoseSensor(this.config.K_FILTER, this.config.PREDICTION_TIME_S, this.config.YAW_ONLY, this.config.DEBUG);
      if (this.sensor) {
        this.sensor.removeEventListener('reading', this._onSensorRead);
        this.sensor.removeEventListener('error', this._onSensorError);
        this.sensor = null;
      }
    }
  }, {
    key: 'getOrientation',
    value: function getOrientation() {
      if (this.fusionSensor) {
        return this.fusionSensor.getOrientation();
      }
      if (!this.sensor || !this.sensor.quaternion) {
        this._out[0] = this._out[1] = this._out[2] = 0;
        this._out[3] = 1;
        return this._out;
      }
      var q = this.sensor.quaternion;
      this._sensorQ.set(q[0], q[1], q[2], q[3]);
      var out = this._outQ;
      out.copy(SENSOR_TO_VR);
      out.multiply(this._sensorQ);
      out.multiply(this._worldToScreenQ);
      if (this.config.YAW_ONLY) {
        out.x = out.z = 0;
        out.normalize();
      }
      this._out[0] = out.x;
      this._out[1] = out.y;
      this._out[2] = out.z;
      this._out[3] = out.w;
      return this._out;
    }
  }, {
    key: '_onSensorError',
    value: function _onSensorError(event) {
      this.errors.push(event.error);
      if (event.error.name === 'NotAllowedError') {
        console.error('Permission to access sensor was denied');
      } else if (event.error.name === 'NotReadableError') {
        console.error('Sensor could not be read');
      } else {
        console.error(event.error);
      }
      this.useDeviceMotion();
    }
  }, {
    key: '_onSensorRead',
    value: function _onSensorRead() {}
  }, {
    key: '_onOrientationChange',
    value: function _onOrientationChange() {
      var angle = -orientation.angle * Math.PI / 180;
      this._worldToScreenQ.setFromAxisAngle(Z_AXIS, angle);
    }
  }]);
  return PoseSensor;
}();
var rotateInstructionsAsset = 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE5OHB4IiBoZWlnaHQ9IjI0MHB4IiB2aWV3Qm94PSIwIDAgMTk4IDI0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDMuMy4zICgxMjA4MSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+dHJhbnNpdGlvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJ0cmFuc2l0aW9uIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIj4KICAgICAgICAgICAgPGcgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTQtKy1JbXBvcnRlZC1MYXllcnMtQ29weS0rLUltcG9ydGVkLUxheWVycy1Db3B5LTItQ29weSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCI+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHktNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEwNy4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjYyNSwyLjUyNyBDMTQ5LjYyNSwyLjUyNyAxNTUuODA1LDYuMDk2IDE1Ni4zNjIsNi40MTggTDE1Ni4zNjIsNy4zMDQgQzE1Ni4zNjIsNy40ODEgMTU2LjM3NSw3LjY2NCAxNTYuNCw3Ljg1MyBDMTU2LjQxLDcuOTM0IDE1Ni40Miw4LjAxNSAxNTYuNDI3LDguMDk1IEMxNTYuNTY3LDkuNTEgMTU3LjQwMSwxMS4wOTMgMTU4LjUzMiwxMi4wOTQgTDE2NC4yNTIsMTcuMTU2IEwxNjQuMzMzLDE3LjA2NiBDMTY0LjMzMywxNy4wNjYgMTY4LjcxNSwxNC41MzYgMTY5LjU2OCwxNC4wNDIgQzE3MS4wMjUsMTQuODgzIDE5NS41MzgsMjkuMDM1IDE5NS41MzgsMjkuMDM1IEwxOTUuNTM4LDgzLjAzNiBDMTk1LjUzOCw4My44MDcgMTk1LjE1Miw4NC4yNTMgMTk0LjU5LDg0LjI1MyBDMTk0LjM1Nyw4NC4yNTMgMTk0LjA5NSw4NC4xNzcgMTkzLjgxOCw4NC4wMTcgTDE2OS44NTEsNzAuMTc5IEwxNjkuODM3LDcwLjIwMyBMMTQyLjUxNSw4NS45NzggTDE0MS42NjUsODQuNjU1IEMxMzYuOTM0LDgzLjEyNiAxMzEuOTE3LDgxLjkxNSAxMjYuNzE0LDgxLjA0NSBDMTI2LjcwOSw4MS4wNiAxMjYuNzA3LDgxLjA2OSAxMjYuNzA3LDgxLjA2OSBMMTIxLjY0LDk4LjAzIEwxMTMuNzQ5LDEwMi41ODYgTDExMy43MTIsMTAyLjUyMyBMMTEzLjcxMiwxMzAuMTEzIEMxMTMuNzEyLDEzMC44ODUgMTEzLjMyNiwxMzEuMzMgMTEyLjc2NCwxMzEuMzMgQzExMi41MzIsMTMxLjMzIDExMi4yNjksMTMxLjI1NCAxMTEuOTkyLDEzMS4wOTQgTDY5LjUxOSwxMDYuNTcyIEM2OC41NjksMTA2LjAyMyA2Ny43OTksMTA0LjY5NSA2Ny43OTksMTAzLjYwNSBMNjcuNzk5LDEwMi41NyBMNjcuNzc4LDEwMi42MTcgQzY3LjI3LDEwMi4zOTMgNjYuNjQ4LDEwMi4yNDkgNjUuOTYyLDEwMi4yMTggQzY1Ljg3NSwxMDIuMjE0IDY1Ljc4OCwxMDIuMjEyIDY1LjcwMSwxMDIuMjEyIEM2NS42MDYsMTAyLjIxMiA2NS41MTEsMTAyLjIxNSA2NS40MTYsMTAyLjIxOSBDNjUuMTk1LDEwMi4yMjkgNjQuOTc0LDEwMi4yMzUgNjQuNzU0LDEwMi4yMzUgQzY0LjMzMSwxMDIuMjM1IDYzLjkxMSwxMDIuMjE2IDYzLjQ5OCwxMDIuMTc4IEM2MS44NDMsMTAyLjAyNSA2MC4yOTgsMTAxLjU3OCA1OS4wOTQsMTAwLjg4MiBMMTIuNTE4LDczLjk5MiBMMTIuNTIzLDc0LjAwNCBMMi4yNDUsNTUuMjU0IEMxLjI0NCw1My40MjcgMi4wMDQsNTEuMDM4IDMuOTQzLDQ5LjkxOCBMNTkuOTU0LDE3LjU3MyBDNjAuNjI2LDE3LjE4NSA2MS4zNSwxNy4wMDEgNjIuMDUzLDE3LjAwMSBDNjMuMzc5LDE3LjAwMSA2NC42MjUsMTcuNjYgNjUuMjgsMTguODU0IEw2NS4yODUsMTguODUxIEw2NS41MTIsMTkuMjY0IEw2NS41MDYsMTkuMjY4IEM2NS45MDksMjAuMDAzIDY2LjQwNSwyMC42OCA2Ni45ODMsMjEuMjg2IEw2Ny4yNiwyMS41NTYgQzY5LjE3NCwyMy40MDYgNzEuNzI4LDI0LjM1NyA3NC4zNzMsMjQuMzU3IEM3Ni4zMjIsMjQuMzU3IDc4LjMyMSwyMy44NCA4MC4xNDgsMjIuNzg1IEM4MC4xNjEsMjIuNzg1IDg3LjQ2NywxOC41NjYgODcuNDY3LDE4LjU2NiBDODguMTM5LDE4LjE3OCA4OC44NjMsMTcuOTk0IDg5LjU2NiwxNy45OTQgQzkwLjg5MiwxNy45OTQgOTIuMTM4LDE4LjY1MiA5Mi43OTIsMTkuODQ3IEw5Ni4wNDIsMjUuNzc1IEw5Ni4wNjQsMjUuNzU3IEwxMDIuODQ5LDI5LjY3NCBMMTAyLjc0NCwyOS40OTIgTDE0OS42MjUsMi41MjcgTTE0OS42MjUsMC44OTIgQzE0OS4zNDMsMC44OTIgMTQ5LjA2MiwwLjk2NSAxNDguODEsMS4xMSBMMTAyLjY0MSwyNy42NjYgTDk3LjIzMSwyNC41NDIgTDk0LjIyNiwxOS4wNjEgQzkzLjMxMywxNy4zOTQgOTEuNTI3LDE2LjM1OSA4OS41NjYsMTYuMzU4IEM4OC41NTUsMTYuMzU4IDg3LjU0NiwxNi42MzIgODYuNjQ5LDE3LjE1IEM4My44NzgsMTguNzUgNzkuNjg3LDIxLjE2OSA3OS4zNzQsMjEuMzQ1IEM3OS4zNTksMjEuMzUzIDc5LjM0NSwyMS4zNjEgNzkuMzMsMjEuMzY5IEM3Ny43OTgsMjIuMjU0IDc2LjA4NCwyMi43MjIgNzQuMzczLDIyLjcyMiBDNzIuMDgxLDIyLjcyMiA2OS45NTksMjEuODkgNjguMzk3LDIwLjM4IEw2OC4xNDUsMjAuMTM1IEM2Ny43MDYsMTkuNjcyIDY3LjMyMywxOS4xNTYgNjcuMDA2LDE4LjYwMSBDNjYuOTg4LDE4LjU1OSA2Ni45NjgsMTguNTE5IDY2Ljk0NiwxOC40NzkgTDY2LjcxOSwxOC4wNjUgQzY2LjY5LDE4LjAxMiA2Ni42NTgsMTcuOTYgNjYuNjI0LDE3LjkxMSBDNjUuNjg2LDE2LjMzNyA2My45NTEsMTUuMzY2IDYyLjA1MywxNS4zNjYgQzYxLjA0MiwxNS4zNjYgNjAuMDMzLDE1LjY0IDU5LjEzNiwxNi4xNTggTDMuMTI1LDQ4LjUwMiBDMC40MjYsNTAuMDYxIC0wLjYxMyw1My40NDIgMC44MTEsNTYuMDQgTDExLjA4OSw3NC43OSBDMTEuMjY2LDc1LjExMyAxMS41MzcsNzUuMzUzIDExLjg1LDc1LjQ5NCBMNTguMjc2LDEwMi4yOTggQzU5LjY3OSwxMDMuMTA4IDYxLjQzMywxMDMuNjMgNjMuMzQ4LDEwMy44MDYgQzYzLjgxMiwxMDMuODQ4IDY0LjI4NSwxMDMuODcgNjQuNzU0LDEwMy44NyBDNjUsMTAzLjg3IDY1LjI0OSwxMDMuODY0IDY1LjQ5NCwxMDMuODUyIEM2NS41NjMsMTAzLjg0OSA2NS42MzIsMTAzLjg0NyA2NS43MDEsMTAzLjg0NyBDNjUuNzY0LDEwMy44NDcgNjUuODI4LDEwMy44NDkgNjUuODksMTAzLjg1MiBDNjUuOTg2LDEwMy44NTYgNjYuMDgsMTAzLjg2MyA2Ni4xNzMsMTAzLjg3NCBDNjYuMjgyLDEwNS40NjcgNjcuMzMyLDEwNy4xOTcgNjguNzAyLDEwNy45ODggTDExMS4xNzQsMTMyLjUxIEMxMTEuNjk4LDEzMi44MTIgMTEyLjIzMiwxMzIuOTY1IDExMi43NjQsMTMyLjk2NSBDMTE0LjI2MSwxMzIuOTY1IDExNS4zNDcsMTMxLjc2NSAxMTUuMzQ3LDEzMC4xMTMgTDExNS4zNDcsMTAzLjU1MSBMMTIyLjQ1OCw5OS40NDYgQzEyMi44MTksOTkuMjM3IDEyMy4wODcsOTguODk4IDEyMy4yMDcsOTguNDk4IEwxMjcuODY1LDgyLjkwNSBDMTMyLjI3OSw4My43MDIgMTM2LjU1Nyw4NC43NTMgMTQwLjYwNyw4Ni4wMzMgTDE0MS4xNCw4Ni44NjIgQzE0MS40NTEsODcuMzQ2IDE0MS45NzcsODcuNjEzIDE0Mi41MTYsODcuNjEzIEMxNDIuNzk0LDg3LjYxMyAxNDMuMDc2LDg3LjU0MiAxNDMuMzMzLDg3LjM5MyBMMTY5Ljg2NSw3Mi4wNzYgTDE5Myw4NS40MzMgQzE5My41MjMsODUuNzM1IDE5NC4wNTgsODUuODg4IDE5NC41OSw4NS44ODggQzE5Ni4wODcsODUuODg4IDE5Ny4xNzMsODQuNjg5IDE5Ny4xNzMsODMuMDM2IEwxOTcuMTczLDI5LjAzNSBDMTk3LjE3MywyOC40NTEgMTk2Ljg2MSwyNy45MTEgMTk2LjM1NSwyNy42MTkgQzE5Ni4zNTUsMjcuNjE5IDE3MS44NDMsMTMuNDY3IDE3MC4zODUsMTIuNjI2IEMxNzAuMTMyLDEyLjQ4IDE2OS44NSwxMi40MDcgMTY5LjU2OCwxMi40MDcgQzE2OS4yODUsMTIuNDA3IDE2OS4wMDIsMTIuNDgxIDE2OC43NDksMTIuNjI3IEMxNjguMTQzLDEyLjk3OCAxNjUuNzU2LDE0LjM1NyAxNjQuNDI0LDE1LjEyNSBMMTU5LjYxNSwxMC44NyBDMTU4Ljc5NiwxMC4xNDUgMTU4LjE1NCw4LjkzNyAxNTguMDU0LDcuOTM0IEMxNTguMDQ1LDcuODM3IDE1OC4wMzQsNy43MzkgMTU4LjAyMSw3LjY0IEMxNTguMDA1LDcuNTIzIDE1Ny45OTgsNy40MSAxNTcuOTk4LDcuMzA0IEwxNTcuOTk4LDYuNDE4IEMxNTcuOTk4LDUuODM0IDE1Ny42ODYsNS4yOTUgMTU3LjE4MSw1LjAwMiBDMTU2LjYyNCw0LjY4IDE1MC40NDIsMS4xMTEgMTUwLjQ0MiwxLjExMSBDMTUwLjE4OSwwLjk2NSAxNDkuOTA3LDAuODkyIDE0OS42MjUsMC44OTIiIGlkPSJGaWxsLTEiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTYuMDI3LDI1LjYzNiBMMTQyLjYwMyw1Mi41MjcgQzE0My44MDcsNTMuMjIyIDE0NC41ODIsNTQuMTE0IDE0NC44NDUsNTUuMDY4IEwxNDQuODM1LDU1LjA3NSBMNjMuNDYxLDEwMi4wNTcgTDYzLjQ2LDEwMi4wNTcgQzYxLjgwNiwxMDEuOTA1IDYwLjI2MSwxMDEuNDU3IDU5LjA1NywxMDAuNzYyIEwxMi40ODEsNzMuODcxIEw5Ni4wMjcsMjUuNjM2IiBpZD0iRmlsbC0yIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYzLjQ2MSwxMDIuMTc0IEM2My40NTMsMTAyLjE3NCA2My40NDYsMTAyLjE3NCA2My40MzksMTAyLjE3MiBDNjEuNzQ2LDEwMi4wMTYgNjAuMjExLDEwMS41NjMgNTguOTk4LDEwMC44NjMgTDEyLjQyMiw3My45NzMgQzEyLjM4Niw3My45NTIgMTIuMzY0LDczLjkxNCAxMi4zNjQsNzMuODcxIEMxMi4zNjQsNzMuODMgMTIuMzg2LDczLjc5MSAxMi40MjIsNzMuNzcgTDk1Ljk2OCwyNS41MzUgQzk2LjAwNCwyNS41MTQgOTYuMDQ5LDI1LjUxNCA5Ni4wODUsMjUuNTM1IEwxNDIuNjYxLDUyLjQyNiBDMTQzLjg4OCw1My4xMzQgMTQ0LjY4Miw1NC4wMzggMTQ0Ljk1Nyw1NS4wMzcgQzE0NC45Nyw1NS4wODMgMTQ0Ljk1Myw1NS4xMzMgMTQ0LjkxNSw1NS4xNjEgQzE0NC45MTEsNTUuMTY1IDE0NC44OTgsNTUuMTc0IDE0NC44OTQsNTUuMTc3IEw2My41MTksMTAyLjE1OCBDNjMuNTAxLDEwMi4xNjkgNjMuNDgxLDEwMi4xNzQgNjMuNDYxLDEwMi4xNzQgTDYzLjQ2MSwxMDIuMTc0IFogTTEyLjcxNCw3My44NzEgTDU5LjExNSwxMDAuNjYxIEM2MC4yOTMsMTAxLjM0MSA2MS43ODYsMTAxLjc4MiA2My40MzUsMTAxLjkzNyBMMTQ0LjcwNyw1NS4wMTUgQzE0NC40MjgsNTQuMTA4IDE0My42ODIsNTMuMjg1IDE0Mi41NDQsNTIuNjI4IEw5Ni4wMjcsMjUuNzcxIEwxMi43MTQsNzMuODcxIEwxMi43MTQsNzMuODcxIFoiIGlkPSJGaWxsLTMiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ4LjMyNyw1OC40NzEgQzE0OC4xNDUsNTguNDggMTQ3Ljk2Miw1OC40OCAxNDcuNzgxLDU4LjQ3MiBDMTQ1Ljg4Nyw1OC4zODkgMTQ0LjQ3OSw1Ny40MzQgMTQ0LjYzNiw1Ni4zNCBDMTQ0LjY4OSw1NS45NjcgMTQ0LjY2NCw1NS41OTcgMTQ0LjU2NCw1NS4yMzUgTDYzLjQ2MSwxMDIuMDU3IEM2NC4wODksMTAyLjExNSA2NC43MzMsMTAyLjEzIDY1LjM3OSwxMDIuMDk5IEM2NS41NjEsMTAyLjA5IDY1Ljc0MywxMDIuMDkgNjUuOTI1LDEwMi4wOTggQzY3LjgxOSwxMDIuMTgxIDY5LjIyNywxMDMuMTM2IDY5LjA3LDEwNC4yMyBMMTQ4LjMyNyw1OC40NzEiIGlkPSJGaWxsLTQiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNjkuMDcsMTA0LjM0NyBDNjkuMDQ4LDEwNC4zNDcgNjkuMDI1LDEwNC4zNCA2OS4wMDUsMTA0LjMyNyBDNjguOTY4LDEwNC4zMDEgNjguOTQ4LDEwNC4yNTcgNjguOTU1LDEwNC4yMTMgQzY5LDEwMy44OTYgNjguODk4LDEwMy41NzYgNjguNjU4LDEwMy4yODggQzY4LjE1MywxMDIuNjc4IDY3LjEwMywxMDIuMjY2IDY1LjkyLDEwMi4yMTQgQzY1Ljc0MiwxMDIuMjA2IDY1LjU2MywxMDIuMjA3IDY1LjM4NSwxMDIuMjE1IEM2NC43NDIsMTAyLjI0NiA2NC4wODcsMTAyLjIzMiA2My40NSwxMDIuMTc0IEM2My4zOTksMTAyLjE2OSA2My4zNTgsMTAyLjEzMiA2My4zNDcsMTAyLjA4MiBDNjMuMzM2LDEwMi4wMzMgNjMuMzU4LDEwMS45ODEgNjMuNDAyLDEwMS45NTYgTDE0NC41MDYsNTUuMTM0IEMxNDQuNTM3LDU1LjExNiAxNDQuNTc1LDU1LjExMyAxNDQuNjA5LDU1LjEyNyBDMTQ0LjY0Miw1NS4xNDEgMTQ0LjY2OCw1NS4xNyAxNDQuNjc3LDU1LjIwNCBDMTQ0Ljc4MSw1NS41ODUgMTQ0LjgwNiw1NS45NzIgMTQ0Ljc1MSw1Ni4zNTcgQzE0NC43MDYsNTYuNjczIDE0NC44MDgsNTYuOTk0IDE0NS4wNDcsNTcuMjgyIEMxNDUuNTUzLDU3Ljg5MiAxNDYuNjAyLDU4LjMwMyAxNDcuNzg2LDU4LjM1NSBDMTQ3Ljk2NCw1OC4zNjMgMTQ4LjE0Myw1OC4zNjMgMTQ4LjMyMSw1OC4zNTQgQzE0OC4zNzcsNTguMzUyIDE0OC40MjQsNTguMzg3IDE0OC40MzksNTguNDM4IEMxNDguNDU0LDU4LjQ5IDE0OC40MzIsNTguNTQ1IDE0OC4zODUsNTguNTcyIEw2OS4xMjksMTA0LjMzMSBDNjkuMTExLDEwNC4zNDIgNjkuMDksMTA0LjM0NyA2OS4wNywxMDQuMzQ3IEw2OS4wNywxMDQuMzQ3IFogTTY1LjY2NSwxMDEuOTc1IEM2NS43NTQsMTAxLjk3NSA2NS44NDIsMTAxLjk3NyA2NS45MywxMDEuOTgxIEM2Ny4xOTYsMTAyLjAzNyA2OC4yODMsMTAyLjQ2OSA2OC44MzgsMTAzLjEzOSBDNjkuMDY1LDEwMy40MTMgNjkuMTg4LDEwMy43MTQgNjkuMTk4LDEwNC4wMjEgTDE0Ny44ODMsNTguNTkyIEMxNDcuODQ3LDU4LjU5MiAxNDcuODExLDU4LjU5MSAxNDcuNzc2LDU4LjU4OSBDMTQ2LjUwOSw1OC41MzMgMTQ1LjQyMiw1OC4xIDE0NC44NjcsNTcuNDMxIEMxNDQuNTg1LDU3LjA5MSAxNDQuNDY1LDU2LjcwNyAxNDQuNTIsNTYuMzI0IEMxNDQuNTYzLDU2LjAyMSAxNDQuNTUyLDU1LjcxNiAxNDQuNDg4LDU1LjQxNCBMNjMuODQ2LDEwMS45NyBDNjQuMzUzLDEwMi4wMDIgNjQuODY3LDEwMi4wMDYgNjUuMzc0LDEwMS45ODIgQzY1LjQ3MSwxMDEuOTc3IDY1LjU2OCwxMDEuOTc1IDY1LjY2NSwxMDEuOTc1IEw2NS42NjUsMTAxLjk3NSBaIiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjA4LDU1LjEzNCBDMS4yMDcsNTMuMzA3IDEuOTY3LDUwLjkxNyAzLjkwNiw0OS43OTcgTDU5LjkxNywxNy40NTMgQzYxLjg1NiwxNi4zMzMgNjQuMjQxLDE2LjkwNyA2NS4yNDMsMTguNzM0IEw2NS40NzUsMTkuMTQ0IEM2NS44NzIsMTkuODgyIDY2LjM2OCwyMC41NiA2Ni45NDUsMjEuMTY1IEw2Ny4yMjMsMjEuNDM1IEM3MC41NDgsMjQuNjQ5IDc1LjgwNiwyNS4xNTEgODAuMTExLDIyLjY2NSBMODcuNDMsMTguNDQ1IEM4OS4zNywxNy4zMjYgOTEuNzU0LDE3Ljg5OSA5Mi43NTUsMTkuNzI3IEw5Ni4wMDUsMjUuNjU1IEwxMi40ODYsNzMuODg0IEwyLjIwOCw1NS4xMzQgWiIgaWQ9IkZpbGwtNiIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40ODYsNzQuMDAxIEMxMi40NzYsNzQuMDAxIDEyLjQ2NSw3My45OTkgMTIuNDU1LDczLjk5NiBDMTIuNDI0LDczLjk4OCAxMi4zOTksNzMuOTY3IDEyLjM4NCw3My45NCBMMi4xMDYsNTUuMTkgQzEuMDc1LDUzLjMxIDEuODU3LDUwLjg0NSAzLjg0OCw0OS42OTYgTDU5Ljg1OCwxNy4zNTIgQzYwLjUyNSwxNi45NjcgNjEuMjcxLDE2Ljc2NCA2Mi4wMTYsMTYuNzY0IEM2My40MzEsMTYuNzY0IDY0LjY2NiwxNy40NjYgNjUuMzI3LDE4LjY0NiBDNjUuMzM3LDE4LjY1NCA2NS4zNDUsMTguNjYzIDY1LjM1MSwxOC42NzQgTDY1LjU3OCwxOS4wODggQzY1LjU4NCwxOS4xIDY1LjU4OSwxOS4xMTIgNjUuNTkxLDE5LjEyNiBDNjUuOTg1LDE5LjgzOCA2Ni40NjksMjAuNDk3IDY3LjAzLDIxLjA4NSBMNjcuMzA1LDIxLjM1MSBDNjkuMTUxLDIzLjEzNyA3MS42NDksMjQuMTIgNzQuMzM2LDI0LjEyIEM3Ni4zMTMsMjQuMTIgNzguMjksMjMuNTgyIDgwLjA1MywyMi41NjMgQzgwLjA2NCwyMi41NTcgODAuMDc2LDIyLjU1MyA4MC4wODgsMjIuNTUgTDg3LjM3MiwxOC4zNDQgQzg4LjAzOCwxNy45NTkgODguNzg0LDE3Ljc1NiA4OS41MjksMTcuNzU2IEM5MC45NTYsMTcuNzU2IDkyLjIwMSwxOC40NzIgOTIuODU4LDE5LjY3IEw5Ni4xMDcsMjUuNTk5IEM5Ni4xMzgsMjUuNjU0IDk2LjExOCwyNS43MjQgOTYuMDYzLDI1Ljc1NiBMMTIuNTQ1LDczLjk4NSBDMTIuNTI2LDczLjk5NiAxMi41MDYsNzQuMDAxIDEyLjQ4Niw3NC4wMDEgTDEyLjQ4Niw3NC4wMDEgWiBNNjIuMDE2LDE2Ljk5NyBDNjEuMzEyLDE2Ljk5NyA2MC42MDYsMTcuMTkgNTkuOTc1LDE3LjU1NCBMMy45NjUsNDkuODk5IEMyLjA4Myw1MC45ODUgMS4zNDEsNTMuMzA4IDIuMzEsNTUuMDc4IEwxMi41MzEsNzMuNzIzIEw5NS44NDgsMjUuNjExIEw5Mi42NTMsMTkuNzgyIEM5Mi4wMzgsMTguNjYgOTAuODcsMTcuOTkgODkuNTI5LDE3Ljk5IEM4OC44MjUsMTcuOTkgODguMTE5LDE4LjE4MiA4Ny40ODksMTguNTQ3IEw4MC4xNzIsMjIuNzcyIEM4MC4xNjEsMjIuNzc4IDgwLjE0OSwyMi43ODIgODAuMTM3LDIyLjc4NSBDNzguMzQ2LDIzLjgxMSA3Ni4zNDEsMjQuMzU0IDc0LjMzNiwyNC4zNTQgQzcxLjU4OCwyNC4zNTQgNjkuMDMzLDIzLjM0NyA2Ny4xNDIsMjEuNTE5IEw2Ni44NjQsMjEuMjQ5IEM2Ni4yNzcsMjAuNjM0IDY1Ljc3NCwxOS45NDcgNjUuMzY3LDE5LjIwMyBDNjUuMzYsMTkuMTkyIDY1LjM1NiwxOS4xNzkgNjUuMzU0LDE5LjE2NiBMNjUuMTYzLDE4LjgxOSBDNjUuMTU0LDE4LjgxMSA2NS4xNDYsMTguODAxIDY1LjE0LDE4Ljc5IEM2NC41MjUsMTcuNjY3IDYzLjM1NywxNi45OTcgNjIuMDE2LDE2Ljk5NyBMNjIuMDE2LDE2Ljk5NyBaIiBpZD0iRmlsbC03IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTQyLjQzNCw0OC44MDggTDQyLjQzNCw0OC44MDggQzM5LjkyNCw0OC44MDcgMzcuNzM3LDQ3LjU1IDM2LjU4Miw0NS40NDMgQzM0Ljc3MSw0Mi4xMzkgMzYuMTQ0LDM3LjgwOSAzOS42NDEsMzUuNzg5IEw1MS45MzIsMjguNjkxIEM1My4xMDMsMjguMDE1IDU0LjQxMywyNy42NTggNTUuNzIxLDI3LjY1OCBDNTguMjMxLDI3LjY1OCA2MC40MTgsMjguOTE2IDYxLjU3MywzMS4wMjMgQzYzLjM4NCwzNC4zMjcgNjIuMDEyLDM4LjY1NyA1OC41MTQsNDAuNjc3IEw0Ni4yMjMsNDcuNzc1IEM0NS4wNTMsNDguNDUgNDMuNzQyLDQ4LjgwOCA0Mi40MzQsNDguODA4IEw0Mi40MzQsNDguODA4IFogTTU1LjcyMSwyOC4xMjUgQzU0LjQ5NSwyOC4xMjUgNTMuMjY1LDI4LjQ2MSA1Mi4xNjYsMjkuMDk2IEwzOS44NzUsMzYuMTk0IEMzNi41OTYsMzguMDg3IDM1LjMwMiw0Mi4xMzYgMzYuOTkyLDQ1LjIxOCBDMzguMDYzLDQ3LjE3MyA0MC4wOTgsNDguMzQgNDIuNDM0LDQ4LjM0IEM0My42NjEsNDguMzQgNDQuODksNDguMDA1IDQ1Ljk5LDQ3LjM3IEw1OC4yODEsNDAuMjcyIEM2MS41NiwzOC4zNzkgNjIuODUzLDM0LjMzIDYxLjE2NCwzMS4yNDggQzYwLjA5MiwyOS4yOTMgNTguMDU4LDI4LjEyNSA1NS43MjEsMjguMTI1IEw1NS43MjEsMjguMTI1IFoiIGlkPSJGaWxsLTgiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjU4OCwyLjQwNyBDMTQ5LjU4OCwyLjQwNyAxNTUuNzY4LDUuOTc1IDE1Ni4zMjUsNi4yOTcgTDE1Ni4zMjUsNy4xODQgQzE1Ni4zMjUsNy4zNiAxNTYuMzM4LDcuNTQ0IDE1Ni4zNjIsNy43MzMgQzE1Ni4zNzMsNy44MTQgMTU2LjM4Miw3Ljg5NCAxNTYuMzksNy45NzUgQzE1Ni41Myw5LjM5IDE1Ny4zNjMsMTAuOTczIDE1OC40OTUsMTEuOTc0IEwxNjUuODkxLDE4LjUxOSBDMTY2LjA2OCwxOC42NzUgMTY2LjI0OSwxOC44MTQgMTY2LjQzMiwxOC45MzQgQzE2OC4wMTEsMTkuOTc0IDE2OS4zODIsMTkuNCAxNjkuNDk0LDE3LjY1MiBDMTY5LjU0MywxNi44NjggMTY5LjU1MSwxNi4wNTcgMTY5LjUxNywxNS4yMjMgTDE2OS41MTQsMTUuMDYzIEwxNjkuNTE0LDEzLjkxMiBDMTcwLjc4LDE0LjY0MiAxOTUuNTAxLDI4LjkxNSAxOTUuNTAxLDI4LjkxNSBMMTk1LjUwMSw4Mi45MTUgQzE5NS41MDEsODQuMDA1IDE5NC43MzEsODQuNDQ1IDE5My43ODEsODMuODk3IEwxNTEuMzA4LDU5LjM3NCBDMTUwLjM1OCw1OC44MjYgMTQ5LjU4OCw1Ny40OTcgMTQ5LjU4OCw1Ni40MDggTDE0OS41ODgsMjIuMzc1IiBpZD0iRmlsbC05IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5NC41NTMsODQuMjUgQzE5NC4yOTYsODQuMjUgMTk0LjAxMyw4NC4xNjUgMTkzLjcyMiw4My45OTcgTDE1MS4yNSw1OS40NzYgQzE1MC4yNjksNTguOTA5IDE0OS40NzEsNTcuNTMzIDE0OS40NzEsNTYuNDA4IEwxNDkuNDcxLDIyLjM3NSBMMTQ5LjcwNSwyMi4zNzUgTDE0OS43MDUsNTYuNDA4IEMxNDkuNzA1LDU3LjQ1OSAxNTAuNDUsNTguNzQ0IDE1MS4zNjYsNTkuMjc0IEwxOTMuODM5LDgzLjc5NSBDMTk0LjI2Myw4NC4wNCAxOTQuNjU1LDg0LjA4MyAxOTQuOTQyLDgzLjkxNyBDMTk1LjIyNyw4My43NTMgMTk1LjM4NCw4My4zOTcgMTk1LjM4NCw4Mi45MTUgTDE5NS4zODQsMjguOTgyIEMxOTQuMTAyLDI4LjI0MiAxNzIuMTA0LDE1LjU0MiAxNjkuNjMxLDE0LjExNCBMMTY5LjYzNCwxNS4yMiBDMTY5LjY2OCwxNi4wNTIgMTY5LjY2LDE2Ljg3NCAxNjkuNjEsMTcuNjU5IEMxNjkuNTU2LDE4LjUwMyAxNjkuMjE0LDE5LjEyMyAxNjguNjQ3LDE5LjQwNSBDMTY4LjAyOCwxOS43MTQgMTY3LjE5NywxOS41NzggMTY2LjM2NywxOS4wMzIgQzE2Ni4xODEsMTguOTA5IDE2NS45OTUsMTguNzY2IDE2NS44MTQsMTguNjA2IEwxNTguNDE3LDEyLjA2MiBDMTU3LjI1OSwxMS4wMzYgMTU2LjQxOCw5LjQzNyAxNTYuMjc0LDcuOTg2IEMxNTYuMjY2LDcuOTA3IDE1Ni4yNTcsNy44MjcgMTU2LjI0Nyw3Ljc0OCBDMTU2LjIyMSw3LjU1NSAxNTYuMjA5LDcuMzY1IDE1Ni4yMDksNy4xODQgTDE1Ni4yMDksNi4zNjQgQzE1NS4zNzUsNS44ODMgMTQ5LjUyOSwyLjUwOCAxNDkuNTI5LDIuNTA4IEwxNDkuNjQ2LDIuMzA2IEMxNDkuNjQ2LDIuMzA2IDE1NS44MjcsNS44NzQgMTU2LjM4NCw2LjE5NiBMMTU2LjQ0Miw2LjIzIEwxNTYuNDQyLDcuMTg0IEMxNTYuNDQyLDcuMzU1IDE1Ni40NTQsNy41MzUgMTU2LjQ3OCw3LjcxNyBDMTU2LjQ4OSw3LjggMTU2LjQ5OSw3Ljg4MiAxNTYuNTA3LDcuOTYzIEMxNTYuNjQ1LDkuMzU4IDE1Ny40NTUsMTAuODk4IDE1OC41NzIsMTEuODg2IEwxNjUuOTY5LDE4LjQzMSBDMTY2LjE0MiwxOC41ODQgMTY2LjMxOSwxOC43MiAxNjYuNDk2LDE4LjgzNyBDMTY3LjI1NCwxOS4zMzYgMTY4LDE5LjQ2NyAxNjguNTQzLDE5LjE5NiBDMTY5LjAzMywxOC45NTMgMTY5LjMyOSwxOC40MDEgMTY5LjM3NywxNy42NDUgQzE2OS40MjcsMTYuODY3IDE2OS40MzQsMTYuMDU0IDE2OS40MDEsMTUuMjI4IEwxNjkuMzk3LDE1LjA2NSBMMTY5LjM5NywxMy43MSBMMTY5LjU3MiwxMy44MSBDMTcwLjgzOSwxNC41NDEgMTk1LjU1OSwyOC44MTQgMTk1LjU1OSwyOC44MTQgTDE5NS42MTgsMjguODQ3IEwxOTUuNjE4LDgyLjkxNSBDMTk1LjYxOCw4My40ODQgMTk1LjQyLDgzLjkxMSAxOTUuMDU5LDg0LjExOSBDMTk0LjkwOCw4NC4yMDYgMTk0LjczNyw4NC4yNSAxOTQuNTUzLDg0LjI1IiBpZD0iRmlsbC0xMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDUuNjg1LDU2LjE2MSBMMTY5LjgsNzAuMDgzIEwxNDMuODIyLDg1LjA4MSBMMTQyLjM2LDg0Ljc3NCBDMTM1LjgyNiw4Mi42MDQgMTI4LjczMiw4MS4wNDYgMTIxLjM0MSw4MC4xNTggQzExNi45NzYsNzkuNjM0IDExMi42NzgsODEuMjU0IDExMS43NDMsODMuNzc4IEMxMTEuNTA2LDg0LjQxNCAxMTEuNTAzLDg1LjA3MSAxMTEuNzMyLDg1LjcwNiBDMTEzLjI3LDg5Ljk3MyAxMTUuOTY4LDk0LjA2OSAxMTkuNzI3LDk3Ljg0MSBMMTIwLjI1OSw5OC42ODYgQzEyMC4yNiw5OC42ODUgOTQuMjgyLDExMy42ODMgOTQuMjgyLDExMy42ODMgTDcwLjE2Nyw5OS43NjEgTDE0NS42ODUsNTYuMTYxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05NC4yODIsMTEzLjgxOCBMOTQuMjIzLDExMy43ODUgTDY5LjkzMyw5OS43NjEgTDcwLjEwOCw5OS42NiBMMTQ1LjY4NSw1Ni4wMjYgTDE0NS43NDMsNTYuMDU5IEwxNzAuMDMzLDcwLjA4MyBMMTQzLjg0Miw4NS4yMDUgTDE0My43OTcsODUuMTk1IEMxNDMuNzcyLDg1LjE5IDE0Mi4zMzYsODQuODg4IDE0Mi4zMzYsODQuODg4IEMxMzUuNzg3LDgyLjcxNCAxMjguNzIzLDgxLjE2MyAxMjEuMzI3LDgwLjI3NCBDMTIwLjc4OCw4MC4yMDkgMTIwLjIzNiw4MC4xNzcgMTE5LjY4OSw4MC4xNzcgQzExNS45MzEsODAuMTc3IDExMi42MzUsODEuNzA4IDExMS44NTIsODMuODE5IEMxMTEuNjI0LDg0LjQzMiAxMTEuNjIxLDg1LjA1MyAxMTEuODQyLDg1LjY2NyBDMTEzLjM3Nyw4OS45MjUgMTE2LjA1OCw5My45OTMgMTE5LjgxLDk3Ljc1OCBMMTE5LjgyNiw5Ny43NzkgTDEyMC4zNTIsOTguNjE0IEMxMjAuMzU0LDk4LjYxNyAxMjAuMzU2LDk4LjYyIDEyMC4zNTgsOTguNjI0IEwxMjAuNDIyLDk4LjcyNiBMMTIwLjMxNyw5OC43ODcgQzEyMC4yNjQsOTguODE4IDk0LjU5OSwxMTMuNjM1IDk0LjM0LDExMy43ODUgTDk0LjI4MiwxMTMuODE4IEw5NC4yODIsMTEzLjgxOCBaIE03MC40MDEsOTkuNzYxIEw5NC4yODIsMTEzLjU0OSBMMTE5LjA4NCw5OS4yMjkgQzExOS42Myw5OC45MTQgMTE5LjkzLDk4Ljc0IDEyMC4xMDEsOTguNjU0IEwxMTkuNjM1LDk3LjkxNCBDMTE1Ljg2NCw5NC4xMjcgMTEzLjE2OCw5MC4wMzMgMTExLjYyMiw4NS43NDYgQzExMS4zODIsODUuMDc5IDExMS4zODYsODQuNDA0IDExMS42MzMsODMuNzM4IEMxMTIuNDQ4LDgxLjUzOSAxMTUuODM2LDc5Ljk0MyAxMTkuNjg5LDc5Ljk0MyBDMTIwLjI0Niw3OS45NDMgMTIwLjgwNiw3OS45NzYgMTIxLjM1NSw4MC4wNDIgQzEyOC43NjcsODAuOTMzIDEzNS44NDYsODIuNDg3IDE0Mi4zOTYsODQuNjYzIEMxNDMuMjMyLDg0LjgzOCAxNDMuNjExLDg0LjkxNyAxNDMuNzg2LDg0Ljk2NyBMMTY5LjU2Niw3MC4wODMgTDE0NS42ODUsNTYuMjk1IEw3MC40MDEsOTkuNzYxIEw3MC40MDEsOTkuNzYxIFoiIGlkPSJGaWxsLTEyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2Ny4yMywxOC45NzkgTDE2Ny4yMyw2OS44NSBMMTM5LjkwOSw4NS42MjMgTDEzMy40NDgsNzEuNDU2IEMxMzIuNTM4LDY5LjQ2IDEzMC4wMiw2OS43MTggMTI3LjgyNCw3Mi4wMyBDMTI2Ljc2OSw3My4xNCAxMjUuOTMxLDc0LjU4NSAxMjUuNDk0LDc2LjA0OCBMMTE5LjAzNCw5Ny42NzYgTDkxLjcxMiwxMTMuNDUgTDkxLjcxMiw2Mi41NzkgTDE2Ny4yMywxOC45NzkiIGlkPSJGaWxsLTEzIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkxLjcxMiwxMTMuNTY3IEM5MS42OTIsMTEzLjU2NyA5MS42NzIsMTEzLjU2MSA5MS42NTMsMTEzLjU1MSBDOTEuNjE4LDExMy41MyA5MS41OTUsMTEzLjQ5MiA5MS41OTUsMTEzLjQ1IEw5MS41OTUsNjIuNTc5IEM5MS41OTUsNjIuNTM3IDkxLjYxOCw2Mi40OTkgOTEuNjUzLDYyLjQ3OCBMMTY3LjE3MiwxOC44NzggQzE2Ny4yMDgsMTguODU3IDE2Ny4yNTIsMTguODU3IDE2Ny4yODgsMTguODc4IEMxNjcuMzI0LDE4Ljg5OSAxNjcuMzQ3LDE4LjkzNyAxNjcuMzQ3LDE4Ljk3OSBMMTY3LjM0Nyw2OS44NSBDMTY3LjM0Nyw2OS44OTEgMTY3LjMyNCw2OS45MyAxNjcuMjg4LDY5Ljk1IEwxMzkuOTY3LDg1LjcyNSBDMTM5LjkzOSw4NS43NDEgMTM5LjkwNSw4NS43NDUgMTM5Ljg3Myw4NS43MzUgQzEzOS44NDIsODUuNzI1IDEzOS44MTYsODUuNzAyIDEzOS44MDIsODUuNjcyIEwxMzMuMzQyLDcxLjUwNCBDMTMyLjk2Nyw3MC42ODIgMTMyLjI4LDcwLjIyOSAxMzEuNDA4LDcwLjIyOSBDMTMwLjMxOSw3MC4yMjkgMTI5LjA0NCw3MC45MTUgMTI3LjkwOCw3Mi4xMSBDMTI2Ljg3NCw3My4yIDEyNi4wMzQsNzQuNjQ3IDEyNS42MDYsNzYuMDgyIEwxMTkuMTQ2LDk3LjcwOSBDMTE5LjEzNyw5Ny43MzggMTE5LjExOCw5Ny43NjIgMTE5LjA5Miw5Ny43NzcgTDkxLjc3LDExMy41NTEgQzkxLjc1MiwxMTMuNTYxIDkxLjczMiwxMTMuNTY3IDkxLjcxMiwxMTMuNTY3IEw5MS43MTIsMTEzLjU2NyBaIE05MS44MjksNjIuNjQ3IEw5MS44MjksMTEzLjI0OCBMMTE4LjkzNSw5Ny41OTggTDEyNS4zODIsNzYuMDE1IEMxMjUuODI3LDc0LjUyNSAxMjYuNjY0LDczLjA4MSAxMjcuNzM5LDcxLjk1IEMxMjguOTE5LDcwLjcwOCAxMzAuMjU2LDY5Ljk5NiAxMzEuNDA4LDY5Ljk5NiBDMTMyLjM3Nyw2OS45OTYgMTMzLjEzOSw3MC40OTcgMTMzLjU1NCw3MS40MDcgTDEzOS45NjEsODUuNDU4IEwxNjcuMTEzLDY5Ljc4MiBMMTY3LjExMywxOS4xODEgTDkxLjgyOSw2Mi42NDcgTDkxLjgyOSw2Mi42NDcgWiIgaWQ9IkZpbGwtMTQiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTY4LjU0MywxOS4yMTMgTDE2OC41NDMsNzAuMDgzIEwxNDEuMjIxLDg1Ljg1NyBMMTM0Ljc2MSw3MS42ODkgQzEzMy44NTEsNjkuNjk0IDEzMS4zMzMsNjkuOTUxIDEyOS4xMzcsNzIuMjYzIEMxMjguMDgyLDczLjM3NCAxMjcuMjQ0LDc0LjgxOSAxMjYuODA3LDc2LjI4MiBMMTIwLjM0Niw5Ny45MDkgTDkzLjAyNSwxMTMuNjgzIEw5My4wMjUsNjIuODEzIEwxNjguNTQzLDE5LjIxMyIgaWQ9IkZpbGwtMTUiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTMuMDI1LDExMy44IEM5My4wMDUsMTEzLjggOTIuOTg0LDExMy43OTUgOTIuOTY2LDExMy43ODUgQzkyLjkzMSwxMTMuNzY0IDkyLjkwOCwxMTMuNzI1IDkyLjkwOCwxMTMuNjg0IEw5Mi45MDgsNjIuODEzIEM5Mi45MDgsNjIuNzcxIDkyLjkzMSw2Mi43MzMgOTIuOTY2LDYyLjcxMiBMMTY4LjQ4NCwxOS4xMTIgQzE2OC41MiwxOS4wOSAxNjguNTY1LDE5LjA5IDE2OC42MDEsMTkuMTEyIEMxNjguNjM3LDE5LjEzMiAxNjguNjYsMTkuMTcxIDE2OC42NiwxOS4yMTIgTDE2OC42Niw3MC4wODMgQzE2OC42Niw3MC4xMjUgMTY4LjYzNyw3MC4xNjQgMTY4LjYwMSw3MC4xODQgTDE0MS4yOCw4NS45NTggQzE0MS4yNTEsODUuOTc1IDE0MS4yMTcsODUuOTc5IDE0MS4xODYsODUuOTY4IEMxNDEuMTU0LDg1Ljk1OCAxNDEuMTI5LDg1LjkzNiAxNDEuMTE1LDg1LjkwNiBMMTM0LjY1NSw3MS43MzggQzEzNC4yOCw3MC45MTUgMTMzLjU5Myw3MC40NjMgMTMyLjcyLDcwLjQ2MyBDMTMxLjYzMiw3MC40NjMgMTMwLjM1Nyw3MS4xNDggMTI5LjIyMSw3Mi4zNDQgQzEyOC4xODYsNzMuNDMzIDEyNy4zNDcsNzQuODgxIDEyNi45MTksNzYuMzE1IEwxMjAuNDU4LDk3Ljk0MyBDMTIwLjQ1LDk3Ljk3MiAxMjAuNDMxLDk3Ljk5NiAxMjAuNDA1LDk4LjAxIEw5My4wODMsMTEzLjc4NSBDOTMuMDY1LDExMy43OTUgOTMuMDQ1LDExMy44IDkzLjAyNSwxMTMuOCBMOTMuMDI1LDExMy44IFogTTkzLjE0Miw2Mi44ODEgTDkzLjE0MiwxMTMuNDgxIEwxMjAuMjQ4LDk3LjgzMiBMMTI2LjY5NSw3Ni4yNDggQzEyNy4xNCw3NC43NTggMTI3Ljk3Nyw3My4zMTUgMTI5LjA1Miw3Mi4xODMgQzEzMC4yMzEsNzAuOTQyIDEzMS41NjgsNzAuMjI5IDEzMi43Miw3MC4yMjkgQzEzMy42ODksNzAuMjI5IDEzNC40NTIsNzAuNzMxIDEzNC44NjcsNzEuNjQxIEwxNDEuMjc0LDg1LjY5MiBMMTY4LjQyNiw3MC4wMTYgTDE2OC40MjYsMTkuNDE1IEw5My4xNDIsNjIuODgxIEw5My4xNDIsNjIuODgxIFoiIGlkPSJGaWxsLTE2IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS44LDcwLjA4MyBMMTQyLjQ3OCw4NS44NTcgTDEzNi4wMTgsNzEuNjg5IEMxMzUuMTA4LDY5LjY5NCAxMzIuNTksNjkuOTUxIDEzMC4zOTMsNzIuMjYzIEMxMjkuMzM5LDczLjM3NCAxMjguNSw3NC44MTkgMTI4LjA2NCw3Ni4yODIgTDEyMS42MDMsOTcuOTA5IEw5NC4yODIsMTEzLjY4MyBMOTQuMjgyLDYyLjgxMyBMMTY5LjgsMTkuMjEzIEwxNjkuOCw3MC4wODMgWiIgaWQ9IkZpbGwtMTciIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTQuMjgyLDExMy45MTcgQzk0LjI0MSwxMTMuOTE3IDk0LjIwMSwxMTMuOTA3IDk0LjE2NSwxMTMuODg2IEM5NC4wOTMsMTEzLjg0NSA5NC4wNDgsMTEzLjc2NyA5NC4wNDgsMTEzLjY4NCBMOTQuMDQ4LDYyLjgxMyBDOTQuMDQ4LDYyLjczIDk0LjA5Myw2Mi42NTIgOTQuMTY1LDYyLjYxMSBMMTY5LjY4MywxOS4wMSBDMTY5Ljc1NSwxOC45NjkgMTY5Ljg0NCwxOC45NjkgMTY5LjkxNywxOS4wMSBDMTY5Ljk4OSwxOS4wNTIgMTcwLjAzMywxOS4xMjkgMTcwLjAzMywxOS4yMTIgTDE3MC4wMzMsNzAuMDgzIEMxNzAuMDMzLDcwLjE2NiAxNjkuOTg5LDcwLjI0NCAxNjkuOTE3LDcwLjI4NSBMMTQyLjU5NSw4Ni4wNiBDMTQyLjUzOCw4Ni4wOTIgMTQyLjQ2OSw4Ni4xIDE0Mi40MDcsODYuMDggQzE0Mi4zNDQsODYuMDYgMTQyLjI5Myw4Ni4wMTQgMTQyLjI2Niw4NS45NTQgTDEzNS44MDUsNzEuNzg2IEMxMzUuNDQ1LDcwLjk5NyAxMzQuODEzLDcwLjU4IDEzMy45NzcsNzAuNTggQzEzMi45MjEsNzAuNTggMTMxLjY3Niw3MS4yNTIgMTMwLjU2Miw3Mi40MjQgQzEyOS41NCw3My41MDEgMTI4LjcxMSw3NC45MzEgMTI4LjI4Nyw3Ni4zNDggTDEyMS44MjcsOTcuOTc2IEMxMjEuODEsOTguMDM0IDEyMS43NzEsOTguMDgyIDEyMS43Miw5OC4xMTIgTDk0LjM5OCwxMTMuODg2IEM5NC4zNjIsMTEzLjkwNyA5NC4zMjIsMTEzLjkxNyA5NC4yODIsMTEzLjkxNyBMOTQuMjgyLDExMy45MTcgWiBNOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDExMy4yNzkgTDEyMS40MDYsOTcuNzU0IEwxMjcuODQsNzYuMjE1IEMxMjguMjksNzQuNzA4IDEyOS4xMzcsNzMuMjQ3IDEzMC4yMjQsNzIuMTAzIEMxMzEuNDI1LDcwLjgzOCAxMzIuNzkzLDcwLjExMiAxMzMuOTc3LDcwLjExMiBDMTM0Ljk5NSw3MC4xMTIgMTM1Ljc5NSw3MC42MzggMTM2LjIzLDcxLjU5MiBMMTQyLjU4NCw4NS41MjYgTDE2OS41NjYsNjkuOTQ4IEwxNjkuNTY2LDE5LjYxNyBMOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDYyLjk0OCBaIiBpZD0iRmlsbC0xOCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMDkuODk0LDkyLjk0MyBMMTA5Ljg5NCw5Mi45NDMgQzEwOC4xMiw5Mi45NDMgMTA2LjY1Myw5Mi4yMTggMTA1LjY1LDkwLjgyMyBDMTA1LjU4Myw5MC43MzEgMTA1LjU5Myw5MC42MSAxMDUuNjczLDkwLjUyOSBDMTA1Ljc1Myw5MC40NDggMTA1Ljg4LDkwLjQ0IDEwNS45NzQsOTAuNTA2IEMxMDYuNzU0LDkxLjA1MyAxMDcuNjc5LDkxLjMzMyAxMDguNzI0LDkxLjMzMyBDMTEwLjA0Nyw5MS4zMzMgMTExLjQ3OCw5MC44OTQgMTEyLjk4LDkwLjAyNyBDMTE4LjI5MSw4Ni45NiAxMjIuNjExLDc5LjUwOSAxMjIuNjExLDczLjQxNiBDMTIyLjYxMSw3MS40ODkgMTIyLjE2OSw2OS44NTYgMTIxLjMzMyw2OC42OTIgQzEyMS4yNjYsNjguNiAxMjEuMjc2LDY4LjQ3MyAxMjEuMzU2LDY4LjM5MiBDMTIxLjQzNiw2OC4zMTEgMTIxLjU2Myw2OC4yOTkgMTIxLjY1Niw2OC4zNjUgQzEyMy4zMjcsNjkuNTM3IDEyNC4yNDcsNzEuNzQ2IDEyNC4yNDcsNzQuNTg0IEMxMjQuMjQ3LDgwLjgyNiAxMTkuODIxLDg4LjQ0NyAxMTQuMzgyLDkxLjU4NyBDMTEyLjgwOCw5Mi40OTUgMTExLjI5OCw5Mi45NDMgMTA5Ljg5NCw5Mi45NDMgTDEwOS44OTQsOTIuOTQzIFogTTEwNi45MjUsOTEuNDAxIEMxMDcuNzM4LDkyLjA1MiAxMDguNzQ1LDkyLjI3OCAxMDkuODkzLDkyLjI3OCBMMTA5Ljg5NCw5Mi4yNzggQzExMS4yMTUsOTIuMjc4IDExMi42NDcsOTEuOTUxIDExNC4xNDgsOTEuMDg0IEMxMTkuNDU5LDg4LjAxNyAxMjMuNzgsODAuNjIxIDEyMy43OCw3NC41MjggQzEyMy43OCw3Mi41NDkgMTIzLjMxNyw3MC45MjkgMTIyLjQ1NCw2OS43NjcgQzEyMi44NjUsNzAuODAyIDEyMy4wNzksNzIuMDQyIDEyMy4wNzksNzMuNDAyIEMxMjMuMDc5LDc5LjY0NSAxMTguNjUzLDg3LjI4NSAxMTMuMjE0LDkwLjQyNSBDMTExLjY0LDkxLjMzNCAxMTAuMTMsOTEuNzQyIDEwOC43MjQsOTEuNzQyIEMxMDguMDgzLDkxLjc0MiAxMDcuNDgxLDkxLjU5MyAxMDYuOTI1LDkxLjQwMSBMMTA2LjkyNSw5MS40MDEgWiIgaWQ9IkZpbGwtMTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjA5Nyw5MC4yMyBDMTE4LjQ4MSw4Ny4xMjIgMTIyLjg0NSw3OS41OTQgMTIyLjg0NSw3My40MTYgQzEyMi44NDUsNzEuMzY1IDEyMi4zNjIsNjkuNzI0IDEyMS41MjIsNjguNTU2IEMxMTkuNzM4LDY3LjMwNCAxMTcuMTQ4LDY3LjM2MiAxMTQuMjY1LDY5LjAyNiBDMTA4Ljg4MSw3Mi4xMzQgMTA0LjUxNyw3OS42NjIgMTA0LjUxNyw4NS44NCBDMTA0LjUxNyw4Ny44OTEgMTA1LDg5LjUzMiAxMDUuODQsOTAuNyBDMTA3LjYyNCw5MS45NTIgMTEwLjIxNCw5MS44OTQgMTEzLjA5Nyw5MC4yMyIgaWQ9IkZpbGwtMjAiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTA4LjcyNCw5MS42MTQgTDEwOC43MjQsOTEuNjE0IEMxMDcuNTgyLDkxLjYxNCAxMDYuNTY2LDkxLjQwMSAxMDUuNzA1LDkwLjc5NyBDMTA1LjY4NCw5MC43ODMgMTA1LjY2NSw5MC44MTEgMTA1LjY1LDkwLjc5IEMxMDQuNzU2LDg5LjU0NiAxMDQuMjgzLDg3Ljg0MiAxMDQuMjgzLDg1LjgxNyBDMTA0LjI4Myw3OS41NzUgMTA4LjcwOSw3MS45NTMgMTE0LjE0OCw2OC44MTIgQzExNS43MjIsNjcuOTA0IDExNy4yMzIsNjcuNDQ5IDExOC42MzgsNjcuNDQ5IEMxMTkuNzgsNjcuNDQ5IDEyMC43OTYsNjcuNzU4IDEyMS42NTYsNjguMzYyIEMxMjEuNjc4LDY4LjM3NyAxMjEuNjk3LDY4LjM5NyAxMjEuNzEyLDY4LjQxOCBDMTIyLjYwNiw2OS42NjIgMTIzLjA3OSw3MS4zOSAxMjMuMDc5LDczLjQxNSBDMTIzLjA3OSw3OS42NTggMTE4LjY1Myw4Ny4xOTggMTEzLjIxNCw5MC4zMzggQzExMS42NCw5MS4yNDcgMTEwLjEzLDkxLjYxNCAxMDguNzI0LDkxLjYxNCBMMTA4LjcyNCw5MS42MTQgWiBNMTA2LjAwNiw5MC41MDUgQzEwNi43OCw5MS4wMzcgMTA3LjY5NCw5MS4yODEgMTA4LjcyNCw5MS4yODEgQzExMC4wNDcsOTEuMjgxIDExMS40NzgsOTAuODY4IDExMi45OCw5MC4wMDEgQzExOC4yOTEsODYuOTM1IDEyMi42MTEsNzkuNDk2IDEyMi42MTEsNzMuNDAzIEMxMjIuNjExLDcxLjQ5NCAxMjIuMTc3LDY5Ljg4IDEyMS4zNTYsNjguNzE4IEMxMjAuNTgyLDY4LjE4NSAxMTkuNjY4LDY3LjkxOSAxMTguNjM4LDY3LjkxOSBDMTE3LjMxNSw2Ny45MTkgMTE1Ljg4Myw2OC4zNiAxMTQuMzgyLDY5LjIyNyBDMTA5LjA3MSw3Mi4yOTMgMTA0Ljc1MSw3OS43MzMgMTA0Ljc1MSw4NS44MjYgQzEwNC43NTEsODcuNzM1IDEwNS4xODUsODkuMzQzIDEwNi4wMDYsOTAuNTA1IEwxMDYuMDA2LDkwLjUwNSBaIiBpZD0iRmlsbC0yMSIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDkuMzE4LDcuMjYyIEwxMzkuMzM0LDE2LjE0IEwxNTUuMjI3LDI3LjE3MSBMMTYwLjgxNiwyMS4wNTkgTDE0OS4zMTgsNy4yNjIiIGlkPSJGaWxsLTIyIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS42NzYsMTMuODQgTDE1OS45MjgsMTkuNDY3IEMxNTYuMjg2LDIxLjU3IDE1MC40LDIxLjU4IDE0Ni43ODEsMTkuNDkxIEMxNDMuMTYxLDE3LjQwMiAxNDMuMTgsMTQuMDAzIDE0Ni44MjIsMTEuOSBMMTU2LjMxNyw2LjI5MiBMMTQ5LjU4OCwyLjQwNyBMNjcuNzUyLDQ5LjQ3OCBMMTEzLjY3NSw3NS45OTIgTDExNi43NTYsNzQuMjEzIEMxMTcuMzg3LDczLjg0OCAxMTcuNjI1LDczLjMxNSAxMTcuMzc0LDcyLjgyMyBDMTE1LjAxNyw2OC4xOTEgMTE0Ljc4MSw2My4yNzcgMTE2LjY5MSw1OC41NjEgQzEyMi4zMjksNDQuNjQxIDE0MS4yLDMzLjc0NiAxNjUuMzA5LDMwLjQ5MSBDMTczLjQ3OCwyOS4zODggMTgxLjk4OSwyOS41MjQgMTkwLjAxMywzMC44ODUgQzE5MC44NjUsMzEuMDMgMTkxLjc4OSwzMC44OTMgMTkyLjQyLDMwLjUyOCBMMTk1LjUwMSwyOC43NSBMMTY5LjY3NiwxMy44NCIgaWQ9IkZpbGwtMjMiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3Ni40NTkgQzExMy41OTQsNzYuNDU5IDExMy41MTQsNzYuNDM4IDExMy40NDIsNzYuMzk3IEw2Ny41MTgsNDkuODgyIEM2Ny4zNzQsNDkuNzk5IDY3LjI4NCw0OS42NDUgNjcuMjg1LDQ5LjQ3OCBDNjcuMjg1LDQ5LjMxMSA2Ny4zNzQsNDkuMTU3IDY3LjUxOSw0OS4wNzMgTDE0OS4zNTUsMi4wMDIgQzE0OS40OTksMS45MTkgMTQ5LjY3NywxLjkxOSAxNDkuODIxLDIuMDAyIEwxNTYuNTUsNS44ODcgQzE1Ni43NzQsNi4wMTcgMTU2Ljg1LDYuMzAyIDE1Ni43MjIsNi41MjYgQzE1Ni41OTIsNi43NDkgMTU2LjMwNyw2LjgyNiAxNTYuMDgzLDYuNjk2IEwxNDkuNTg3LDIuOTQ2IEw2OC42ODcsNDkuNDc5IEwxMTMuNjc1LDc1LjQ1MiBMMTE2LjUyMyw3My44MDggQzExNi43MTUsNzMuNjk3IDExNy4xNDMsNzMuMzk5IDExNi45NTgsNzMuMDM1IEMxMTQuNTQyLDY4LjI4NyAxMTQuMyw2My4yMjEgMTE2LjI1OCw1OC4zODUgQzExOS4wNjQsNTEuNDU4IDEyNS4xNDMsNDUuMTQzIDEzMy44NCw0MC4xMjIgQzE0Mi40OTcsMzUuMTI0IDE1My4zNTgsMzEuNjMzIDE2NS4yNDcsMzAuMDI4IEMxNzMuNDQ1LDI4LjkyMSAxODIuMDM3LDI5LjA1OCAxOTAuMDkxLDMwLjQyNSBDMTkwLjgzLDMwLjU1IDE5MS42NTIsMzAuNDMyIDE5Mi4xODYsMzAuMTI0IEwxOTQuNTY3LDI4Ljc1IEwxNjkuNDQyLDE0LjI0NCBDMTY5LjIxOSwxNC4xMTUgMTY5LjE0MiwxMy44MjkgMTY5LjI3MSwxMy42MDYgQzE2OS40LDEzLjM4MiAxNjkuNjg1LDEzLjMwNiAxNjkuOTA5LDEzLjQzNSBMMTk1LjczNCwyOC4zNDUgQzE5NS44NzksMjguNDI4IDE5NS45NjgsMjguNTgzIDE5NS45NjgsMjguNzUgQzE5NS45NjgsMjguOTE2IDE5NS44NzksMjkuMDcxIDE5NS43MzQsMjkuMTU0IEwxOTIuNjUzLDMwLjkzMyBDMTkxLjkzMiwzMS4zNSAxOTAuODksMzEuNTA4IDE4OS45MzUsMzEuMzQ2IEMxODEuOTcyLDI5Ljk5NSAxNzMuNDc4LDI5Ljg2IDE2NS4zNzIsMzAuOTU0IEMxNTMuNjAyLDMyLjU0MyAxNDIuODYsMzUuOTkzIDEzNC4zMDcsNDAuOTMxIEMxMjUuNzkzLDQ1Ljg0NyAxMTkuODUxLDUyLjAwNCAxMTcuMTI0LDU4LjczNiBDMTE1LjI3LDYzLjMxNCAxMTUuNTAxLDY4LjExMiAxMTcuNzksNzIuNjExIEMxMTguMTYsNzMuMzM2IDExNy44NDUsNzQuMTI0IDExNi45OSw3NC42MTcgTDExMy45MDksNzYuMzk3IEMxMTMuODM2LDc2LjQzOCAxMTMuNzU2LDc2LjQ1OSAxMTMuNjc1LDc2LjQ1OSIgaWQ9IkZpbGwtMjQiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUzLjMxNiwyMS4yNzkgQzE1MC45MDMsMjEuMjc5IDE0OC40OTUsMjAuNzUxIDE0Ni42NjQsMTkuNjkzIEMxNDQuODQ2LDE4LjY0NCAxNDMuODQ0LDE3LjIzMiAxNDMuODQ0LDE1LjcxOCBDMTQzLjg0NCwxNC4xOTEgMTQ0Ljg2LDEyLjc2MyAxNDYuNzA1LDExLjY5OCBMMTU2LjE5OCw2LjA5MSBDMTU2LjMwOSw2LjAyNSAxNTYuNDUyLDYuMDYyIDE1Ni41MTgsNi4xNzMgQzE1Ni41ODMsNi4yODQgMTU2LjU0Nyw2LjQyNyAxNTYuNDM2LDYuNDkzIEwxNDYuOTQsMTIuMTAyIEMxNDUuMjQ0LDEzLjA4MSAxNDQuMzEyLDE0LjM2NSAxNDQuMzEyLDE1LjcxOCBDMTQ0LjMxMiwxNy4wNTggMTQ1LjIzLDE4LjMyNiAxNDYuODk3LDE5LjI4OSBDMTUwLjQ0NiwyMS4zMzggMTU2LjI0LDIxLjMyNyAxNTkuODExLDE5LjI2NSBMMTY5LjU1OSwxMy42MzcgQzE2OS42NywxMy41NzMgMTY5LjgxMywxMy42MTEgMTY5Ljg3OCwxMy43MjMgQzE2OS45NDMsMTMuODM0IDE2OS45MDQsMTMuOTc3IDE2OS43OTMsMTQuMDQyIEwxNjAuMDQ1LDE5LjY3IEMxNTguMTg3LDIwLjc0MiAxNTUuNzQ5LDIxLjI3OSAxNTMuMzE2LDIxLjI3OSIgaWQ9IkZpbGwtMjUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3NS45OTIgTDY3Ljc2Miw0OS40ODQiIGlkPSJGaWxsLTI2IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMy42NzUsNzYuMzQyIEMxMTMuNjE1LDc2LjM0MiAxMTMuNTU1LDc2LjMyNyAxMTMuNSw3Ni4yOTUgTDY3LjU4Nyw0OS43ODcgQzY3LjQxOSw0OS42OSA2Ny4zNjIsNDkuNDc2IDY3LjQ1OSw0OS4zMDkgQzY3LjU1Niw0OS4xNDEgNjcuNzcsNDkuMDgzIDY3LjkzNyw0OS4xOCBMMTEzLjg1LDc1LjY4OCBDMTE0LjAxOCw3NS43ODUgMTE0LjA3NSw3NiAxMTMuOTc4LDc2LjE2NyBDMTEzLjkxNCw3Ni4yNzkgMTEzLjc5Niw3Ni4zNDIgMTEzLjY3NSw3Ni4zNDIiIGlkPSJGaWxsLTI3IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY3Ljc2Miw0OS40ODQgTDY3Ljc2MiwxMDMuNDg1IEM2Ny43NjIsMTA0LjU3NSA2OC41MzIsMTA1LjkwMyA2OS40ODIsMTA2LjQ1MiBMMTExLjk1NSwxMzAuOTczIEMxMTIuOTA1LDEzMS41MjIgMTEzLjY3NSwxMzEuMDgzIDExMy42NzUsMTI5Ljk5MyBMMTEzLjY3NSw3NS45OTIiIGlkPSJGaWxsLTI4IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMi43MjcsMTMxLjU2MSBDMTEyLjQzLDEzMS41NjEgMTEyLjEwNywxMzEuNDY2IDExMS43OCwxMzEuMjc2IEw2OS4zMDcsMTA2Ljc1NSBDNjguMjQ0LDEwNi4xNDIgNjcuNDEyLDEwNC43MDUgNjcuNDEyLDEwMy40ODUgTDY3LjQxMiw0OS40ODQgQzY3LjQxMiw0OS4yOSA2Ny41NjksNDkuMTM0IDY3Ljc2Miw0OS4xMzQgQzY3Ljk1Niw0OS4xMzQgNjguMTEzLDQ5LjI5IDY4LjExMyw0OS40ODQgTDY4LjExMywxMDMuNDg1IEM2OC4xMTMsMTA0LjQ0NSA2OC44MiwxMDUuNjY1IDY5LjY1NywxMDYuMTQ4IEwxMTIuMTMsMTMwLjY3IEMxMTIuNDc0LDEzMC44NjggMTEyLjc5MSwxMzAuOTEzIDExMywxMzAuNzkyIEMxMTMuMjA2LDEzMC42NzMgMTEzLjMyNSwxMzAuMzgxIDExMy4zMjUsMTI5Ljk5MyBMMTEzLjMyNSw3NS45OTIgQzExMy4zMjUsNzUuNzk4IDExMy40ODIsNzUuNjQxIDExMy42NzUsNzUuNjQxIEMxMTMuODY5LDc1LjY0MSAxMTQuMDI1LDc1Ljc5OCAxMTQuMDI1LDc1Ljk5MiBMMTE0LjAyNSwxMjkuOTkzIEMxMTQuMDI1LDEzMC42NDggMTEzLjc4NiwxMzEuMTQ3IDExMy4zNSwxMzEuMzk5IEMxMTMuMTYyLDEzMS41MDcgMTEyLjk1MiwxMzEuNTYxIDExMi43MjcsMTMxLjU2MSIgaWQ9IkZpbGwtMjkiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEyLjg2LDQwLjUxMiBDMTEyLjg2LDQwLjUxMiAxMTIuODYsNDAuNTEyIDExMi44NTksNDAuNTEyIEMxMTAuNTQxLDQwLjUxMiAxMDguMzYsMzkuOTkgMTA2LjcxNywzOS4wNDEgQzEwNS4wMTIsMzguMDU3IDEwNC4wNzQsMzYuNzI2IDEwNC4wNzQsMzUuMjkyIEMxMDQuMDc0LDMzLjg0NyAxMDUuMDI2LDMyLjUwMSAxMDYuNzU0LDMxLjUwNCBMMTE4Ljc5NSwyNC41NTEgQzEyMC40NjMsMjMuNTg5IDEyMi42NjksMjMuMDU4IDEyNS4wMDcsMjMuMDU4IEMxMjcuMzI1LDIzLjA1OCAxMjkuNTA2LDIzLjU4MSAxMzEuMTUsMjQuNTMgQzEzMi44NTQsMjUuNTE0IDEzMy43OTMsMjYuODQ1IDEzMy43OTMsMjguMjc4IEMxMzMuNzkzLDI5LjcyNCAxMzIuODQxLDMxLjA2OSAxMzEuMTEzLDMyLjA2NyBMMTE5LjA3MSwzOS4wMTkgQzExNy40MDMsMzkuOTgyIDExNS4xOTcsNDAuNTEyIDExMi44Niw0MC41MTIgTDExMi44Niw0MC41MTIgWiBNMTI1LjAwNywyMy43NTkgQzEyMi43OSwyMy43NTkgMTIwLjcwOSwyNC4yNTYgMTE5LjE0NiwyNS4xNTggTDEwNy4xMDQsMzIuMTEgQzEwNS42MDIsMzIuOTc4IDEwNC43NzQsMzQuMTA4IDEwNC43NzQsMzUuMjkyIEMxMDQuNzc0LDM2LjQ2NSAxMDUuNTg5LDM3LjU4MSAxMDcuMDY3LDM4LjQzNCBDMTA4LjYwNSwzOS4zMjMgMTEwLjY2MywzOS44MTIgMTEyLjg1OSwzOS44MTIgTDExMi44NiwzOS44MTIgQzExNS4wNzYsMzkuODEyIDExNy4xNTgsMzkuMzE1IDExOC43MjEsMzguNDEzIEwxMzAuNzYyLDMxLjQ2IEMxMzIuMjY0LDMwLjU5MyAxMzMuMDkyLDI5LjQ2MyAxMzMuMDkyLDI4LjI3OCBDMTMzLjA5MiwyNy4xMDYgMTMyLjI3OCwyNS45OSAxMzAuOCwyNS4xMzYgQzEyOS4yNjEsMjQuMjQ4IDEyNy4yMDQsMjMuNzU5IDEyNS4wMDcsMjMuNzU5IEwxMjUuMDA3LDIzLjc1OSBaIiBpZD0iRmlsbC0zMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNjUuNjMsMTYuMjE5IEwxNTkuODk2LDE5LjUzIEMxNTYuNzI5LDIxLjM1OCAxNTEuNjEsMjEuMzY3IDE0OC40NjMsMTkuNTUgQzE0NS4zMTYsMTcuNzMzIDE0NS4zMzIsMTQuNzc4IDE0OC40OTksMTIuOTQ5IEwxNTQuMjMzLDkuNjM5IEwxNjUuNjMsMTYuMjE5IiBpZD0iRmlsbC0zMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNTQuMjMzLDEwLjQ0OCBMMTY0LjIyOCwxNi4yMTkgTDE1OS41NDYsMTguOTIzIEMxNTguMTEyLDE5Ljc1IDE1Ni4xOTQsMjAuMjA2IDE1NC4xNDcsMjAuMjA2IEMxNTIuMTE4LDIwLjIwNiAxNTAuMjI0LDE5Ljc1NyAxNDguODE0LDE4Ljk0MyBDMTQ3LjUyNCwxOC4xOTkgMTQ2LjgxNCwxNy4yNDkgMTQ2LjgxNCwxNi4yNjkgQzE0Ni44MTQsMTUuMjc4IDE0Ny41MzcsMTQuMzE0IDE0OC44NSwxMy41NTYgTDE1NC4yMzMsMTAuNDQ4IE0xNTQuMjMzLDkuNjM5IEwxNDguNDk5LDEyLjk0OSBDMTQ1LjMzMiwxNC43NzggMTQ1LjMxNiwxNy43MzMgMTQ4LjQ2MywxOS41NSBDMTUwLjAzMSwyMC40NTUgMTUyLjA4NiwyMC45MDcgMTU0LjE0NywyMC45MDcgQzE1Ni4yMjQsMjAuOTA3IDE1OC4zMDYsMjAuNDQ3IDE1OS44OTYsMTkuNTMgTDE2NS42MywxNi4yMTkgTDE1NC4yMzMsOS42MzkiIGlkPSJGaWxsLTMyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NS40NDUsNzIuNjY3IEwxNDUuNDQ1LDcyLjY2NyBDMTQzLjY3Miw3Mi42NjcgMTQyLjIwNCw3MS44MTcgMTQxLjIwMiw3MC40MjIgQzE0MS4xMzUsNzAuMzMgMTQxLjE0NSw3MC4xNDcgMTQxLjIyNSw3MC4wNjYgQzE0MS4zMDUsNjkuOTg1IDE0MS40MzIsNjkuOTQ2IDE0MS41MjUsNzAuMDExIEMxNDIuMzA2LDcwLjU1OSAxNDMuMjMxLDcwLjgyMyAxNDQuMjc2LDcwLjgyMiBDMTQ1LjU5OCw3MC44MjIgMTQ3LjAzLDcwLjM3NiAxNDguNTMyLDY5LjUwOSBDMTUzLjg0Miw2Ni40NDMgMTU4LjE2Myw1OC45ODcgMTU4LjE2Myw1Mi44OTQgQzE1OC4xNjMsNTAuOTY3IDE1Ny43MjEsNDkuMzMyIDE1Ni44ODQsNDguMTY4IEMxNTYuODE4LDQ4LjA3NiAxNTYuODI4LDQ3Ljk0OCAxNTYuOTA4LDQ3Ljg2NyBDMTU2Ljk4OCw0Ny43ODYgMTU3LjExNCw0Ny43NzQgMTU3LjIwOCw0Ny44NCBDMTU4Ljg3OCw0OS4wMTIgMTU5Ljc5OCw1MS4yMiAxNTkuNzk4LDU0LjA1OSBDMTU5Ljc5OCw2MC4zMDEgMTU1LjM3Myw2OC4wNDYgMTQ5LjkzMyw3MS4xODYgQzE0OC4zNiw3Mi4wOTQgMTQ2Ljg1LDcyLjY2NyAxNDUuNDQ1LDcyLjY2NyBMMTQ1LjQ0NSw3Mi42NjcgWiBNMTQyLjQ3Niw3MSBDMTQzLjI5LDcxLjY1MSAxNDQuMjk2LDcyLjAwMiAxNDUuNDQ1LDcyLjAwMiBDMTQ2Ljc2Nyw3Mi4wMDIgMTQ4LjE5OCw3MS41NSAxNDkuNyw3MC42ODIgQzE1NS4wMSw2Ny42MTcgMTU5LjMzMSw2MC4xNTkgMTU5LjMzMSw1NC4wNjUgQzE1OS4zMzEsNTIuMDg1IDE1OC44NjgsNTAuNDM1IDE1OC4wMDYsNDkuMjcyIEMxNTguNDE3LDUwLjMwNyAxNTguNjMsNTEuNTMyIDE1OC42Myw1Mi44OTIgQzE1OC42Myw1OS4xMzQgMTU0LjIwNSw2Ni43NjcgMTQ4Ljc2NSw2OS45MDcgQzE0Ny4xOTIsNzAuODE2IDE0NS42ODEsNzEuMjgzIDE0NC4yNzYsNzEuMjgzIEMxNDMuNjM0LDcxLjI4MyAxNDMuMDMzLDcxLjE5MiAxNDIuNDc2LDcxIEwxNDIuNDc2LDcxIFoiIGlkPSJGaWxsLTMzIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0OC42NDgsNjkuNzA0IEMxNTQuMDMyLDY2LjU5NiAxNTguMzk2LDU5LjA2OCAxNTguMzk2LDUyLjg5MSBDMTU4LjM5Niw1MC44MzkgMTU3LjkxMyw0OS4xOTggMTU3LjA3NCw0OC4wMyBDMTU1LjI4OSw0Ni43NzggMTUyLjY5OSw0Ni44MzYgMTQ5LjgxNiw0OC41MDEgQzE0NC40MzMsNTEuNjA5IDE0MC4wNjgsNTkuMTM3IDE0MC4wNjgsNjUuMzE0IEMxNDAuMDY4LDY3LjM2NSAxNDAuNTUyLDY5LjAwNiAxNDEuMzkxLDcwLjE3NCBDMTQzLjE3Niw3MS40MjcgMTQ1Ljc2NSw3MS4zNjkgMTQ4LjY0OCw2OS43MDQiIGlkPSJGaWxsLTM0IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NC4yNzYsNzEuMjc2IEwxNDQuMjc2LDcxLjI3NiBDMTQzLjEzMyw3MS4yNzYgMTQyLjExOCw3MC45NjkgMTQxLjI1Nyw3MC4zNjUgQzE0MS4yMzYsNzAuMzUxIDE0MS4yMTcsNzAuMzMyIDE0MS4yMDIsNzAuMzExIEMxNDAuMzA3LDY5LjA2NyAxMzkuODM1LDY3LjMzOSAxMzkuODM1LDY1LjMxNCBDMTM5LjgzNSw1OS4wNzMgMTQ0LjI2LDUxLjQzOSAxNDkuNyw0OC4yOTggQzE1MS4yNzMsNDcuMzkgMTUyLjc4NCw0Ni45MjkgMTU0LjE4OSw0Ni45MjkgQzE1NS4zMzIsNDYuOTI5IDE1Ni4zNDcsNDcuMjM2IDE1Ny4yMDgsNDcuODM5IEMxNTcuMjI5LDQ3Ljg1NCAxNTcuMjQ4LDQ3Ljg3MyAxNTcuMjYzLDQ3Ljg5NCBDMTU4LjE1Nyw0OS4xMzggMTU4LjYzLDUwLjg2NSAxNTguNjMsNTIuODkxIEMxNTguNjMsNTkuMTMyIDE1NC4yMDUsNjYuNzY2IDE0OC43NjUsNjkuOTA3IEMxNDcuMTkyLDcwLjgxNSAxNDUuNjgxLDcxLjI3NiAxNDQuMjc2LDcxLjI3NiBMMTQ0LjI3Niw3MS4yNzYgWiBNMTQxLjU1OCw3MC4xMDQgQzE0Mi4zMzEsNzAuNjM3IDE0My4yNDUsNzEuMDA1IDE0NC4yNzYsNzEuMDA1IEMxNDUuNTk4LDcxLjAwNSAxNDcuMDMsNzAuNDY3IDE0OC41MzIsNjkuNiBDMTUzLjg0Miw2Ni41MzQgMTU4LjE2Myw1OS4wMzMgMTU4LjE2Myw1Mi45MzkgQzE1OC4xNjMsNTEuMDMxIDE1Ny43MjksNDkuMzg1IDE1Ni45MDcsNDguMjIzIEMxNTYuMTMzLDQ3LjY5MSAxNTUuMjE5LDQ3LjQwOSAxNTQuMTg5LDQ3LjQwOSBDMTUyLjg2Nyw0Ny40MDkgMTUxLjQzNSw0Ny44NDIgMTQ5LjkzMyw0OC43MDkgQzE0NC42MjMsNTEuNzc1IDE0MC4zMDIsNTkuMjczIDE0MC4zMDIsNjUuMzY2IEMxNDAuMzAyLDY3LjI3NiAxNDAuNzM2LDY4Ljk0MiAxNDEuNTU4LDcwLjEwNCBMMTQxLjU1OCw3MC4xMDQgWiIgaWQ9IkZpbGwtMzUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUwLjcyLDY1LjM2MSBMMTUwLjM1Nyw2NS4wNjYgQzE1MS4xNDcsNjQuMDkyIDE1MS44NjksNjMuMDQgMTUyLjUwNSw2MS45MzggQzE1My4zMTMsNjAuNTM5IDE1My45NzgsNTkuMDY3IDE1NC40ODIsNTcuNTYzIEwxNTQuOTI1LDU3LjcxMiBDMTU0LjQxMiw1OS4yNDUgMTUzLjczMyw2MC43NDUgMTUyLjkxLDYyLjE3MiBDMTUyLjI2Miw2My4yOTUgMTUxLjUyNSw2NC4zNjggMTUwLjcyLDY1LjM2MSIgaWQ9IkZpbGwtMzYiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE1LjkxNyw4NC41MTQgTDExNS41NTQsODQuMjIgQzExNi4zNDQsODMuMjQ1IDExNy4wNjYsODIuMTk0IDExNy43MDIsODEuMDkyIEMxMTguNTEsNzkuNjkyIDExOS4xNzUsNzguMjIgMTE5LjY3OCw3Ni43MTcgTDEyMC4xMjEsNzYuODY1IEMxMTkuNjA4LDc4LjM5OCAxMTguOTMsNzkuODk5IDExOC4xMDYsODEuMzI2IEMxMTcuNDU4LDgyLjQ0OCAxMTYuNzIyLDgzLjUyMSAxMTUuOTE3LDg0LjUxNCIgaWQ9IkZpbGwtMzciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE0LDEzMC40NzYgTDExNCwxMzAuMDA4IEwxMTQsNzYuMDUyIEwxMTQsNzUuNTg0IEwxMTQsNzYuMDUyIEwxMTQsMTMwLjAwOCBMMTE0LDEzMC40NzYiIGlkPSJGaWxsLTM4IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYyLjAwMDAwMCwgMC4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkuODIyLDM3LjQ3NCBDMTkuODM5LDM3LjMzOSAxOS43NDcsMzcuMTk0IDE5LjU1NSwzNy4wODIgQzE5LjIyOCwzNi44OTQgMTguNzI5LDM2Ljg3MiAxOC40NDYsMzcuMDM3IEwxMi40MzQsNDAuNTA4IEMxMi4zMDMsNDAuNTg0IDEyLjI0LDQwLjY4NiAxMi4yNDMsNDAuNzkzIEMxMi4yNDUsNDAuOTI1IDEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQxLjM3MSBMMTIuMjQ1LDQxLjQxNCBMMTIuMjM4LDQxLjU0MiBDOC4xNDgsNDMuODg3IDUuNjQ3LDQ1LjMyMSA1LjY0Nyw0NS4zMjEgQzUuNjQ2LDQ1LjMyMSAzLjU3LDQ2LjM2NyAyLjg2LDUwLjUxMyBDMi44Niw1MC41MTMgMS45NDgsNTcuNDc0IDEuOTYyLDcwLjI1OCBDMS45NzcsODIuODI4IDIuNTY4LDg3LjMyOCAzLjEyOSw5MS42MDkgQzMuMzQ5LDkzLjI5MyA2LjEzLDkzLjczNCA2LjEzLDkzLjczNCBDNi40NjEsOTMuNzc0IDYuODI4LDkzLjcwNyA3LjIxLDkzLjQ4NiBMODIuNDgzLDQ5LjkzNSBDODQuMjkxLDQ4Ljg2NiA4NS4xNSw0Ni4yMTYgODUuNTM5LDQzLjY1MSBDODYuNzUyLDM1LjY2MSA4Ny4yMTQsMTAuNjczIDg1LjI2NCwzLjc3MyBDODUuMDY4LDMuMDggODQuNzU0LDIuNjkgODQuMzk2LDIuNDkxIEw4Mi4zMSwxLjcwMSBDODEuNTgzLDEuNzI5IDgwLjg5NCwyLjE2OCA4MC43NzYsMi4yMzYgQzgwLjYzNiwyLjMxNyA0MS44MDcsMjQuNTg1IDIwLjAzMiwzNy4wNzIgTDE5LjgyMiwzNy40NzQiIGlkPSJGaWxsLTEiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNODIuMzExLDEuNzAxIEw4NC4zOTYsMi40OTEgQzg0Ljc1NCwyLjY5IDg1LjA2OCwzLjA4IDg1LjI2NCwzLjc3MyBDODcuMjEzLDEwLjY3MyA4Ni43NTEsMzUuNjYgODUuNTM5LDQzLjY1MSBDODUuMTQ5LDQ2LjIxNiA4NC4yOSw0OC44NjYgODIuNDgzLDQ5LjkzNSBMNy4yMSw5My40ODYgQzYuODk3LDkzLjY2NyA2LjU5NSw5My43NDQgNi4zMTQsOTMuNzQ0IEw2LjEzMSw5My43MzMgQzYuMTMxLDkzLjczNCAzLjM0OSw5My4yOTMgMy4xMjgsOTEuNjA5IEMyLjU2OCw4Ny4zMjcgMS45NzcsODIuODI4IDEuOTYzLDcwLjI1OCBDMS45NDgsNTcuNDc0IDIuODYsNTAuNTEzIDIuODYsNTAuNTEzIEMzLjU3LDQ2LjM2NyA1LjY0Nyw0NS4zMjEgNS42NDcsNDUuMzIxIEM1LjY0Nyw0NS4zMjEgOC4xNDgsNDMuODg3IDEyLjIzOCw0MS41NDIgTDEyLjI0NSw0MS40MTQgTDEyLjI0NSw0MS4zNzEgQzEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQwLjkyNSAxMi4yNDMsNDAuNzkzIEMxMi4yNCw0MC42ODYgMTIuMzAyLDQwLjU4MyAxMi40MzQsNDAuNTA4IEwxOC40NDYsMzcuMDM2IEMxOC41NzQsMzYuOTYyIDE4Ljc0NiwzNi45MjYgMTguOTI3LDM2LjkyNiBDMTkuMTQ1LDM2LjkyNiAxOS4zNzYsMzYuOTc5IDE5LjU1NCwzNy4wODIgQzE5Ljc0NywzNy4xOTQgMTkuODM5LDM3LjM0IDE5LjgyMiwzNy40NzQgTDIwLjAzMywzNy4wNzIgQzQxLjgwNiwyNC41ODUgODAuNjM2LDIuMzE4IDgwLjc3NywyLjIzNiBDODAuODk0LDIuMTY4IDgxLjU4MywxLjcyOSA4Mi4zMTEsMS43MDEgTTgyLjMxMSwwLjcwNCBMODIuMjcyLDAuNzA1IEM4MS42NTQsMC43MjggODAuOTg5LDAuOTQ5IDgwLjI5OCwxLjM2MSBMODAuMjc3LDEuMzczIEM4MC4xMjksMS40NTggNTkuNzY4LDEzLjEzNSAxOS43NTgsMzYuMDc5IEMxOS41LDM1Ljk4MSAxOS4yMTQsMzUuOTI5IDE4LjkyNywzNS45MjkgQzE4LjU2MiwzNS45MjkgMTguMjIzLDM2LjAxMyAxNy45NDcsMzYuMTczIEwxMS45MzUsMzkuNjQ0IEMxMS40OTMsMzkuODk5IDExLjIzNiw0MC4zMzQgMTEuMjQ2LDQwLjgxIEwxMS4yNDcsNDAuOTYgTDUuMTY3LDQ0LjQ0NyBDNC43OTQsNDQuNjQ2IDIuNjI1LDQ1Ljk3OCAxLjg3Nyw1MC4zNDUgTDEuODcxLDUwLjM4NCBDMS44NjIsNTAuNDU0IDAuOTUxLDU3LjU1NyAwLjk2NSw3MC4yNTkgQzAuOTc5LDgyLjg3OSAxLjU2OCw4Ny4zNzUgMi4xMzcsOTEuNzI0IEwyLjEzOSw5MS43MzkgQzIuNDQ3LDk0LjA5NCA1LjYxNCw5NC42NjIgNS45NzUsOTQuNzE5IEw2LjAwOSw5NC43MjMgQzYuMTEsOTQuNzM2IDYuMjEzLDk0Ljc0MiA2LjMxNCw5NC43NDIgQzYuNzksOTQuNzQyIDcuMjYsOTQuNjEgNy43MSw5NC4zNSBMODIuOTgzLDUwLjc5OCBDODQuNzk0LDQ5LjcyNyA4NS45ODIsNDcuMzc1IDg2LjUyNSw0My44MDEgQzg3LjcxMSwzNS45ODcgODguMjU5LDEwLjcwNSA4Ni4yMjQsMy41MDIgQzg1Ljk3MSwyLjYwOSA4NS41MiwxLjk3NSA4NC44ODEsMS42MiBMODQuNzQ5LDEuNTU4IEw4Mi42NjQsMC43NjkgQzgyLjU1MSwwLjcyNSA4Mi40MzEsMC43MDQgODIuMzExLDAuNzA0IiBpZD0iRmlsbC0yIiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY2LjI2NywxMS41NjUgTDY3Ljc2MiwxMS45OTkgTDExLjQyMyw0NC4zMjUiIGlkPSJGaWxsLTMiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMjAyLDkwLjU0NSBDMTIuMDI5LDkwLjU0NSAxMS44NjIsOTAuNDU1IDExLjc2OSw5MC4yOTUgQzExLjYzMiw5MC4wNTcgMTEuNzEzLDg5Ljc1MiAxMS45NTIsODkuNjE0IEwzMC4zODksNzguOTY5IEMzMC42MjgsNzguODMxIDMwLjkzMyw3OC45MTMgMzEuMDcxLDc5LjE1MiBDMzEuMjA4LDc5LjM5IDMxLjEyNyw3OS42OTYgMzAuODg4LDc5LjgzMyBMMTIuNDUxLDkwLjQ3OCBMMTIuMjAyLDkwLjU0NSIgaWQ9IkZpbGwtNCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMy43NjQsNDIuNjU0IEwxMy42NTYsNDIuNTkyIEwxMy43MDIsNDIuNDIxIEwxOC44MzcsMzkuNDU3IEwxOS4wMDcsMzkuNTAyIEwxOC45NjIsMzkuNjczIEwxMy44MjcsNDIuNjM3IEwxMy43NjQsNDIuNjU0IiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTguNTIsOTAuMzc1IEw4LjUyLDQ2LjQyMSBMOC41ODMsNDYuMzg1IEw3NS44NCw3LjU1NCBMNzUuODQsNTEuNTA4IEw3NS43NzgsNTEuNTQ0IEw4LjUyLDkwLjM3NSBMOC41Miw5MC4zNzUgWiBNOC43Nyw0Ni41NjQgTDguNzcsODkuOTQ0IEw3NS41OTEsNTEuMzY1IEw3NS41OTEsNy45ODUgTDguNzcsNDYuNTY0IEw4Ljc3LDQ2LjU2NCBaIiBpZD0iRmlsbC02IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0Ljk4Niw4My4xODIgQzI0Ljc1Niw4My4zMzEgMjQuMzc0LDgzLjU2NiAyNC4xMzcsODMuNzA1IEwxMi42MzIsOTAuNDA2IEMxMi4zOTUsOTAuNTQ1IDEyLjQyNiw5MC42NTggMTIuNyw5MC42NTggTDEzLjI2NSw5MC42NTggQzEzLjU0LDkwLjY1OCAxMy45NTgsOTAuNTQ1IDE0LjE5NSw5MC40MDYgTDI1LjcsODMuNzA1IEMyNS45MzcsODMuNTY2IDI2LjEyOCw4My40NTIgMjYuMTI1LDgzLjQ0OSBDMjYuMTIyLDgzLjQ0NyAyNi4xMTksODMuMjIgMjYuMTE5LDgyLjk0NiBDMjYuMTE5LDgyLjY3MiAyNS45MzEsODIuNTY5IDI1LjcwMSw4Mi43MTkgTDI0Ljk4Niw4My4xODIiIGlkPSJGaWxsLTciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjY2LDkwLjc4MiBMMTIuNyw5MC43ODIgQzEyLjUsOTAuNzgyIDEyLjM4NCw5MC43MjYgMTIuMzU0LDkwLjYxNiBDMTIuMzI0LDkwLjUwNiAxMi4zOTcsOTAuMzk5IDEyLjU2OSw5MC4yOTkgTDI0LjA3NCw4My41OTcgQzI0LjMxLDgzLjQ1OSAyNC42ODksODMuMjI2IDI0LjkxOCw4My4wNzggTDI1LjYzMyw4Mi42MTQgQzI1LjcyMyw4Mi41NTUgMjUuODEzLDgyLjUyNSAyNS44OTksODIuNTI1IEMyNi4wNzEsODIuNTI1IDI2LjI0NCw4Mi42NTUgMjYuMjQ0LDgyLjk0NiBDMjYuMjQ0LDgzLjE2IDI2LjI0NSw4My4zMDkgMjYuMjQ3LDgzLjM4MyBMMjYuMjUzLDgzLjM4NyBMMjYuMjQ5LDgzLjQ1NiBDMjYuMjQ2LDgzLjUzMSAyNi4yNDYsODMuNTMxIDI1Ljc2Myw4My44MTIgTDE0LjI1OCw5MC41MTQgQzE0LDkwLjY2NSAxMy41NjQsOTAuNzgyIDEzLjI2Niw5MC43ODIgTDEzLjI2Niw5MC43ODIgWiBNMTIuNjY2LDkwLjUzMiBMMTIuNyw5MC41MzMgTDEzLjI2Niw5MC41MzMgQzEzLjUxOCw5MC41MzMgMTMuOTE1LDkwLjQyNSAxNC4xMzIsOTAuMjk5IEwyNS42MzcsODMuNTk3IEMyNS44MDUsODMuNDk5IDI1LjkzMSw4My40MjQgMjUuOTk4LDgzLjM4MyBDMjUuOTk0LDgzLjI5OSAyNS45OTQsODMuMTY1IDI1Ljk5NCw4Mi45NDYgTDI1Ljg5OSw4Mi43NzUgTDI1Ljc2OCw4Mi44MjQgTDI1LjA1NCw4My4yODcgQzI0LjgyMiw4My40MzcgMjQuNDM4LDgzLjY3MyAyNC4yLDgzLjgxMiBMMTIuNjk1LDkwLjUxNCBMMTIuNjY2LDkwLjUzMiBMMTIuNjY2LDkwLjUzMiBaIiBpZD0iRmlsbC04IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLjI2Niw4OS44NzEgTDEyLjcsODkuODcxIEMxMi41LDg5Ljg3MSAxMi4zODQsODkuODE1IDEyLjM1NCw4OS43MDUgQzEyLjMyNCw4OS41OTUgMTIuMzk3LDg5LjQ4OCAxMi41NjksODkuMzg4IEwyNC4wNzQsODIuNjg2IEMyNC4zMzIsODIuNTM1IDI0Ljc2OCw4Mi40MTggMjUuMDY3LDgyLjQxOCBMMjUuNjMyLDgyLjQxOCBDMjUuODMyLDgyLjQxOCAyNS45NDgsODIuNDc0IDI1Ljk3OCw4Mi41ODQgQzI2LjAwOCw4Mi42OTQgMjUuOTM1LDgyLjgwMSAyNS43NjMsODIuOTAxIEwxNC4yNTgsODkuNjAzIEMxNCw4OS43NTQgMTMuNTY0LDg5Ljg3MSAxMy4yNjYsODkuODcxIEwxMy4yNjYsODkuODcxIFogTTEyLjY2Niw4OS42MjEgTDEyLjcsODkuNjIyIEwxMy4yNjYsODkuNjIyIEMxMy41MTgsODkuNjIyIDEzLjkxNSw4OS41MTUgMTQuMTMyLDg5LjM4OCBMMjUuNjM3LDgyLjY4NiBMMjUuNjY3LDgyLjY2OCBMMjUuNjMyLDgyLjY2NyBMMjUuMDY3LDgyLjY2NyBDMjQuODE1LDgyLjY2NyAyNC40MTgsODIuNzc1IDI0LjIsODIuOTAxIEwxMi42OTUsODkuNjAzIEwxMi42NjYsODkuNjIxIEwxMi42NjYsODkuNjIxIFoiIGlkPSJGaWxsLTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMzcsOTAuODAxIEwxMi4zNyw4OS41NTQgTDEyLjM3LDkwLjgwMSIgaWQ9IkZpbGwtMTAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4xMyw5My45MDEgQzUuMzc5LDkzLjgwOCA0LjgxNiw5My4xNjQgNC42OTEsOTIuNTI1IEMzLjg2LDg4LjI4NyAzLjU0LDgzLjc0MyAzLjUyNiw3MS4xNzMgQzMuNTExLDU4LjM4OSA0LjQyMyw1MS40MjggNC40MjMsNTEuNDI4IEM1LjEzNCw0Ny4yODIgNy4yMSw0Ni4yMzYgNy4yMSw0Ni4yMzYgQzcuMjEsNDYuMjM2IDgxLjY2NywzLjI1IDgyLjA2OSwzLjAxNyBDODIuMjkyLDIuODg4IDg0LjU1NiwxLjQzMyA4NS4yNjQsMy45NCBDODcuMjE0LDEwLjg0IDg2Ljc1MiwzNS44MjcgODUuNTM5LDQzLjgxOCBDODUuMTUsNDYuMzgzIDg0LjI5MSw0OS4wMzMgODIuNDgzLDUwLjEwMSBMNy4yMSw5My42NTMgQzYuODI4LDkzLjg3NCA2LjQ2MSw5My45NDEgNi4xMyw5My45MDEgQzYuMTMsOTMuOTAxIDMuMzQ5LDkzLjQ2IDMuMTI5LDkxLjc3NiBDMi41NjgsODcuNDk1IDEuOTc3LDgyLjk5NSAxLjk2Miw3MC40MjUgQzEuOTQ4LDU3LjY0MSAyLjg2LDUwLjY4IDIuODYsNTAuNjggQzMuNTcsNDYuNTM0IDUuNjQ3LDQ1LjQ4OSA1LjY0Nyw0NS40ODkgQzUuNjQ2LDQ1LjQ4OSA4LjA2NSw0NC4wOTIgMTIuMjQ1LDQxLjY3OSBMMTMuMTE2LDQxLjU2IEwxOS43MTUsMzcuNzMgTDE5Ljc2MSwzNy4yNjkgTDYuMTMsOTMuOTAxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjMxNyw5NC4xNjEgTDYuMTAyLDk0LjE0OCBMNi4xMDEsOTQuMTQ4IEw1Ljg1Nyw5NC4xMDEgQzUuMTM4LDkzLjk0NSAzLjA4NSw5My4zNjUgMi44ODEsOTEuODA5IEMyLjMxMyw4Ny40NjkgMS43MjcsODIuOTk2IDEuNzEzLDcwLjQyNSBDMS42OTksNTcuNzcxIDIuNjA0LDUwLjcxOCAyLjYxMyw1MC42NDggQzMuMzM4LDQ2LjQxNyA1LjQ0NSw0NS4zMSA1LjUzNSw0NS4yNjYgTDEyLjE2Myw0MS40MzkgTDEzLjAzMyw0MS4zMiBMMTkuNDc5LDM3LjU3OCBMMTkuNTEzLDM3LjI0NCBDMTkuNTI2LDM3LjEwNyAxOS42NDcsMzcuMDA4IDE5Ljc4NiwzNy4wMjEgQzE5LjkyMiwzNy4wMzQgMjAuMDIzLDM3LjE1NiAyMC4wMDksMzcuMjkzIEwxOS45NSwzNy44ODIgTDEzLjE5OCw0MS44MDEgTDEyLjMyOCw0MS45MTkgTDUuNzcyLDQ1LjcwNCBDNS43NDEsNDUuNzIgMy43ODIsNDYuNzcyIDMuMTA2LDUwLjcyMiBDMy4wOTksNTAuNzgyIDIuMTk4LDU3LjgwOCAyLjIxMiw3MC40MjQgQzIuMjI2LDgyLjk2MyAyLjgwOSw4Ny40MiAzLjM3Myw5MS43MjkgQzMuNDY0LDkyLjQyIDQuMDYyLDkyLjg4MyA0LjY4Miw5My4xODEgQzQuNTY2LDkyLjk4NCA0LjQ4Niw5Mi43NzYgNC40NDYsOTIuNTcyIEMzLjY2NSw4OC41ODggMy4yOTEsODQuMzcgMy4yNzYsNzEuMTczIEMzLjI2Miw1OC41MiA0LjE2Nyw1MS40NjYgNC4xNzYsNTEuMzk2IEM0LjkwMSw0Ny4xNjUgNy4wMDgsNDYuMDU5IDcuMDk4LDQ2LjAxNCBDNy4wOTQsNDYuMDE1IDgxLjU0MiwzLjAzNCA4MS45NDQsMi44MDIgTDgxLjk3MiwyLjc4NSBDODIuODc2LDIuMjQ3IDgzLjY5MiwyLjA5NyA4NC4zMzIsMi4zNTIgQzg0Ljg4NywyLjU3MyA4NS4yODEsMy4wODUgODUuNTA0LDMuODcyIEM4Ny41MTgsMTEgODYuOTY0LDM2LjA5MSA4NS43ODUsNDMuODU1IEM4NS4yNzgsNDcuMTk2IDg0LjIxLDQ5LjM3IDgyLjYxLDUwLjMxNyBMNy4zMzUsOTMuODY5IEM2Ljk5OSw5NC4wNjMgNi42NTgsOTQuMTYxIDYuMzE3LDk0LjE2MSBMNi4zMTcsOTQuMTYxIFogTTYuMTcsOTMuNjU0IEM2LjQ2Myw5My42OSA2Ljc3NCw5My42MTcgNy4wODUsOTMuNDM3IEw4Mi4zNTgsNDkuODg2IEM4NC4xODEsNDguODA4IDg0Ljk2LDQ1Ljk3MSA4NS4yOTIsNDMuNzggQzg2LjQ2NiwzNi4wNDkgODcuMDIzLDExLjA4NSA4NS4wMjQsNC4wMDggQzg0Ljg0NiwzLjM3NyA4NC41NTEsMi45NzYgODQuMTQ4LDIuODE2IEM4My42NjQsMi42MjMgODIuOTgyLDIuNzY0IDgyLjIyNywzLjIxMyBMODIuMTkzLDMuMjM0IEM4MS43OTEsMy40NjYgNy4zMzUsNDYuNDUyIDcuMzM1LDQ2LjQ1MiBDNy4zMDQsNDYuNDY5IDUuMzQ2LDQ3LjUyMSA0LjY2OSw1MS40NzEgQzQuNjYyLDUxLjUzIDMuNzYxLDU4LjU1NiAzLjc3NSw3MS4xNzMgQzMuNzksODQuMzI4IDQuMTYxLDg4LjUyNCA0LjkzNiw5Mi40NzYgQzUuMDI2LDkyLjkzNyA1LjQxMiw5My40NTkgNS45NzMsOTMuNjE1IEM2LjA4Nyw5My42NCA2LjE1OCw5My42NTIgNi4xNjksOTMuNjU0IEw2LjE3LDkzLjY1NCBMNi4xNyw5My42NTQgWiIgaWQ9IkZpbGwtMTIiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4zMTcsNjguOTgyIEM3LjgwNiw2OC43MDEgOC4yMDIsNjguOTI2IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNi44MjksNzEuMjk0IDYuNDMzLDcxLjA2OSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIiBpZD0iRmlsbC0xMyIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjkyLDcxLjEzMyBDNi42MzEsNzEuMTMzIDYuNDMzLDcwLjkwNSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIEM3LjQ2LDY4LjkgNy41OTUsNjguODYxIDcuNzE0LDY4Ljg2MSBDOC4wMDMsNjguODYxIDguMjAyLDY5LjA5IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNy4xNzQsNzEuMDk0IDcuMDM5LDcxLjEzMyA2LjkyLDcxLjEzMyBNNy43MTQsNjguNjc0IEM3LjU1Nyw2OC42NzQgNy4zOTIsNjguNzIzIDcuMjI0LDY4LjgyMSBDNi42NzYsNjkuMTM4IDYuMjQ2LDY5Ljg3OSA2LjI0Niw3MC41MDggQzYuMjQ2LDcwLjk5NCA2LjUxNyw3MS4zMiA2LjkyLDcxLjMyIEM3LjA3OCw3MS4zMiA3LjI0Myw3MS4yNzEgNy40MTEsNzEuMTc0IEM3Ljk1OSw3MC44NTcgOC4zODksNzAuMTE3IDguMzg5LDY5LjQ4NyBDOC4zODksNjkuMDAxIDguMTE3LDY4LjY3NCA3LjcxNCw2OC42NzQiIGlkPSJGaWxsLTE0IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYuOTIsNzAuOTQ3IEM2LjY0OSw3MC45NDcgNi42MjEsNzAuNjQgNi42MjEsNzAuNTA4IEM2LjYyMSw3MC4wMTcgNi45ODIsNjkuMzkyIDcuNDExLDY5LjE0NSBDNy41MjEsNjkuMDgyIDcuNjI1LDY5LjA0OSA3LjcxNCw2OS4wNDkgQzcuOTg2LDY5LjA0OSA4LjAxNSw2OS4zNTUgOC4wMTUsNjkuNDg3IEM4LjAxNSw2OS45NzggNy42NTIsNzAuNjAzIDcuMjI0LDcwLjg1MSBDNy4xMTUsNzAuOTE0IDcuMDEsNzAuOTQ3IDYuOTIsNzAuOTQ3IE03LjcxNCw2OC44NjEgQzcuNTk1LDY4Ljg2MSA3LjQ2LDY4LjkgNy4zMTcsNjguOTgyIEM2LjgyOSw2OS4yNjUgNi40MzMsNjkuOTQ4IDYuNDMzLDcwLjUwOCBDNi40MzMsNzAuOTA1IDYuNjMxLDcxLjEzMyA2LjkyLDcxLjEzMyBDNy4wMzksNzEuMTMzIDcuMTc0LDcxLjA5NCA3LjMxNyw3MS4wMTIgQzcuODA2LDcwLjczIDguMjAyLDcwLjA0NyA4LjIwMiw2OS40ODcgQzguMjAyLDY5LjA5IDguMDAzLDY4Ljg2MSA3LjcxNCw2OC44NjEiIGlkPSJGaWxsLTE1IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcuNDQ0LDg1LjM1IEM3LjcwOCw4NS4xOTggNy45MjEsODUuMzE5IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuOTI1IDcuNzA4LDg2LjI5MiA3LjQ0NCw4Ni40NDQgQzcuMTgxLDg2LjU5NyA2Ljk2Nyw4Ni40NzUgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IiBpZD0iRmlsbC0xNiIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjIzLDg2LjUxIEM3LjA3NCw4Ni41MSA2Ljk2Nyw4Ni4zODcgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IEM3LjUyMSw4NS4zMDUgNy41OTQsODUuMjg0IDcuNjU4LDg1LjI4NCBDNy44MTQsODUuMjg0IDcuOTIxLDg1LjQwOCA3LjkyMSw4NS42MjIgQzcuOTIxLDg1LjkyNSA3LjcwOCw4Ni4yOTIgNy40NDQsODYuNDQ0IEM3LjM2Nyw4Ni40ODkgNy4yOTQsODYuNTEgNy4yMyw4Ni41MSBNNy42NTgsODUuMDk4IEM3LjU1OCw4NS4wOTggNy40NTUsODUuMTI3IDcuMzUxLDg1LjE4OCBDNy4wMzEsODUuMzczIDYuNzgxLDg1LjgwNiA2Ljc4MSw4Ni4xNzMgQzYuNzgxLDg2LjQ4MiA2Ljk2Niw4Ni42OTcgNy4yMyw4Ni42OTcgQzcuMzMsODYuNjk3IDcuNDMzLDg2LjY2NiA3LjUzOCw4Ni42MDcgQzcuODU4LDg2LjQyMiA4LjEwOCw4NS45ODkgOC4xMDgsODUuNjIyIEM4LjEwOCw4NS4zMTMgNy45MjMsODUuMDk4IDcuNjU4LDg1LjA5OCIgaWQ9IkZpbGwtMTciIGZpbGw9IiM4MDk3QTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4yMyw4Ni4zMjIgTDcuMTU0LDg2LjE3MyBDNy4xNTQsODUuOTM4IDcuMzMzLDg1LjYyOSA3LjUzOCw4NS41MTIgTDcuNjU4LDg1LjQ3MSBMNy43MzQsODUuNjIyIEM3LjczNCw4NS44NTYgNy41NTUsODYuMTY0IDcuMzUxLDg2LjI4MiBMNy4yMyw4Ni4zMjIgTTcuNjU4LDg1LjI4NCBDNy41OTQsODUuMjg0IDcuNTIxLDg1LjMwNSA3LjQ0NCw4NS4zNSBDNy4xODEsODUuNTAyIDYuOTY3LDg1Ljg3MSA2Ljk2Nyw4Ni4xNzMgQzYuOTY3LDg2LjM4NyA3LjA3NCw4Ni41MSA3LjIzLDg2LjUxIEM3LjI5NCw4Ni41MSA3LjM2Nyw4Ni40ODkgNy40NDQsODYuNDQ0IEM3LjcwOCw4Ni4yOTIgNy45MjEsODUuOTI1IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuNDA4IDcuODE0LDg1LjI4NCA3LjY1OCw4NS4yODQiIGlkPSJGaWxsLTE4IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTc3LjI3OCw3Ljc2OSBMNzcuMjc4LDUxLjQzNiBMMTAuMjA4LDkwLjE2IEwxMC4yMDgsNDYuNDkzIEw3Ny4yNzgsNy43NjkiIGlkPSJGaWxsLTE5IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4Myw5MC4zNzUgTDEwLjA4Myw0Ni40MjEgTDEwLjE0Niw0Ni4zODUgTDc3LjQwMyw3LjU1NCBMNzcuNDAzLDUxLjUwOCBMNzcuMzQxLDUxLjU0NCBMMTAuMDgzLDkwLjM3NSBMMTAuMDgzLDkwLjM3NSBaIE0xMC4zMzMsNDYuNTY0IEwxMC4zMzMsODkuOTQ0IEw3Ny4xNTQsNTEuMzY1IEw3Ny4xNTQsNy45ODUgTDEwLjMzMyw0Ni41NjQgTDEwLjMzMyw0Ni41NjQgWiIgaWQ9IkZpbGwtMjAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMjUuNzM3LDg4LjY0NyBMMTE4LjA5OCw5MS45ODEgTDExOC4wOTgsODQgTDEwNi42MzksODguNzEzIEwxMDYuNjM5LDk2Ljk4MiBMOTksMTAwLjMxNSBMMTEyLjM2OSwxMDMuOTYxIEwxMjUuNzM3LDg4LjY0NyIgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTIiIGZpbGw9IiM0NTVBNjQiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+';
function RotateInstructions() {
  this.loadIcon_();
  var overlay = document.createElement('div');
  var s = overlay.style;
  s.position = 'fixed';
  s.top = 0;
  s.right = 0;
  s.bottom = 0;
  s.left = 0;
  s.backgroundColor = 'gray';
  s.fontFamily = 'sans-serif';
  s.zIndex = 1000000;
  var img = document.createElement('img');
  img.src = this.icon;
  var s = img.style;
  s.marginLeft = '25%';
  s.marginTop = '25%';
  s.width = '50%';
  overlay.appendChild(img);
  var text = document.createElement('div');
  var s = text.style;
  s.textAlign = 'center';
  s.fontSize = '16px';
  s.lineHeight = '24px';
  s.margin = '24px 25%';
  s.width = '50%';
  text.innerHTML = 'Place your phone into your Cardboard viewer.';
  overlay.appendChild(text);
  var snackbar = document.createElement('div');
  var s = snackbar.style;
  s.backgroundColor = '#CFD8DC';
  s.position = 'fixed';
  s.bottom = 0;
  s.width = '100%';
  s.height = '48px';
  s.padding = '14px 24px';
  s.boxSizing = 'border-box';
  s.color = '#656A6B';
  overlay.appendChild(snackbar);
  var snackbarText = document.createElement('div');
  snackbarText.style.float = 'left';
  snackbarText.innerHTML = 'No Cardboard viewer?';
  var snackbarButton = document.createElement('a');
  snackbarButton.href = 'https://www.google.com/get/cardboard/get-cardboard/';
  snackbarButton.innerHTML = 'get one';
  snackbarButton.target = '_blank';
  var s = snackbarButton.style;
  s.float = 'right';
  s.fontWeight = 600;
  s.textTransform = 'uppercase';
  s.borderLeft = '1px solid gray';
  s.paddingLeft = '24px';
  s.textDecoration = 'none';
  s.color = '#656A6B';
  snackbar.appendChild(snackbarText);
  snackbar.appendChild(snackbarButton);
  this.overlay = overlay;
  this.text = text;
  this.hide();
}
RotateInstructions.prototype.show = function (parent) {
  if (!parent && !this.overlay.parentElement) {
    document.body.appendChild(this.overlay);
  } else if (parent) {
    if (this.overlay.parentElement && this.overlay.parentElement != parent) this.overlay.parentElement.removeChild(this.overlay);
    parent.appendChild(this.overlay);
  }
  this.overlay.style.display = 'block';
  var img = this.overlay.querySelector('img');
  var s = img.style;
  if (isLandscapeMode()) {
    s.width = '20%';
    s.marginLeft = '40%';
    s.marginTop = '3%';
  } else {
    s.width = '50%';
    s.marginLeft = '25%';
    s.marginTop = '25%';
  }
};
RotateInstructions.prototype.hide = function () {
  this.overlay.style.display = 'none';
};
RotateInstructions.prototype.showTemporarily = function (ms, parent) {
  this.show(parent);
  this.timer = setTimeout(this.hide.bind(this), ms);
};
RotateInstructions.prototype.disableShowTemporarily = function () {
  clearTimeout(this.timer);
};
RotateInstructions.prototype.update = function () {
  this.disableShowTemporarily();
  if (!isLandscapeMode() && isMobile()) {
    this.show();
  } else {
    this.hide();
  }
};
RotateInstructions.prototype.loadIcon_ = function () {
  this.icon = base64('image/svg+xml', rotateInstructionsAsset);
};
var DEFAULT_VIEWER = 'CardboardV1';
var VIEWER_KEY = 'WEBVR_CARDBOARD_VIEWER';
var CLASS_NAME = 'webvr-polyfill-viewer-selector';
function ViewerSelector(defaultViewer) {
  try {
    this.selectedKey = localStorage.getItem(VIEWER_KEY);
  } catch (error) {
    console.error('Failed to load viewer profile: %s', error);
  }
  if (!this.selectedKey) {
    this.selectedKey = defaultViewer || DEFAULT_VIEWER;
  }
  this.dialog = this.createDialog_(DeviceInfo.Viewers);
  this.root = null;
  this.onChangeCallbacks_ = [];
}
ViewerSelector.prototype.show = function (root) {
  this.root = root;
  root.appendChild(this.dialog);
  var selected = this.dialog.querySelector('#' + this.selectedKey);
  selected.checked = true;
  this.dialog.style.display = 'block';
};
ViewerSelector.prototype.hide = function () {
  if (this.root && this.root.contains(this.dialog)) {
    this.root.removeChild(this.dialog);
  }
  this.dialog.style.display = 'none';
};
ViewerSelector.prototype.getCurrentViewer = function () {
  return DeviceInfo.Viewers[this.selectedKey];
};
ViewerSelector.prototype.getSelectedKey_ = function () {
  var input = this.dialog.querySelector('input[name=field]:checked');
  if (input) {
    return input.id;
  }
  return null;
};
ViewerSelector.prototype.onChange = function (cb) {
  this.onChangeCallbacks_.push(cb);
};
ViewerSelector.prototype.fireOnChange_ = function (viewer) {
  for (var i = 0; i < this.onChangeCallbacks_.length; i++) {
    this.onChangeCallbacks_[i](viewer);
  }
};
ViewerSelector.prototype.onSave_ = function () {
  this.selectedKey = this.getSelectedKey_();
  if (!this.selectedKey || !DeviceInfo.Viewers[this.selectedKey]) {
    console.error('ViewerSelector.onSave_: this should never happen!');
    return;
  }
  this.fireOnChange_(DeviceInfo.Viewers[this.selectedKey]);
  try {
    localStorage.setItem(VIEWER_KEY, this.selectedKey);
  } catch (error) {
    console.error('Failed to save viewer profile: %s', error);
  }
  this.hide();
};
ViewerSelector.prototype.createDialog_ = function (options) {
  var container = document.createElement('div');
  container.classList.add(CLASS_NAME);
  container.style.display = 'none';
  var overlay = document.createElement('div');
  var s = overlay.style;
  s.position = 'fixed';
  s.left = 0;
  s.top = 0;
  s.width = '100%';
  s.height = '100%';
  s.background = 'rgba(0, 0, 0, 0.3)';
  overlay.addEventListener('click', this.hide.bind(this));
  var width = 280;
  var dialog = document.createElement('div');
  var s = dialog.style;
  s.boxSizing = 'border-box';
  s.position = 'fixed';
  s.top = '24px';
  s.left = '50%';
  s.marginLeft = -width / 2 + 'px';
  s.width = width + 'px';
  s.padding = '24px';
  s.overflow = 'hidden';
  s.background = '#fafafa';
  s.fontFamily = "'Roboto', sans-serif";
  s.boxShadow = '0px 5px 20px #666';
  dialog.appendChild(this.createH1_('Select your viewer'));
  for (var id in options) {
    dialog.appendChild(this.createChoice_(id, options[id].label));
  }
  dialog.appendChild(this.createButton_('Save', this.onSave_.bind(this)));
  container.appendChild(overlay);
  container.appendChild(dialog);
  return container;
};
ViewerSelector.prototype.createH1_ = function (name) {
  var h1 = document.createElement('h1');
  var s = h1.style;
  s.color = 'black';
  s.fontSize = '20px';
  s.fontWeight = 'bold';
  s.marginTop = 0;
  s.marginBottom = '24px';
  h1.innerHTML = name;
  return h1;
};
ViewerSelector.prototype.createChoice_ = function (id, name) {
  var div = document.createElement('div');
  div.style.marginTop = '8px';
  div.style.color = 'black';
  var input = document.createElement('input');
  input.style.fontSize = '30px';
  input.setAttribute('id', id);
  input.setAttribute('type', 'radio');
  input.setAttribute('value', id);
  input.setAttribute('name', 'field');
  var label = document.createElement('label');
  label.style.marginLeft = '4px';
  label.setAttribute('for', id);
  label.innerHTML = name;
  div.appendChild(input);
  div.appendChild(label);
  return div;
};
ViewerSelector.prototype.createButton_ = function (label, onclick) {
  var button = document.createElement('button');
  button.innerHTML = label;
  var s = button.style;
  s.float = 'right';
  s.textTransform = 'uppercase';
  s.color = '#1094f7';
  s.fontSize = '14px';
  s.letterSpacing = 0;
  s.border = 0;
  s.background = 'none';
  s.marginTop = '16px';
  button.addEventListener('click', onclick);
  return button;
};
var commonjsGlobal$$1 = typeof window !== 'undefined' ? window : typeof commonjsGlobal !== 'undefined' ? commonjsGlobal : typeof self !== 'undefined' ? self : {};
function unwrapExports$$1 (x) {
  return x && x.__esModule ? x['default'] : x;
}
function createCommonjsModule$$1(fn, module) {
  return module = { exports: {} }, fn(module, module.exports), module.exports;
}
var NoSleep = createCommonjsModule$$1(function (module, exports) {
(function webpackUniversalModuleDefinition(root, factory) {
  module.exports = factory();
})(commonjsGlobal$$1, function() {
return          (function(modules) {
          var installedModules = {};
          function __webpack_require__(moduleId) {
            if(installedModules[moduleId]) {
              return installedModules[moduleId].exports;
            }
            var module = installedModules[moduleId] = {
              i: moduleId,
              l: false,
              exports: {}
            };
            modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
            module.l = true;
            return module.exports;
          }
          __webpack_require__.m = modules;
          __webpack_require__.c = installedModules;
          __webpack_require__.d = function(exports, name, getter) {
            if(!__webpack_require__.o(exports, name)) {
              Object.defineProperty(exports, name, {
                configurable: false,
                enumerable: true,
                get: getter
              });
            }
          };
          __webpack_require__.n = function(module) {
            var getter = module && module.__esModule ?
              function getDefault() { return module['default']; } :
              function getModuleExports() { return module; };
            __webpack_require__.d(getter, 'a', getter);
            return getter;
          };
          __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
          __webpack_require__.p = "";
          return __webpack_require__(__webpack_require__.s = 0);
         })
         ([
      (function(module, exports, __webpack_require__) {
var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
var mediaFile = __webpack_require__(1);
var oldIOS = typeof navigator !== 'undefined' && parseFloat(('' + (/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0, ''])[1]).replace('undefined', '3_2').replace('_', '.').replace('_', '')) < 10 && !window.MSStream;
var NoSleep = function () {
  function NoSleep() {
    _classCallCheck(this, NoSleep);
    if (oldIOS) {
      this.noSleepTimer = null;
    } else {
      this.noSleepVideo = document.createElement('video');
      this.noSleepVideo.setAttribute('playsinline', '');
      this.noSleepVideo.setAttribute('src', mediaFile);
      this.noSleepVideo.addEventListener('timeupdate', function (e) {
        if (this.noSleepVideo.currentTime > 0.5) {
          this.noSleepVideo.currentTime = Math.random();
        }
      }.bind(this));
    }
  }
  _createClass(NoSleep, [{
    key: 'enable',
    value: function enable() {
      if (oldIOS) {
        this.disable();
        this.noSleepTimer = window.setInterval(function () {
          window.location.href = '/';
          window.setTimeout(window.stop, 0);
        }, 15000);
      } else {
        this.noSleepVideo.play();
      }
    }
  }, {
    key: 'disable',
    value: function disable() {
      if (oldIOS) {
        if (this.noSleepTimer) {
          window.clearInterval(this.noSleepTimer);
          this.noSleepTimer = null;
        }
      } else {
        this.noSleepVideo.pause();
      }
    }
  }]);
  return NoSleep;
}();
module.exports = NoSleep;
      }),
      (function(module, exports, __webpack_require__) {
module.exports = 'data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA=';
      })
         ]);
});
});
var NoSleep$1 = unwrapExports$$1(NoSleep);
var nextDisplayId = 1000;
var defaultLeftBounds = [0, 0, 0.5, 1];
var defaultRightBounds = [0.5, 0, 0.5, 1];
var raf = window.requestAnimationFrame;
var caf = window.cancelAnimationFrame;
function VRFrameData() {
  this.leftProjectionMatrix = new Float32Array(16);
  this.leftViewMatrix = new Float32Array(16);
  this.rightProjectionMatrix = new Float32Array(16);
  this.rightViewMatrix = new Float32Array(16);
  this.pose = null;
}
function VRDisplayCapabilities(config) {
  Object.defineProperties(this, {
    hasPosition: {
      writable: false, enumerable: true, value: config.hasPosition
    },
    hasExternalDisplay: {
      writable: false, enumerable: true, value: config.hasExternalDisplay
    },
    canPresent: {
      writable: false, enumerable: true, value: config.canPresent
    },
    maxLayers: {
      writable: false, enumerable: true, value: config.maxLayers
    },
    hasOrientation: {
      enumerable: true, get: function get() {
        deprecateWarning('VRDisplayCapabilities.prototype.hasOrientation', 'VRDisplay.prototype.getFrameData');
        return config.hasOrientation;
      }
    }
  });
}
function VRDisplay(config) {
  config = config || {};
  var USE_WAKELOCK = 'wakelock' in config ? config.wakelock : true;
  this.isPolyfilled = true;
  this.displayId = nextDisplayId++;
  this.displayName = '';
  this.depthNear = 0.01;
  this.depthFar = 10000.0;
  this.isPresenting = false;
  Object.defineProperty(this, 'isConnected', {
    get: function get() {
      deprecateWarning('VRDisplay.prototype.isConnected', 'VRDisplayCapabilities.prototype.hasExternalDisplay');
      return false;
    }
  });
  this.capabilities = new VRDisplayCapabilities({
    hasPosition: false,
    hasOrientation: false,
    hasExternalDisplay: false,
    canPresent: false,
    maxLayers: 1
  });
  this.stageParameters = null;
  this.waitingForPresent_ = false;
  this.layer_ = null;
  this.originalParent_ = null;
  this.fullscreenElement_ = null;
  this.fullscreenWrapper_ = null;
  this.fullscreenElementCachedStyle_ = null;
  this.fullscreenEventTarget_ = null;
  this.fullscreenChangeHandler_ = null;
  this.fullscreenErrorHandler_ = null;
  if (USE_WAKELOCK && isMobile()) {
    this.wakelock_ = new NoSleep$1();
  }
}
VRDisplay.prototype.getFrameData = function (frameData) {
  return frameDataFromPose(frameData, this._getPose(), this);
};
VRDisplay.prototype.getPose = function () {
  deprecateWarning('VRDisplay.prototype.getPose', 'VRDisplay.prototype.getFrameData');
  return this._getPose();
};
VRDisplay.prototype.resetPose = function () {
  deprecateWarning('VRDisplay.prototype.resetPose');
  return this._resetPose();
};
VRDisplay.prototype.getImmediatePose = function () {
  deprecateWarning('VRDisplay.prototype.getImmediatePose', 'VRDisplay.prototype.getFrameData');
  return this._getPose();
};
VRDisplay.prototype.requestAnimationFrame = function (callback) {
  return raf(callback);
};
VRDisplay.prototype.cancelAnimationFrame = function (id) {
  return caf(id);
};
VRDisplay.prototype.wrapForFullscreen = function (element) {
  if (isIOS()) {
    return element;
  }
  if (!this.fullscreenWrapper_) {
    this.fullscreenWrapper_ = document.createElement('div');
    var cssProperties = ['height: ' + Math.min(screen.height, screen.width) + 'px !important', 'top: 0 !important', 'left: 0 !important', 'right: 0 !important', 'border: 0', 'margin: 0', 'padding: 0', 'z-index: 999999 !important', 'position: fixed'];
    this.fullscreenWrapper_.setAttribute('style', cssProperties.join('; ') + ';');
    this.fullscreenWrapper_.classList.add('webvr-polyfill-fullscreen-wrapper');
  }
  if (this.fullscreenElement_ == element) {
    return this.fullscreenWrapper_;
  }
  if (this.fullscreenElement_) {
    if (this.originalParent_) {
      this.originalParent_.appendChild(this.fullscreenElement_);
    } else {
      this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_);
    }
  }
  this.fullscreenElement_ = element;
  this.originalParent_ = element.parentElement;
  if (!this.originalParent_) {
    document.body.appendChild(element);
  }
  if (!this.fullscreenWrapper_.parentElement) {
    var parent = this.fullscreenElement_.parentElement;
    parent.insertBefore(this.fullscreenWrapper_, this.fullscreenElement_);
    parent.removeChild(this.fullscreenElement_);
  }
  this.fullscreenWrapper_.insertBefore(this.fullscreenElement_, this.fullscreenWrapper_.firstChild);
  this.fullscreenElementCachedStyle_ = this.fullscreenElement_.getAttribute('style');
  var self = this;
  function applyFullscreenElementStyle() {
    if (!self.fullscreenElement_) {
      return;
    }
    var cssProperties = ['position: absolute', 'top: 0', 'left: 0', 'width: ' + Math.max(screen.width, screen.height) + 'px', 'height: ' + Math.min(screen.height, screen.width) + 'px', 'border: 0', 'margin: 0', 'padding: 0'];
    self.fullscreenElement_.setAttribute('style', cssProperties.join('; ') + ';');
  }
  applyFullscreenElementStyle();
  return this.fullscreenWrapper_;
};
VRDisplay.prototype.removeFullscreenWrapper = function () {
  if (!this.fullscreenElement_) {
    return;
  }
  var element = this.fullscreenElement_;
  if (this.fullscreenElementCachedStyle_) {
    element.setAttribute('style', this.fullscreenElementCachedStyle_);
  } else {
    element.removeAttribute('style');
  }
  this.fullscreenElement_ = null;
  this.fullscreenElementCachedStyle_ = null;
  var parent = this.fullscreenWrapper_.parentElement;
  this.fullscreenWrapper_.removeChild(element);
  if (this.originalParent_ === parent) {
    parent.insertBefore(element, this.fullscreenWrapper_);
  }
  else if (this.originalParent_) {
      this.originalParent_.appendChild(element);
    }
  parent.removeChild(this.fullscreenWrapper_);
  return element;
};
VRDisplay.prototype.requestPresent = function (layers) {
  var wasPresenting = this.isPresenting;
  var self = this;
  if (!(layers instanceof Array)) {
    deprecateWarning('VRDisplay.prototype.requestPresent with non-array argument', 'an array of VRLayers as the first argument');
    layers = [layers];
  }
  return new Promise(function (resolve, reject) {
    if (!self.capabilities.canPresent) {
      reject(new Error('VRDisplay is not capable of presenting.'));
      return;
    }
    if (layers.length == 0 || layers.length > self.capabilities.maxLayers) {
      reject(new Error('Invalid number of layers.'));
      return;
    }
    var incomingLayer = layers[0];
    if (!incomingLayer.source) {
      resolve();
      return;
    }
    var leftBounds = incomingLayer.leftBounds || defaultLeftBounds;
    var rightBounds = incomingLayer.rightBounds || defaultRightBounds;
    if (wasPresenting) {
      var layer = self.layer_;
      if (layer.source !== incomingLayer.source) {
        layer.source = incomingLayer.source;
      }
      for (var i = 0; i < 4; i++) {
        layer.leftBounds[i] = leftBounds[i];
        layer.rightBounds[i] = rightBounds[i];
      }
      self.wrapForFullscreen(self.layer_.source);
      self.updatePresent_();
      resolve();
      return;
    }
    self.layer_ = {
      predistorted: incomingLayer.predistorted,
      source: incomingLayer.source,
      leftBounds: leftBounds.slice(0),
      rightBounds: rightBounds.slice(0)
    };
    self.waitingForPresent_ = false;
    if (self.layer_ && self.layer_.source) {
      var fullscreenElement = self.wrapForFullscreen(self.layer_.source);
      var onFullscreenChange = function onFullscreenChange() {
        var actualFullscreenElement = getFullscreenElement();
        self.isPresenting = fullscreenElement === actualFullscreenElement;
        if (self.isPresenting) {
          if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('landscape-primary').catch(function (error) {
              console.error('screen.orientation.lock() failed due to', error.message);
            });
          }
          self.waitingForPresent_ = false;
          self.beginPresent_();
          resolve();
        } else {
          if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
          }
          self.removeFullscreenWrapper();
          self.disableWakeLock();
          self.endPresent_();
          self.removeFullscreenListeners_();
        }
        self.fireVRDisplayPresentChange_();
      };
      var onFullscreenError = function onFullscreenError() {
        if (!self.waitingForPresent_) {
          return;
        }
        self.removeFullscreenWrapper();
        self.removeFullscreenListeners_();
        self.disableWakeLock();
        self.waitingForPresent_ = false;
        self.isPresenting = false;
        reject(new Error('Unable to present.'));
      };
      self.addFullscreenListeners_(fullscreenElement, onFullscreenChange, onFullscreenError);
      if (requestFullscreen(fullscreenElement)) {
        self.enableWakeLock();
        self.waitingForPresent_ = true;
      } else if (isIOS() || isWebViewAndroid()) {
        self.enableWakeLock();
        self.isPresenting = true;
        self.beginPresent_();
        self.fireVRDisplayPresentChange_();
        resolve();
      }
    }
    if (!self.waitingForPresent_ && !isIOS()) {
      exitFullscreen();
      reject(new Error('Unable to present.'));
    }
  });
};
VRDisplay.prototype.exitPresent = function () {
  var wasPresenting = this.isPresenting;
  var self = this;
  this.isPresenting = false;
  this.layer_ = null;
  this.disableWakeLock();
  return new Promise(function (resolve, reject) {
    if (wasPresenting) {
      if (!exitFullscreen() && isIOS()) {
        self.endPresent_();
        self.fireVRDisplayPresentChange_();
      }
      if (isWebViewAndroid()) {
        self.removeFullscreenWrapper();
        self.removeFullscreenListeners_();
        self.endPresent_();
        self.fireVRDisplayPresentChange_();
      }
      resolve();
    } else {
      reject(new Error('Was not presenting to VRDisplay.'));
    }
  });
};
VRDisplay.prototype.getLayers = function () {
  if (this.layer_) {
    return [this.layer_];
  }
  return [];
};
VRDisplay.prototype.fireVRDisplayPresentChange_ = function () {
  var event = new CustomEvent('vrdisplaypresentchange', { detail: { display: this } });
  window.dispatchEvent(event);
};
VRDisplay.prototype.fireVRDisplayConnect_ = function () {
  var event = new CustomEvent('vrdisplayconnect', { detail: { display: this } });
  window.dispatchEvent(event);
};
VRDisplay.prototype.addFullscreenListeners_ = function (element, changeHandler, errorHandler) {
  this.removeFullscreenListeners_();
  this.fullscreenEventTarget_ = element;
  this.fullscreenChangeHandler_ = changeHandler;
  this.fullscreenErrorHandler_ = errorHandler;
  if (changeHandler) {
    if (document.fullscreenEnabled) {
      element.addEventListener('fullscreenchange', changeHandler, false);
    } else if (document.webkitFullscreenEnabled) {
      element.addEventListener('webkitfullscreenchange', changeHandler, false);
    } else if (document.mozFullScreenEnabled) {
      document.addEventListener('mozfullscreenchange', changeHandler, false);
    } else if (document.msFullscreenEnabled) {
      element.addEventListener('msfullscreenchange', changeHandler, false);
    }
  }
  if (errorHandler) {
    if (document.fullscreenEnabled) {
      element.addEventListener('fullscreenerror', errorHandler, false);
    } else if (document.webkitFullscreenEnabled) {
      element.addEventListener('webkitfullscreenerror', errorHandler, false);
    } else if (document.mozFullScreenEnabled) {
      document.addEventListener('mozfullscreenerror', errorHandler, false);
    } else if (document.msFullscreenEnabled) {
      element.addEventListener('msfullscreenerror', errorHandler, false);
    }
  }
};
VRDisplay.prototype.removeFullscreenListeners_ = function () {
  if (!this.fullscreenEventTarget_) return;
  var element = this.fullscreenEventTarget_;
  if (this.fullscreenChangeHandler_) {
    var changeHandler = this.fullscreenChangeHandler_;
    element.removeEventListener('fullscreenchange', changeHandler, false);
    element.removeEventListener('webkitfullscreenchange', changeHandler, false);
    document.removeEventListener('mozfullscreenchange', changeHandler, false);
    element.removeEventListener('msfullscreenchange', changeHandler, false);
  }
  if (this.fullscreenErrorHandler_) {
    var errorHandler = this.fullscreenErrorHandler_;
    element.removeEventListener('fullscreenerror', errorHandler, false);
    element.removeEventListener('webkitfullscreenerror', errorHandler, false);
    document.removeEventListener('mozfullscreenerror', errorHandler, false);
    element.removeEventListener('msfullscreenerror', errorHandler, false);
  }
  this.fullscreenEventTarget_ = null;
  this.fullscreenChangeHandler_ = null;
  this.fullscreenErrorHandler_ = null;
};
VRDisplay.prototype.enableWakeLock = function () {
  if (this.wakelock_) {
    this.wakelock_.enable();
  }
};
VRDisplay.prototype.disableWakeLock = function () {
  if (this.wakelock_) {
    this.wakelock_.disable();
  }
};
VRDisplay.prototype.beginPresent_ = function () {
};
VRDisplay.prototype.endPresent_ = function () {
};
VRDisplay.prototype.submitFrame = function (pose) {
};
VRDisplay.prototype.getEyeParameters = function (whichEye) {
  return null;
};
var config = {
  ADDITIONAL_VIEWERS: [],
  DEFAULT_VIEWER: '',
  MOBILE_WAKE_LOCK: true,
  DEBUG: false,
  DPDB_URL: 'https://dpdb.webvr.rocks/dpdb.json',
  K_FILTER: 0.98,
  PREDICTION_TIME_S: 0.040,
  CARDBOARD_UI_DISABLED: false,
  ROTATE_INSTRUCTIONS_DISABLED: false,
  YAW_ONLY: false,
  BUFFER_SCALE: 0.5,
  DIRTY_SUBMIT_FRAME_BINDINGS: false
};
var Eye = {
  LEFT: 'left',
  RIGHT: 'right'
};
function CardboardVRDisplay(config$$1) {
  var defaults = extend({}, config);
  config$$1 = extend(defaults, config$$1 || {});
  VRDisplay.call(this, {
    wakelock: config$$1.MOBILE_WAKE_LOCK
  });
  this.config = config$$1;
  this.displayName = 'Cardboard VRDisplay';
  this.capabilities = new VRDisplayCapabilities({
    hasPosition: false,
    hasOrientation: true,
    hasExternalDisplay: false,
    canPresent: true,
    maxLayers: 1
  });
  this.stageParameters = null;
  this.bufferScale_ = this.config.BUFFER_SCALE;
  this.poseSensor_ = new PoseSensor(this.config);
  this.distorter_ = null;
  this.cardboardUI_ = null;
  this.dpdb_ = new Dpdb(this.config.DPDB_URL, this.onDeviceParamsUpdated_.bind(this));
  this.deviceInfo_ = new DeviceInfo(this.dpdb_.getDeviceParams(), config$$1.ADDITIONAL_VIEWERS);
  this.viewerSelector_ = new ViewerSelector(config$$1.DEFAULT_VIEWER);
  this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));
  this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());
  if (!this.config.ROTATE_INSTRUCTIONS_DISABLED) {
    this.rotateInstructions_ = new RotateInstructions();
  }
  if (isIOS()) {
    window.addEventListener('resize', this.onResize_.bind(this));
  }
}
CardboardVRDisplay.prototype = Object.create(VRDisplay.prototype);
CardboardVRDisplay.prototype._getPose = function () {
  return {
    position: null,
    orientation: this.poseSensor_.getOrientation(),
    linearVelocity: null,
    linearAcceleration: null,
    angularVelocity: null,
    angularAcceleration: null
  };
};
CardboardVRDisplay.prototype._resetPose = function () {
  if (this.poseSensor_.resetPose) {
    this.poseSensor_.resetPose();
  }
};
CardboardVRDisplay.prototype._getFieldOfView = function (whichEye) {
  var fieldOfView;
  if (whichEye == Eye.LEFT) {
    fieldOfView = this.deviceInfo_.getFieldOfViewLeftEye();
  } else if (whichEye == Eye.RIGHT) {
    fieldOfView = this.deviceInfo_.getFieldOfViewRightEye();
  } else {
    console.error('Invalid eye provided: %s', whichEye);
    return null;
  }
  return fieldOfView;
};
CardboardVRDisplay.prototype._getEyeOffset = function (whichEye) {
  var offset;
  if (whichEye == Eye.LEFT) {
    offset = [-this.deviceInfo_.viewer.interLensDistance * 0.5, 0.0, 0.0];
  } else if (whichEye == Eye.RIGHT) {
    offset = [this.deviceInfo_.viewer.interLensDistance * 0.5, 0.0, 0.0];
  } else {
    console.error('Invalid eye provided: %s', whichEye);
    return null;
  }
  return offset;
};
CardboardVRDisplay.prototype.getEyeParameters = function (whichEye) {
  var offset = this._getEyeOffset(whichEye);
  var fieldOfView = this._getFieldOfView(whichEye);
  var eyeParams = {
    offset: offset,
    renderWidth: this.deviceInfo_.device.width * 0.5 * this.bufferScale_,
    renderHeight: this.deviceInfo_.device.height * this.bufferScale_
  };
  Object.defineProperty(eyeParams, 'fieldOfView', {
    enumerable: true,
    get: function get() {
      deprecateWarning('VRFieldOfView', 'VRFrameData\'s projection matrices');
      return fieldOfView;
    }
  });
  return eyeParams;
};
CardboardVRDisplay.prototype.onDeviceParamsUpdated_ = function (newParams) {
  if (this.config.DEBUG) {
    console.log('DPDB reported that device params were updated.');
  }
  this.deviceInfo_.updateDeviceParams(newParams);
  if (this.distorter_) {
    this.distorter_.updateDeviceInfo(this.deviceInfo_);
  }
};
CardboardVRDisplay.prototype.updateBounds_ = function () {
  if (this.layer_ && this.distorter_ && (this.layer_.leftBounds || this.layer_.rightBounds)) {
    this.distorter_.setTextureBounds(this.layer_.leftBounds, this.layer_.rightBounds);
  }
};
CardboardVRDisplay.prototype.beginPresent_ = function () {
  var gl = this.layer_.source.getContext('webgl');
  if (!gl) gl = this.layer_.source.getContext('experimental-webgl');
  if (!gl) gl = this.layer_.source.getContext('webgl2');
  if (!gl) return;
  if (this.layer_.predistorted) {
    if (!this.config.CARDBOARD_UI_DISABLED) {
      gl.canvas.width = getScreenWidth() * this.bufferScale_;
      gl.canvas.height = getScreenHeight() * this.bufferScale_;
      this.cardboardUI_ = new CardboardUI(gl);
    }
  } else {
    if (!this.config.CARDBOARD_UI_DISABLED) {
      this.cardboardUI_ = new CardboardUI(gl);
    }
    this.distorter_ = new CardboardDistorter(gl, this.cardboardUI_, this.config.BUFFER_SCALE, this.config.DIRTY_SUBMIT_FRAME_BINDINGS);
    this.distorter_.updateDeviceInfo(this.deviceInfo_);
  }
  if (this.cardboardUI_) {
    this.cardboardUI_.listen(function (e) {
      this.viewerSelector_.show(this.layer_.source.parentElement);
      e.stopPropagation();
      e.preventDefault();
    }.bind(this), function (e) {
      this.exitPresent();
      e.stopPropagation();
      e.preventDefault();
    }.bind(this));
  }
  if (this.rotateInstructions_) {
    if (isLandscapeMode() && isMobile()) {
      this.rotateInstructions_.showTemporarily(3000, this.layer_.source.parentElement);
    } else {
      this.rotateInstructions_.update();
    }
  }
  this.orientationHandler = this.onOrientationChange_.bind(this);
  window.addEventListener('orientationchange', this.orientationHandler);
  this.vrdisplaypresentchangeHandler = this.updateBounds_.bind(this);
  window.addEventListener('vrdisplaypresentchange', this.vrdisplaypresentchangeHandler);
  this.fireVRDisplayDeviceParamsChange_();
};
CardboardVRDisplay.prototype.endPresent_ = function () {
  if (this.distorter_) {
    this.distorter_.destroy();
    this.distorter_ = null;
  }
  if (this.cardboardUI_) {
    this.cardboardUI_.destroy();
    this.cardboardUI_ = null;
  }
  if (this.rotateInstructions_) {
    this.rotateInstructions_.hide();
  }
  this.viewerSelector_.hide();
  window.removeEventListener('orientationchange', this.orientationHandler);
  window.removeEventListener('vrdisplaypresentchange', this.vrdisplaypresentchangeHandler);
};
CardboardVRDisplay.prototype.updatePresent_ = function () {
  this.endPresent_();
  this.beginPresent_();
};
CardboardVRDisplay.prototype.submitFrame = function (pose) {
  if (this.distorter_) {
    this.updateBounds_();
    this.distorter_.submitFrame();
  } else if (this.cardboardUI_ && this.layer_) {
    var canvas = this.layer_.source.getContext('webgl').canvas;
    if (canvas.width != this.lastWidth || canvas.height != this.lastHeight) {
      this.cardboardUI_.onResize();
    }
    this.lastWidth = canvas.width;
    this.lastHeight = canvas.height;
    this.cardboardUI_.render();
  }
};
CardboardVRDisplay.prototype.onOrientationChange_ = function (e) {
  this.viewerSelector_.hide();
  if (this.rotateInstructions_) {
    this.rotateInstructions_.update();
  }
  this.onResize_();
};
CardboardVRDisplay.prototype.onResize_ = function (e) {
  if (this.layer_) {
    var gl = this.layer_.source.getContext('webgl');
    var cssProperties = ['position: absolute', 'top: 0', 'left: 0',
    'width: 100vw', 'height: 100vh', 'border: 0', 'margin: 0',
    'padding: 0px', 'box-sizing: content-box'];
    gl.canvas.setAttribute('style', cssProperties.join('; ') + ';');
    safariCssSizeWorkaround(gl.canvas);
  }
};
CardboardVRDisplay.prototype.onViewerChanged_ = function (viewer) {
  this.deviceInfo_.setViewer(viewer);
  if (this.distorter_) {
    this.distorter_.updateDeviceInfo(this.deviceInfo_);
  }
  this.fireVRDisplayDeviceParamsChange_();
};
CardboardVRDisplay.prototype.fireVRDisplayDeviceParamsChange_ = function () {
  var event = new CustomEvent('vrdisplaydeviceparamschange', {
    detail: {
      vrdisplay: this,
      deviceInfo: this.deviceInfo_
    }
  });
  window.dispatchEvent(event);
};
CardboardVRDisplay.VRFrameData = VRFrameData;
CardboardVRDisplay.VRDisplay = VRDisplay;
return CardboardVRDisplay;
})));
});
var CardboardVRDisplay = unwrapExports(cardboardVrDisplay);

var PolyfilledXRDevice = function (_EventTarget) {
  inherits(PolyfilledXRDevice, _EventTarget);
  function PolyfilledXRDevice(global) {
    classCallCheck(this, PolyfilledXRDevice);
    var _this = possibleConstructorReturn(this, (PolyfilledXRDevice.__proto__ || Object.getPrototypeOf(PolyfilledXRDevice)).call(this));
    _this.global = global;
    _this.onWindowResize = _this.onWindowResize.bind(_this);
    _this.global.window.addEventListener('resize', _this.onWindowResize);
    _this.environmentBlendMode = 'opaque';
    return _this;
  }
  createClass(PolyfilledXRDevice, [{
    key: 'onBaseLayerSet',
    value: function onBaseLayerSet(sessionId, layer) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'supportsSession',
    value: function supportsSession() {
      throw new Error('Not implemented');
    }
  }, {
    key: 'requestSession',
    value: function requestSession() {
      return new Promise(function ($return, $error) {
        return $error(new Error('Not implemented'));
      }.bind(this));
    }
  }, {
    key: 'requestAnimationFrame',
    value: function requestAnimationFrame(callback) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'onFrameStart',
    value: function onFrameStart(sessionId) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'onFrameEnd',
    value: function onFrameEnd(sessionId) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'requestStageBounds',
    value: function requestStageBounds() {
      throw new Error('Not implemented');
    }
  }, {
    key: 'requestFrameOfReferenceTransform',
    value: function requestFrameOfReferenceTransform(type, options) {
      return new Promise(function ($return, $error) {
        return $return(undefined);
      }.bind(this));
    }
  }, {
    key: 'cancelAnimationFrame',
    value: function cancelAnimationFrame(handle) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'endSession',
    value: function endSession(sessionId) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getViewport',
    value: function getViewport(sessionId, eye, layer, target) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getProjectionMatrix',
    value: function getProjectionMatrix(eye) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getBasePoseMatrix',
    value: function getBasePoseMatrix() {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getBaseViewMatrix',
    value: function getBaseViewMatrix(eye) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getInputSources',
    value: function getInputSources() {
      throw new Error('Not implemented');
    }
  }, {
    key: 'getInputPose',
    value: function getInputPose(inputSource, coordinateSystem) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'onWindowResize',
    value: function onWindowResize() {
      this.onWindowResize();
    }
  }, {
    key: 'depthNear',
    get: function get$$1() {
      throw new Error('Not implemented');
    }
    ,
    set: function set$$1(val) {
      throw new Error('Not implemented');
    }
  }, {
    key: 'depthFar',
    get: function get$$1() {
      throw new Error('Not implemented');
    }
    ,
    set: function set$$1(val) {
      throw new Error('Not implemented');
    }
  }]);
  return PolyfilledXRDevice;
}(EventTarget);

function create$2() {
  var out = new ARRAY_TYPE(9);
  out[0] = 1;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  out[4] = 1;
  out[5] = 0;
  out[6] = 0;
  out[7] = 0;
  out[8] = 1;
  return out;
}

function create$3() {
  var out = new ARRAY_TYPE(4);
  out[0] = 0;
  out[1] = 0;
  out[2] = 0;
  out[3] = 0;
  return out;
}
function clone$3(a) {
  var out = new ARRAY_TYPE(4);
  out[0] = a[0];
  out[1] = a[1];
  out[2] = a[2];
  out[3] = a[3];
  return out;
}

function copy$3(out, a) {
  out[0] = a[0];
  out[1] = a[1];
  out[2] = a[2];
  out[3] = a[3];
  return out;
}


















function normalize$1(out, a) {
  var x = a[0];
  var y = a[1];
  var z = a[2];
  var w = a[3];
  var len = x * x + y * y + z * z + w * w;
  if (len > 0) {
    len = 1 / Math.sqrt(len);
    out[0] = x * len;
    out[1] = y * len;
    out[2] = z * len;
    out[3] = w * len;
  }
  return out;
}















var forEach$1 = function () {
  var vec = create$3();
  return function (a, stride, offset, count, fn, arg) {
    var i = void 0,
        l = void 0;
    if (!stride) {
      stride = 4;
    }
    if (!offset) {
      offset = 0;
    }
    if (count) {
      l = Math.min(count * stride + offset, a.length);
    } else {
      l = a.length;
    }
    for (i = offset; i < l; i += stride) {
      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];vec[3] = a[i + 3];
      fn(vec, vec, arg);
      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];a[i + 3] = vec[3];
    }
    return a;
  };
}();

function create$4() {
  var out = new ARRAY_TYPE(4);
  out[0] = 0;
  out[1] = 0;
  out[2] = 0;
  out[3] = 1;
  return out;
}

function setAxisAngle(out, axis, rad) {
  rad = rad * 0.5;
  var s = Math.sin(rad);
  out[0] = s * axis[0];
  out[1] = s * axis[1];
  out[2] = s * axis[2];
  out[3] = Math.cos(rad);
  return out;
}

function multiply$4(out, a, b) {
  var ax = a[0],
      ay = a[1],
      az = a[2],
      aw = a[3];
  var bx = b[0],
      by = b[1],
      bz = b[2],
      bw = b[3];
  out[0] = ax * bw + aw * bx + ay * bz - az * by;
  out[1] = ay * bw + aw * by + az * bx - ax * bz;
  out[2] = az * bw + aw * bz + ax * by - ay * bx;
  out[3] = aw * bw - ax * bx - ay * by - az * bz;
  return out;
}




function slerp(out, a, b, t) {
  var ax = a[0],
      ay = a[1],
      az = a[2],
      aw = a[3];
  var bx = b[0],
      by = b[1],
      bz = b[2],
      bw = b[3];
  var omega = void 0,
      cosom = void 0,
      sinom = void 0,
      scale0 = void 0,
      scale1 = void 0;
  cosom = ax * bx + ay * by + az * bz + aw * bw;
  if (cosom < 0.0) {
    cosom = -cosom;
    bx = -bx;
    by = -by;
    bz = -bz;
    bw = -bw;
  }
  if (1.0 - cosom > 0.000001) {
    omega = Math.acos(cosom);
    sinom = Math.sin(omega);
    scale0 = Math.sin((1.0 - t) * omega) / sinom;
    scale1 = Math.sin(t * omega) / sinom;
  } else {
    scale0 = 1.0 - t;
    scale1 = t;
  }
  out[0] = scale0 * ax + scale1 * bx;
  out[1] = scale0 * ay + scale1 * by;
  out[2] = scale0 * az + scale1 * bz;
  out[3] = scale0 * aw + scale1 * bw;
  return out;
}
function invert$2(out, a) {
  var a0 = a[0],
      a1 = a[1],
      a2 = a[2],
      a3 = a[3];
  var dot$$1 = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;
  var invDot = dot$$1 ? 1.0 / dot$$1 : 0;
  out[0] = -a0 * invDot;
  out[1] = -a1 * invDot;
  out[2] = -a2 * invDot;
  out[3] = a3 * invDot;
  return out;
}

function fromMat3(out, m) {
  var fTrace = m[0] + m[4] + m[8];
  var fRoot = void 0;
  if (fTrace > 0.0) {
    fRoot = Math.sqrt(fTrace + 1.0);
    out[3] = 0.5 * fRoot;
    fRoot = 0.5 / fRoot;
    out[0] = (m[5] - m[7]) * fRoot;
    out[1] = (m[6] - m[2]) * fRoot;
    out[2] = (m[1] - m[3]) * fRoot;
  } else {
    var i = 0;
    if (m[4] > m[0]) i = 1;
    if (m[8] > m[i * 3 + i]) i = 2;
    var j = (i + 1) % 3;
    var k = (i + 2) % 3;
    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);
    out[i] = 0.5 * fRoot;
    fRoot = 0.5 / fRoot;
    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;
    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;
    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;
  }
  return out;
}
function fromEuler(out, x, y, z) {
  var halfToRad = 0.5 * Math.PI / 180.0;
  x *= halfToRad;
  y *= halfToRad;
  z *= halfToRad;
  var sx = Math.sin(x);
  var cx = Math.cos(x);
  var sy = Math.sin(y);
  var cy = Math.cos(y);
  var sz = Math.sin(z);
  var cz = Math.cos(z);
  out[0] = sx * cy * cz - cx * sy * sz;
  out[1] = cx * sy * cz + sx * cy * sz;
  out[2] = cx * cy * sz - sx * sy * cz;
  out[3] = cx * cy * cz + sx * sy * sz;
  return out;
}

var clone$4 = clone$3;

var copy$4 = copy$3;










var normalize$2 = normalize$1;


var rotationTo = function () {
  var tmpvec3 = create$1();
  var xUnitVec3 = fromValues$1(1, 0, 0);
  var yUnitVec3 = fromValues$1(0, 1, 0);
  return function (out, a, b) {
    var dot$$1 = dot(a, b);
    if (dot$$1 < -0.999999) {
      cross(tmpvec3, xUnitVec3, a);
      if (len(tmpvec3) < 0.000001) cross(tmpvec3, yUnitVec3, a);
      normalize(tmpvec3, tmpvec3);
      setAxisAngle(out, tmpvec3, Math.PI);
      return out;
    } else if (dot$$1 > 0.999999) {
      out[0] = 0;
      out[1] = 0;
      out[2] = 0;
      out[3] = 1;
      return out;
    } else {
      cross(tmpvec3, a, b);
      out[0] = tmpvec3[0];
      out[1] = tmpvec3[1];
      out[2] = tmpvec3[2];
      out[3] = 1 + dot$$1;
      return normalize$2(out, out);
    }
  };
}();
var sqlerp = function () {
  var temp1 = create$4();
  var temp2 = create$4();
  return function (out, a, b, c, d, t) {
    slerp(temp1, a, d, t);
    slerp(temp2, b, c, t);
    slerp(out, temp1, temp2, 2 * t * (1 - t));
    return out;
  };
}();
var setAxes = function () {
  var matr = create$2();
  return function (out, view, right, up) {
    matr[0] = right[0];
    matr[3] = right[1];
    matr[6] = right[2];
    matr[1] = up[0];
    matr[4] = up[1];
    matr[7] = up[2];
    matr[2] = -view[0];
    matr[5] = -view[1];
    matr[8] = -view[2];
    return normalize$2(out, fromMat3(out, matr));
  };
}();

var HEAD_ELBOW_OFFSET_RIGHTHANDED = fromValues$1(0.155, -0.465, -0.15);
var HEAD_ELBOW_OFFSET_LEFTHANDED = fromValues$1(-0.155, -0.465, -0.15);
var ELBOW_WRIST_OFFSET = fromValues$1(0, 0, -0.25);
var WRIST_CONTROLLER_OFFSET = fromValues$1(0, 0, 0.05);
var ARM_EXTENSION_OFFSET = fromValues$1(-0.08, 0.14, 0.08);
var ELBOW_BEND_RATIO = 0.4;
var EXTENSION_RATIO_WEIGHT = 0.4;
var MIN_ANGULAR_SPEED = 0.61;
var MIN_ANGLE_DELTA = 0.175;
var MIN_EXTENSION_COS = 0.12;
var MAX_EXTENSION_COS = 0.87;
var RAD_TO_DEG = 180 / Math.PI;
function eulerFromQuaternion(out, q, order) {
  function clamp(value, min$$1, max$$1) {
    return value < min$$1 ? min$$1 : value > max$$1 ? max$$1 : value;
  }
  var sqx = q[0] * q[0];
  var sqy = q[1] * q[1];
  var sqz = q[2] * q[2];
  var sqw = q[3] * q[3];
  if (order === 'XYZ') {
    out[0] = Math.atan2(2 * (q[0] * q[3] - q[1] * q[2]), sqw - sqx - sqy + sqz);
    out[1] = Math.asin(clamp(2 * (q[0] * q[2] + q[1] * q[3]), -1, 1));
    out[2] = Math.atan2(2 * (q[2] * q[3] - q[0] * q[1]), sqw + sqx - sqy - sqz);
  } else if (order === 'YXZ') {
    out[0] = Math.asin(clamp(2 * (q[0] * q[3] - q[1] * q[2]), -1, 1));
    out[1] = Math.atan2(2 * (q[0] * q[2] + q[1] * q[3]), sqw - sqx - sqy + sqz);
    out[2] = Math.atan2(2 * (q[0] * q[1] + q[2] * q[3]), sqw - sqx + sqy - sqz);
  } else if (order === 'ZXY') {
    out[0] = Math.asin(clamp(2 * (q[0] * q[3] + q[1] * q[2]), -1, 1));
    out[1] = Math.atan2(2 * (q[1] * q[3] - q[2] * q[0]), sqw - sqx - sqy + sqz);
    out[2] = Math.atan2(2 * (q[2] * q[3] - q[0] * q[1]), sqw - sqx + sqy - sqz);
  } else if (order === 'ZYX') {
    out[0] = Math.atan2(2 * (q[0] * q[3] + q[2] * q[1]), sqw - sqx - sqy + sqz);
    out[1] = Math.asin(clamp(2 * (q[1] * q[3] - q[0] * q[2]), -1, 1));
    out[2] = Math.atan2(2 * (q[0] * q[1] + q[2] * q[3]), sqw + sqx - sqy - sqz);
  } else if (order === 'YZX') {
    out[0] = Math.atan2(2 * (q[0] * q[3] - q[2] * q[1]), sqw - sqx + sqy - sqz);
    out[1] = Math.atan2(2 * (q[1] * q[3] - q[0] * q[2]), sqw + sqx - sqy - sqz);
    out[2] = Math.asin(clamp(2 * (q[0] * q[1] + q[2] * q[3]), -1, 1));
  } else if (order === 'XZY') {
    out[0] = Math.atan2(2 * (q[0] * q[3] + q[1] * q[2]), sqw - sqx + sqy - sqz);
    out[1] = Math.atan2(2 * (q[0] * q[2] + q[1] * q[3]), sqw + sqx - sqy - sqz);
    out[2] = Math.asin(clamp(2 * (q[2] * q[3] - q[0] * q[1]), -1, 1));
  } else {
    console.log('No order given for quaternion to euler conversion.');
    return;
  }
}
var OrientationArmModel = function () {
  function OrientationArmModel() {
    classCallCheck(this, OrientationArmModel);
    this.hand = 'right';
    this.headElbowOffset = HEAD_ELBOW_OFFSET_RIGHTHANDED;
    this.controllerQ = create$4();
    this.lastControllerQ = create$4();
    this.headQ = create$4();
    this.headPos = create$1();
    this.elbowPos = create$1();
    this.wristPos = create$1();
    this.time = null;
    this.lastTime = null;
    this.rootQ = create$4();
    this.position = create$1();
  }
  createClass(OrientationArmModel, [{
    key: 'setHandedness',
    value: function setHandedness(hand) {
      if (this.hand != hand) {
        this.hand = hand;
        if (this.hand == 'left') {
          this.headElbowOffset = HEAD_ELBOW_OFFSET_LEFTHANDED;
        } else {
          this.headElbowOffset = HEAD_ELBOW_OFFSET_RIGHTHANDED;
        }
      }
    }
  }, {
    key: 'update',
    value: function update(controllerOrientation, headPoseMatrix) {
      this.time = now$1();
      if (controllerOrientation) {
        copy$4(this.lastControllerQ, this.controllerQ);
        copy$4(this.controllerQ, controllerOrientation);
      }
      if (headPoseMatrix) {
        getTranslation(this.headPos, headPoseMatrix);
        getRotation(this.headQ, headPoseMatrix);
      }
      var headYawQ = this.getHeadYawOrientation_();
      var angleDelta = this.quatAngle_(this.lastControllerQ, this.controllerQ);
      var timeDelta = (this.time - this.lastTime) / 1000;
      var controllerAngularSpeed = angleDelta / timeDelta;
      if (controllerAngularSpeed > MIN_ANGULAR_SPEED) {
        slerp(this.rootQ, this.rootQ, headYawQ, Math.min(angleDelta / MIN_ANGLE_DELTA, 1.0));
      } else {
        copy$4(this.rootQ, headYawQ);
      }
      var controllerForward = fromValues$1(0, 0, -1.0);
      transformQuat(controllerForward, controllerForward, this.controllerQ);
      var controllerDotY = dot(controllerForward, [0, 1, 0]);
      var extensionRatio = this.clamp_((controllerDotY - MIN_EXTENSION_COS) / MAX_EXTENSION_COS, 0.0, 1.0);
      var controllerCameraQ = clone$4(this.rootQ);
      invert$2(controllerCameraQ, controllerCameraQ);
      multiply$4(controllerCameraQ, controllerCameraQ, this.controllerQ);
      var elbowPos = this.elbowPos;
      copy$1(elbowPos, this.headPos);
      add$1(elbowPos, elbowPos, this.headElbowOffset);
      var elbowOffset = clone$1(ARM_EXTENSION_OFFSET);
      scale$1(elbowOffset, elbowOffset, extensionRatio);
      add$1(elbowPos, elbowPos, elbowOffset);
      var totalAngle = this.quatAngle_(controllerCameraQ, create$4());
      var totalAngleDeg = totalAngle * RAD_TO_DEG;
      var lerpSuppression = 1 - Math.pow(totalAngleDeg / 180, 4);var elbowRatio = ELBOW_BEND_RATIO;
      var wristRatio = 1 - ELBOW_BEND_RATIO;
      var lerpValue = lerpSuppression * (elbowRatio + wristRatio * extensionRatio * EXTENSION_RATIO_WEIGHT);
      var wristQ = create$4();
      slerp(wristQ, wristQ, controllerCameraQ, lerpValue);
      var invWristQ = invert$2(create$4(), wristQ);
      var elbowQ = clone$4(controllerCameraQ);
      multiply$4(elbowQ, elbowQ, invWristQ);
      var wristPos = this.wristPos;
      copy$1(wristPos, WRIST_CONTROLLER_OFFSET);
      transformQuat(wristPos, wristPos, wristQ);
      add$1(wristPos, wristPos, ELBOW_WRIST_OFFSET);
      transformQuat(wristPos, wristPos, elbowQ);
      add$1(wristPos, wristPos, elbowPos);
      var offset = clone$1(ARM_EXTENSION_OFFSET);
      scale$1(offset, offset, extensionRatio);
      add$1(this.position, this.wristPos, offset);
      transformQuat(this.position, this.position, this.rootQ);
      this.lastTime = this.time;
    }
  }, {
    key: 'getPosition',
    value: function getPosition() {
      return this.position;
    }
  }, {
    key: 'getHeadYawOrientation_',
    value: function getHeadYawOrientation_() {
      var headEuler = create$1();
      eulerFromQuaternion(headEuler, this.headQ, 'YXZ');
      var destinationQ = fromEuler(create$4(), 0, headEuler[1] * RAD_TO_DEG, 0);
      return destinationQ;
    }
  }, {
    key: 'clamp_',
    value: function clamp_(value, min$$1, max$$1) {
      return Math.min(Math.max(value, min$$1), max$$1);
    }
  }, {
    key: 'quatAngle_',
    value: function quatAngle_(q1, q2) {
      var vec1 = [0, 0, -1];
      var vec2 = [0, 0, -1];
      transformQuat(vec1, vec1, q1);
      transformQuat(vec2, vec2, q2);
      return angle(vec1, vec2);
    }
  }]);
  return OrientationArmModel;
}();

var GamepadXRInputSource = function () {
  function GamepadXRInputSource(polyfill) {
    var primaryButtonIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    classCallCheck(this, GamepadXRInputSource);
    this.polyfill = polyfill;
    this.gamepad = null;
    this.inputSource = new XRInputSource(this);
    this.lastPosition = create$1();
    this.emulatedPosition = false;
    this.basePoseMatrix = create();
    this.inputPoses = new WeakMap();
    this.primaryButtonIndex = primaryButtonIndex;
    this.primaryActionPressed = false;
    this.handedness = '';
    this.targetRayMode = 'gaze';
    this.armModel = null;
  }
  createClass(GamepadXRInputSource, [{
    key: 'updateFromGamepad',
    value: function updateFromGamepad(gamepad) {
      this.gamepad = gamepad;
      this.handedness = gamepad.hand;
      if (gamepad.pose) {
        this.targetRayMode = 'tracked-pointer';
        this.emulatedPosition = !gamepad.pose.hasPosition;
      } else if (gamepad.hand === '') {
        this.targetRayMode = 'gaze';
        this.emulatedPosition = false;
      }
    }
  }, {
    key: 'updateBasePoseMatrix',
    value: function updateBasePoseMatrix() {
      if (this.gamepad && this.gamepad.pose) {
        var pose = this.gamepad.pose;
        var position = pose.position;
        var orientation = pose.orientation;
        if (!position && !orientation) {
          return;
        }
        if (!position) {
          if (!pose.hasPosition) {
            if (!this.armModel) {
              this.armModel = new OrientationArmModel();
            }
            this.armModel.setHandedness(this.gamepad.hand);
            this.armModel.update(orientation, this.polyfill.getBasePoseMatrix());
            position = this.armModel.getPosition();
          } else {
            position = this.lastPosition;
          }
        } else {
          this.lastPosition[0] = position[0];
          this.lastPosition[1] = position[1];
          this.lastPosition[2] = position[2];
        }
        fromRotationTranslation(this.basePoseMatrix, orientation, position);
      } else {
        copy(this.basePoseMatrix, this.polyfill.getBasePoseMatrix());
      }
      return this.basePoseMatrix;
    }
  }, {
    key: 'getXRInputPose',
    value: function getXRInputPose(coordinateSystem) {
      this.updateBasePoseMatrix();
      var inputPose = this.inputPoses.get(coordinateSystem);
      if (!inputPose) {
        inputPose = new XRInputPose(this, this.gamepad && this.gamepad.pose);
        this.inputPoses.set(coordinateSystem, inputPose);
      }
      var rayTransformMatrix = new Float32Array(16);
      coordinateSystem.transformBasePoseMatrix(rayTransformMatrix, this.basePoseMatrix);
      inputPose.targetRay = poseMatrixToXRRay(rayTransformMatrix);
      if (inputPose.gripMatrix) {
        coordinateSystem.transformBasePoseMatrix(inputPose.gripMatrix, this.basePoseMatrix);
      }
      return inputPose;
    }
  }]);
  return GamepadXRInputSource;
}();

var EXTRA_PRESENTATION_ATTRIBUTES = {
  highRefreshRate: true
};
var PRIMARY_BUTTON_MAP = {
  oculus: 1,
  openvr: 1
};
var CAN_USE_GAMEPAD = _global.navigator && 'getGamepads' in _global.navigator;
var SESSION_ID = 0;
var Session = function Session(sessionOptions) {
  classCallCheck(this, Session);
  this.outputContext = sessionOptions.outputContext;
  this.immersive = sessionOptions.immersive;
  this.ended = null;
  this.baseLayer = null;
  this.id = ++SESSION_ID;
  this.modifiedCanvasLayer = false;
};

var WebVRDevice = function (_PolyfilledXRDevice) {
  inherits(WebVRDevice, _PolyfilledXRDevice);
  function WebVRDevice(global, display) {
    classCallCheck(this, WebVRDevice);
    var canPresent = display.capabilities.canPresent;
    var _this = possibleConstructorReturn(this, (WebVRDevice.__proto__ || Object.getPrototypeOf(WebVRDevice)).call(this, global));
    _this.display = display;
    _this.frame = new global.VRFrameData();
    _this.sessions = new Map();
    _this.immersiveSession = null;
    _this.canPresent = canPresent;
    _this.baseModelMatrix = create();
    _this.gamepadInputSources = {};
    _this.tempVec3 = new Float32Array(3);
    _this.onVRDisplayPresentChange = _this.onVRDisplayPresentChange.bind(_this);
    global.window.addEventListener('vrdisplaypresentchange', _this.onVRDisplayPresentChange);
    return _this;
  }
  createClass(WebVRDevice, [{
    key: 'onBaseLayerSet',
    value: function onBaseLayerSet(sessionId, layer) {
      var _this2 = this;
      var session = this.sessions.get(sessionId);
      var canvas = layer.context.canvas;
      if (session.immersive) {
        var left = this.display.getEyeParameters('left');
        var right = this.display.getEyeParameters('right');
        canvas.width = Math.max(left.renderWidth, right.renderWidth) * 2;
        canvas.height = Math.max(left.renderHeight, right.renderHeight);
        this.display.requestPresent([{
          source: canvas, attributes: EXTRA_PRESENTATION_ATTRIBUTES
        }]).then(function () {
          if ("production" !== 'test' && !_this2.global.document.body.contains(canvas)) {
            session.modifiedCanvasLayer = true;
            _this2.global.document.body.appendChild(canvas);
            applyCanvasStylesForMinimalRendering(canvas);
          }
          session.baseLayer = layer;
        });
      }
      else if (session.outputContext) {
          session.baseLayer = layer;
        }
    }
  }, {
    key: 'supportsSession',
    value: function supportsSession() {
      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
      if (options.immersive === true && this.canPresent === false) {
        return false;
      }
      return true;
    }
  }, {
    key: 'requestSession',
    value: function requestSession() {
      var $args = arguments;return new Promise(function ($return, $error) {
        var options, canvas, ctx, session;
        options = $args.length > 0 && $args[0] !== undefined ? $args[0] : {};
        if (!this.supportsSession(options)) {
          return $return(Promise.reject());
        }
        if (options.immersive) {
          canvas = this.global.document.createElement('canvas');
          {
            ctx = canvas.getContext('webgl');
          }
          return Promise.resolve(this.display.requestPresent([{
            source: canvas, attributes: EXTRA_PRESENTATION_ATTRIBUTES }])).then(function ($await_2) {
            try {
              return $If_1.call(this);
            } catch ($boundEx) {
              return $error($boundEx);
            }
          }.bind(this), $error);
        }
        function $If_1() {
          session = new Session(options);
          this.sessions.set(session.id, session);
          if (options.immersive) {
            this.immersiveSession = session;
            this.dispatchEvent('@@webxr-polyfill/vr-present-start', session.id);
          }
          return $return(Promise.resolve(session.id));
        }
        return $If_1.call(this);
      }.bind(this));
    }
  }, {
    key: 'requestAnimationFrame',
    value: function requestAnimationFrame(callback) {
      return this.display.requestAnimationFrame(callback);
    }
  }, {
    key: 'getPrimaryButtonIndex',
    value: function getPrimaryButtonIndex(gamepad) {
      var primaryButton = 0;
      var name = gamepad.id.toLowerCase();
      for (var key in PRIMARY_BUTTON_MAP) {
        if (name.includes(key)) {
          primaryButton = PRIMARY_BUTTON_MAP[key];
          break;
        }
      }
      return Math.min(primaryButton, gamepad.buttons.length - 1);
    }
  }, {
    key: 'onFrameStart',
    value: function onFrameStart(sessionId) {
      this.display.getFrameData(this.frame);
      var session = this.sessions.get(sessionId);
      if (session.immersive && CAN_USE_GAMEPAD) {
        var prevInputSources = this.gamepadInputSources;
        this.gamepadInputSources = {};
        var gamepads = _global.navigator.getGamepads();
        for (var i = 0; i < gamepads.length; ++i) {
          var gamepad = gamepads[i];
          if (gamepad && gamepad.displayId === this.display.displayId) {
            var inputSourceImpl = prevInputSources[i];
            if (!inputSourceImpl) {
              inputSourceImpl = new GamepadXRInputSource(this, this.getPrimaryButtonIndex(gamepad));
            }
            inputSourceImpl.updateFromGamepad(gamepad);
            this.gamepadInputSources[i] = inputSourceImpl;
            if (inputSourceImpl.primaryButtonIndex != -1) {
              var primaryActionPressed = gamepad.buttons[inputSourceImpl.primaryButtonIndex].pressed;
              if (primaryActionPressed && !inputSourceImpl.primaryActionPressed) {
                this.dispatchEvent('@@webxr-polyfill/input-select-start', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });
              } else if (!primaryActionPressed && inputSourceImpl.primaryActionPressed) {
                this.dispatchEvent('@@webxr-polyfill/input-select-end', { sessionId: session.id, inputSource: inputSourceImpl.inputSource });
              }
              inputSourceImpl.primaryActionPressed = primaryActionPressed;
            }
          }
        }
      }
      if (session.outputContext && !session.immersive) {
        var outputCanvas = session.outputContext.canvas;
        var oWidth = outputCanvas.offsetWidth;
        var oHeight = outputCanvas.offsetHeight;
        if (outputCanvas.width != oWidth) {
          outputCanvas.width = oWidth;
        }
        if (outputCanvas.height != oHeight) {
          outputCanvas.height = oHeight;
        }
        var canvas = session.baseLayer.context.canvas;
        if (!this.immersiveSession || canvas !== this.immersiveSession.baseLayer.context.canvas) {
          if (canvas.width != oWidth) {
            canvas.width = oWidth;
          }
          if (canvas.height != oHeight) {
            canvas.height = oHeight;
          }
          perspective(this.frame.leftProjectionMatrix, Math.PI * 0.4, oWidth / oHeight, this.depthNear, this.depthFar);
        }
      }
    }
  }, {
    key: 'onFrameEnd',
    value: function onFrameEnd(sessionId) {
      var session = this.sessions.get(sessionId);
      if (session.ended || !session.baseLayer) {
        return;
      }
      if (session.outputContext && !(session.immersive && !this.display.capabilities.hasExternalDisplay)) {
        var mirroring = session.immersive && this.display.capabilities.hasExternalDisplay;
        var canvas = session.baseLayer.context.canvas;
        var iWidth = mirroring ? canvas.width / 2 : canvas.width;
        var iHeight = canvas.height;
        {
          var outputCanvas = session.outputContext.canvas;
          var outputContext = outputCanvas.getContext('2d');
          var oWidth = outputCanvas.width;
          var oHeight = outputCanvas.height;
          outputContext.drawImage(canvas, 0, 0, iWidth, iHeight, 0, 0, oWidth, oHeight);
        }
      }
      if (session.immersive && session.baseLayer) {
        this.display.submitFrame();
      }
    }
  }, {
    key: 'cancelAnimationFrame',
    value: function cancelAnimationFrame(handle) {
      this.display.cancelAnimationFrame(handle);
    }
  }, {
    key: 'endSession',
    value: function endSession(sessionId) {
      return new Promise(function ($return, $error) {
        var session = this.sessions.get(sessionId);
        if (session.ended) {
          return $return();
        }
        if (session.immersive) {
          return $return(this.display.exitPresent());
        } else {
          session.ended = true;
        }
        return $return();
      }.bind(this));
    }
  }, {
    key: 'requestStageBounds',
    value: function requestStageBounds() {
      if (this.display.stageParameters) {
        var width = this.display.stageParameters.sizeX;
        var depth = this.display.stageParameters.sizeZ;
        var data = [];
        data.push(-width / 2);
        data.push(-depth / 2);
        data.push(width / 2);
        data.push(-depth / 2);
        data.push(width / 2);
        data.push(depth / 2);
        data.push(-width / 2);
        data.push(depth / 2);
        return data;
      }
      return null;
    }
  }, {
    key: 'requestFrameOfReferenceTransform',
    value: function requestFrameOfReferenceTransform(type, options) {
      return new Promise(function ($return, $error) {
        if (type === 'stage' && this.display.stageParameters && this.display.stageParameters.sittingToStandingTransform) {
          return $return(this.display.stageParameters.sittingToStandingTransform);
        }
        return $return();
      }.bind(this));
    }
  }, {
    key: 'getProjectionMatrix',
    value: function getProjectionMatrix(eye) {
      if (eye === 'left') {
        return this.frame.leftProjectionMatrix;
      } else if (eye === 'right') {
        return this.frame.rightProjectionMatrix;
      } else {
        throw new Error('eye must be of type \'left\' or \'right\'');
      }
    }
  }, {
    key: 'getViewport',
    value: function getViewport(sessionId, eye, layer, target) {
      var session = this.sessions.get(sessionId);
      var _layer$context$canvas = layer.context.canvas,
          width = _layer$context$canvas.width,
          height = _layer$context$canvas.height;
      if (!session.immersive) {
        target.x = target.y = 0;
        target.width = width;
        target.height = height;
        return true;
      }
      if (eye === 'left') {
        target.x = 0;
      } else if (eye === 'right') {
        target.x = width / 2;
      } else {
        return false;
      }
      target.y = 0;
      target.width = width / 2;
      target.height = height;
      return true;
    }
  }, {
    key: 'getBasePoseMatrix',
    value: function getBasePoseMatrix() {
      var _frame$pose = this.frame.pose,
          position = _frame$pose.position,
          orientation = _frame$pose.orientation;
      if (!position && !orientation) {
        return this.baseModelMatrix;
      }
      if (!position) {
        position = this.tempVec3;
        position[0] = position[1] = position[2] = 0;
      }
      fromRotationTranslation(this.baseModelMatrix, orientation, position);
      return this.baseModelMatrix;
    }
  }, {
    key: 'getBaseViewMatrix',
    value: function getBaseViewMatrix(eye) {
      if (eye === 'left') {
        return this.frame.leftViewMatrix;
      } else if (eye === 'right') {
        return this.frame.rightViewMatrix;
      } else {
        throw new Error('eye must be of type \'left\' or \'right\'');
      }
    }
  }, {
    key: 'getInputSources',
    value: function getInputSources() {
      var inputSources = [];
      for (var i in this.gamepadInputSources) {
        inputSources.push(this.gamepadInputSources[i].inputSource);
      }
      return inputSources;
    }
  }, {
    key: 'getInputPose',
    value: function getInputPose(inputSource, coordinateSystem) {
      if (!coordinateSystem) {
        return null;
      }
      for (var i in this.gamepadInputSources) {
        var inputSourceImpl = this.gamepadInputSources[i];
        if (inputSourceImpl.inputSource === inputSource) {
          return inputSourceImpl.getXRInputPose(coordinateSystem);
        }
      }
      return null;
    }
  }, {
    key: 'onWindowResize',
    value: function onWindowResize() {}
  }, {
    key: 'onVRDisplayPresentChange',
    value: function onVRDisplayPresentChange(e) {
      var _this3 = this;
      if (!this.display.isPresenting) {
        this.sessions.forEach(function (session) {
          if (session.immersive && !session.ended) {
            if (session.modifiedCanvasLayer) {
              var canvas = session.baseLayer.context.canvas;
              document.body.removeChild(canvas);
              canvas.setAttribute('style', '');
            }
            if (_this3.immersiveSession === session) {
              _this3.immersiveSession = null;
            }
            _this3.dispatchEvent('@@webxr-polyfill/vr-present-end', session.id);
          }
        });
      }
    }
  }, {
    key: 'depthNear',
    get: function get$$1() {
      return this.display.depthNear;
    }
    ,
    set: function set$$1(val) {
      this.display.depthNear = val;
    }
  }, {
    key: 'depthFar',
    get: function get$$1() {
      return this.display.depthFar;
    }
    ,
    set: function set$$1(val) {
      this.display.depthFar = val;
    }
  }]);
  return WebVRDevice;
}(PolyfilledXRDevice);

var CardboardXRDevice = function (_WebVRDevice) {
  inherits(CardboardXRDevice, _WebVRDevice);
  function CardboardXRDevice(global) {
    classCallCheck(this, CardboardXRDevice);
    var display = new CardboardVRDisplay();
    var _this = possibleConstructorReturn(this, (CardboardXRDevice.__proto__ || Object.getPrototypeOf(CardboardXRDevice)).call(this, global, display));
    _this.display = display;
    _this.frame = {
      rightViewMatrix: new Float32Array(16),
      leftViewMatrix: new Float32Array(16),
      rightProjectionMatrix: new Float32Array(16),
      leftProjectionMatrix: new Float32Array(16),
      pose: null,
      timestamp: null
    };
    return _this;
  }
  return CardboardXRDevice;
}(WebVRDevice);

var getXRDevice = function getXRDevice(global) {
  return new Promise(function ($return, $error) {
    var device;
    device = null;
    if ('xr' in global.navigator) {
      var $Try_1_Post = function () {
        try {
          return $If_3.call(this);
        } catch ($boundEx) {
          return $error($boundEx);
        }
      }.bind(this);var $Try_1_Catch = function (e) {
        try {
          return $Try_1_Post();
        } catch ($boundEx) {
          return $error($boundEx);
        }
      }.bind(this);
      try {
        return Promise.resolve(global.navigator.xr.requestDevice()).then(function ($await_6) {
          try {
            device = $await_6;
            return $Try_1_Post();
          } catch ($boundEx) {
            return $Try_1_Catch($boundEx);
          }
        }.bind(this), $Try_1_Catch);
      } catch (e) {
        $Try_1_Catch(e);
      }
    }
    function $If_3() {
      return $return(device);
    }
    return $If_3.call(this);
  }.bind(this));
};
var getVRDisplay = function getVRDisplay(global) {
  return new Promise(function ($return, $error) {
    var device, displays;
    device = null;
    if ('getVRDisplays' in global.navigator) {
      var $Try_2_Post = function () {
        try {
          return $If_4.call(this);
        } catch ($boundEx) {
          return $error($boundEx);
        }
      }.bind(this);var $Try_2_Catch = function (e) {
        try {
          return $Try_2_Post();
        } catch ($boundEx) {
          return $error($boundEx);
        }
      }.bind(this);
      try {
        return Promise.resolve(global.navigator.getVRDisplays()).then(function ($await_7) {
          try {
            displays = $await_7;
            if (displays && displays.length) {
              device = new WebVRDevice(global, displays[0]);
            }
            return $Try_2_Post();
          } catch ($boundEx) {
            return $Try_2_Catch($boundEx);
          }
        }.bind(this), $Try_2_Catch);
      } catch (e) {
        $Try_2_Catch(e);
      }
    }
    function $If_4() {
      return $return(device);
    }
    return $If_4.call(this);
  }.bind(this));
};
var requestDevice = function requestDevice(global, config) {
  return new Promise(function ($return, $error) {
    var device;
    return Promise.resolve(getXRDevice(global)).then(function ($await_8) {
      try {
        device = $await_8;
        if (device) {
          return $return(device);
        }
        if (config.webvr) {
          return Promise.resolve(getVRDisplay(global)).then(function ($await_9) {
            try {
              device = $await_9;
              if (device) {
                return $return(new XRDevice(device));
              }
              return $If_5.call(this);
            } catch ($boundEx) {
              return $error($boundEx);
            }
          }.bind(this), $error);
        }
        function $If_5() {
          if (config.cardboard && isMobile(global)) {
            if (!global.VRFrameData) {
              global.VRFrameData = function () {
                this.rightViewMatrix = new Float32Array(16);
                this.leftViewMatrix = new Float32Array(16);
                this.rightProjectionMatrix = new Float32Array(16);
                this.leftProjectionMatrix = new Float32Array(16);
                this.pose = null;
              };
            }
            return $return(new XRDevice(new CardboardXRDevice(global)));
          }
          return $return(null);
        }
        return $If_5.call(this);
      } catch ($boundEx) {
        return $error($boundEx);
      }
    }.bind(this), $error);
  }.bind(this));
};

var CONFIG_DEFAULTS = {
  webvr: true,
  cardboard: true
};
var partials = ['navigator', 'HTMLCanvasElement', 'WebGLRenderingContext'];
var WebXRPolyfill = function () {
  function WebXRPolyfill(global) {
    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    classCallCheck(this, WebXRPolyfill);
    this.global = global || _global;
    this.config = Object.freeze(Object.assign({}, CONFIG_DEFAULTS, config));
    this.nativeWebXR = 'xr' in this.global.navigator;
    this.injected = false;
    if (!this.nativeWebXR) {
      this._injectPolyfill(this.global);
    }
    else if (this.config.cardboard && isMobile(this.global)) {
        this._patchRequestDevice();
      }
  }
  createClass(WebXRPolyfill, [{
    key: '_injectPolyfill',
    value: function _injectPolyfill(global) {
      if (!partials.every(function (iface) {
        return !!global[iface];
      })) {
        throw new Error('Global must have the following attributes : ' + partials);
      }
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;
      try {
        for (var _iterator = Object.keys(API)[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var className = _step.value;
          if (global[className] !== undefined) {
            console.warn(className + ' already defined on global.');
          } else {
            global[className] = API[className];
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
      {
        var polyfilledCtx = extendContextCompatibleXRDevice(global.WebGLRenderingContext);
        if (polyfilledCtx) {
          extendGetContext(global.HTMLCanvasElement);
          if (global.WebGL2RenderingContext) {
            extendContextCompatibleXRDevice(global.WebGL2RenderingContext);
          }
        }
      }
      this.injected = true;
      this._patchRequestDevice();
    }
  }, {
    key: '_patchRequestDevice',
    value: function _patchRequestDevice() {
      var device = requestDevice(this.global, this.config);
      this.xr = new XR(device);
      Object.defineProperty(this.global.navigator, 'xr', {
        value: this.xr,
        configurable: true
      });
    }
  }]);
  return WebXRPolyfill;
}();

return WebXRPolyfill;

})));

    </script>
    <!--This script patches up around implementation differences in past browser versions
        so that the samples can always be written against the most recent spec changes.
        It won't be necessary after the API has been officially shipped for a bit.-->
    <!-- <script src='./js/webxr-version-shim.js'></script> -->
    <script>
// Copyright 2018 The Immersive Web Community Group
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:

// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.

// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

// This file contains various patches to adjust for differences in outdated browser
// implementations of the WebXR API and allow the samples to be coded exclusively
// against the most recent version.

class XRRayShim {
  constructor(rayMatrix) {
    this._transformMatrix = rayMatrix;

    // TODO: Don't rely on these types for the shim.
    // Some browsers don't support them yet.
    let o = new DOMPointReadOnly(0, 0, 0, 1);
    let d = new DOMPointReadOnly(0, 0, -1, 0);
    let t = new DOMMatrix(rayMatrix);

    this._origin = DOMPointReadOnly.fromPoint(t.transformPoint(o));
    this._direction = DOMPointReadOnly.fromPoint(t.transformPoint(d));
  }

  get origin() {
    return this._origin;
  }

  get direction() {
    return this._direction;
  }

  get transformMatrix() {
    return this._transformMatrix;
  }
}

class WebXRVersionShim {
  constructor() {
    if (this._shouldApplyPatch()) {
      this._applyPatch();
    }
  }

  _isMobile() {
    return /Android/i.test(navigator.userAgent) ||
          /iPhone|iPad|iPod/i.test(navigator.userAgent);s
  }

  _shouldApplyPatch() {
    // Don't apply the patch with WebXR isn't available.
    if (!('xr' in navigator)) {
      return false;
    }

    // Allow for universally disabling the version shim with a URL arg, which will
    // make it easier to test updates to native implementations.
    let query = window.location.search.substring(1) || window.location.hash.substring(1);
    let vars = query.split('&');
    for (let i = 0; i < vars.length; i++) {
      let pair = vars[i].split('=');
      if (pair[0].toLowerCase() == 'nowebxrversionshim') {
        return false;
      }
    }

    return true;
  }

  _applyPatch() {
    //===========================
    // Chrome 67/68
    //===========================

    // Map 'immersive' to the old 'exclusive' verbiage if needed.
    if ('exclusive' in XRSession.prototype) {
      const NATIVE_SUPPORTS_SESSION = XRDevice.prototype.supportsSession;
      XRDevice.prototype.supportsSession = function(options) {
        options.exclusive = !!options.immersive;
        return NATIVE_SUPPORTS_SESSION.call(this, options);
      };

      const NATIVE_REQUEST_SESSION = XRDevice.prototype.requestSession;
      XRDevice.prototype.requestSession = function(options) {
        options.exclusive = !!options.immersive;
        return NATIVE_REQUEST_SESSION.call(this, options);
      };

      Object.defineProperty(XRSession.prototype, 'immersive', {
        enumerable: true, configurable: false, writeable: false,
        get: function() { return this.exclusive; }
      });
    }

    // We can't test for the existence of the enums in question directly, so this code
    // will just try to create the requested type and fall back if it fails.
    const NATIVE_REQUEST_FRAME_OF_REFERENCE = XRSession.prototype.requestFrameOfReference;
    XRSession.prototype.requestFrameOfReference = function(type, options) {
      let session = this;
      // Try the current type.
      return NATIVE_REQUEST_FRAME_OF_REFERENCE.call(session, type, options).catch((error)=>{
        // FIXME: Should be checking for TypeError specifically. Requires a polyfill update.
        if(error instanceof Error) {
          // If the current type fails, switch to the other version.
          switch(type) {
            case 'eye-level':
              type = 'eyeLevel';
              break;
            case 'head-model':
              type = 'headModel';
              break;
            default:
              return Promise.reject(error);
          }
          return Promise.resolve(NATIVE_REQUEST_FRAME_OF_REFERENCE.call(session, type, options));
        } else {
          return Promise.reject(error);
        }
      });
    };

    // Make sure that requestAnimationFrame is always supplied with a timestamp
    const NATIVE_REQUEST_ANIMATION_FRAME = XRSession.prototype.requestAnimationFrame;
    XRSession.prototype.requestAnimationFrame = function(callback) {
      return NATIVE_REQUEST_ANIMATION_FRAME.call(this, (timestamp, frame) => {
        callback(timestamp ? timestamp : performance.now(), frame);
      });
    };

    if (!('getNativeFramebufferScaleFactor' in XRWebGLLayer)) {
      if (this._isMobile()) {
        const NATIVE_WEBGL_LAYER = XRWebGLLayer;
        const NATIVE_WEBGL_LAYER_PROTOTYPE = XRWebGLLayer.prototype;
        XRWebGLLayer = function(session, gl, options) {
          if (options && options.framebufferScaleFactor) {
            // On Chrome 67/68 mobile the default framebuffer returned is 0.7 of full res.
            options.framebufferScaleFactor = 0.7 * options.framebufferScaleFactor;
          }

          return new NATIVE_WEBGL_LAYER(session, gl, options);
        };

        XRWebGLLayer.prototype = NATIVE_WEBGL_LAYER_PROTOTYPE;

        Object.defineProperty(XRWebGLLayer, 'getNativeFramebufferScaleFactor', {
          enumerable: true, configurable: false, writeable: false,
          value: function(session) {
            if (!session) {
              throw new TypeError('No XRSession specified');
            }
            if (isMobile()) {
              // On Chrome 67/68 mobile the default framebuffer returned is 0.7 of full res.
              return 1.42857;
            } else {
              // On Chrome 67/68 desktop the full res buffer is already returned.
              return 1.0;
            }
          }
        });
      }
    }

    // If the environmentBlendMode isn't available report it as 'opaque', since any
    // implementations lacking this property only really worked on VR headsets.
    if (!('environmentBlendMode' in XRSession.prototype)) {
      Object.defineProperty(XRSession.prototype, 'environmentBlendMode', {
        enumerable: true, configurable: false, writeable: false,
        get: function() { return 'opaque'; }
      });
    }

    if (!('targetRayMode' in XRInputSource.prototype)) {
      Object.defineProperty(XRInputSource.prototype, 'targetRayMode', {
        enumerable: true, configurable: false, writeable: false,
        get: function() {
          switch (this.pointerOrigin) {
            case 'head': return 'gaze';
            case 'hand': return 'tracked-pointer';
            case 'screen': return 'screen';

            default: throw new ValueError('Unrecognized pointerOrigin: ' + this.pointerOrigin);
          }
        }
      });
    }

    if (!('targetRay' in XRInputPose.prototype)) {
      Object.defineProperty(XRInputPose.prototype, 'targetRay', {
        enumerable: true, configurable: false, writeable: false,
        get: function() {
          if (!this._targetRay) {
            if (this.targetRayMatrix) {
              this._targetRay = new XRRayShim(this.targetRayMatrix);
            } else if (this.pointerMatrix) {
              this._targetRay = new XRRayShim(this.pointerMatrix);
            }
          }
          return this._targetRay || null;
        }
      });
    }
  }
}

    </script>
    <!-- <script src='./js/cottontail/build/cottontail.js'></script> -->
    <script>
/*!
 * Copyright 2018 The Immersive Web Community Group
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=35)}([function(t,e,r){"use strict";r.r(e),r.d(e,"EPSILON",function(){return n}),r.d(e,"ARRAY_TYPE",function(){return i}),r.d(e,"RANDOM",function(){return o}),r.d(e,"setMatrixArrayType",function(){return a}),r.d(e,"toRadian",function(){return s}),r.d(e,"equals",function(){return c});const n=1e-6;let i="undefined"!=typeof Float32Array?Float32Array:Array;const o=Math.random;function a(t){i=t}const u=Math.PI/180;function s(t){return t*u}function c(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))}},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"fromValues",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"add",function(){return c}),r.d(e,"subtract",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"divide",function(){return h}),r.d(e,"ceil",function(){return d}),r.d(e,"floor",function(){return v}),r.d(e,"min",function(){return _}),r.d(e,"max",function(){return m}),r.d(e,"round",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"scaleAndAdd",function(){return b}),r.d(e,"distance",function(){return g}),r.d(e,"squaredDistance",function(){return M}),r.d(e,"length",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return w}),r.d(e,"inverse",function(){return E}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return R}),r.d(e,"lerp",function(){return P}),r.d(e,"random",function(){return S}),r.d(e,"transformMat4",function(){return A}),r.d(e,"transformQuat",function(){return N}),r.d(e,"str",function(){return C}),r.d(e,"exactEquals",function(){return I}),r.d(e,"equals",function(){return k}),r.d(e,"sub",function(){return L}),r.d(e,"mul",function(){return F}),r.d(e,"div",function(){return D}),r.d(e,"dist",function(){return B}),r.d(e,"sqrDist",function(){return j}),r.d(e,"len",function(){return U}),r.d(e,"sqrLen",function(){return V}),r.d(e,"forEach",function(){return Y});var n=r(0);function i(){let t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function o(t){let e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,r,i){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function c(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function l(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function h(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function _(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function m(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function y(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function b(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function g(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function M(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o}function x(t){let e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}function T(t){let e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function w(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function E(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function O(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function P(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=u+n*(r[3]-u),t}function S(t,e){return e=e||1,t[0]=n.RANDOM(),t[1]=n.RANDOM(),t[2]=n.RANDOM(),t[3]=n.RANDOM(),O(t,t),y(t,t,e),t}function A(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}function N(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[0],u=r[1],s=r[2],c=r[3],f=c*n+u*o-s*i,l=c*i+s*n-a*o,h=c*o+a*i-u*n,d=-a*n-u*i-s*o;return t[0]=f*c+d*-a+l*-s-h*-u,t[1]=l*c+d*-u+h*-a-f*-s,t[2]=h*c+d*-s+f*-u-l*-a,t[3]=e[3],t}function C(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function k(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=e[0],s=e[1],c=e[2],f=e[3];return Math.abs(r-u)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))}const L=f,F=l,D=h,B=g,j=M,U=x,V=T,Y=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=4),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Node=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(34),o=r(6);var a=new Float32Array([0,0,0]),u=new Float32Array([0,0,0,1]),s=new Float32Array([1,1,1]),c=o.mat4.create();e.Node=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=null,this.children=[],this.parent=null,this.visible=!0,this.selectable=!1,this._matrix=null,this._dirtyTRS=!1,this._translation=null,this._rotation=null,this._scale=null,this._dirtyWorldMatrix=!1,this._worldMatrix=null,this._activeFrameId=-1,this._hoverFrameId=-1,this._renderPrimitives=null,this._renderer=null,this._selectHandler=null}return n(t,[{key:"_setRenderer",value:function(t){if(this._renderer!=t&&(this._renderer&&this.clearRenderPrimitives(),this._renderer=t,t)){this.onRendererChanged(t);var e=!0,r=!1,n=void 0;try{for(var i,o=this.children[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value._setRenderer(t)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}}},{key:"onRendererChanged",value:function(t){}},{key:"clone",value:function(){var e=this,r=new t;return r.name=this.name,r.visible=this.visible,r._renderer=this._renderer,r._dirtyTRS=this._dirtyTRS,this._translation&&(r._translation=o.vec3.create(),o.vec3.copy(r._translation,this._translation)),this._rotation&&(r._rotation=o.quat.create(),o.quat.copy(r._rotation,this._rotation)),this._scale&&(r._scale=o.vec3.create(),o.vec3.copy(r._scale,this._scale)),!r._dirtyTRS&&this._matrix&&(r._matrix=o.mat4.create(),o.mat4.copy(r._matrix,this._matrix)),r._dirtyWorldMatrix=this._dirtyWorldMatrix,!r._dirtyWorldMatrix&&this._worldMatrix&&(r._worldMatrix=o.mat4.create(),o.mat4.copy(r._worldMatrix,this._worldMatrix)),this.waitForComplete().then(function(){if(e._renderPrimitives){var t=!0,n=!1,i=void 0;try{for(var o,a=e._renderPrimitives[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var u=o.value;r.addRenderPrimitive(u)}}catch(t){n=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}var s=!0,c=!1,f=void 0;try{for(var l,h=e.children[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;r.addNode(d.clone())}}catch(t){c=!0,f=t}finally{try{!s&&h.return&&h.return()}finally{if(c)throw f}}}),r}},{key:"markActive",value:function(t){if(this.visible&&this._renderPrimitives){this._activeFrameId=t;var e=!0,r=!1,n=void 0;try{for(var i,o=this._renderPrimitives[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.markActive(t)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}var a=!0,u=!1,s=void 0;try{for(var c,f=this.children[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;l.visible&&l.markActive(t)}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}},{key:"addNode",value:function(t){t&&t.parent!=this&&(t.parent&&t.parent.removeNode(t),t.parent=this,this.children.push(t),this._renderer&&t._setRenderer(this._renderer))}},{key:"removeNode",value:function(t){var e=this.children.indexOf(t);e>-1&&(this.children.splice(e,1),t.parent=null)}},{key:"clearNodes",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.parent=null}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this.children=[]}},{key:"setMatrixDirty",value:function(){if(!this._dirtyWorldMatrix){this._dirtyWorldMatrix=!0;var t=!0,e=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.setMatrixDirty()}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}}}},{key:"_updateLocalMatrix",value:function(){return this._matrix||(this._matrix=o.mat4.create()),this._dirtyTRS&&(this._dirtyTRS=!1,o.mat4.fromRotationTranslationScale(this._matrix,this._rotation||u,this._translation||a,this._scale||s)),this._matrix}},{key:"waitForComplete",value:function(){var t=this,e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;e.push(u.waitForComplete())}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._renderPrimitives){var s=!0,c=!1,f=void 0;try{for(var l,h=this._renderPrimitives[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var d=l.value;e.push(d.waitForComplete())}}catch(t){c=!0,f=t}finally{try{!s&&h.return&&h.return()}finally{if(c)throw f}}}return Promise.all(e).then(function(){return t})}},{key:"addRenderPrimitive",value:function(t){this._renderPrimitives?this._renderPrimitives.push(t):this._renderPrimitives=[t],t._instances.push(this)}},{key:"removeRenderPrimitive",value:function(t){if(this._renderPrimitives){var e=this._renderPrimitives._instances.indexOf(t);e>-1&&(this._renderPrimitives._instances.splice(e,1),(e=t._instances.indexOf(this))>-1&&t._instances.splice(e,1),this._renderPrimitives.length||(this._renderPrimitives=null))}}},{key:"clearRenderPrimitives",value:function(){if(this._renderPrimitives){var t=!0,e=!1,r=void 0;try{for(var n,i=this._renderPrimitives[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=n.value,a=o._instances.indexOf(this);a>-1&&o._instances.splice(a,1)}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this._renderPrimitives=null}}},{key:"_hitTestSelectableNode",value:function(t){if(this._renderPrimitives){var e=null,r=!0,n=!1,a=void 0;try{for(var u,s=this._renderPrimitives[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var f=u.value;if(f._min){e||(o.mat4.invert(c,this.worldMatrix),o.mat4.multiply(c,c,t.transformMatrix),e=new i.Ray(c));var l=e.intersectsAABB(f._min,f._max);if(l)return o.vec3.transformMat4(l,l,this.worldMatrix),l}}}catch(t){n=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}}var h=!0,d=!1,v=void 0;try{for(var _,m=this.children[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=_.value._hitTestSelectableNode(t);if(p)return p}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}return null}},{key:"hitTest",value:function(t){if(this.selectable&&this.visible){var e=this._hitTestSelectableNode(t);if(e){var r=o.vec3.fromValues(t.origin.x,t.origin.y,t.origin.z);return{node:this,intersection:e,distance:o.vec3.distance(r,e)}}return null}var n=null,i=!0,a=!1,u=void 0;try{for(var s,c=this.children[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var f=s.value.hitTest(t);f&&(!n||n.distance>f.distance)&&(n=f)}}catch(t){a=!0,u=t}finally{try{!i&&c.return&&c.return()}finally{if(a)throw u}}return n}},{key:"onSelect",value:function(t){this._selectHandler=t}},{key:"handleSelect",value:function(){this._selectHandler&&this._selectHandler()}},{key:"onHoverStart",value:function(){}},{key:"onHoverEnd",value:function(){}},{key:"_update",value:function(t,e){this.onUpdate(t,e);var r=!0,n=!1,i=void 0;try{for(var o,a=this.children[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value._update(t,e)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"onUpdate",value:function(t,e){}},{key:"matrix",set:function(t){t?(this._matrix||(this._matrix=o.mat4.create()),o.mat4.copy(this._matrix,t)):this._matrix=null,this.setMatrixDirty(),this._dirtyTRS=!1,this._translation=null,this._rotation=null,this._scale=null},get:function(){return this.setMatrixDirty(),this._updateLocalMatrix()}},{key:"worldMatrix",get:function(){return this._worldMatrix||(this._dirtyWorldMatrix=!0,this._worldMatrix=o.mat4.create()),(this._dirtyWorldMatrix||this._dirtyTRS)&&(this.parent?o.mat4.mul(this._worldMatrix,this.parent.worldMatrix,this._updateLocalMatrix()):o.mat4.copy(this._worldMatrix,this._updateLocalMatrix()),this._dirtyWorldMatrix=!1),this._worldMatrix}},{key:"translation",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._translation=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._translation||(this._translation=o.vec3.clone(a)),this._translation}},{key:"rotation",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._rotation=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._rotation||(this._rotation=o.quat.clone(u)),this._rotation}},{key:"scale",set:function(t){null!=t&&(this._dirtyTRS=!0,this.setMatrixDirty()),this._scale=t},get:function(){return this._dirtyTRS=!0,this.setMatrixDirty(),this._scale||(this._scale=o.vec3.clone(s)),this._scale}},{key:"renderPrimitives",get:function(){return this._renderPrimitives}},{key:"selectHandler",get:function(){return this._selectHandler}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.stateToBlendFunc=c;var o=WebGLRenderingContext,a=e.CAP={CULL_FACE:1,BLEND:2,DEPTH_TEST:4,STENCIL_TEST:8,COLOR_MASK:16,DEPTH_MASK:32,STENCIL_MASK:64},u=e.MAT_STATE={CAPS_RANGE:255,BLEND_SRC_SHIFT:8,BLEND_SRC_RANGE:3840,BLEND_DST_SHIFT:12,BLEND_DST_RANGE:61440,BLEND_FUNC_RANGE:65280,DEPTH_FUNC_SHIFT:16,DEPTH_FUNC_RANGE:983040},s=e.RENDER_ORDER={OPAQUE:0,SKY:1,TRANSPARENT:2,ADDITIVE:3,DEFAULT:4};function c(t,e,r){var n=(t&e)>>r;switch(n){case 0:case 1:return n;default:return n-2+o.SRC_COLOR}}var f=e.MaterialState=function(){function t(){i(this,t),this._state=a.CULL_FACE|a.DEPTH_TEST|a.COLOR_MASK|a.DEPTH_MASK,this.blendFuncSrc=o.SRC_ALPHA,this.blendFuncDst=o.ONE_MINUS_SRC_ALPHA,this.depthFunc=o.LESS}return n(t,[{key:"cullFace",get:function(){return!!(this._state&a.CULL_FACE)},set:function(t){t?this._state|=a.CULL_FACE:this._state&=~a.CULL_FACE}},{key:"blend",get:function(){return!!(this._state&a.BLEND)},set:function(t){t?this._state|=a.BLEND:this._state&=~a.BLEND}},{key:"depthTest",get:function(){return!!(this._state&a.DEPTH_TEST)},set:function(t){t?this._state|=a.DEPTH_TEST:this._state&=~a.DEPTH_TEST}},{key:"stencilTest",get:function(){return!!(this._state&a.STENCIL_TEST)},set:function(t){t?this._state|=a.STENCIL_TEST:this._state&=~a.STENCIL_TEST}},{key:"colorMask",get:function(){return!!(this._state&a.COLOR_MASK)},set:function(t){t?this._state|=a.COLOR_MASK:this._state&=~a.COLOR_MASK}},{key:"depthMask",get:function(){return!!(this._state&a.DEPTH_MASK)},set:function(t){t?this._state|=a.DEPTH_MASK:this._state&=~a.DEPTH_MASK}},{key:"depthFunc",get:function(){return((this._state&u.DEPTH_FUNC_RANGE)>>u.DEPTH_FUNC_SHIFT)+o.NEVER},set:function(t){t-=o.NEVER,this._state&=~u.DEPTH_FUNC_RANGE,this._state|=t<<u.DEPTH_FUNC_SHIFT}},{key:"stencilMask",get:function(){return!!(this._state&a.STENCIL_MASK)},set:function(t){t?this._state|=a.STENCIL_MASK:this._state&=~a.STENCIL_MASK}},{key:"blendFuncSrc",get:function(){return c(this._state,u.BLEND_SRC_RANGE,u.BLEND_SRC_SHIFT)},set:function(t){switch(t){case 0:case 1:break;default:t=t-o.SRC_COLOR+2}this._state&=~u.BLEND_SRC_RANGE,this._state|=t<<u.BLEND_SRC_SHIFT}},{key:"blendFuncDst",get:function(){return c(this._state,u.BLEND_DST_RANGE,u.BLEND_DST_SHIFT)},set:function(t){switch(t){case 0:case 1:break;default:t=t-o.SRC_COLOR+2}this._state&=~u.BLEND_DST_RANGE,this._state|=t<<u.BLEND_DST_SHIFT}}]),t}(),l=function(){function t(e){i(this,t),this._uniformName=e,this._texture=null}return n(t,[{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t}}]),t}(),h=function(){function t(e,r,n){i(this,t),this._uniformName=e,this._value=r,this._length=n,this._length||(r instanceof Array?this._length=r.length:this._length=1)}return n(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}();e.Material=function(){function t(){i(this,t),this.state=new f,this.renderOrder=s.DEFAULT,this._samplers=[],this._uniforms=[]}return n(t,[{key:"defineSampler",value:function(t){var e=new l(t);return this._samplers.push(e),e}},{key:"defineUniform",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new h(t,e,r);return this._uniforms.push(n),n}},{key:"getProgramDefines",value:function(t){return{}}},{key:"materialName",get:function(){return null}},{key:"vertexSource",get:function(){return null}},{key:"fragmentSource",get:function(){return null}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"length",function(){return a}),r.d(e,"fromValues",function(){return u}),r.d(e,"copy",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"add",function(){return f}),r.d(e,"subtract",function(){return l}),r.d(e,"multiply",function(){return h}),r.d(e,"divide",function(){return d}),r.d(e,"ceil",function(){return v}),r.d(e,"floor",function(){return _}),r.d(e,"min",function(){return m}),r.d(e,"max",function(){return p}),r.d(e,"round",function(){return y}),r.d(e,"scale",function(){return b}),r.d(e,"scaleAndAdd",function(){return g}),r.d(e,"distance",function(){return M}),r.d(e,"squaredDistance",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return w}),r.d(e,"inverse",function(){return E}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return R}),r.d(e,"cross",function(){return P}),r.d(e,"lerp",function(){return S}),r.d(e,"hermite",function(){return A}),r.d(e,"bezier",function(){return N}),r.d(e,"random",function(){return C}),r.d(e,"transformMat4",function(){return I}),r.d(e,"transformMat3",function(){return k}),r.d(e,"transformQuat",function(){return L}),r.d(e,"rotateX",function(){return F}),r.d(e,"rotateY",function(){return D}),r.d(e,"rotateZ",function(){return B}),r.d(e,"angle",function(){return j}),r.d(e,"str",function(){return U}),r.d(e,"exactEquals",function(){return V}),r.d(e,"equals",function(){return Y}),r.d(e,"sub",function(){return G}),r.d(e,"mul",function(){return H}),r.d(e,"div",function(){return q}),r.d(e,"dist",function(){return X}),r.d(e,"sqrDist",function(){return W}),r.d(e,"len",function(){return K}),r.d(e,"sqrLen",function(){return z}),r.d(e,"forEach",function(){return Q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t}function o(t){var e=new n.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){let e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function u(t,e,r){let i=new n.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function c(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function f(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function l(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function h(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function d(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function v(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function _(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function p(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function y(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function b(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function g(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function M(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}function x(t,e){let r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function T(t){let e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function w(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function E(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function O(t,e){let r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function P(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[0],u=r[1],s=r[2];return t[0]=i*s-o*u,t[1]=o*a-n*s,t[2]=n*u-i*a,t}function S(t,e,r,n){let i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t}function A(t,e,r,n,i,o){let a=o*o,u=a*(2*o-3)+1,s=a*(o-2)+o,c=a*(o-1),f=a*(3-2*o);return t[0]=e[0]*u+r[0]*s+n[0]*c+i[0]*f,t[1]=e[1]*u+r[1]*s+n[1]*c+i[1]*f,t[2]=e[2]*u+r[2]*s+n[2]*c+i[2]*f,t}function N(t,e,r,n,i,o){let a=1-o,u=a*a,s=o*o,c=u*a,f=3*o*u,l=3*s*a,h=s*o;return t[0]=e[0]*c+r[0]*f+n[0]*l+i[0]*h,t[1]=e[1]*c+r[1]*f+n[1]*l+i[1]*h,t[2]=e[2]*c+r[2]*f+n[2]*l+i[2]*h,t}function C(t,e){e=e||1;let r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=i*e,t}function I(t,e,r){let n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function k(t,e,r){let n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function L(t,e,r){let n=r[0],i=r[1],o=r[2],a=r[3],u=e[0],s=e[1],c=e[2],f=i*c-o*s,l=o*u-n*c,h=n*s-i*u,d=i*h-o*l,v=o*f-n*h,_=n*l-i*f,m=2*a;return f*=m,l*=m,h*=m,d*=2,v*=2,_*=2,t[0]=u+f+d,t[1]=s+l+v,t[2]=c+h+_,t}function F(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function D(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function B(t,e,r,n){let i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function j(t,e){let r=u(t[0],t[1],t[2]),n=u(e[0],e[1],e[2]);O(r,r),O(n,n);let i=R(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}function U(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function V(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Y(t,e){let r=t[0],i=t[1],o=t[2],a=e[0],u=e[1],s=e[2];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-s)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(s))}const G=l,H=h,q=d,X=M,W=x,K=a,z=T,Q=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=3),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return u}),r.d(e,"identity",function(){return s}),r.d(e,"setAxisAngle",function(){return c}),r.d(e,"getAxisAngle",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"rotateX",function(){return h}),r.d(e,"rotateY",function(){return d}),r.d(e,"rotateZ",function(){return v}),r.d(e,"calculateW",function(){return _}),r.d(e,"slerp",function(){return m}),r.d(e,"invert",function(){return p}),r.d(e,"conjugate",function(){return y}),r.d(e,"fromMat3",function(){return b}),r.d(e,"fromEuler",function(){return g}),r.d(e,"str",function(){return M}),r.d(e,"clone",function(){return x}),r.d(e,"fromValues",function(){return T}),r.d(e,"copy",function(){return w}),r.d(e,"set",function(){return E}),r.d(e,"add",function(){return O}),r.d(e,"mul",function(){return R}),r.d(e,"scale",function(){return P}),r.d(e,"dot",function(){return S}),r.d(e,"lerp",function(){return A}),r.d(e,"length",function(){return N}),r.d(e,"len",function(){return C}),r.d(e,"squaredLength",function(){return I}),r.d(e,"sqrLen",function(){return k}),r.d(e,"normalize",function(){return L}),r.d(e,"exactEquals",function(){return F}),r.d(e,"equals",function(){return D}),r.d(e,"rotationTo",function(){return B}),r.d(e,"sqlerp",function(){return j}),r.d(e,"setAxes",function(){return U});var n=r(0),i=r(12),o=r(4),a=r(1);function u(){let t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function s(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function c(t,e,r){r*=.5;let n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function f(t,e){let r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function l(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*f+a*u+i*c-o*s,t[1]=i*f+a*s+o*u-n*c,t[2]=o*f+a*c+n*s-i*u,t[3]=a*f-n*u-i*s-o*c,t}function h(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+a*u,t[1]=i*s+o*u,t[2]=o*s-i*u,t[3]=a*s-n*u,t}function d(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s-o*u,t[1]=i*s+a*u,t[2]=o*s+n*u,t[3]=a*s-i*u,t}function v(t,e,r){r*=.5;let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+i*u,t[1]=i*s-n*u,t[2]=o*s+a*u,t[3]=a*s-o*u,t}function _(t,e){let r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t}function m(t,e,r,n){let i,o,a,u,s,c=e[0],f=e[1],l=e[2],h=e[3],d=r[0],v=r[1],_=r[2],m=r[3];return(o=c*d+f*v+l*_+h*m)<0&&(o=-o,d=-d,v=-v,_=-_,m=-m),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),u=Math.sin((1-n)*i)/a,s=Math.sin(n*i)/a):(u=1-n,s=n),t[0]=u*c+s*d,t[1]=u*f+s*v,t[2]=u*l+s*_,t[3]=u*h+s*m,t}function p(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,u=a?1/a:0;return t[0]=-r*u,t[1]=-n*u,t[2]=-i*u,t[3]=o*u,t}function y(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function b(t,e){let r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);let i=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*i+i]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*i+o]-e[3*o+i])*r,t[i]=(e[3*i+n]+e[3*n+i])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function g(t,e,r,n){let i=.5*Math.PI/180;e*=i,r*=i,n*=i;let o=Math.sin(e),a=Math.cos(e),u=Math.sin(r),s=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return t[0]=o*s*f-a*u*c,t[1]=a*u*f+o*s*c,t[2]=a*s*c-o*u*f,t[3]=a*s*f+o*u*c,t}function M(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const x=a.clone,T=a.fromValues,w=a.copy,E=a.set,O=a.add,R=l,P=a.scale,S=a.dot,A=a.lerp,N=a.length,C=N,I=a.squaredLength,k=I,L=a.normalize,F=a.exactEquals,D=a.equals,B=function(){let t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,a){let u=o.dot(i,a);return u<-.999999?(o.cross(t,e,i),o.len(t)<1e-6&&o.cross(t,r,i),o.normalize(t,t),c(n,t,Math.PI),n):u>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+u,L(n,n))}}(),j=function(){let t=u(),e=u();return function(r,n,i,o,a,u){return m(t,n,a,u),m(e,i,o,u),m(r,t,e,2*u*(1-u)),r}}(),U=function(){let t=i.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],L(e,b(e,t))}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var n=d(r(0)),i=d(r(33)),o=d(r(32)),a=d(r(12)),u=d(r(10)),s=d(r(5)),c=d(r(31)),f=d(r(30)),l=d(r(4)),h=d(r(1));function d(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}e.glMatrix=n,e.mat2=i,e.mat2d=o,e.mat3=a,e.mat4=u,e.quat=s,e.quat2=c,e.vec2=f,e.vec3=l,e.vec4=h},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Primitive=e.PrimitiveAttribute=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.PrimitiveAttribute=function t(e,r,n,i,a,u){o(this,t),this.name=e,this.buffer=r,this.componentCount=n||3,this.componentType=i||5126,this.stride=a||0,this.byteOffset=u||0,this.normalized=!1},e.Primitive=function(){function t(e,r,n){o(this,t),this.attributes=e||[],this.elementCount=r||0,this.mode=n||4,this.indexBuffer=null,this.indexByteOffset=0,this.indexType=0,this._min=null,this._max=null}return n(t,[{key:"setIndexBuffer",value:function(t,e,r){this.indexBuffer=t,this.indexByteOffset=e||0,this.indexType=r||5123}},{key:"setBounds",value:function(t,e){this._min=i.vec3.clone(t),this._max=i.vec3.clone(e)}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=WebGLRenderingContext,s=e.TextureSampler=function t(){a(this,t),this.minFilter=null,this.magFilter=null,this.wrapS=null,this.wrapT=null},c=e.Texture=function(){function t(){a(this,t),this.sampler=new s,this.mipmap=!0}return n(t,[{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return 0}},{key:"height",get:function(){return 0}},{key:"textureKey",get:function(){return null}}]),t}(),f=e.ImageTexture=function(t){function e(t){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._img=t,r._imgBitmap=null,t.src&&t.complete?t.naturalWidth?r._promise=r._finishImage():r._promise=Promise.reject("Image provided had failed to load."):r._promise=new Promise(function(e,n){t.addEventListener("load",function(){return e(r._finishImage())}),t.addEventListener("error",n)}),r}return o(e,c),n(e,[{key:"_finishImage",value:function(){var t=this;return window.createImageBitmap?window.createImageBitmap(this._img).then(function(e){return t._imgBitmap=e,Promise.resolve(t)}):Promise.resolve(this)}},{key:"waitForComplete",value:function(){return this._promise}},{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return this._img.width}},{key:"height",get:function(){return this._img.height}},{key:"textureKey",get:function(){return this._img.src}},{key:"source",get:function(){return this._imgBitmap||this._img}}]),e}(),l=(e.UrlTexture=function(t){function e(t){a(this,e);var r=new Image,n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return r.src=t,n}return o(e,f),e}(),e.BlobTexture=function(t){function e(t){a(this,e);var r=new Image,n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,r));return r.src=window.URL.createObjectURL(t),n}return o(e,f),e}(),e.VideoTexture=function(t){function e(t){a(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t,t.readyState>=2?r._promise=Promise.resolve(r):t.error?r._promise=Promise.reject(t.error):r._promise=new Promise(function(e,n){t.addEventListener("loadeddata",function(){return e(r)}),t.addEventListener("error",n)}),r}return o(e,c),n(e,[{key:"waitForComplete",value:function(){return this._promise}},{key:"format",get:function(){return u.RGBA}},{key:"width",get:function(){return this._video.videoWidth}},{key:"height",get:function(){return this._video.videoHeight}},{key:"textureKey",get:function(){return this._video.src}},{key:"source",get:function(){return this._video}}]),e}(),0),h=e.DataTexture=function(t){function e(t,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:u.RGBA,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u.UNSIGNED_BYTE;a(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return c._data=t,c._width=r,c._height=n,c._format=o,c._type=s,c._key="DATA_"+l,l++,c}return o(e,c),n(e,[{key:"format",get:function(){return this._format}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"textureKey",get:function(){return this._key}}]),e}();e.ColorTexture=function(t){function e(t,r,n,o){a(this,e);var u=new Uint8Array([255*t,255*r,255*n,255*o]),s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,u,1,1));return s.mipmap=!1,s._key="COLOR_"+u[0]+"_"+u[1]+"_"+u[2]+"_"+u[3],s}return o(e,h),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GeometryBuilderBase=e.PrimitiveStream=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(7),o=r(6);function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=WebGLRenderingContext,s=o.vec3.create(),c=e.PrimitiveStream=function(){function t(e){a(this,t),this._vertices=[],this._indices=[],this._geometryStarted=!1,this._vertexOffset=0,this._vertexIndex=0,this._highIndex=0,this._flipWinding=!1,this._invertNormals=!1,this._transform=null,this._normalTransform=null,this._min=null,this._max=null}return n(t,[{key:"startGeometry",value:function(){if(this._geometryStarted)throw new Error("Attempted to start a new geometry before the previous one was ended.");this._geometryStarted=!0,this._vertexIndex=0,this._highIndex=0}},{key:"endGeometry",value:function(){if(!this._geometryStarted)throw new Error("Attempted to end a geometry before one was started.");if(this._highIndex>=this._vertexIndex)throw new Error("Geometry contains indices that are out of bounds.\n                       (Contains an index of "+this._highIndex+" when the vertex count is "+this._vertexIndex+")");this._geometryStarted=!1,this._vertexOffset+=this._vertexIndex}},{key:"pushVertex",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;if(!this._geometryStarted)throw new Error("Cannot push vertices before calling startGeometry().");return this._transform&&(s[0]=t,s[1]=e,s[2]=r,o.vec3.transformMat4(s,s,this._transform),t=s[0],e=s[1],r=s[2],s[0]=a,s[1]=u,s[2]=c,o.vec3.transformMat3(s,s,this._normalTransform),a=s[0],u=s[1],c=s[2]),this._invertNormals&&(a*=-1,u*=-1,c*=-1),this._vertices.push(t,e,r,n,i,a,u,c),this._min?(this._min[0]=Math.min(this._min[0],t),this._min[1]=Math.min(this._min[1],e),this._min[2]=Math.min(this._min[2],r),this._max[0]=Math.max(this._max[0],t),this._max[1]=Math.max(this._max[1],e),this._max[2]=Math.max(this._max[2],r)):(this._min=o.vec3.fromValues(t,e,r),this._max=o.vec3.fromValues(t,e,r)),this._vertexIndex++}},{key:"pushTriangle",value:function(t,e,r){if(!this._geometryStarted)throw new Error("Cannot push triangles before calling startGeometry().");this._highIndex=Math.max(this._highIndex,t,e,r),t+=this._vertexOffset,e+=this._vertexOffset,r+=this._vertexOffset,this._flipWinding?this._indices.push(r,e,t):this._indices.push(t,e,r)}},{key:"clear",value:function(){if(this._geometryStarted)throw new Error("Cannot clear before ending the current geometry.");this._vertices=[],this._indices=[],this._vertexOffset=0,this._min=null,this._max=null}},{key:"finishPrimitive",value:function(t){if(!this._vertexOffset)throw new Error("Attempted to call finishPrimitive() before creating any geometry.");var e=t.createRenderBuffer(u.ARRAY_BUFFER,new Float32Array(this._vertices)),r=t.createRenderBuffer(u.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices)),n=[new i.PrimitiveAttribute("POSITION",e,3,u.FLOAT,32,0),new i.PrimitiveAttribute("TEXCOORD_0",e,2,u.FLOAT,32,12),new i.PrimitiveAttribute("NORMAL",e,3,u.FLOAT,32,20)],o=new i.Primitive(n,this._indices.length);return o.setIndexBuffer(r),o.setBounds(this._min,this._max),o}},{key:"flipWinding",set:function(t){if(this._geometryStarted)throw new Error("Cannot change flipWinding before ending the current geometry.");this._flipWinding=t},get:function(){this._flipWinding}},{key:"invertNormals",set:function(t){if(this._geometryStarted)throw new Error("Cannot change invertNormals before ending the current geometry.");this._invertNormals=t},get:function(){this._invertNormals}},{key:"transform",set:function(t){if(this._geometryStarted)throw new Error("Cannot change transform before ending the current geometry.");this._transform=t,this._transform&&(this._normalTransform||(this._normalTransform=o.mat3.create()),o.mat3.fromMat4(this._normalTransform,this._transform))},get:function(){this._transform}},{key:"nextVertexIndex",get:function(){return this._vertexIndex}}]),t}();e.GeometryBuilderBase=function(){function t(e){a(this,t),this._stream=e||new c}return n(t,[{key:"finishPrimitive",value:function(t){return this._stream.finishPrimitive(t)}},{key:"clear",value:function(){this._stream.clear()}},{key:"primitiveStream",set:function(t){this._stream=t},get:function(){return this._stream}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"fromValues",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"identity",function(){return c}),r.d(e,"transpose",function(){return f}),r.d(e,"invert",function(){return l}),r.d(e,"adjoint",function(){return h}),r.d(e,"determinant",function(){return d}),r.d(e,"multiply",function(){return v}),r.d(e,"translate",function(){return _}),r.d(e,"scale",function(){return m}),r.d(e,"rotate",function(){return p}),r.d(e,"rotateX",function(){return y}),r.d(e,"rotateY",function(){return b}),r.d(e,"rotateZ",function(){return g}),r.d(e,"fromTranslation",function(){return M}),r.d(e,"fromScaling",function(){return x}),r.d(e,"fromRotation",function(){return T}),r.d(e,"fromXRotation",function(){return w}),r.d(e,"fromYRotation",function(){return E}),r.d(e,"fromZRotation",function(){return O}),r.d(e,"fromRotationTranslation",function(){return R}),r.d(e,"fromQuat2",function(){return P}),r.d(e,"getTranslation",function(){return S}),r.d(e,"getScaling",function(){return A}),r.d(e,"getRotation",function(){return N}),r.d(e,"fromRotationTranslationScale",function(){return C}),r.d(e,"fromRotationTranslationScaleOrigin",function(){return I}),r.d(e,"fromQuat",function(){return k}),r.d(e,"frustum",function(){return L}),r.d(e,"perspective",function(){return F}),r.d(e,"perspectiveFromFieldOfView",function(){return D}),r.d(e,"ortho",function(){return B}),r.d(e,"lookAt",function(){return j}),r.d(e,"targetTo",function(){return U}),r.d(e,"str",function(){return V}),r.d(e,"frob",function(){return Y}),r.d(e,"add",function(){return G}),r.d(e,"subtract",function(){return H}),r.d(e,"multiplyScalar",function(){return q}),r.d(e,"multiplyScalarAndAdd",function(){return X}),r.d(e,"exactEquals",function(){return W}),r.d(e,"equals",function(){return K}),r.d(e,"mul",function(){return z}),r.d(e,"sub",function(){return Q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t){let e=new n.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function u(t,e,r,i,o,a,u,s,c,f,l,h,d,v,_,m){let p=new n.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=r,p[3]=i,p[4]=o,p[5]=a,p[6]=u,p[7]=s,p[8]=c,p[9]=f,p[10]=l,p[11]=h,p[12]=d,p[13]=v,p[14]=_,p[15]=m,p}function s(t,e,r,n,i,o,a,u,s,c,f,l,h,d,v,_,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=f,t[10]=l,t[11]=h,t[12]=d,t[13]=v,t[14]=_,t[15]=m,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,e){if(t===e){let r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function l(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15],y=r*u-n*a,b=r*s-i*a,g=r*c-o*a,M=n*s-i*u,x=n*c-o*u,T=i*c-o*s,w=f*_-l*v,E=f*m-h*v,O=f*p-d*v,R=l*m-h*_,P=l*p-d*_,S=h*p-d*m,A=y*S-b*P+g*R+M*O-x*E+T*w;return A?(A=1/A,t[0]=(u*S-s*P+c*R)*A,t[1]=(i*P-n*S-o*R)*A,t[2]=(_*T-m*x+p*M)*A,t[3]=(h*x-l*T-d*M)*A,t[4]=(s*O-a*S-c*E)*A,t[5]=(r*S-i*O+o*E)*A,t[6]=(m*g-v*T-p*b)*A,t[7]=(f*T-h*g+d*b)*A,t[8]=(a*P-u*O+c*w)*A,t[9]=(n*O-r*P-o*w)*A,t[10]=(v*x-_*g+p*y)*A,t[11]=(l*g-f*x-d*y)*A,t[12]=(u*E-a*R-s*w)*A,t[13]=(r*R-n*E+i*w)*A,t[14]=(_*b-v*M-m*y)*A,t[15]=(f*M-l*b+h*y)*A,t):null}function h(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15];return t[0]=u*(h*p-d*m)-l*(s*p-c*m)+_*(s*d-c*h),t[1]=-(n*(h*p-d*m)-l*(i*p-o*m)+_*(i*d-o*h)),t[2]=n*(s*p-c*m)-u*(i*p-o*m)+_*(i*c-o*s),t[3]=-(n*(s*d-c*h)-u*(i*d-o*h)+l*(i*c-o*s)),t[4]=-(a*(h*p-d*m)-f*(s*p-c*m)+v*(s*d-c*h)),t[5]=r*(h*p-d*m)-f*(i*p-o*m)+v*(i*d-o*h),t[6]=-(r*(s*p-c*m)-a*(i*p-o*m)+v*(i*c-o*s)),t[7]=r*(s*d-c*h)-a*(i*d-o*h)+f*(i*c-o*s),t[8]=a*(l*p-d*_)-f*(u*p-c*_)+v*(u*d-c*l),t[9]=-(r*(l*p-d*_)-f*(n*p-o*_)+v*(n*d-o*l)),t[10]=r*(u*p-c*_)-a*(n*p-o*_)+v*(n*c-o*u),t[11]=-(r*(u*d-c*l)-a*(n*d-o*l)+f*(n*c-o*u)),t[12]=-(a*(l*m-h*_)-f*(u*m-s*_)+v*(u*h-s*l)),t[13]=r*(l*m-h*_)-f*(n*m-i*_)+v*(n*h-i*l),t[14]=-(r*(u*m-s*_)-a*(n*m-i*_)+v*(n*s-i*u)),t[15]=r*(u*h-s*l)-a*(n*h-i*l)+f*(n*s-i*u),t}function d(t){let e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],h=t[11],d=t[12],v=t[13],_=t[14],m=t[15];return(e*a-r*o)*(l*m-h*_)-(e*u-n*o)*(f*m-h*v)+(e*s-i*o)*(f*_-l*v)+(r*u-n*a)*(c*m-h*d)-(r*s-i*a)*(c*_-l*d)+(n*s-i*u)*(c*v-f*d)}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=e[9],d=e[10],v=e[11],_=e[12],m=e[13],p=e[14],y=e[15],b=r[0],g=r[1],M=r[2],x=r[3];return t[0]=b*n+g*u+M*l+x*_,t[1]=b*i+g*s+M*h+x*m,t[2]=b*o+g*c+M*d+x*p,t[3]=b*a+g*f+M*v+x*y,b=r[4],g=r[5],M=r[6],x=r[7],t[4]=b*n+g*u+M*l+x*_,t[5]=b*i+g*s+M*h+x*m,t[6]=b*o+g*c+M*d+x*p,t[7]=b*a+g*f+M*v+x*y,b=r[8],g=r[9],M=r[10],x=r[11],t[8]=b*n+g*u+M*l+x*_,t[9]=b*i+g*s+M*h+x*m,t[10]=b*o+g*c+M*d+x*p,t[11]=b*a+g*f+M*v+x*y,b=r[12],g=r[13],M=r[14],x=r[15],t[12]=b*n+g*u+M*l+x*_,t[13]=b*i+g*s+M*h+x*m,t[14]=b*o+g*c+M*d+x*p,t[15]=b*a+g*f+M*v+x*y,t}function _(t,e,r){let n,i,o,a,u,s,c,f,l,h,d,v,_=r[0],m=r[1],p=r[2];return e===t?(t[12]=e[0]*_+e[4]*m+e[8]*p+e[12],t[13]=e[1]*_+e[5]*m+e[9]*p+e[13],t[14]=e[2]*_+e[6]*m+e[10]*p+e[14],t[15]=e[3]*_+e[7]*m+e[11]*p+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=e[9],d=e[10],v=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l,t[9]=h,t[10]=d,t[11]=v,t[12]=n*_+u*m+l*p+e[12],t[13]=i*_+s*m+h*p+e[13],t[14]=o*_+c*m+d*p+e[14],t[15]=a*_+f*m+v*p+e[15]),t}function m(t,e,r){let n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,r,i){let o,a,u,s,c,f,l,h,d,v,_,m,p,y,b,g,M,x,T,w,E,O,R,P,S=i[0],A=i[1],N=i[2],C=Math.sqrt(S*S+A*A+N*N);return Math.abs(C)<n.EPSILON?null:(S*=C=1/C,A*=C,N*=C,o=Math.sin(r),u=1-(a=Math.cos(r)),s=e[0],c=e[1],f=e[2],l=e[3],h=e[4],d=e[5],v=e[6],_=e[7],m=e[8],p=e[9],y=e[10],b=e[11],g=S*S*u+a,M=A*S*u+N*o,x=N*S*u-A*o,T=S*A*u-N*o,w=A*A*u+a,E=N*A*u+S*o,O=S*N*u+A*o,R=A*N*u-S*o,P=N*N*u+a,t[0]=s*g+h*M+m*x,t[1]=c*g+d*M+p*x,t[2]=f*g+v*M+y*x,t[3]=l*g+_*M+b*x,t[4]=s*T+h*w+m*E,t[5]=c*T+d*w+p*E,t[6]=f*T+v*w+y*E,t[7]=l*T+_*w+b*E,t[8]=s*O+h*R+m*P,t[9]=c*O+d*R+p*P,t[10]=f*O+v*R+y*P,t[11]=l*O+_*R+b*P,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function y(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*n,t[5]=a*i+f*n,t[6]=u*i+l*n,t[7]=s*i+h*n,t[8]=c*i-o*n,t[9]=f*i-a*n,t[10]=l*i-u*n,t[11]=h*i-s*n,t}function b(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],u=e[2],s=e[3],c=e[8],f=e[9],l=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*n,t[1]=a*i-f*n,t[2]=u*i-l*n,t[3]=s*i-h*n,t[8]=o*n+c*i,t[9]=a*n+f*i,t[10]=u*n+l*i,t[11]=s*n+h*i,t}function g(t,e,r){let n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],u=e[2],s=e[3],c=e[4],f=e[5],l=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*n,t[1]=a*i+f*n,t[2]=u*i+l*n,t[3]=s*i+h*n,t[4]=c*i-o*n,t[5]=f*i-a*n,t[6]=l*i-u*n,t[7]=h*i-s*n,t}function M(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function x(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,r){let i,o,a,u=r[0],s=r[1],c=r[2],f=Math.sqrt(u*u+s*s+c*c);return Math.abs(f)<n.EPSILON?null:(u*=f=1/f,s*=f,c*=f,i=Math.sin(e),a=1-(o=Math.cos(e)),t[0]=u*u*a+o,t[1]=s*u*a+c*i,t[2]=c*u*a-s*i,t[3]=0,t[4]=u*s*a-c*i,t[5]=s*s*a+o,t[6]=c*s*a+u*i,t[7]=0,t[8]=u*c*a+s*i,t[9]=s*c*a-u*i,t[10]=c*c*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function w(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function O(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=n+n,s=i+i,c=o+o,f=n*u,l=n*s,h=n*c,d=i*s,v=i*c,_=o*c,m=a*u,p=a*s,y=a*c;return t[0]=1-(d+_),t[1]=l+y,t[2]=h-p,t[3]=0,t[4]=l-y,t[5]=1-(f+_),t[6]=v+m,t[7]=0,t[8]=h+p,t[9]=v-m,t[10]=1-(f+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function P(t,e){let r=new n.ARRAY_TYPE(3),i=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=i*i+o*o+a*a+u*u;return h>0?(r[0]=2*(s*u+l*i+c*a-f*o)/h,r[1]=2*(c*u+l*o+f*i-s*a)/h,r[2]=2*(f*u+l*a+s*o-c*i)/h):(r[0]=2*(s*u+l*i+c*a-f*o),r[1]=2*(c*u+l*o+f*i-s*a),r[2]=2*(f*u+l*a+s*o-c*i)),R(t,e,r),t}function S(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function A(t,e){let r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],u=e[6],s=e[8],c=e[9],f=e[10];return t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+a*a+u*u),t[2]=Math.sqrt(s*s+c*c+f*f),t}function N(t,e){let r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t}function C(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=e[3],s=i+i,c=o+o,f=a+a,l=i*s,h=i*c,d=i*f,v=o*c,_=o*f,m=a*f,p=u*s,y=u*c,b=u*f,g=n[0],M=n[1],x=n[2];return t[0]=(1-(v+m))*g,t[1]=(h+b)*g,t[2]=(d-y)*g,t[3]=0,t[4]=(h-b)*M,t[5]=(1-(l+m))*M,t[6]=(_+p)*M,t[7]=0,t[8]=(d+y)*x,t[9]=(_-p)*x,t[10]=(1-(l+v))*x,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function I(t,e,r,n,i){let o=e[0],a=e[1],u=e[2],s=e[3],c=o+o,f=a+a,l=u+u,h=o*c,d=o*f,v=o*l,_=a*f,m=a*l,p=u*l,y=s*c,b=s*f,g=s*l,M=n[0],x=n[1],T=n[2],w=i[0],E=i[1],O=i[2],R=(1-(_+p))*M,P=(d+g)*M,S=(v-b)*M,A=(d-g)*x,N=(1-(h+p))*x,C=(m+y)*x,I=(v+b)*T,k=(m-y)*T,L=(1-(h+_))*T;return t[0]=R,t[1]=P,t[2]=S,t[3]=0,t[4]=A,t[5]=N,t[6]=C,t[7]=0,t[8]=I,t[9]=k,t[10]=L,t[11]=0,t[12]=r[0]+w-(R*w+A*E+I*O),t[13]=r[1]+E-(P*w+N*E+k*O),t[14]=r[2]+O-(S*w+C*E+L*O),t[15]=1,t}function k(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,u=n+n,s=i+i,c=r*a,f=n*a,l=n*u,h=i*a,d=i*u,v=i*s,_=o*a,m=o*u,p=o*s;return t[0]=1-l-v,t[1]=f+p,t[2]=h-m,t[3]=0,t[4]=f-p,t[5]=1-c-v,t[6]=d+_,t[7]=0,t[8]=h+m,t[9]=d-_,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e,r,n,i,o,a){let u=1/(r-e),s=1/(i-n),c=1/(o-a);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*s,t[6]=0,t[7]=0,t[8]=(r+e)*u,t[9]=(i+n)*s,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function F(t,e,r,n,i){let o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t}function D(t,e,r,n){let i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),u=Math.tan(e.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(i+o);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-u)*s*.5,t[9]=(i-o)*c*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function B(t,e,r,n,i,o,a){let u=1/(e-r),s=1/(n-i),c=1/(o-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*u,t[13]=(i+n)*s,t[14]=(a+o)*c,t[15]=1,t}function j(t,e,r,i){let o,a,u,s,f,l,h,d,v,_,m=e[0],p=e[1],y=e[2],b=i[0],g=i[1],M=i[2],x=r[0],T=r[1],w=r[2];return Math.abs(m-x)<n.EPSILON&&Math.abs(p-T)<n.EPSILON&&Math.abs(y-w)<n.EPSILON?c(t):(h=m-x,d=p-T,v=y-w,o=g*(v*=_=1/Math.sqrt(h*h+d*d+v*v))-M*(d*=_),a=M*(h*=_)-b*v,u=b*d-g*h,(_=Math.sqrt(o*o+a*a+u*u))?(o*=_=1/_,a*=_,u*=_):(o=0,a=0,u=0),s=d*u-v*a,f=v*o-h*u,l=h*a-d*o,(_=Math.sqrt(s*s+f*f+l*l))?(s*=_=1/_,f*=_,l*=_):(s=0,f=0,l=0),t[0]=o,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=f,t[6]=d,t[7]=0,t[8]=u,t[9]=l,t[10]=v,t[11]=0,t[12]=-(o*m+a*p+u*y),t[13]=-(s*m+f*p+l*y),t[14]=-(h*m+d*p+v*y),t[15]=1,t)}function U(t,e,r,n){let i=e[0],o=e[1],a=e[2],u=n[0],s=n[1],c=n[2],f=i-r[0],l=o-r[1],h=a-r[2],d=f*f+l*l+h*h;d>0&&(f*=d=1/Math.sqrt(d),l*=d,h*=d);let v=s*h-c*l,_=c*f-u*h,m=u*l-s*f;return(d=v*v+_*_+m*m)>0&&(v*=d=1/Math.sqrt(d),_*=d,m*=d),t[0]=v,t[1]=_,t[2]=m,t[3]=0,t[4]=l*m-h*_,t[5]=h*v-f*m,t[6]=f*_-l*v,t[7]=0,t[8]=f,t[9]=l,t[10]=h,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function V(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Y(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function G(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function H(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function q(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function X(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function W(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function K(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],h=t[9],d=t[10],v=t[11],_=t[12],m=t[13],p=t[14],y=t[15],b=e[0],g=e[1],M=e[2],x=e[3],T=e[4],w=e[5],E=e[6],O=e[7],R=e[8],P=e[9],S=e[10],A=e[11],N=e[12],C=e[13],I=e[14],k=e[15];return Math.abs(r-b)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-g)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(o-M)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-x)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-T)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(s-w)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(c-E)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(f-O)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(l-R)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(h-P)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-S)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(v-A)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(A))&&Math.abs(_-N)<=n.EPSILON*Math.max(1,Math.abs(_),Math.abs(N))&&Math.abs(m-C)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(p-I)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(y-k)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))}const z=v,Q=H},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=e.RenderTexture=e.RenderView=e.ATTRIB_MASK=e.ATTRIB=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.createWebGLContext=p;var i=r(3),o=r(2),a=r(29),u=r(8),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var f=e.ATTRIB={POSITION:1,NORMAL:2,TANGENT:3,TEXCOORD_0:4,TEXCOORD_1:5,COLOR_0:6},l=e.ATTRIB_MASK={POSITION:1,NORMAL:2,TANGENT:4,TEXCOORD_0:8,TEXCOORD_1:16,COLOR_0:32},h=WebGLRenderingContext,d=new Float32Array([-.1,-1,-.2]),v=new Float32Array([3,3,3]),_=new RegExp("precision (lowp|mediump|highp) float;");function m(t){return 0==(t&t-1)}function p(t){t=t||{alpha:!1};var e=document.createElement("canvas"),r=t.webgl2?["webgl2"]:["webgl","experimental-webgl"],n=null,i=!0,o=!1,a=void 0;try{for(var u,s=r[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;if(n=e.getContext(c,t))break}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}if(!n){var f=t.webgl2?"WebGL 2":"WebGL";return console.error("This browser does not support "+f+"."),null}return n}e.RenderView=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";c(this,t),this.projectionMatrix=e,this.viewMatrix=r,this.viewport=n,this._eye=i,this._eyeIndex="left"==i?0:1}return n(t,[{key:"eye",get:function(){return this._eye},set:function(t){this._eye=t,this._eyeIndex="left"==t?0:1}},{key:"eyeIndex",get:function(){return this._eyeIndex}}]),t}();var y=function(){function t(e,r,n){var i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c(this,t),this._target=e,this._usage=r,this._length=o,n instanceof Promise?(this._buffer=null,this._promise=n.then(function(t){return i._buffer=t,i})):(this._buffer=n,this._promise=Promise.resolve(this))}return n(t,[{key:"waitForComplete",value:function(){return this._promise}}]),t}(),b=function t(e){c(this,t),this._attrib_index=f[e.name],this._componentCount=e.componentCount,this._componentType=e.componentType,this._stride=e.stride,this._byteOffset=e.byteOffset,this._normalized=e.normalized},g=function t(e){c(this,t),this._buffer=e,this._attributes=[]},M=function(){function t(e){c(this,t),this._activeFrameId=0,this._instances=[],this._material=null,this.setPrimitive(e)}return n(t,[{key:"setPrimitive",value:function(t){this._mode=t.mode,this._elementCount=t.elementCount,this._promise=null,this._vao=null,this._complete=!1,this._attributeBuffers=[],this._attributeMask=0;var e=!0,r=!1,n=void 0;try{for(var i,o=t.attributes[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._attributeMask|=l[a.name];var u=new b(a),c=!1,f=!0,h=!1,d=void 0;try{for(var v,_=this._attributeBuffers[Symbol.iterator]();!(f=(v=_.next()).done);f=!0){var m=v.value;if(m._buffer==a.buffer){m._attributes.push(u),c=!0;break}}}catch(t){h=!0,d=t}finally{try{!f&&_.return&&_.return()}finally{if(h)throw d}}if(!c){var p=new g(a.buffer);p._attributes.push(u),this._attributeBuffers.push(p)}}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._indexBuffer=null,this._indexByteOffset=0,this._indexType=0,t.indexBuffer&&(this._indexByteOffset=t.indexByteOffset,this._indexType=t.indexType,this._indexBuffer=t.indexBuffer),t._min?(this._min=s.vec3.clone(t._min),this._max=s.vec3.clone(t._max)):(this._min=null,this._max=null),null!=this._material&&this.waitForComplete()}},{key:"setRenderMaterial",value:function(t){this._material=t,this._promise=null,this._complete=!1,null!=this._material&&this.waitForComplete()}},{key:"markActive",value:function(t){if(this._complete&&this._activeFrameId!=t){if(this._material&&!this._material.markActive(t))return;this._activeFrameId=t}}},{key:"waitForComplete",value:function(){var t=this;if(!this._promise){if(!this._material)return Promise.reject("RenderPrimitive does not have a material");var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=this._attributeBuffers[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;u._buffer._buffer||e.push(u._buffer._promise)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this._indexBuffer&&!this._indexBuffer._buffer&&e.push(this._indexBuffer._promise),this._promise=Promise.all(e).then(function(){return t._complete=!0,t})}return this._promise}},{key:"samplers",get:function(){return this._material._samplerDictionary}},{key:"uniforms",get:function(){return this._material._uniform_dictionary}}]),t}(),x=e.RenderTexture=function(){function t(e){c(this,t),this._texture=e,this._complete=!1,this._activeFrameId=0,this._activeCallback=null}return n(t,[{key:"markActive",value:function(t){this._activeCallback&&this._activeFrameId!=t&&(this._activeFrameId=t,this._activeCallback(this))}}]),t}(),T=s.mat4.create();function w(t,e,r,n,i){var o=(i&r)-(n&r);o&&(o>0?t.enable(e):t.disable(e))}var E=function(){function t(e,r,n){c(this,t),this._renderer=e,this._uniformName=r._uniformName,this._renderTexture=e._getRenderTexture(r._texture),this._index=n}return n(t,[{key:"texture",set:function(t){this._renderTexture=this._renderer._getRenderTexture(t)}}]),t}(),O=function(){function t(e){c(this,t),this._uniformName=e._uniformName,this._uniform=null,this._length=e._length,e._value instanceof Array?this._value=new Float32Array(e._value):this._value=new Float32Array([e._value])}return n(t,[{key:"value",set:function(t){if(1==this._value.length)this._value[0]=t;else for(var e=0;e<this._value.length;++e)this._value[e]=t[e]}}]),t}(),R=function(){function t(e,r,n){c(this,t),this._program=n,this._state=r.state._state,this._activeFrameId=0,this._completeForActiveFrame=!1,this._samplerDictionary={},this._samplers=[];for(var o=0;o<r._samplers.length;++o){var a=new E(e,r._samplers[o],o);this._samplers.push(a),this._samplerDictionary[a._uniformName]=a}this._uniform_dictionary={},this._uniforms=[];var u=!0,s=!1,f=void 0;try{for(var l,h=r._uniforms[Symbol.iterator]();!(u=(l=h.next()).done);u=!0){var d=l.value,v=new O(d);this._uniforms.push(v),this._uniform_dictionary[v._uniformName]=v}}catch(t){s=!0,f=t}finally{try{!u&&h.return&&h.return()}finally{if(s)throw f}}this._firstBind=!0,this._renderOrder=r.renderOrder,this._renderOrder==i.RENDER_ORDER.DEFAULT&&(this._state&i.CAP.BLEND?this._renderOrder=i.RENDER_ORDER.TRANSPARENT:this._renderOrder=i.RENDER_ORDER.OPAQUE)}return n(t,[{key:"bind",value:function(t){if(this._firstBind){for(var e=0;e<this._samplers.length;){var r=this._samplers[e];this._program.uniform[r._uniformName]?++e:this._samplers.splice(e,1)}for(var n=0;n<this._uniforms.length;){var i=this._uniforms[n];i._uniform=this._program.uniform[i._uniformName],i._uniform?++n:this._uniforms.splice(n,1)}this._firstBind=!1}var o=!0,a=!1,u=void 0;try{for(var s,c=this._samplers[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var f=s.value;t.activeTexture(t.TEXTURE0+f._index),f._renderTexture&&f._renderTexture._complete?t.bindTexture(t.TEXTURE_2D,f._renderTexture._texture):t.bindTexture(t.TEXTURE_2D,null)}}catch(t){a=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw u}}var l=!0,h=!1,d=void 0;try{for(var v,_=this._uniforms[Symbol.iterator]();!(l=(v=_.next()).done);l=!0){var m=v.value;switch(m._length){case 1:t.uniform1fv(m._uniform,m._value);break;case 2:t.uniform2fv(m._uniform,m._value);break;case 3:t.uniform3fv(m._uniform,m._value);break;case 4:t.uniform4fv(m._uniform,m._value)}}}catch(t){h=!0,d=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw d}}}},{key:"markActive",value:function(t){if(this._activeFrameId!=t){this._activeFrameId=t,this._completeForActiveFrame=!0;for(var e=0;e<this._samplers.length;++e){var r=this._samplers[e];if(r._renderTexture){if(!r._renderTexture._complete){this._completeForActiveFrame=!1;break}r._renderTexture.markActive(t)}}}return this._completeForActiveFrame}},{key:"_capsDiff",value:function(t){return t&i.MAT_STATE.CAPS_RANGE^this._state&i.MAT_STATE.CAPS_RANGE}},{key:"_blendDiff",value:function(t){return this._state&i.CAP.BLEND?t&i.MAT_STATE.BLEND_FUNC_RANGE^this._state&i.MAT_STATE.BLEND_FUNC_RANGE:0}},{key:"_depthFuncDiff",value:function(t){return this._state&i.CAP.DEPTH_TEST?t&i.MAT_STATE.DEPTH_FUNC_RANGE^this._state&i.MAT_STATE.DEPTH_FUNC_RANGE:0}},{key:"cullFace",get:function(){return!!(this._state&i.CAP.CULL_FACE)}},{key:"blend",get:function(){return!!(this._state&i.CAP.BLEND)}},{key:"depthTest",get:function(){return!!(this._state&i.CAP.DEPTH_TEST)}},{key:"stencilTest",get:function(){return!!(this._state&i.CAP.STENCIL_TEST)}},{key:"colorMask",get:function(){return!!(this._state&i.CAP.COLOR_MASK)}},{key:"depthMask",get:function(){return!!(this._state&i.CAP.DEPTH_MASK)}},{key:"stencilMask",get:function(){return!!(this._state&i.CAP.STENCIL_MASK)}},{key:"depthFunc",get:function(){return((this._state&i.MAT_STATE.DEPTH_FUNC_RANGE)>>i.MAT_STATE.DEPTH_FUNC_SHIFT)+h.NEVER}},{key:"blendFuncSrc",get:function(){return(0,i.stateToBlendFunc)(this._state,i.MAT_STATE.BLEND_SRC_RANGE,i.MAT_STATE.BLEND_SRC_SHIFT)}},{key:"blendFuncDst",get:function(){return(0,i.stateToBlendFunc)(this._state,i.MAT_STATE.BLEND_DST_RANGE,i.MAT_STATE.BLEND_DST_SHIFT)}}]),t}();e.Renderer=function(){function t(e){c(this,t),this._gl=e||p(),this._frameId=0,this._programCache={},this._textureCache={},this._renderPrimitives=Array(i.RENDER_ORDER.DEFAULT),this._cameraPositions=[],this._vaoExt=e.getExtension("OES_vertex_array_object");var r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);this._defaultFragPrecision=r.precision>0?"highp":"mediump",this._depthMaskNeedsReset=!1,this._colorMaskNeedsReset=!1,this._globalLightColor=s.vec3.clone(v),this._globalLightDir=s.vec3.clone(d)}return n(t,[{key:"createRenderBuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h.STATIC_DRAW,n=this._gl,i=n.createBuffer();if(e instanceof Promise){var o=new y(t,r,e.then(function(e){return n.bindBuffer(t,i),n.bufferData(t,e,r),o._length=e.byteLength,i}));return o}return n.bindBuffer(t,i),n.bufferData(t,e,r),new y(t,r,i,e.byteLength)}},{key:"updateRenderBuffer",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t._buffer){var i=this._gl;i.bindBuffer(t._target,t._buffer),0==n&&t._length==e.byteLength?i.bufferData(t._target,e,t._usage):i.bufferSubData(t._target,n,e)}else t.waitForComplete().then(function(t){r.updateRenderBuffer(t,e,n)})}},{key:"createRenderPrimitive",value:function(t,e){var r=new M(t),n=this._getMaterialProgram(e,r),i=new R(this,e,n);return r.setRenderMaterial(i),this._renderPrimitives[i._renderOrder]||(this._renderPrimitives[i._renderOrder]=[]),this._renderPrimitives[i._renderOrder].push(r),r}},{key:"createMesh",value:function(t,e){var r=new o.Node;return r.addRenderPrimitive(this.createRenderPrimitive(t,e)),r}},{key:"drawViews",value:function(t,e){if(e){var r=this._gl;if(this._frameId++,e.markActive(this._frameId),1==t.length&&t[0].viewport){var n=t[0].viewport;this._gl.viewport(n.x,n.y,n.width,n.height)}for(var i=0;i<t.length;++i){s.mat4.invert(T,t[i].viewMatrix),this._cameraPositions.length<=i&&this._cameraPositions.push(s.vec3.create());var o=this._cameraPositions[i];s.vec3.set(o,0,0,0),s.vec3.transformMat4(o,o,T)}var a=!0,u=!1,c=void 0;try{for(var f,l=this._renderPrimitives[Symbol.iterator]();!(a=(f=l.next()).done);a=!0){var h=f.value;h&&h.length&&this._drawRenderPrimitiveSet(t,h)}}catch(t){u=!0,c=t}finally{try{!a&&l.return&&l.return()}finally{if(u)throw c}}this._vaoExt&&this._vaoExt.bindVertexArrayOES(null),this._depthMaskNeedsReset&&r.depthMask(!0),this._colorMaskNeedsReset&&r.colorMask(!0,!0,!0,!0)}}},{key:"_drawRenderPrimitiveSet",value:function(t,e){var r=this._gl,n=null,i=null,o=0,a=!0,u=!1,s=void 0;try{for(var c,f=e[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;if(l._activeFrameId==this._frameId){n!=l._material._program&&((n=l._material._program).use(),n.uniform.LIGHT_DIRECTION&&r.uniform3fv(n.uniform.LIGHT_DIRECTION,this._globalLightDir),n.uniform.LIGHT_COLOR&&r.uniform3fv(n.uniform.LIGHT_COLOR,this._globalLightColor),1==t.length&&(r.uniformMatrix4fv(n.uniform.PROJECTION_MATRIX,!1,t[0].projectionMatrix),r.uniformMatrix4fv(n.uniform.VIEW_MATRIX,!1,t[0].viewMatrix),r.uniform3fv(n.uniform.CAMERA_POSITION,this._cameraPositions[0]),r.uniform1i(n.uniform.EYE_INDEX,t[0].eyeIndex))),i!=l._material&&(this._bindMaterialState(l._material,i),l._material.bind(r,n,i),i=l._material),this._vaoExt?l._vao?this._vaoExt.bindVertexArrayOES(l._vao):(l._vao=this._vaoExt.createVertexArrayOES(),this._vaoExt.bindVertexArrayOES(l._vao),this._bindPrimitive(l)):(this._bindPrimitive(l,o),o=l._attributeMask);for(var h=0;h<t.length;++h){var d=t[h];if(t.length>1){if(d.viewport){var v=d.viewport;r.viewport(v.x,v.y,v.width,v.height)}r.uniformMatrix4fv(n.uniform.PROJECTION_MATRIX,!1,d.projectionMatrix),r.uniformMatrix4fv(n.uniform.VIEW_MATRIX,!1,d.viewMatrix),r.uniform3fv(n.uniform.CAMERA_POSITION,this._cameraPositions[h]),r.uniform1i(n.uniform.EYE_INDEX,d.eyeIndex)}var _=!0,m=!1,p=void 0;try{for(var y,b=l._instances[Symbol.iterator]();!(_=(y=b.next()).done);_=!0){var g=y.value;g._activeFrameId==this._frameId&&(r.uniformMatrix4fv(n.uniform.MODEL_MATRIX,!1,g.worldMatrix),l._indexBuffer?r.drawElements(l._mode,l._elementCount,l._indexType,l._indexByteOffset):r.drawArrays(l._mode,0,l._elementCount))}}catch(t){m=!0,p=t}finally{try{!_&&b.return&&b.return()}finally{if(m)throw p}}}}}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}},{key:"_getRenderTexture",value:function(t){var e=this;if(!t)return null;var r=t.textureKey;if(!r)throw new Error("Texure does not have a valid key");if(r in this._textureCache)return this._textureCache[r];var n=this._gl,i=n.createTexture(),o=new x(i);return this._textureCache[r]=o,t instanceof u.DataTexture?(n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.width,t.height,0,t.format,t._type,t._data),this._setSamplerParameters(t),o._complete=!0):t.waitForComplete().then(function(){n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.format,n.UNSIGNED_BYTE,t.source),e._setSamplerParameters(t),o._complete=!0,t instanceof u.VideoTexture&&t._video.addEventListener("playing",function(){o._activeCallback=function(){t._video.paused||t._video.waiting||(n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,t.format,t.format,n.UNSIGNED_BYTE,t.source))}})}),o}},{key:"_setSamplerParameters",value:function(t){var e=this._gl,r=t.sampler,n=m(t.width)&&m(t.height),i=n&&t.mipmap;i&&e.generateMipmap(e.TEXTURE_2D);var o=r.minFilter||(i?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),a=r.wrapS||(n?e.REPEAT:e.CLAMP_TO_EDGE),u=r.wrapT||(n?e.REPEAT:e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,u)}},{key:"_getProgramKey",value:function(t,e){var r=t+":";for(var n in e)r+=n+"="+e[n]+",";return r}},{key:"_getMaterialProgram",value:function(t,e){var r=this,n=t.materialName,i=t.vertexSource,o=t.fragmentSource;if(null==n)throw new Error("Material does not have a name");if(null==i)throw new Error('Material "'+n+'" does not have a vertex source');if(null==o)throw new Error('Material "'+n+'" does not have a fragment source');var u=t.getProgramDefines(e),s=this._getProgramKey(n,u);if(s in this._programCache)return this._programCache[s];var c=i;c+="\nuniform mat4 PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX;\n\nvoid main() {\n  gl_Position = vertex_main(PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX);\n}\n";var l=(o.match(_)?"":"precision "+this._defaultFragPrecision+" float;\n")+o;l+="\nvoid main() {\n  gl_FragColor = fragment_main();\n}\n";var h=new a.Program(this._gl,c,l,f,u);return this._programCache[s]=h,h.onNextUse(function(e){for(var n=0;n<t._samplers.length;++n){var i=t._samplers[n],o=e.uniform[i._uniformName];o&&r._gl.uniform1i(o,n)}}),h}},{key:"_bindPrimitive",value:function(t,e){var r=this._gl;if(e!=t._attributeMask)for(var n in f)t._attributeMask&l[n]?r.enableVertexAttribArray(f[n]):r.disableVertexAttribArray(f[n]);var i=!0,o=!1,a=void 0;try{for(var u,s=t._attributeBuffers[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var c=u.value;r.bindBuffer(r.ARRAY_BUFFER,c._buffer._buffer);var h=!0,d=!1,v=void 0;try{for(var _,m=c._attributes[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=_.value;r.vertexAttribPointer(p._attrib_index,p._componentCount,p._componentType,p._normalized,p._stride,p._byteOffset)}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}}}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}t._indexBuffer?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._indexBuffer._buffer):r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)}},{key:"_bindMaterialState",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._gl,n=t._state,o=e?e._state:~n;if(n!=o){if(t._capsDiff(o)){w(r,r.CULL_FACE,i.CAP.CULL_FACE,o,n),w(r,r.BLEND,i.CAP.BLEND,o,n),w(r,r.DEPTH_TEST,i.CAP.DEPTH_TEST,o,n),w(r,r.STENCIL_TEST,i.CAP.STENCIL_TEST,o,n);var a=(n&i.CAP.COLOR_MASK)-(o&i.CAP.COLOR_MASK);if(a){var u=a>1;this._colorMaskNeedsReset=!u,r.colorMask(u,u,u,u)}var s=(n&i.CAP.DEPTH_MASK)-(o&i.CAP.DEPTH_MASK);s&&(this._depthMaskNeedsReset=!(s>1),r.depthMask(s>1));var c=(n&i.CAP.STENCIL_MASK)-(o&i.CAP.STENCIL_MASK);c&&r.stencilMask(c>1)}t._blendDiff(o)&&r.blendFunc(t.blendFuncSrc,t.blendFuncDst),t._depthFuncDiff(o)&&r.depthFunc(t.depthFunc)}}},{key:"gl",get:function(){return this._gl}},{key:"globalLightColor",set:function(t){s.vec3.copy(this._globalLightColor,t)},get:function(){return s.vec3.clone(this._globalLightColor)}},{key:"globalLightDir",set:function(t){s.vec3.copy(this._globalLightDir,t)},get:function(){return s.vec3.clone(this._globalLightDir)}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"fromMat4",function(){return o}),r.d(e,"clone",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"identity",function(){return f}),r.d(e,"transpose",function(){return l}),r.d(e,"invert",function(){return h}),r.d(e,"adjoint",function(){return d}),r.d(e,"determinant",function(){return v}),r.d(e,"multiply",function(){return _}),r.d(e,"translate",function(){return m}),r.d(e,"rotate",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"fromTranslation",function(){return b}),r.d(e,"fromRotation",function(){return g}),r.d(e,"fromScaling",function(){return M}),r.d(e,"fromMat2d",function(){return x}),r.d(e,"fromQuat",function(){return T}),r.d(e,"normalFromMat4",function(){return w}),r.d(e,"projection",function(){return E}),r.d(e,"str",function(){return O}),r.d(e,"frob",function(){return R}),r.d(e,"add",function(){return P}),r.d(e,"subtract",function(){return S}),r.d(e,"multiplyScalar",function(){return A}),r.d(e,"multiplyScalarAndAdd",function(){return N}),r.d(e,"exactEquals",function(){return C}),r.d(e,"equals",function(){return I}),r.d(e,"mul",function(){return k}),r.d(e,"sub",function(){return L});var n=r(0);function i(){let t=new n.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function a(t){let e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(t,e,r,i,o,a,u,s,c){let f=new n.ARRAY_TYPE(9);return f[0]=t,f[1]=e,f[2]=r,f[3]=i,f[4]=o,f[5]=a,f[6]=u,f[7]=s,f[8]=c,f}function c(t,e,r,n,i,o,a,u,s,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t}function f(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function l(t,e){if(t===e){let r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function h(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=f*a-u*c,h=-f*o+u*s,d=c*o-a*s,v=r*l+n*h+i*d;return v?(v=1/v,t[0]=l*v,t[1]=(-f*n+i*c)*v,t[2]=(u*n-i*a)*v,t[3]=h*v,t[4]=(f*r-i*s)*v,t[5]=(-u*r+i*o)*v,t[6]=d*v,t[7]=(-c*r+n*s)*v,t[8]=(a*r-n*o)*v,t):null}function d(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8];return t[0]=a*f-u*c,t[1]=i*c-n*f,t[2]=n*u-i*a,t[3]=u*s-o*f,t[4]=r*f-i*s,t[5]=i*o-r*u,t[6]=o*c-a*s,t[7]=n*s-r*c,t[8]=r*a-n*o,t}function v(t){let e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],u=t[6],s=t[7],c=t[8];return e*(c*o-a*s)+r*(-c*i+a*u)+n*(s*i-o*u)}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=r[0],d=r[1],v=r[2],_=r[3],m=r[4],p=r[5],y=r[6],b=r[7],g=r[8];return t[0]=h*n+d*a+v*c,t[1]=h*i+d*u+v*f,t[2]=h*o+d*s+v*l,t[3]=_*n+m*a+p*c,t[4]=_*i+m*u+p*f,t[5]=_*o+m*s+p*l,t[6]=y*n+b*a+g*c,t[7]=y*i+b*u+g*f,t[8]=y*o+b*s+g*l,t}function m(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=u,t[5]=s,t[6]=h*n+d*a+c,t[7]=h*i+d*u+f,t[8]=h*o+d*s+l,t}function p(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],h=Math.sin(r),d=Math.cos(r);return t[0]=d*n+h*a,t[1]=d*i+h*u,t[2]=d*o+h*s,t[3]=d*a-h*n,t[4]=d*u-h*i,t[5]=d*s-h*o,t[6]=c,t[7]=f,t[8]=l,t}function y(t,e,r){let n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function g(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function M(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function T(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,u=n+n,s=i+i,c=r*a,f=n*a,l=n*u,h=i*a,d=i*u,v=i*s,_=o*a,m=o*u,p=o*s;return t[0]=1-l-v,t[3]=f-p,t[6]=h+m,t[1]=f+p,t[4]=1-c-v,t[7]=d-_,t[2]=h-m,t[5]=d+_,t[8]=1-c-l,t}function w(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=e[6],c=e[7],f=e[8],l=e[9],h=e[10],d=e[11],v=e[12],_=e[13],m=e[14],p=e[15],y=r*u-n*a,b=r*s-i*a,g=r*c-o*a,M=n*s-i*u,x=n*c-o*u,T=i*c-o*s,w=f*_-l*v,E=f*m-h*v,O=f*p-d*v,R=l*m-h*_,P=l*p-d*_,S=h*p-d*m,A=y*S-b*P+g*R+M*O-x*E+T*w;return A?(A=1/A,t[0]=(u*S-s*P+c*R)*A,t[1]=(s*O-a*S-c*E)*A,t[2]=(a*P-u*O+c*w)*A,t[3]=(i*P-n*S-o*R)*A,t[4]=(r*S-i*O+o*E)*A,t[5]=(n*O-r*P-o*w)*A,t[6]=(_*T-m*x+p*M)*A,t[7]=(m*g-v*T-p*b)*A,t[8]=(v*x-_*g+p*y)*A,t):null}function E(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function O(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function R(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function P(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function S(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function A(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function N(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function C(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function I(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],h=e[0],d=e[1],v=e[2],_=e[3],m=e[4],p=e[5],y=e[6],b=e[7],g=e[8];return Math.abs(r-h)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-d)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(a-_)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(u-m)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(s-p)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(c-y)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-b)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(b))&&Math.abs(l-g)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))}const k=_,L=S},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PbrMaterial=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(11);e.PbrMaterial=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.baseColor=t.defineSampler("baseColorTex"),t.metallicRoughness=t.defineSampler("metallicRoughnessTex"),t.normal=t.defineSampler("normalTex"),t.occlusion=t.defineSampler("occlusionTex"),t.emissive=t.defineSampler("emissiveTex"),t.baseColorFactor=t.defineUniform("baseColorFactor",[1,1,1,1]),t.metallicRoughnessFactor=t.defineUniform("metallicRoughnessFactor",[1,1]),t.occlusionStrength=t.defineUniform("occlusionStrength",1),t.emissiveFactor=t.defineUniform("emissiveFactor",[0,0,0]),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.Material),n(e,[{key:"getProgramDefines",value:function(t){var e={};return t._attributeMask&o.ATTRIB_MASK.COLOR_0&&(e.USE_VERTEX_COLOR=1),t._attributeMask&o.ATTRIB_MASK.TEXCOORD_0&&(this.baseColor.texture&&(e.USE_BASE_COLOR_MAP=1),this.normal.texture&&t._attributeMask&o.ATTRIB_MASK.TANGENT&&(e.USE_NORMAL_MAP=1),this.metallicRoughness.texture&&(e.USE_METAL_ROUGH_MAP=1),this.occlusion.texture&&(e.USE_OCCLUSION=1),this.emissive.texture&&(e.USE_EMISSIVE_TEXTURE=1)),this.metallicRoughness.texture&&t._attributeMask&o.ATTRIB_MASK.TEXCOORD_0||1!=this.metallicRoughnessFactor.value[1]||(e.FULLY_ROUGH=1),e}},{key:"materialName",get:function(){return"PBR"}},{key:"vertexSource",get:function(){return"\nattribute vec3 POSITION, NORMAL;\nattribute vec2 TEXCOORD_0, TEXCOORD_1;\n\nuniform vec3 CAMERA_POSITION;\nuniform vec3 LIGHT_DIRECTION;\n\nvarying vec3 vLight; // Vector from vertex to light.\nvarying vec3 vView; // Vector from vertex to camera.\nvarying vec2 vTex;\n\n#ifdef USE_NORMAL_MAP\nattribute vec4 TANGENT;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_VERTEX_COLOR\nattribute vec4 COLOR_0;\nvarying vec4 vCol;\n#endif\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vec3 n = normalize(vec3(model * vec4(NORMAL, 0.0)));\n#ifdef USE_NORMAL_MAP\n  vec3 t = normalize(vec3(model * vec4(TANGENT.xyz, 0.0)));\n  vec3 b = cross(n, t) * TANGENT.w;\n  vTBN = mat3(t, b, n);\n#else\n  vNorm = n;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  vCol = COLOR_0;\n#endif\n\n  vTex = TEXCOORD_0;\n  vec4 mPos = model * vec4(POSITION, 1.0);\n  vLight = -LIGHT_DIRECTION;\n  vView = CAMERA_POSITION - mPos.xyz;\n  return proj * view * mPos;\n}"}},{key:"fragmentSource",get:function(){return"\n#define M_PI 3.14159265\n\nuniform vec4 baseColorFactor;\n#ifdef USE_BASE_COLOR_MAP\nuniform sampler2D baseColorTex;\n#endif\n\nvarying vec3 vLight;\nvarying vec3 vView;\nvarying vec2 vTex;\n\n#ifdef USE_VERTEX_COLOR\nvarying vec4 vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\nuniform sampler2D normalTex;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_METAL_ROUGH_MAP\nuniform sampler2D metallicRoughnessTex;\n#endif\nuniform vec2 metallicRoughnessFactor;\n\n#ifdef USE_OCCLUSION\nuniform sampler2D occlusionTex;\nuniform float occlusionStrength;\n#endif\n\n#ifdef USE_EMISSIVE_TEXTURE\nuniform sampler2D emissiveTex;\n#endif\nuniform vec3 emissiveFactor;\n\nuniform vec3 LIGHT_COLOR;\n\nconst vec3 dielectricSpec = vec3(0.04);\nconst vec3 black = vec3(0.0);\n\n\nvec3 lambertDiffuse(vec3 cDiff) {\n  return cDiff / M_PI;\n}\n\nfloat specD(float a, float nDotH) {\n  float aSqr = a * a;\n  float f = ((nDotH * nDotH) * (aSqr - 1.0) + 1.0);\n  return aSqr / (M_PI * f * f);\n}\n\nfloat specG(float roughness, float nDotL, float nDotV) {\n  float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n  float gl = nDotL / (nDotL * (1.0 - k) + k);\n  float gv = nDotV / (nDotV * (1.0 - k) + k);\n  return gl * gv;\n}\n\nvec3 specF(float vDotH, vec3 F0) {\n  float exponent = (-5.55473 * vDotH - 6.98316) * vDotH;\n  float base = 2.0;\n  return F0 + (1.0 - F0) * pow(base, exponent);\n}\n\nvec4 fragment_main() {\n#ifdef USE_BASE_COLOR_MAP\n  vec4 baseColor = texture2D(baseColorTex, vTex) * baseColorFactor;\n#else\n  vec4 baseColor = baseColorFactor;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  baseColor *= vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\n  vec3 n = texture2D(normalTex, vTex).rgb;\n  n = normalize(vTBN * (2.0 * n - 1.0));\n#else\n  vec3 n = normalize(vNorm);\n#endif\n\n#ifdef FULLY_ROUGH\n  float metallic = 0.0;\n#else\n  float metallic = metallicRoughnessFactor.x;\n#endif\n\n  float roughness = metallicRoughnessFactor.y;\n\n#ifdef USE_METAL_ROUGH_MAP\n  vec4 metallicRoughness = texture2D(metallicRoughnessTex, vTex);\n  metallic *= metallicRoughness.b;\n  roughness *= metallicRoughness.g;\n#endif\n  \n  vec3 l = normalize(vLight);\n  vec3 v = normalize(vView);\n  vec3 h = normalize(l+v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = abs(dot(n, v)) + 0.001;\n  float nDotH = max(dot(n, h), 0.0);\n  float vDotH = max(dot(v, h), 0.0);\n\n  // From GLTF Spec\n  vec3 cDiff = mix(baseColor.rgb * (1.0 - dielectricSpec.r), black, metallic); // Diffuse color\n  vec3 F0 = mix(dielectricSpec, baseColor.rgb, metallic); // Specular color\n  float a = roughness * roughness;\n\n#ifdef FULLY_ROUGH\n  vec3 specular = F0 * 0.45;\n#else\n  vec3 F = specF(vDotH, F0);\n  float D = specD(a, nDotH);\n  float G = specG(roughness, nDotL, nDotV);\n  vec3 specular = (D * F * G) / (4.0 * nDotL * nDotV);\n#endif\n  float halfLambert = dot(n, l) * 0.5 + 0.5;\n  halfLambert *= halfLambert;\n\n  vec3 color = (halfLambert * LIGHT_COLOR * lambertDiffuse(cDiff)) + specular;\n\n#ifdef USE_OCCLUSION\n  float occlusion = texture2D(occlusionTex, vTex).r;\n  color = mix(color, color * occlusion, occlusionStrength);\n#endif\n  \n  vec3 emissive = emissiveFactor;\n#ifdef USE_EMISSIVE_TEXTURE\n  emissive *= texture2D(emissiveTex, vTex).rgb;\n#endif\n  color += emissive;\n\n  // gamma correction\n  //color = pow(color, vec3(1.0/2.2));\n\n  return vec4(color, baseColor.a);\n}"}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoxBuilder=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(9);e.BoxBuilder=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.GeometryBuilderBase),n(e,[{key:"pushBox",value:function(t,e){var r=this.primitiveStream,n=.5*(e[0]-t[0]),i=.5*(e[1]-t[1]),o=.5*(e[2]-t[2]),a=t[0]+n,u=t[1]+i,s=t[2]+o;r.startGeometry();var c=r.nextVertexIndex;r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(-n+a,-i+u,-o+s,0,1,0,-1,0),r.pushVertex(+n+a,-i+u,-o+s,1,1,0,-1,0),r.pushVertex(+n+a,-i+u,+o+s,1,0,0,-1,0),r.pushVertex(-n+a,-i+u,+o+s,0,0,0,-1,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,+i+u,-o+s,0,0,0,1,0),r.pushVertex(+n+a,+i+u,-o+s,1,0,0,1,0),r.pushVertex(+n+a,+i+u,+o+s,1,1,0,1,0),r.pushVertex(-n+a,+i+u,+o+s,0,1,0,1,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,-i+u,-o+s,0,1,-1,0,0),r.pushVertex(-n+a,+i+u,-o+s,0,0,-1,0,0),r.pushVertex(-n+a,+i+u,+o+s,1,0,-1,0,0),r.pushVertex(-n+a,-i+u,+o+s,1,1,-1,0,0),c=r.nextVertexIndex,r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(+n+a,-i+u,-o+s,1,1,1,0,0),r.pushVertex(+n+a,+i+u,-o+s,1,0,1,0,0),r.pushVertex(+n+a,+i+u,+o+s,0,0,1,0,0),r.pushVertex(+n+a,-i+u,+o+s,0,1,1,0,0),c=r.nextVertexIndex,r.pushTriangle(c,c+2,c+1),r.pushTriangle(c,c+3,c+2),r.pushVertex(-n+a,-i+u,-o+s,1,1,0,0,-1),r.pushVertex(+n+a,-i+u,-o+s,0,1,0,0,-1),r.pushVertex(+n+a,+i+u,-o+s,0,0,0,0,-1),r.pushVertex(-n+a,+i+u,-o+s,1,0,0,0,-1),c=r.nextVertexIndex,r.pushTriangle(c,c+1,c+2),r.pushTriangle(c,c+2,c+3),r.pushVertex(-n+a,-i+u,+o+s,0,1,0,0,1),r.pushVertex(+n+a,-i+u,+o+s,1,1,0,0,1),r.pushVertex(+n+a,+i+u,+o+s,1,0,0,0,1),r.pushVertex(-n+a,+i+u,+o+s,0,0,0,0,1),r.endGeometry()}},{key:"pushCube",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],e=.5*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);this.pushBox([t[0]-e,t[1]-e,t[2]-e],[t[0]+e,t[1]+e,t[2]+e])}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var i=null;function o(){if(!i){i={};for(var t=(window.location.search.substring(1)||window.location.hash.substring(1)).split("&"),e=0;e<t.length;e++){var r=t[e].split("=");i[r[0].toLowerCase()]=decodeURIComponent(r[1])}}}window.onhashchange=function(){i=null};e.QueryArgs=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n(t,null,[{key:"getString",value:function(t,e){o();var r=t.toLowerCase();return r in i?i[r]:e}},{key:"getInt",value:function(t,e){o();var r=t.toLowerCase();return r in i?parseInt(i[r],10):e}},{key:"getFloat",value:function(t,e){o();var r=t.toLowerCase();return r in i?parseFloat(i[r]):e}},{key:"getBool",value:function(t,e){o();var r=t.toLowerCase();return r in i?0!=parseInt(i[r],10):e}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FallbackHelper=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);e.FallbackHelper=function(){function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=e,this.gl=r,this._emulateStage=!1,this.lookYaw=0,this.lookPitch=0,this.viewMatrix=i.mat4.create();var o=i.mat4.create();function a(){r.canvas.width=r.canvas.offsetWidth*window.devicePixelRatio,r.canvas.height=r.canvas.offsetHeight*window.devicePixelRatio,i.mat4.perspective(o,.4*Math.PI,r.canvas.width/r.canvas.height,.1,1e3),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight)}this.projectionMatrix=o,i.mat4.identity(this.viewMatrix),window.addEventListener("resize",a),a();var u=r.canvas,s=0,c=0;u.addEventListener("touchstart",function(t){2==t.touches.length&&(s=t.touches[1].pageX,c=t.touches[1].pageY)}),u.addEventListener("touchmove",function(t){2==t.touches.length&&(n.onLook(t.touches[1].pageX-s,t.touches[1].pageY-c),s=t.touches[1].pageX,c=t.touches[1].pageY)}),u.addEventListener("mousemove",function(t){2&t.buttons&&n.onLook(t.movementX,t.movementY)}),u.addEventListener("contextmenu",function(t){t.preventDefault()}),this.boundOnFrame=this.onFrame.bind(this),window.requestAnimationFrame(this.boundOnFrame)}return n(t,[{key:"onLook",value:function(t,e){this.lookYaw+=.0025*t,this.lookPitch+=.0025*e,this.lookPitch<.5*-Math.PI&&(this.lookPitch=.5*-Math.PI),this.lookPitch>.5*Math.PI&&(this.lookPitch=.5*Math.PI),this.updateView()}},{key:"onFrame",value:function(t){var e=this.gl;window.requestAnimationFrame(this.boundOnFrame),this.scene.startFrame(),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.scene.draw(this.projectionMatrix,this.viewMatrix),this.scene.endFrame()}},{key:"updateView",value:function(){i.mat4.identity(this.viewMatrix),i.mat4.rotateX(this.viewMatrix,this.viewMatrix,-this.lookPitch),i.mat4.rotateY(this.viewMatrix,this.viewMatrix,-this.lookYaw),this._emulateStage&&i.mat4.translate(this.viewMatrix,this.viewMatrix,[0,-1.6,0])}},{key:"emulateStage",get:function(){return this._emulateStage},set:function(t){this._emulateStage=t,this.updateView()}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SevenSegmentText=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(7);function u(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=function(t){function e(){return s(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"SEVEN_SEGMENT_TEXT"}},{key:"vertexSource",get:function(){return"\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 0.0, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n    const vec4 color = vec4(0.0, 1.0, 0.0, 1.0);\n\n    vec4 fragment_main() {\n      return color;\n    }"}}]),e}();e.SevenSegmentText=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._text="",t._charNodes=[],t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.clearNodes(),this._charNodes=[];var e=[],r={},n=[];function i(t,n,i,o,a){var u=e.length/2;e.push(n,i,o,i,o,a,n,a),r[t]=[u,u+2,u+1,u,u+3,u+2]}var o={};function s(t,e){for(var i={character:t,offset:2*n.length,count:0},a=0;a<e.length;++a){var s=e[a],c=r[s];i.count+=c.length,n.push.apply(n,u(c))}o[t]=i}i(0,-1,1,.5,.75),i(1,-1,.125,.5,-.125),i(2,-1,-.75,.5,-1),i(3,-1,1,-.75,-.125),i(4,.25,1,.5,-.125),i(5,-1,.125,-.75,-1),i(6,.25,.125,.5,-1),s("0",[0,2,3,4,5,6]),s("1",[4,6]),s("2",[0,1,2,4,5]),s("3",[0,1,2,4,6]),s("4",[1,3,4,6]),s("5",[0,1,2,3,6]),s("6",[0,1,2,3,5,6]),s("7",[0,4,6]),s("8",[0,1,2,3,4,5,6]),s("9",[0,1,2,3,4,6]),s("A",[0,1,3,4,5,6]),s("B",[1,2,3,5,6]),s("C",[0,2,3,5]),s("D",[1,2,4,5,6]),s("E",[0,1,2,4,6]),s("F",[0,1,3,5]),s("P",[0,1,3,4,5]),s("-",[1]),s(" ",[]),s("_",[2]);var c=t.gl,f=t.createRenderBuffer(c.ARRAY_BUFFER,new Float32Array(e)),h=t.createRenderBuffer(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),d=[new a.PrimitiveAttribute("POSITION",f,2,c.FLOAT,8,0)],v=new a.Primitive(d,n.length);v.setIndexBuffer(h);var _=new l;for(var m in this._charPrimitives={},o){var p=o[m];v.elementCount=p.count,v.indexByteOffset=p.offset,this._charPrimitives[m]=t.createRenderPrimitive(v,_)}this.text=this._text}},{key:"text",get:function(){return this._text},set:function(t){this._text=t;for(var e=0,r=null;e<t.length;++e)if(r=t[e]in this._charPrimitives?this._charPrimitives[t[e]]:this._charPrimitives._,this._charNodes.length<=e){var n=new o.Node;n.addRenderPrimitive(r);var i=2*e;n.translation=[i,0,0],this._charNodes.push(n),this.addNode(n)}else this._charNodes[e].clearRenderPrimitives(),this._charNodes[e].addRenderPrimitive(r),this._charNodes[e].visible=!0;for(;e<this._charNodes.length;++e)this._charNodes[e].visible=!1}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StatsViewer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(7),u=r(17);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=30,h=90,d=function(t){function e(){return s(this,e),c(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"STATS_VIEWER"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec3 COLOR_0;\n    varying vec4 vColor;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vColor = vec4(COLOR_0, 1.0);\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n    varying vec4 vColor;\n\n    vec4 fragment_main() {\n      return vColor;\n    }"}}]),e}();function v(t){return.9/l*t-.45}function _(t){return Math.min(t,h)*(.7/h)-.45}var m=window.performance&&performance.now?performance.now.bind(performance):Date.now;e.StatsViewer=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._performanceMonitoring=!1,t._startTime=m(),t._prevFrameTime=t._startTime,t._prevGraphUpdateTime=t._startTime,t._frames=0,t._fpsAverage=0,t._fpsMin=0,t._fpsStep=t._performanceMonitoring?1e3:250,t._lastSegment=0,t._fpsVertexBuffer=null,t._fpsRenderPrimitive=null,t._fpsNode=null,t._sevenSegmentNode=new u.SevenSegmentText,t._sevenSegmentNode.matrix=new Float32Array([.075,0,0,0,0,.075,0,0,0,0,1,0,-.3625,.3625,.02,1]),t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.clearNodes();for(var e=t.gl,r=[],n=[],i=0;i<l;++i){r.push(v(i),_(0),.02,0,1,1),r.push(v(i+1),_(0),.02,0,1,1),r.push(v(i),_(0),.02,0,1,1),r.push(v(i+1),_(0),.02,0,1,1);var u=4*i;n.push(u,u+3,u+1,u+3,u,u+2)}function s(t,e,i,o,a,u,s,c){var f=r.length/6;r.push(t,e,a,u,s,c),r.push(i,o,a,u,s,c),r.push(t,o,a,u,s,c),r.push(i,e,a,u,s,c),n.push(f,f+1,f+2,f,f+3,f+1)}s(-.5,-.5,.5,.5,0,0,0,.125),s(-.45,-.45,.45,.25,.01,0,0,.4),s(-.45,_(30),.45,_(32),.015,.5,0,.5),s(-.45,_(60),.45,_(62),.015,.2,0,.75),this._fpsVertexBuffer=t.createRenderBuffer(e.ARRAY_BUFFER,new Float32Array(r),e.DYNAMIC_DRAW);var c=t.createRenderBuffer(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),f=[new a.PrimitiveAttribute("POSITION",this._fpsVertexBuffer,3,e.FLOAT,24,0),new a.PrimitiveAttribute("COLOR_0",this._fpsVertexBuffer,3,e.FLOAT,24,12)],h=new a.Primitive(f,n.length);h.setIndexBuffer(c),h.setBounds([-.5,-.5,0],[.5,.5,.015]),this._fpsRenderPrimitive=t.createRenderPrimitive(h,new d),this._fpsNode=new o.Node,this._fpsNode.addRenderPrimitive(this._fpsRenderPrimitive),this.addNode(this._fpsNode),this.addNode(this._sevenSegmentNode)}},{key:"begin",value:function(){this._startTime=m()}},{key:"end",value:function(){var t=m(),e=1e3/(t-this._prevFrameTime);if(this._prevFrameTime=t,this._fpsMin=this._frames?Math.min(this._fpsMin,e):e,this._frames++,t>this._prevGraphUpdateTime+this._fpsStep){var r=t-this._prevGraphUpdateTime;this._fpsAverage=Math.round(1e3/(r/this._frames)),this._updateGraph(this._fpsMin,this._fpsAverage),this._performanceMonitoring&&console.log("Average FPS: "+this._fpsAverage+" Min FPS: "+this._fpsMin),this._prevGraphUpdateTime=t,this._frames=0,this._fpsMin=0}}},{key:"_updateGraph",value:function(t,e){var r,n=(r=t,{r:Math.max(0,Math.min(1,1-r/60)),g:Math.max(0,Math.min(1,(r-15)/(h-15))),b:Math.max(0,Math.min(1,(r-15)/(h-15)))}),i=_(t-1),o=_(e+1),a=[v(this._lastSegment),o,.02,n.r,n.g,n.b,v(this._lastSegment+1),o,.02,n.r,n.g,n.b,v(this._lastSegment),i,.02,n.r,n.g,n.b,v(this._lastSegment+1),i,.02,n.r,n.g,n.b];n.r=.2,n.g=1,n.b=.2,this._lastSegment==l-1?(this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),24*this._lastSegment*4),a=[v(0),_(h),.02,n.r,n.g,n.b,v(.25),_(h),.02,n.r,n.g,n.b,v(0),_(0),.02,n.r,n.g,n.b,v(.25),_(0),.02,n.r,n.g,n.b],this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),0)):(a.push(v(this._lastSegment+1),_(h),.02,n.r,n.g,n.b,v(this._lastSegment+1.25),_(h),.02,n.r,n.g,n.b,v(this._lastSegment+1),_(0),.02,n.r,n.g,n.b,v(this._lastSegment+1.25),_(0),.02,n.r,n.g,n.b),this._renderer.updateRenderBuffer(this._fpsVertexBuffer,new Float32Array(a),24*this._lastSegment*4)),this._lastSegment=(this._lastSegment+1)%l,this._sevenSegmentNode.text=this._fpsAverage+" FP5"}},{key:"performanceMonitoring",get:function(){return this._performanceMonitoring},set:function(t){this._performanceMonitoring=t,this._fpsStep=t?1e3:250}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InputRenderer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(7),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=new Uint8Array([255,255,255,1,255,255,255,2,191,191,191,4,204,204,204,5,219,219,219,7,204,204,204,10,216,216,216,13,210,210,210,17,206,206,206,21,206,206,206,26,206,206,206,31,205,205,205,36,200,200,200,42,201,201,201,47,201,201,201,52,201,201,201,57,201,201,201,61,200,200,200,65,203,203,203,68,238,238,238,135,250,250,250,200,249,249,249,201,249,249,249,201,250,250,250,201,250,250,250,201,249,249,249,201,249,249,249,201,250,250,250,200,238,238,238,135,203,203,203,68,200,200,200,65,201,201,201,61,201,201,201,57,201,201,201,52,201,201,201,47,200,200,200,42,205,205,205,36,206,206,206,31,206,206,206,26,206,206,206,21,210,210,210,17,216,216,216,13,204,204,204,10,219,219,219,7,204,204,204,5,191,191,191,4,255,255,255,2,255,255,255,1]),d=[1,1,1,.25],v=[1,1,1,1],_=[.5,.5,.5,.25],m={controllers:!0,lasers:!0,cursors:!0},p=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.blendFuncDst=l.ONE,t.state.depthMask=!1,t.laser=t.defineSampler("diffuse"),t.laser.texture=new u.DataTexture(h,48,1),t.laserColor=t.defineUniform("laserColor",d),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_LASER"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n\n    uniform vec4 laserColor;\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    const float fadePoint = 0.5335;\n    const float fadeEnd = 0.535;\n\n    vec4 fragment_main() {\n      vec2 uv = vTexCoord;\n      float front_fade_factor = 1.0 - clamp(1.0 - (uv.y - fadePoint) / (1.0 - fadePoint), 0.0, 1.0);\n      float back_fade_factor = clamp((uv.y - fadePoint) / (fadeEnd - fadePoint), 0.0, 1.0);\n      vec4 color = laserColor * texture2D(diffuse, vTexCoord);\n      float opacity = color.a * front_fade_factor * back_fade_factor;\n      return vec4(color.rgb * opacity, opacity);\n    }"}}]),e}(),y="\nattribute vec4 POSITION;\n\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vLuminance = POSITION.z;\n  vOpacity = POSITION.w;\n\n  // Billboarded, constant size vertex transform.\n  vec4 screenPos = proj * view * model * vec4(0.0, 0.0, 0.0, 1.0);\n  screenPos /= screenPos.w;\n  screenPos.xy += POSITION.xy;\n  return screenPos;\n}",b="\nprecision mediump float;\n\nuniform vec4 cursorColor;\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 fragment_main() {\n  vec3 color = cursorColor.rgb * vLuminance;\n  float opacity = cursorColor.a * vOpacity;\n  return vec4(color * opacity, opacity);\n}",g=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.depthMask=!1,t.cursorColor=t.defineUniform("cursorColor",v),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_CURSOR"}},{key:"vertexSource",get:function(){return y}},{key:"fragmentSource",get:function(){return b}}]),e}(),M=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.ADDITIVE,t.state.cullFace=!1,t.state.blend=!0,t.state.blendFuncSrc=l.ONE,t.state.depthFunc=l.GEQUAL,t.state.depthMask=!1,t.cursorColor=t.defineUniform("cursorColor",_),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"INPUT_CURSOR_2"}},{key:"vertexSource",get:function(){return y}},{key:"fragmentSource",get:function(){return b}}]),e}();e.InputRenderer=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._maxInputElements=32,t._controllers=[],t._controllerNode=null,t._controllerNodeHandedness=null,t._lasers=null,t._cursors=null,t._activeControllers=0,t._activeLasers=0,t._activeCursors=0,t}return f(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this._controllers=[],this._controllerNode=null,this._controllerNodeHandedness=null,this._lasers=null,this._cursors=null,this._activeControllers=0,this._activeLasers=0,this._activeCursors=0}},{key:"setControllerMesh",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";this._controllerNode=t,this._controllerNode.visible=!1,this.addNode(this._controllerNode),this._controllerNodeHandedness=e}},{key:"addController",value:function(t){if(this._controllerNode){var e=null;this._activeControllers<this._controllers.length?e=this._controllers[this._activeControllers]:(e=this._controllerNode.clone(),this.addNode(e),this._controllers.push(e)),this._activeControllers=(this._activeControllers+1)%this._maxInputElements,e.matrix=t,e.visible=!0}}},{key:"addLaserPointer",value:function(t){!this._lasers&&this._renderer&&(this._lasers=[this._createLaserMesh()],this.addNode(this._lasers[0]));var e=null;this._activeLasers<this._lasers.length?e=this._lasers[this._activeLasers]:(e=this._lasers[0].clone(),this.addNode(e),this._lasers.push(e)),this._activeLasers=(this._activeLasers+1)%this._maxInputElements,e.matrix=t.transformMatrix,e.visible=!0}},{key:"addCursor",value:function(t){!this._cursors&&this._renderer&&(this._cursors=[this._createCursorMesh()],this.addNode(this._cursors[0]));var e=null;this._activeCursors<this._cursors.length?e=this._cursors[this._activeCursors]:(e=this._cursors[0].clone(),this.addNode(e),this._cursors.push(e)),this._activeCursors=(this._activeCursors+1)%this._maxInputElements,e.translation=t,e.visible=!0}},{key:"reset",value:function(t){if(t||(t=m),this._controllers&&t.controllers){var e=!0,r=!1,n=void 0;try{for(var i,o=this._controllers[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){i.value.visible=!1}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._activeControllers=0}if(this._lasers&&t.lasers){var a=!0,u=!1,s=void 0;try{for(var c,f=this._lasers[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){c.value.visible=!1}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}this._activeLasers=0}if(this._cursors&&t.cursors){var l=!0,h=!1,d=void 0;try{for(var v,_=this._cursors[Symbol.iterator]();!(l=(v=_.next()).done);l=!0){v.value.visible=!1}}catch(t){h=!0,d=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw d}}this._activeCursors=0}}},{key:"_createLaserMesh",value:function(){var t=this._renderer._gl,e=.005,r=[0,e,0,0,1,0,e,-1,0,0,0,-e,0,1,1,0,-e,-1,1,0,e,0,0,0,1,e,0,-1,0,0,-e,0,0,1,1,-e,0,-1,1,0,0,-e,0,0,1,0,-e,-1,0,0,0,e,0,1,1,0,e,-1,1,0,-e,0,0,0,1,-e,0,-1,0,0,e,0,0,1,1,e,0,-1,1,0],n=[0,1,2,1,3,2,4,5,6,5,7,6,8,9,10,9,11,10,12,13,14,13,15,14],i=this._renderer.createRenderBuffer(t.ARRAY_BUFFER,new Float32Array(r)),u=this._renderer.createRenderBuffer(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n)),s=n.length,c=[new a.PrimitiveAttribute("POSITION",i,3,t.FLOAT,20,0),new a.PrimitiveAttribute("TEXCOORD_0",i,2,t.FLOAT,20,12)],f=new a.Primitive(c,s);f.setIndexBuffer(u);var l=new p,h=this._renderer.createRenderPrimitive(f,l),d=new o.Node;return d.addRenderPrimitive(h),d}},{key:"_createCursorMesh",value:function(){for(var t=this._renderer._gl,e=[],r=[],n=2*Math.PI/16,i=0;i<16;++i){var u=i*n,s=Math.cos(u),c=Math.sin(u);e.push(.004*s,.004*c,1,.9),i>1&&r.push(0,i-1,i)}for(var f=0;f<16;++f){var l=f*n,h=Math.cos(l),d=Math.sin(l);if(e.push(.004*h,.004*d,.5,.75),e.push(.007*h,.007*d,0,0),f>0){var v=16+2*f;r.push(v-2,v-1,v),r.push(v-1,v+1,v)}}r.push(46,47,16),r.push(47,17,16);var _=this._renderer.createRenderBuffer(t.ARRAY_BUFFER,new Float32Array(e)),m=this._renderer.createRenderBuffer(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),p=r.length,y=[new a.PrimitiveAttribute("POSITION",_,4,t.FLOAT,16,0)],b=new a.Primitive(y,p);b.setIndexBuffer(m);var x=new g,T=new M,w=this._renderer.createRenderPrimitive(b,x),E=this._renderer.createRenderPrimitive(b,T),O=new o.Node;return O.addRenderPrimitive(w),O.addRenderPrimitive(E),O}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Scene=e.WebXRView=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(11),o=r(19),a=r(18),u=r(2),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=e.WebXRView=function(t){function e(t,r,n){return c(this,e),f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t?t.projectionMatrix:null,r&&t?r.getViewMatrix(t):null,n&&t?n.getViewport(t):null,t?t.eye:"left"))}return l(e,i.RenderView),e}();e.Scene=function(t){function e(){c(this,e);var t=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._timestamp=-1,t._frameDelta=0,t._statsStanding=!1,t._stats=null,t._statsEnabled=!1,t.enableStats(!0),t._inputRenderer=null,t._resetInputEndFrame=!0,t._lastTimestamp=0,t._hoverFrame=0,t._hoveredNodes=[],t.clear=!0,t}return l(e,u.Node),n(e,[{key:"setRenderer",value:function(t){this._setRenderer(t)}},{key:"loseRenderer",value:function(){this._renderer&&(this._stats=null,this._renderer=null,this._inputRenderer=null)}},{key:"updateInputSources",value:function(t,e){if(t.session.getInputSources){var r=t.session.getInputSources(),n=[],i=this._hoverFrame;this._hoverFrame++;var o=!0,a=!1,u=void 0;try{for(var c,f=r[Symbol.iterator]();!(o=(c=f.next()).done);o=!0){var l=c.value,h=t.getInputPose(l,e);if(h&&(h.gripMatrix&&this.inputRenderer.addController(h.gripMatrix),h.targetRay)){"tracked-pointer"==l.targetRayMode&&this.inputRenderer.addLaserPointer(h.targetRay);var d=this.hitTest(h.targetRay);if(d)this.inputRenderer.addCursor(d.intersection),d.node._hoverFrameId!=i&&d.node.onHoverStart(),d.node._hoverFrameId=this._hoverFrame,n.push(d.node);else{var v=s.vec3.fromValues(h.targetRay.origin.x,h.targetRay.origin.y,h.targetRay.origin.z);s.vec3.add(v,v,[1*h.targetRay.direction.x,1*h.targetRay.direction.y,1*h.targetRay.direction.z]),this.inputRenderer.addCursor(v)}}}}catch(t){a=!0,u=t}finally{try{!o&&f.return&&f.return()}finally{if(a)throw u}}var _=!0,m=!1,p=void 0;try{for(var y,b=this._hoveredNodes[Symbol.iterator]();!(_=(y=b.next()).done);_=!0){var g=y.value;g._hoverFrameId!=this._hoverFrame&&g.onHoverEnd()}}catch(t){m=!0,p=t}finally{try{!_&&b.return&&b.return()}finally{if(m)throw p}}this._hoveredNodes=n}}},{key:"handleSelect",value:function(t,e,r){var n=e.getInputPose(t,r);n&&this.handleSelectPointer(n.targetRay)}},{key:"handleSelectPointer",value:function(t){if(t){var e=this.hitTest(t);e&&e.node.handleSelect()}}},{key:"enableStats",value:function(t){t!=this._statsEnabled&&(this._statsEnabled=t,t?(this._stats=new a.StatsViewer,this._stats.selectable=!0,this.addNode(this._stats),this._statsStanding?this._stats.translation=[0,1.4,-.75]:this._stats.translation=[0,-.3,-.5],this._stats.scale=[.3,.3,.3],s.quat.fromEuler(this._stats.rotation,-45,0,0)):t||this._stats&&(this.removeNode(this._stats),this._stats=null))}},{key:"standingStats",value:function(t){this._statsStanding=t,this._stats&&(this._statsStanding?this._stats.translation=[0,1.4,-.75]:this._stats.translation=[0,-.3,-.5],this._stats.scale=[.3,.3,.3],s.quat.fromEuler(this._stats.rotation,-45,0,0))}},{key:"draw",value:function(t,e,r){var n=new i.RenderView;n.projectionMatrix=t,n.viewMatrix=e,r&&(n.eye=r),this.drawViewArray([n])}},{key:"drawXRFrame",value:function(t,e){if(this._renderer&&e){var r=this._renderer.gl,n=t.session.baseLayer;if(r){r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer),this.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var i=[],o=!0,a=!1,u=void 0;try{for(var s,c=t.views[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var f=s.value;i.push(new h(f,e,n))}}catch(t){a=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw u}}this.drawViewArray(i)}}}},{key:"drawViewArray",value:function(t){this._renderer&&this._renderer.drawViews(t,this)}},{key:"startFrame",value:function(){var t=this._timestamp;return this._timestamp=performance.now(),this._stats&&this._stats.begin(),this._frameDelta=t>=0?this._timestamp-t:0,this._update(this._timestamp,this._frameDelta),this._frameDelta}},{key:"endFrame",value:function(){this._inputRenderer&&this._resetInputEndFrame&&this._inputRenderer.reset(),this._stats&&this._stats.end()}},{key:"onLoadScene",value:function(t){return Promise.resolve()}},{key:"inputRenderer",get:function(){return this._inputRenderer||(this._inputRenderer=new o.InputRenderer,this.addNode(this._inputRenderer)),this._inputRenderer}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VideoNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(7),a=r(2),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.image=t.defineSampler("diffuse"),t.texCoordScaleOffset=t.defineUniform("texCoordScaleOffset",[1,1,0,0,1,1,0,0],4),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"VIDEO_PLAYER"}},{key:"vertexSource",get:function(){return"\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n      return out_vec;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }"}}]),e}();e.VideoNode=function(t){function e(t){s(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._video=t.video,r._displayMode=t.displayMode||"mono",r._video_texture=new u.VideoTexture(r._video),r}return f(e,a.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=[0,2,1,0,3,2],r=t.createRenderBuffer(l.ARRAY_BUFFER,new Float32Array([-1,1,0,0,0,1,1,0,1,0,1,-1,0,1,1,-1,-1,0,0,1])),n=t.createRenderBuffer(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(e)),i=[new o.PrimitiveAttribute("POSITION",r,3,l.FLOAT,20,0),new o.PrimitiveAttribute("TEXCOORD_0",r,2,l.FLOAT,20,12)],a=new o.Primitive(i,e.length);a.setIndexBuffer(n),a.setBounds([-1,-1,0],[1,1,.015]);var u=new h;switch(u.image.texture=this._video_texture,this._displayMode){case"mono":u.texCoordScaleOffset.value=[1,1,0,0,1,1,0,0];break;case"stereoTopBottom":u.texCoordScaleOffset.value=[1,.5,0,0,1,.5,0,.5];break;case"stereoLeftRight":u.texCoordScaleOffset.value=[.5,1,0,0,.5,1,.5,0]}var s=t.createRenderPrimitive(a,u);this.addRenderPrimitive(s)}},{key:"aspectRatio",get:function(){var t=this._video.videoWidth,e=this._video.videoHeight;switch(this._displayMode){case"stereoTopBottom":e*=.5;break;case"stereoLeftRight":t*=.5}return e&&t?t/e:1}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SkyboxNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(7),a=r(2),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l=WebGLRenderingContext,h=function(t){function e(){s(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.renderOrder=i.RENDER_ORDER.SKY,t.state.depthFunc=l.LEQUAL,t.state.depthMask=!1,t.image=t.defineSampler("diffuse"),t.texCoordScaleOffset=t.defineUniform("texCoordScaleOffset",[1,1,0,0,1,1,0,0],4),t}return f(e,i.Material),n(e,[{key:"materialName",get:function(){return"SKYBOX"}},{key:"vertexSource",get:function(){return"\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      // Drop the translation portion of the view matrix\n      view[3].xyz = vec3(0.0, 0.0, 0.0);\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n\n      // Returning the W component for both Z and W forces the geometry depth to\n      // the far plane. When combined with a depth func of LEQUAL this makes the\n      // sky write to any depth fragment that has not been written to yet.\n      return out_vec.xyww;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }"}}]),e}();e.SkyboxNode=function(t){function e(t){s(this,e);var r=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._url=t.url,r._displayMode=t.displayMode||"mono",r._rotationY=t.rotationY||0,r}return f(e,a.Node),n(e,[{key:"onRendererChanged",value:function(t){for(var e=[],r=[],n=0;n<=40;++n)for(var i=n*Math.PI/40,a=Math.sin(i),s=Math.cos(i),c=41*n,f=41*(n+1),d=0;d<=40;++d){var v=2*d*Math.PI/40+this._rotationY,_=Math.sin(v)*a,m=s,p=-Math.cos(v)*a,y=d/40,b=n/40;if(e.push(_,m,p,y,b),n<40&&d<40){var g=c+d,M=f+d;r.push(g,M,g+1,M,M+1,g+1)}}var x=t.createRenderBuffer(l.ARRAY_BUFFER,new Float32Array(e)),T=t.createRenderBuffer(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),w=[new o.PrimitiveAttribute("POSITION",x,3,l.FLOAT,20,0),new o.PrimitiveAttribute("TEXCOORD_0",x,2,l.FLOAT,20,12)],E=new o.Primitive(w,r.length);E.setIndexBuffer(T);var O=new h;switch(O.image.texture=new u.UrlTexture(this._url),this._displayMode){case"mono":O.texCoordScaleOffset.value=[1,1,0,0,1,1,0,0];break;case"stereoTopBottom":O.texCoordScaleOffset.value=[1,.5,0,0,1,.5,0,.5];break;case"stereoLeftRight":O.texCoordScaleOffset.value=[.5,1,0,0,.5,1,.5,0]}var R=t.createRenderPrimitive(E,O);this.addRenderPrimitive(R)}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gltf2Loader=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(13),o=r(2),a=r(7),u=r(8);function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var c=WebGLRenderingContext,f=1313821514,l=5130562;function h(t){return!!t.match(/^data:/)}function d(t,e){return function(t){var e=new RegExp("^"+window.location.protocol,"i");return!!t.match(e)}(t)||h(t)?t:e+t}function v(t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;default:return 0}}e.Gltf2Loader=function(){function t(e){s(this,t),this.renderer=e,this._gl=e._gl}return n(t,[{key:"loadFromUrl",value:function(t){var e=this;return fetch(t).then(function(r){var n=t.lastIndexOf("/"),i=0!==n?t.substring(0,n+1):"";if(t.endsWith(".gltf"))return r.json().then(function(t){return e.loadFromJson(t,i)});if(t.endsWith(".glb"))return r.arrayBuffer().then(function(t){return e.loadFromBinary(t,i)});throw new Error("Unrecognized file extension")})}},{key:"loadFromBinary",value:function(t,e){var r=new DataView(t,0,12),n=r.getUint32(0,!0),i=r.getUint32(4,!0),o=r.getUint32(8,!0);if(1179937895!=n)throw new Error("Invalid magic string in binary header.");if(2!=i)throw new Error("Incompatible version in binary header.");for(var a={},u=12;u<o;){var s=new DataView(t,u,8),c=s.getUint32(0,!0);a[s.getUint32(4,!0)]=t.slice(u+8,u+8+c),u+=c+8}if(!a[f])throw new Error("File contained no json chunk.");var h=new TextDecoder("utf-8").decode(a[f]),d=JSON.parse(h);return this.loadFromJson(d,e,a[l])}},{key:"loadFromJson",value:function(t,e,r){if(!t.asset)throw new Error("Missing asset description.");if("2.0"!=t.asset.minVersion&&"2.0"!=t.asset.version)throw new Error("Incompatible asset version.");var n=[];if(r)n[0]=new p({},e,r);else{var s=!0,f=!1,l=void 0;try{for(var h,d=t.buffers[Symbol.iterator]();!(s=(h=d.next()).done);s=!0){var y=h.value;n.push(new p(y,e))}}catch(t){f=!0,l=t}finally{try{!s&&d.return&&d.return()}finally{if(f)throw l}}}var b=[],g=!0,M=!1,x=void 0;try{for(var T,w=t.bufferViews[Symbol.iterator]();!(g=(T=w.next()).done);g=!0){var E=T.value;b.push(new m(E,n))}}catch(t){M=!0,x=t}finally{try{!g&&w.return&&w.return()}finally{if(M)throw x}}var O=[];if(t.images){var R=!0,P=!1,S=void 0;try{for(var A,N=t.images[Symbol.iterator]();!(R=(A=N.next()).done);R=!0){var C=A.value;O.push(new p(C,e))}}catch(t){P=!0,S=t}finally{try{!R&&N.return&&N.return()}finally{if(P)throw S}}}var I=[];if(t.textures){var k=!0,L=!1,F=void 0;try{for(var D,B=t.textures[Symbol.iterator]();!(k=(D=B.next()).done);k=!0){var j=D.value,U=O[j.source].texture(b);if(j.sampler){var V=V[j.sampler];U.sampler.minFilter=V.minFilter,U.sampler.magFilter=V.magFilter,U.sampler.wrapS=V.wrapS,U.sampler.wrapT=V.wrapT}I.push(U)}}catch(t){L=!0,F=t}finally{try{!k&&B.return&&B.return()}finally{if(L)throw F}}}function Y(t){return t?I[t.index]:null}var G=[];if(t.materials){var H=!0,q=!1,X=void 0;try{for(var W,K=t.materials[Symbol.iterator]();!(H=(W=K.next()).done);H=!0){var z=W.value,Q=new i.PbrMaterial,J=z.pbrMetallicRoughness||{};switch(Q.baseColorFactor.value=J.baseColorFactor||[1,1,1,1],Q.baseColor.texture=Y(J.baseColorTexture),Q.metallicRoughnessFactor.value=[J.metallicFactor||1,J.roughnessFactor||1],Q.metallicRoughness.texture=Y(J.metallicRoughnessTexture),Q.normal.texture=Y(t.normalTexture),Q.occlusion.texture=Y(t.occlusionTexture),Q.occlusionStrength.value=t.occlusionTexture&&t.occlusionTexture.strength?t.occlusionTexture.strength:1,Q.emissiveFactor.value=z.emissiveFactor||[0,0,0],Q.emissive.texture=Y(t.emissiveTexture),!Q.emissive.texture&&t.emissiveFactor&&(Q.emissive.texture=new u.ColorTexture(1,1,1,1)),z.alphaMode){case"BLEND":case"MASK":Q.state.blend=!0;break;default:Q.state.blend=!1}Q.state.cullFace=!z.doubleSided,G.push(Q)}}catch(t){q=!0,X=t}finally{try{!H&&K.return&&K.return()}finally{if(q)throw X}}}var Z=t.accessors,$=[],tt=!0,et=!1,rt=void 0;try{for(var nt,it=t.meshes[Symbol.iterator]();!(tt=(nt=it.next()).done);tt=!0){var ot=nt.value,at=new _;$.push(at);var ut=!0,st=!1,ct=void 0;try{for(var ft,lt=ot.primitives[Symbol.iterator]();!(ut=(ft=lt.next()).done);ut=!0){var ht=ft.value,dt=null;dt="material"in ht?G[ht.material]:new i.PbrMaterial;var vt=[],_t=0,mt=null,pt=null;for(var yt in ht.attributes){var bt=Z[ht.attributes[yt]],gt=b[bt.bufferView];_t=bt.count;var Mt=new a.PrimitiveAttribute(yt,gt.renderBuffer(this.renderer,c.ARRAY_BUFFER),v(bt.type),bt.componentType,gt.byteStride||0,bt.byteOffset||0);Mt.normalized=bt.normalized||!1,"POSITION"==yt&&(mt=bt.min,pt=bt.max),vt.push(Mt)}var xt=new a.Primitive(vt,_t,ht.mode);if("indices"in ht){var Tt=Z[ht.indices],wt=b[Tt.bufferView];xt.setIndexBuffer(wt.renderBuffer(this.renderer,c.ELEMENT_ARRAY_BUFFER),Tt.byteOffset||0,Tt.componentType),xt.indexType=Tt.componentType,xt.indexByteOffset=Tt.byteOffset||0,xt.elementCount=Tt.count}mt&&pt&&xt.setBounds(mt,pt),at.primitives.push(this.renderer.createRenderPrimitive(xt,dt))}}catch(t){st=!0,ct=t}finally{try{!ut&&lt.return&&lt.return()}finally{if(st)throw ct}}}}catch(t){et=!0,rt=t}finally{try{!tt&&it.return&&it.return()}finally{if(et)throw rt}}var Et=new o.Node,Ot=t.scenes[t.scene],Rt=!0,Pt=!1,St=void 0;try{for(var At,Nt=Ot.nodes[Symbol.iterator]();!(Rt=(At=Nt.next()).done);Rt=!0){var Ct=At.value,It=t.nodes[Ct];Et.addNode(this.processNodes(It,t.nodes,$))}}catch(t){Pt=!0,St=t}finally{try{!Rt&&Nt.return&&Nt.return()}finally{if(Pt)throw St}}return Et}},{key:"processNodes",value:function(t,e,r){var n=new o.Node;if(n.name=t.name,"mesh"in t){var i=r[t.mesh],a=!0,u=!1,s=void 0;try{for(var c,f=i.primitives[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var l=c.value;n.addRenderPrimitive(l)}}catch(t){u=!0,s=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}}if(t.matrix?n.matrix=new Float32Array(t.matrix):(t.translation||t.rotation||t.scale)&&(t.translation&&(n.translation=new Float32Array(t.translation)),t.rotation&&(n.rotation=new Float32Array(t.rotation)),t.scale&&(n.scale=new Float32Array(t.scale))),t.children){var h=!0,d=!1,v=void 0;try{for(var _,m=t.children[Symbol.iterator]();!(h=(_=m.next()).done);h=!0){var p=e[_.value];n.addNode(this.processNodes(p,e,r))}}catch(t){d=!0,v=t}finally{try{!h&&m.return&&m.return()}finally{if(d)throw v}}}return n}}]),t}();var _=function t(){s(this,t),this.primitives=[]},m=function(){function t(e,r){s(this,t),this.buffer=r[e.buffer],this.byteOffset=e.byteOffset||0,this.byteLength=e.byteLength||null,this.byteStride=e.byteStride,this._viewPromise=null,this._renderBuffer=null}return n(t,[{key:"dataView",value:function(){var t=this;return this._viewPromise||(this._viewPromise=this.buffer.arrayBuffer().then(function(e){return new DataView(e,t.byteOffset,t.byteLength)})),this._viewPromise}},{key:"renderBuffer",value:function(t,e){return this._renderBuffer||(this._renderBuffer=t.createRenderBuffer(e,this.dataView())),this._renderBuffer}}]),t}(),p=function(){function t(e,r,n){s(this,t),this.json=e,this.baseUrl=r,this._dataPromise=null,this._texture=null,n&&(this._dataPromise=Promise.resolve(n))}return n(t,[{key:"arrayBuffer",value:function(){if(!this._dataPromise){if(h(this.json.uri)){var t=this.json.uri.replace("data:application/octet-stream;base64,",""),e=Uint8Array.from(atob(t),function(t){return t.charCodeAt(0)});return this._dataPromise=Promise.resolve(e.buffer),this._dataPromise}this._dataPromise=fetch(d(this.json.uri,this.baseUrl)).then(function(t){return t.arrayBuffer()})}return this._dataPromise}},{key:"texture",value:function(t){var e=this;if(!this._texture){var r=new Image;if(this._texture=new u.ImageTexture(r),this.json.uri)h(this.json.uri)?r.src=this.json.uri:r.src=""+this.baseUrl+this.json.uri;else t[this.json.bufferView].dataView().then(function(t){var n=new Blob([t],{type:e.json.mimeType});r.src=window.URL.createObjectURL(n)})}return this._texture}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gltf2Node=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(2),o=r(23);var a=new WeakMap;e.Gltf2Node=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._url=t.url,r._promise=null,r._resolver=null,r._rejecter=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=this,r=a.get(t);r||(r=new o.Gltf2Loader(t),a.set(t,r)),!this._resolver&&this._promise&&(this._promise=null),this._ensurePromise(),r.loadFromUrl(this._url).then(function(t){e.addNode(t),e._resolver(t.waitForComplete()),e._resolver=null,e._rejecter=null}).catch(function(t){e._rejecter(t),e._resolver=null,e._rejecter=null})}},{key:"_ensurePromise",value:function(){var t=this;return this._promise||(this._promise=new Promise(function(e,r){t._resolver=e,t._rejecter=r})),this._promise}},{key:"waitForComplete",value:function(){return this._ensurePromise()}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CubeSeaNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(8),u=r(14),s=r(6);function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var h=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c(this,e);var r=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.heavy=t,r.baseColor=r.defineSampler("baseColor"),r}return l(e,i.Material),n(e,[{key:"materialName",get:function(){return"CUBE_SEA"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    attribute vec3 NORMAL;\n\n    varying vec2 vTexCoord;\n    varying vec3 vLight;\n\n    const vec3 lightDir = vec3(0.75, 0.5, 1.0);\n    const vec3 ambientColor = vec3(0.5, 0.5, 0.5);\n    const vec3 lightColor = vec3(0.75, 0.75, 0.75);\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec3 normalRotated = vec3(model * vec4(NORMAL, 0.0));\n      float lightFactor = max(dot(normalize(lightDir), normalRotated), 0.0);\n      vLight = ambientColor + (lightColor * lightFactor);\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return this.heavy?"\n      precision mediump float;\n\n      uniform sampler2D diffuse;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec2 dimensions = vec2(64, 64);\n      float seed = 0.42;\n\n      vec2 hash( vec2 p ) {\n        p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\n        return fract(sin(p)*18.5453);\n      }\n\n      vec3 hash3( vec2 p ) {\n          vec3 q = vec3( dot(p,vec2(127.1,311.7)),\n                 dot(p,vec2(269.5,183.3)),\n                 dot(p,vec2(419.2,371.9)) );\n        return fract(sin(q)*43758.5453);\n      }\n\n      float iqnoise( in vec2 x, float u, float v ) {\n        vec2 p = floor(x);\n        vec2 f = fract(x);\n        float k = 1.0+63.0*pow(1.0-v,4.0);\n        float va = 0.0;\n        float wt = 0.0;\n        for( int j=-2; j<=2; j++ )\n          for( int i=-2; i<=2; i++ ) {\n            vec2 g = vec2( float(i),float(j) );\n            vec3 o = hash3( p + g )*vec3(u,u,1.0);\n            vec2 r = g - f + o.xy;\n            float d = dot(r,r);\n            float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\n            va += o.z*ww;\n            wt += ww;\n          }\n        return va/wt;\n      }\n\n      // return distance, and cell id\n      vec2 voronoi( in vec2 x ) {\n        vec2 n = floor( x );\n        vec2 f = fract( x );\n        vec3 m = vec3( 8.0 );\n        for( int j=-1; j<=1; j++ )\n          for( int i=-1; i<=1; i++ ) {\n            vec2  g = vec2( float(i), float(j) );\n            vec2  o = hash( n + g );\n            vec2  r = g - f + (0.5+0.5*sin(seed+6.2831*o));\n            float d = dot( r, r );\n            if( d<m.x )\n              m = vec3( d, o );\n          }\n        return vec2( sqrt(m.x), m.y+m.z );\n      }\n\n      vec4 fragment_main() {\n        vec2 uv = ( vTexCoord );\n        uv *= vec2( 10., 10. );\n        uv += seed;\n        vec2 p = 0.5 - 0.5*sin( 0.*vec2(1.01,1.71) );\n\n        vec2 c = voronoi( uv );\n        vec3 col = vec3( c.y / 2. );\n\n        float f = iqnoise( 1. * uv + c.y, p.x, p.y );\n        col *= 1.0 + .25 * vec3( f );\n\n        return vec4(vLight, 1.0) * texture2D(diffuse, vTexCoord) * vec4( col, 1. );\n      }":"\n      precision mediump float;\n      uniform sampler2D baseColor;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec4 fragment_main() {\n        return vec4(vLight, 1.0) * texture2D(baseColor, vTexCoord);\n      }"}}]),e}();e.CubeSeaNode=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e);var r=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.heavyGpu=!!t.heavyGpu,r.cubeCount=t.cubeCount||(r.heavyGpu?12:10),r.cubeScale=t.cubeScale||1,r.halfOnly=!!t.halfOnly,r.autoRotate=!!t.autoRotate,r._texture=new a.UrlTexture(t.imageUrl||"media/textures/cube-sea.png"),r._material=new h(r.heavyGpu),r._material.baseColor.texture=r._texture,r._renderPrimitive=null,r}return l(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this._renderPrimitive=null;var e=new u.BoxBuilder;e.pushCube([0,.25,-.8],.1),e.pushCube([.8,.25,0],.1),e.pushCube([0,.25,.8],.1),e.pushCube([-.8,.25,0],.1);var r=e.finishPrimitive(t);return this.heroNode=t.createMesh(r,this._material),this.rebuildCubes(e),this.cubeSeaNode=new o.Node,this.cubeSeaNode.addRenderPrimitive(this._renderPrimitive),this.addNode(this.cubeSeaNode),this.addNode(this.heroNode),this.waitForComplete()}},{key:"rebuildCubes",value:function(t){if(this._renderer){t?t.clear():t=new u.BoxBuilder;for(var e=.4*this.cubeScale,r=.5*this.cubeCount,n=0;n<this.cubeCount;++n)for(var i=0;i<this.cubeCount;++i)for(var o=0;o<this.cubeCount;++o){var a=[n-r,i-r,o-r];this.halfOnly&&a[0]<0||(0==a[0]&&0==a[1]&&0==a[2]||t.pushCube(a,e))}this.cubeCount>12&&(t.indexType=5125);var s=t.finishPrimitive(this._renderer);this._renderPrimitive?this._renderPrimitive.setPrimitive(s):this._renderPrimitive=this._renderer.createRenderPrimitive(s,this._material)}}},{key:"onUpdate",value:function(t,e){this.autoRotate&&s.mat4.fromRotation(this.cubeSeaNode.matrix,t/500,[0,-1,0]),s.mat4.fromRotation(this.heroNode.matrix,t/2e3,[0,1,0])}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DropShadowNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(9);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=WebGLRenderingContext,l=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.state.blendFuncSrc=f.ONE,t.state.blendFuncDst=f.ONE_MINUS_SRC_ALPHA,t.state.depthFunc=f.LEQUAL,t.state.depthMask=!1,t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"DROP_SHADOW_MATERIAL"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    varying float vShadow;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vShadow = TEXCOORD_0.x;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    varying float vShadow;\n\n    vec4 fragment_main() {\n      return vec4(0.0, 0.0, 0.0, vShadow);\n    }"}}]),e}();e.DropShadowNode=function(t){function e(t,r){return u(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return c(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=new a.PrimitiveStream;e.startGeometry(),e.pushVertex(0,.01,0,.7);for(var r=2*Math.PI/32,n=void 0,i=0;i<32;++i){n=e.nextVertexIndex;var o=i*r,u=Math.cos(o),s=Math.sin(o);e.pushVertex(.6*u,.01,.6*s,.3),e.pushVertex(1*u,.01,1*s,0),i>0&&(e.pushTriangle(0,n,n-2),e.pushTriangle(n,n+1,n-1),e.pushTriangle(n,n-1,n-2))}e.pushTriangle(0,1,n),e.pushTriangle(1,2,n+1),e.pushTriangle(1,n+1,n),e.endGeometry();var c=e.finishPrimitive(t);this._shadowRenderPrimitive=t.createRenderPrimitive(c,new l),this.addRenderPrimitive(this._shadowRenderPrimitive)}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ButtonNode=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(9);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.defineUniform("hoverAmount",0),t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BUTTON_MATERIAL"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n\n    uniform float hoverAmount;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      float scale = mix(1.0, 1.1, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform float hoverAmount;\n\n    const vec4 default_color = vec4(0.75, 0.75, 0.75, 0.85);\n    const vec4 hover_color = vec4(0.9, 0.9,\n                                  0.9, 1);\n\n    vec4 fragment_main() {\n      return mix(default_color, hover_color, hoverAmount);\n    }"}}]),e}(),l=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.defineUniform("hoverAmount",0),t.icon=t.defineSampler("icon"),t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BUTTON_ICON_MATERIAL"}},{key:"vertexSource",get:function(){return"\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    uniform float hoverAmount;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      float scale = mix(1.0, 1.1, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }"}},{key:"fragmentSource",get:function(){return"\n    uniform sampler2D icon;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(icon, vTexCoord);\n    }"}}]),e}();e.ButtonNode=function(t){function e(t,r){u(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.selectable=!0,n._selectHandler=r,n._iconTexture=t,n._hovered=!1,n._hoverT=0,n}return c(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){var e=new a.PrimitiveStream,r=.0025,n=.05,i=n-.025;e.startGeometry();for(var o=0;o<32;++o){var u=o*(2*Math.PI/32),s=.025*Math.cos(u),c=.025*Math.sin(u);switch(Math.floor(o/8)){case 0:s+=i,c+=i;break;case 1:s-=i,c+=i;break;case 2:s-=i,c-=i;break;case 3:s+=i,c-=i}e.pushVertex(s,c,-r,0,0,0,0,1),o>1&&e.pushTriangle(0,o-1,o)}e.endGeometry();var h=e.finishPrimitive(t);this._buttonRenderPrimitive=t.createRenderPrimitive(h,new f),this.addRenderPrimitive(this._buttonRenderPrimitive),n=.035,e.clear(),e.startGeometry(),e.pushVertex(-n,n,r,0,0,0,0,1),e.pushVertex(-n,-n,r,0,1,0,0,1),e.pushVertex(n,-n,r,1,1,0,0,1),e.pushVertex(n,n,r,1,0,0,0,1),e.pushTriangle(0,1,2),e.pushTriangle(0,2,3),e.endGeometry();var d=e.finishPrimitive(t),v=new l;v.icon.texture=this._iconTexture,this._iconRenderPrimitive=t.createRenderPrimitive(d,v),this.addRenderPrimitive(this._iconRenderPrimitive)}},{key:"onHoverStart",value:function(){this._hovered=!0}},{key:"onHoverEnd",value:function(){this._hovered=!1}},{key:"_updateHoverState",value:function(){var t=this._hoverT/200,e=t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1;this._buttonRenderPrimitive.uniforms.hoverAmount.value=e,this._iconRenderPrimitive.uniforms.hoverAmount.value=e}},{key:"onUpdate",value:function(t,e){this._hovered&&this._hoverT<200?(this._hoverT=Math.min(200,this._hoverT+e),this._updateHoverState()):!this._hovered&&this._hoverT>0&&(this._hoverT=Math.max(0,this._hoverT-e),this._updateHoverState())}},{key:"iconTexture",get:function(){return this._iconTexture},set:function(t){this._iconTexture!=t&&(this._iconTexture=t,this._iconRenderPrimitive.samplers.icon.texture=t)}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BoundsRenderer=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(3),o=r(2),a=r(7);function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var f=WebGLRenderingContext,l=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.state.blend=!0,t.state.blendFuncSrc=f.SRC_ALPHA,t.state.blendFuncDst=f.ONE,t.state.depthTest=!1,t}return c(e,i.Material),n(e,[{key:"materialName",get:function(){return"BOUNDS_RENDERER"}},{key:"vertexSource",get:function(){return"\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 1.0);\n    }"}},{key:"fragmentSource",get:function(){return"\n    precision mediump float;\n\n    vec4 fragment_main() {\n      return vec4(0.0, 1.0, 0.0, 0.3);\n    }"}}]),e}();e.BoundsRenderer=function(t){function e(){u(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._stageBounds=null,t}return c(e,o.Node),n(e,[{key:"onRendererChanged",value:function(t){this.stageBounds=this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds},set:function(t){if(this._stageBounds&&this.clearRenderPrimitives(),this._stageBounds=t,t&&0!==t.length&&this._renderer){for(var e=[],r=[],n=t.geometry.length,i=0;i<n;i++){var o=t.geometry[i];e.push(o.x,0,o.z),r.push(i,0===i?n-1:i-1,n)}e.push(0,0,0);var u=this._renderer.createRenderBuffer(f.ARRAY_BUFFER,new Float32Array(e)),s=this._renderer.createRenderBuffer(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(r)),c=[new a.PrimitiveAttribute("POSITION",u,3,f.FLOAT,12,0)],h=new a.Primitive(c,r.length);h.setIndexBuffer(s);var d=this._renderer.createRenderPrimitive(h,new l);this.addRenderPrimitive(d)}}}]),e}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.Program=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._gl=e,this.program=e.createProgram(),this.attrib=null,this.uniform=null,this.defines={},this._firstUse=!0,this._nextUseCallbacks=[];var a="";if(o)for(var u in o)this.defines[u]=o[u],a+="#define "+u+" "+o[u]+"\n";if(this._vertShader=e.createShader(e.VERTEX_SHADER),e.attachShader(this.program,this._vertShader),e.shaderSource(this._vertShader,a+r),e.compileShader(this._vertShader),this._fragShader=e.createShader(e.FRAGMENT_SHADER),e.attachShader(this.program,this._fragShader),e.shaderSource(this._fragShader,a+n),e.compileShader(this._fragShader),i)for(var s in this.attrib={},i)e.bindAttribLocation(this.program,i[s],s),this.attrib[s]=i[s];e.linkProgram(this.program)}return n(t,[{key:"onNextUse",value:function(t){this._nextUseCallbacks.push(t)}},{key:"use",value:function(){var t=this._gl;if(this._firstUse){if(this._firstUse=!1,t.getProgramParameter(this.program,t.LINK_STATUS)){if(!this.attrib){this.attrib={};for(var e=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES),r=0;r<e;r++){var n=t.getActiveAttrib(this.program,r);this.attrib[n.name]=t.getAttribLocation(this.program,n.name)}}this.uniform={};for(var i=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS),o="",a=0;a<i;a++){o=t.getActiveUniform(this.program,a).name.replace("[0]",""),this.uniform[o]=t.getUniformLocation(this.program,o)}}else t.getShaderParameter(this._vertShader,t.COMPILE_STATUS)?t.getShaderParameter(this._fragShader,t.COMPILE_STATUS)?console.error("Program link error: "+t.getProgramInfoLog(this.program)):console.error("Fragment shader compile error: "+t.getShaderInfoLog(this._fragShader)):console.error("Vertex shader compile error: "+t.getShaderInfoLog(this._vertShader)),t.deleteProgram(this.program),this.program=null;t.deleteShader(this._vertShader),t.deleteShader(this._fragShader)}if(t.useProgram(this.program),this._nextUseCallbacks.length){var u=!0,s=!1,c=void 0;try{for(var f,l=this._nextUseCallbacks[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){(0,f.value)(this)}}catch(t){s=!0,c=t}finally{try{!u&&l.return&&l.return()}finally{if(s)throw c}}this._nextUseCallbacks=[]}}}]),t}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"fromValues",function(){return a}),r.d(e,"copy",function(){return u}),r.d(e,"set",function(){return s}),r.d(e,"add",function(){return c}),r.d(e,"subtract",function(){return f}),r.d(e,"multiply",function(){return l}),r.d(e,"divide",function(){return h}),r.d(e,"ceil",function(){return d}),r.d(e,"floor",function(){return v}),r.d(e,"min",function(){return _}),r.d(e,"max",function(){return m}),r.d(e,"round",function(){return p}),r.d(e,"scale",function(){return y}),r.d(e,"scaleAndAdd",function(){return b}),r.d(e,"distance",function(){return g}),r.d(e,"squaredDistance",function(){return M}),r.d(e,"length",function(){return x}),r.d(e,"squaredLength",function(){return T}),r.d(e,"negate",function(){return w}),r.d(e,"inverse",function(){return E}),r.d(e,"normalize",function(){return O}),r.d(e,"dot",function(){return R}),r.d(e,"cross",function(){return P}),r.d(e,"lerp",function(){return S}),r.d(e,"random",function(){return A}),r.d(e,"transformMat2",function(){return N}),r.d(e,"transformMat2d",function(){return C}),r.d(e,"transformMat3",function(){return I}),r.d(e,"transformMat4",function(){return k}),r.d(e,"str",function(){return L}),r.d(e,"exactEquals",function(){return F}),r.d(e,"equals",function(){return D}),r.d(e,"len",function(){return B}),r.d(e,"sub",function(){return j}),r.d(e,"mul",function(){return U}),r.d(e,"div",function(){return V}),r.d(e,"dist",function(){return Y}),r.d(e,"sqrDist",function(){return G}),r.d(e,"sqrLen",function(){return H}),r.d(e,"forEach",function(){return q});var n=r(0);function i(){let t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t}function o(t){let e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e}function a(t,e){let r=new n.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r}function u(t,e){return t[0]=e[0],t[1]=e[1],t}function s(t,e,r){return t[0]=e,t[1]=r,t}function c(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function l(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function h(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function _(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function m(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function y(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function b(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function g(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function M(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function x(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function T(t){var e=t[0],r=t[1];return e*e+r*r}function w(t,e){return t[0]=-e[0],t[1]=-e[1],t}function E(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function O(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]}function P(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function S(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}function A(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function N(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function C(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function I(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function k(t,e,r){let n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function L(t){return"vec2("+t[0]+", "+t[1]+")"}function F(t,e){return t[0]===e[0]&&t[1]===e[1]}function D(t,e){let r=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))}const B=x,j=f,U=l,V=h,Y=g,G=M,H=T,q=function(){let t=i();return function(e,r,n,i,o,a){let u,s;for(r||(r=2),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],o(t,t,a),e[u]=t[0],e[u+1]=t[1];return e}}()},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return a}),r.d(e,"clone",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"fromRotationTranslationValues",function(){return c}),r.d(e,"fromRotationTranslation",function(){return f}),r.d(e,"fromTranslation",function(){return l}),r.d(e,"fromRotation",function(){return h}),r.d(e,"fromMat4",function(){return d}),r.d(e,"copy",function(){return v}),r.d(e,"identity",function(){return _}),r.d(e,"set",function(){return m}),r.d(e,"getReal",function(){return p}),r.d(e,"getDual",function(){return y}),r.d(e,"setReal",function(){return b}),r.d(e,"setDual",function(){return g}),r.d(e,"getTranslation",function(){return M}),r.d(e,"translate",function(){return x}),r.d(e,"rotateX",function(){return T}),r.d(e,"rotateY",function(){return w}),r.d(e,"rotateZ",function(){return E}),r.d(e,"rotateByQuatAppend",function(){return O}),r.d(e,"rotateByQuatPrepend",function(){return R}),r.d(e,"rotateAroundAxis",function(){return P}),r.d(e,"add",function(){return S}),r.d(e,"multiply",function(){return A}),r.d(e,"mul",function(){return N}),r.d(e,"scale",function(){return C}),r.d(e,"dot",function(){return I}),r.d(e,"lerp",function(){return k}),r.d(e,"invert",function(){return L}),r.d(e,"conjugate",function(){return F}),r.d(e,"length",function(){return D}),r.d(e,"len",function(){return B}),r.d(e,"squaredLength",function(){return j}),r.d(e,"sqrLen",function(){return U}),r.d(e,"normalize",function(){return V}),r.d(e,"str",function(){return Y}),r.d(e,"exactEquals",function(){return G}),r.d(e,"equals",function(){return H});var n=r(0),i=r(5),o=r(10);function a(){let t=new n.ARRAY_TYPE(8);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function u(t){let e=new n.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function s(t,e,r,i,o,a,u,s){let c=new n.ARRAY_TYPE(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=o,c[5]=a,c[6]=u,c[7]=s,c}function c(t,e,r,i,o,a,u){let s=new n.ARRAY_TYPE(8);s[0]=t,s[1]=e,s[2]=r,s[3]=i;let c=.5*o,f=.5*a,l=.5*u;return s[4]=c*i+f*r-l*e,s[5]=f*i+l*t-c*r,s[6]=l*i+c*e-f*t,s[7]=-c*t-f*e-l*r,s}function f(t,e,r){let n=.5*r[0],i=.5*r[1],o=.5*r[2],a=e[0],u=e[1],s=e[2],c=e[3];return t[0]=a,t[1]=u,t[2]=s,t[3]=c,t[4]=n*c+i*s-o*u,t[5]=i*c+o*a-n*s,t[6]=o*c+n*u-i*a,t[7]=-n*a-i*u-o*s,t}function l(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function d(t,e){let r=i.create();o.getRotation(r,e);let a=new n.ARRAY_TYPE(3);return o.getTranslation(a,e),f(t,r,a),t}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function _(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function m(t,e,r,n,i,o,a,u,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=u,t[7]=s,t}const p=i.copy;function y(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}const b=i.copy;function g(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function M(t,e){let r=e[4],n=e[5],i=e[6],o=e[7],a=-e[0],u=-e[1],s=-e[2],c=e[3];return t[0]=2*(r*c+o*a+n*s-i*u),t[1]=2*(n*c+o*u+i*a-r*s),t[2]=2*(i*c+o*s+r*u-n*a),t}function x(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=.5*r[0],s=.5*r[1],c=.5*r[2],f=e[4],l=e[5],h=e[6],d=e[7];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=a*u+i*c-o*s+f,t[5]=a*s+o*u-n*c+l,t[6]=a*c+n*s-i*u+h,t[7]=-n*u-i*s-o*c+d,t}function T(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateX(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function w(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateY(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function E(t,e,r){let n=-e[0],o=-e[1],a=-e[2],u=e[3],s=e[4],c=e[5],f=e[6],l=e[7],h=s*u+l*n+c*a-f*o,d=c*u+l*o+f*n-s*a,v=f*u+l*a+s*o-c*n,_=l*u-s*n-c*o-f*a;return i.rotateZ(t,e,r),n=t[0],o=t[1],a=t[2],u=t[3],t[4]=h*u+_*n+d*a-v*o,t[5]=d*u+_*o+v*n-h*a,t[6]=v*u+_*a+h*o-d*n,t[7]=_*u-h*n-d*o-v*a,t}function O(t,e,r){let n=r[0],i=r[1],o=r[2],a=r[3],u=e[0],s=e[1],c=e[2],f=e[3];return t[0]=u*a+f*n+s*o-c*i,t[1]=s*a+f*i+c*n-u*o,t[2]=c*a+f*o+u*i-s*n,t[3]=f*a-u*n-s*i-c*o,u=e[4],s=e[5],c=e[6],f=e[7],t[4]=u*a+f*n+s*o-c*i,t[5]=s*a+f*i+c*n-u*o,t[6]=c*a+f*o+u*i-s*n,t[7]=f*a-u*n-s*i-c*o,t}function R(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*f+a*u+i*c-o*s,t[1]=i*f+a*s+o*u-n*c,t[2]=o*f+a*c+n*s-i*u,t[3]=a*f-n*u-i*s-o*c,u=r[4],s=r[5],c=r[6],f=r[7],t[4]=n*f+a*u+i*c-o*s,t[5]=i*f+a*s+o*u-n*c,t[6]=o*f+a*c+n*s-i*u,t[7]=a*f-n*u-i*s-o*c,t}function P(t,e,r,i){if(Math.abs(i)<n.EPSILON)return v(t,e);let o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i*=.5;let a=Math.sin(i),u=a*r[0]/o,s=a*r[1]/o,c=a*r[2]/o,f=Math.cos(i),l=e[0],h=e[1],d=e[2],_=e[3];t[0]=l*f+_*u+h*c-d*s,t[1]=h*f+_*s+d*u-l*c,t[2]=d*f+_*c+l*s-h*u,t[3]=_*f-l*u-h*s-d*c;let m=e[4],p=e[5],y=e[6],b=e[7];return t[4]=m*f+b*u+p*c-y*s,t[5]=p*f+b*s+y*u-m*c,t[6]=y*f+b*c+m*s-p*u,t[7]=b*f-m*u-p*s-y*c,t}function S(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function A(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[4],s=r[5],c=r[6],f=r[7],l=e[4],h=e[5],d=e[6],v=e[7],_=r[0],m=r[1],p=r[2],y=r[3];return t[0]=n*y+a*_+i*p-o*m,t[1]=i*y+a*m+o*_-n*p,t[2]=o*y+a*p+n*m-i*_,t[3]=a*y-n*_-i*m-o*p,t[4]=n*f+a*u+i*c-o*s+l*y+v*_+h*p-d*m,t[5]=i*f+a*s+o*u-n*c+h*y+v*m+d*_-l*p,t[6]=o*f+a*c+n*s-i*u+d*y+v*p+l*m-h*_,t[7]=a*f-n*u-i*s-o*c+v*y-l*_-h*m-d*p,t}const N=A;function C(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}const I=i.dot;function k(t,e,r,n){let i=1-n;return I(e,r)<0&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t}function L(t,e){let r=j(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function F(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}const D=i.length,B=D,j=i.squaredLength,U=j;function V(t,e){let r=j(e);return r>0&&(r=Math.sqrt(r),t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r,t[3]=e[3]/r,t[4]=e[4]/r,t[5]=e[5]/r,t[6]=e[6]/r,t[7]=e[7]/r),t}function Y(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function H(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=e[0],h=e[1],d=e[2],v=e[3],_=e[4],m=e[5],p=e[6],y=e[7];return Math.abs(r-l)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-h)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-d)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-v)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(u-_)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(s-m)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(c-p)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(f-y)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(y))}},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"identity",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"invert",function(){return f}),r.d(e,"determinant",function(){return l}),r.d(e,"multiply",function(){return h}),r.d(e,"rotate",function(){return d}),r.d(e,"scale",function(){return v}),r.d(e,"translate",function(){return _}),r.d(e,"fromRotation",function(){return m}),r.d(e,"fromScaling",function(){return p}),r.d(e,"fromTranslation",function(){return y}),r.d(e,"str",function(){return b}),r.d(e,"frob",function(){return g}),r.d(e,"add",function(){return M}),r.d(e,"subtract",function(){return x}),r.d(e,"multiplyScalar",function(){return T}),r.d(e,"multiplyScalarAndAdd",function(){return w}),r.d(e,"exactEquals",function(){return E}),r.d(e,"equals",function(){return O}),r.d(e,"mul",function(){return R}),r.d(e,"sub",function(){return P});var n=r(0);function i(){let t=new n.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function o(t){let e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function s(t,e,r,i,o,a){let u=new n.ARRAY_TYPE(6);return u[0]=t,u[1]=e,u[2]=r,u[3]=i,u[4]=o,u[5]=a,u}function c(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function f(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],u=e[5],s=r*o-n*i;return s?(s=1/s,t[0]=o*s,t[1]=-n*s,t[2]=-i*s,t[3]=r*s,t[4]=(i*u-o*a)*s,t[5]=(n*a-r*u)*s,t):null}function l(t){return t[0]*t[3]-t[1]*t[2]}function h(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1],l=r[2],h=r[3],d=r[4],v=r[5];return t[0]=n*c+o*f,t[1]=i*c+a*f,t[2]=n*l+o*h,t[3]=i*l+a*h,t[4]=n*d+o*v+u,t[5]=i*d+a*v+s,t}function d(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=Math.sin(r),f=Math.cos(r);return t[0]=n*f+o*c,t[1]=i*f+a*c,t[2]=n*-c+o*f,t[3]=i*-c+a*f,t[4]=u,t[5]=s,t}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1];return t[0]=n*c,t[1]=i*c,t[2]=o*f,t[3]=a*f,t[4]=u,t[5]=s,t}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=n*c+o*f+u,t[5]=i*c+a*f+s,t}function m(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function p(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function y(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function b(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function g(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)}function M(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function x(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function T(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function w(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function E(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function O(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=t[4],s=t[5],c=e[0],f=e[1],l=e[2],h=e[3],d=e[4],v=e[5];return Math.abs(r-c)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(i-f)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(u-d)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(s-v)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))}const R=h,P=x},function(t,e,r){"use strict";r.r(e),r.d(e,"create",function(){return i}),r.d(e,"clone",function(){return o}),r.d(e,"copy",function(){return a}),r.d(e,"identity",function(){return u}),r.d(e,"fromValues",function(){return s}),r.d(e,"set",function(){return c}),r.d(e,"transpose",function(){return f}),r.d(e,"invert",function(){return l}),r.d(e,"adjoint",function(){return h}),r.d(e,"determinant",function(){return d}),r.d(e,"multiply",function(){return v}),r.d(e,"rotate",function(){return _}),r.d(e,"scale",function(){return m}),r.d(e,"fromRotation",function(){return p}),r.d(e,"fromScaling",function(){return y}),r.d(e,"str",function(){return b}),r.d(e,"frob",function(){return g}),r.d(e,"LDU",function(){return M}),r.d(e,"add",function(){return x}),r.d(e,"subtract",function(){return T}),r.d(e,"exactEquals",function(){return w}),r.d(e,"equals",function(){return E}),r.d(e,"multiplyScalar",function(){return O}),r.d(e,"multiplyScalarAndAdd",function(){return R}),r.d(e,"mul",function(){return P}),r.d(e,"sub",function(){return S});var n=r(0);function i(){let t=new n.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function o(t){let e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function s(t,e,r,i){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o}function c(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function f(t,e){if(t===e){let r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function l(t,e){let r=e[0],n=e[1],i=e[2],o=e[3],a=r*o-i*n;return a?(a=1/a,t[0]=o*a,t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t):null}function h(t,e){let r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function d(t){return t[0]*t[3]-t[2]*t[1]}function v(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=r[3];return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*c+o*f,t[3]=i*c+a*f,t}function _(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(r),s=Math.cos(r);return t[0]=n*s+o*u,t[1]=i*s+a*u,t[2]=n*-u+o*s,t[3]=i*-u+a*s,t}function m(t,e,r){let n=e[0],i=e[1],o=e[2],a=e[3],u=r[0],s=r[1];return t[0]=n*u,t[1]=i*u,t[2]=o*s,t[3]=a*s,t}function p(t,e){let r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function y(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function b(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function g(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function M(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function x(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function T(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function w(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function E(t,e){let r=t[0],i=t[1],o=t[2],a=t[3],u=e[0],s=e[1],c=e[2],f=e[3];return Math.abs(r-u)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))}function O(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function R(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}const P=v,S=T},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Ray=void 0;var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(6);var o=i.mat3.create();e.Ray=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.origin=i.vec3.create(),this._dir=i.vec3.create(),this._dir[2]=-1,e&&(i.vec3.transformMat4(this.origin,this.origin,e),i.mat3.fromMat4(o,e),i.vec3.transformMat3(this._dir,this._dir,o)),this.dir=this._dir}return n(t,[{key:"intersectsAABB",value:function(t,e){var r=this,n=[t,e],o=(n[r.sign[0]][0]-r.origin[0])*r.inv_dir[0],a=(n[1-r.sign[0]][0]-r.origin[0])*r.inv_dir[0],u=(n[r.sign[1]][1]-r.origin[1])*r.inv_dir[1],s=(n[1-r.sign[1]][1]-r.origin[1])*r.inv_dir[1];if(o>s||u>a)return null;u>o&&(o=u),s<a&&(a=s);var c=(n[r.sign[2]][2]-r.origin[2])*r.inv_dir[2],f=(n[1-r.sign[2]][2]-r.origin[2])*r.inv_dir[2];if(o>f||c>a)return null;c>o&&(o=c),f<a&&(a=f);var l=-1;if(o>0&&a>0)l=Math.min(o,a);else if(o>0)l=o;else{if(!(a>0))return null;l=a}l-=.02;var h=i.vec3.clone(this._dir);return i.vec3.scale(h,h,l),i.vec3.add(h,h,this.origin),h}},{key:"dir",get:function(){return this._dir},set:function(t){this._dir=i.vec3.copy(this._dir,t),i.vec3.normalize(this._dir,this._dir),this.inv_dir=i.vec3.fromValues(1/this._dir[0],1/this._dir[1],1/this._dir[2]),this.sign=[this.inv_dir[0]<0?1:0,this.inv_dir[1]<0?1:0,this.inv_dir[2]<0?1:0]}}]),t}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(2);Object.defineProperty(e,"Node",{enumerable:!0,get:function(){return n.Node}});var i=r(11);Object.defineProperty(e,"Renderer",{enumerable:!0,get:function(){return i.Renderer}}),Object.defineProperty(e,"createWebGLContext",{enumerable:!0,get:function(){return i.createWebGLContext}});var o=r(8);Object.defineProperty(e,"UrlTexture",{enumerable:!0,get:function(){return o.UrlTexture}});var a=r(9);Object.defineProperty(e,"PrimitiveStream",{enumerable:!0,get:function(){return a.PrimitiveStream}});var u=r(14);Object.defineProperty(e,"BoxBuilder",{enumerable:!0,get:function(){return u.BoxBuilder}});var s=r(13);Object.defineProperty(e,"PbrMaterial",{enumerable:!0,get:function(){return s.PbrMaterial}});var c=r(6);Object.defineProperty(e,"mat4",{enumerable:!0,get:function(){return c.mat4}}),Object.defineProperty(e,"mat3",{enumerable:!0,get:function(){return c.mat3}}),Object.defineProperty(e,"vec3",{enumerable:!0,get:function(){return c.vec3}}),Object.defineProperty(e,"vec4",{enumerable:!0,get:function(){return c.vec4}}),Object.defineProperty(e,"quat",{enumerable:!0,get:function(){return c.quat}});var f=r(28);Object.defineProperty(e,"BoundsRenderer",{enumerable:!0,get:function(){return f.BoundsRenderer}});var l=r(27);Object.defineProperty(e,"ButtonNode",{enumerable:!0,get:function(){return l.ButtonNode}});var h=r(26);Object.defineProperty(e,"DropShadowNode",{enumerable:!0,get:function(){return h.DropShadowNode}});var d=r(25);Object.defineProperty(e,"CubeSeaNode",{enumerable:!0,get:function(){return d.CubeSeaNode}});var v=r(24);Object.defineProperty(e,"Gltf2Node",{enumerable:!0,get:function(){return v.Gltf2Node}});var _=r(22);Object.defineProperty(e,"SkyboxNode",{enumerable:!0,get:function(){return _.SkyboxNode}});var m=r(21);Object.defineProperty(e,"VideoNode",{enumerable:!0,get:function(){return m.VideoNode}});var p=r(20);Object.defineProperty(e,"WebXRView",{enumerable:!0,get:function(){return p.WebXRView}}),Object.defineProperty(e,"Scene",{enumerable:!0,get:function(){return p.Scene}});var y=r(16);Object.defineProperty(e,"FallbackHelper",{enumerable:!0,get:function(){return y.FallbackHelper}});var b=r(15);Object.defineProperty(e,"QueryArgs",{enumerable:!0,get:function(){return b.QueryArgs}})}])});
    </script>
    <!-- <script src='./js/webxr-button.js'></script> -->
    <script>
// Copyright 2016 Google Inc.
//
//     Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
//     You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
//     Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
//     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//     See the License for the specific language governing permissions and
// limitations under the License.

// This is a stripped down and specialized version of WebVR-UI
// (https://github.com/googlevr/webvr-ui) that takes out most of the state
// management in favor of providing a simple way of listing available devices
// for the needs of the sample pages. Functionality like beginning sessions
// is intentionally left out so that the sample pages can demonstrate them more
// clearly.

window.XRDeviceButton = (function () {

//
// State consts
//

// Not yet presenting, but ready to present
const READY_TO_PRESENT = 'ready';

// In presentation mode
const PRESENTING = 'presenting';
const PRESENTING_FULLSCREEN = 'presenting-fullscreen';

// Checking device availability
const PREPARING = 'preparing';

// Errors
const ERROR_NO_PRESENTABLE_DISPLAYS = 'error-no-presentable-displays';
const ERROR_BROWSER_NOT_SUPPORTED = 'error-browser-not-supported';
const ERROR_REQUEST_TO_PRESENT_REJECTED = 'error-request-to-present-rejected';
const ERROR_EXIT_PRESENT_REJECTED = 'error-exit-present-rejected';
const ERROR_REQUEST_STATE_CHANGE_REJECTED = 'error-request-state-change-rejected';
const ERROR_UNKOWN = 'error-unkown';

//
// DOM element
//

const _LOGO_SCALE = 0.8;
let _WEBXR_UI_CSS_INJECTED = {};

/**
 * Generate the innerHTML for the button
 *
 * @return {string} html of the button as string
 * @param {string} cssPrefix
 * @param {Number} height
 * @private
 */
const generateInnerHTML = (cssPrefix, height)=> {
  const logoHeight = height*_LOGO_SCALE;
  const svgString = generateXRIconString(cssPrefix, logoHeight) + generateNoXRIconString(cssPrefix, logoHeight);

  return `<button class="${cssPrefix}-button">
          <div class="${cssPrefix}-title"></div>
          <div class="${cssPrefix}-logo" >${svgString}</div>
        </button>`;
};

/**
 * Inject the CSS string to the head of the document
 *
 * @param {string} cssText the css to inject
 */
const injectCSS = (cssText)=> {
  // Create the css
  const style = document.createElement('style');
  style.innerHTML = cssText;

  let head = document.getElementsByTagName('head')[0];
  head.insertBefore(style, head.firstChild);
};

/**
 * Generate DOM element view for button
 *
 * @return {HTMLElement}
 * @param {Object} options
 */
const createDefaultView = (options)=> {
  const fontSize = options.height / 3;
  if (options.injectCSS) {
    // Check that css isnt already injected
    if (!_WEBXR_UI_CSS_INJECTED[options.cssprefix]) {
      injectCSS(generateCSS(options, fontSize));
      _WEBXR_UI_CSS_INJECTED[options.cssprefix] = true;
    }
  }

  const el = document.createElement('div');
  el.innerHTML = generateInnerHTML(options.cssprefix, fontSize);
  return el.firstChild;
};


const createXRIcon = (cssPrefix, height)=>{
  const el = document.createElement('div');
  el.innerHTML = generateXRIconString(cssPrefix, height);
  return el.firstChild;
};

const createNoXRIcon = (cssPrefix, height)=>{
  const el = document.createElement('div');
  el.innerHTML = generateNoXRIconString(cssPrefix, height);
  return el.firstChild;
};

const generateXRIconString = (cssPrefix, height)=> {
    let aspect = 28 / 18;
    return `<svg class="${cssPrefix}-svg" version="1.1" x="0px" y="0px"
        width="${aspect * height}px" height="${height}px" viewBox="0 0 28 18" xml:space="preserve">
        <path d="M26.8,1.1C26.1,0.4,25.1,0,24.2,0H3.4c-1,0-1.7,0.4-2.4,1.1C0.3,1.7,0,2.7,0,3.6v10.7
        c0,1,0.3,1.9,0.9,2.6C1.6,17.6,2.4,18,3.4,18h5c0.7,0,1.3-0.2,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l
        1.5-2.6C13.2,13.1,13,13,14,13v0h-0.2 h0c0.3,0,0.7,0.1,0.8,0.5l1.4,2.6c0.3,0.6,0.8,1.1,1.3,
        1.4c0.6,0.3,1.2,0.5,1.8,0.5h5c1,0,2-0.4,2.7-1.1c0.7-0.7,1.2-1.6,1.2-2.6 V3.6C28,2.7,27.5,
        1.7,26.8,1.1z M7.4,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8c1.6,0,2.8,1.3,2.8,2.8
        C10.2,10.5,8.9,11.8,7.4,11.8z M20.1,11.8c-1.6,0-2.8-1.3-2.8-2.8c0-1.6,1.3-2.8,2.8-2.8C21.7
        ,6.2,23,7.4,23,9 C23,10.5,21.7,11.8,20.1,11.8z"/>
    </svg>`;
};

const generateNoXRIconString = (cssPrefix, height)=>{
    let aspect = 28 / 18;
    return `<svg class="${cssPrefix}-svg-error" x="0px" y="0px"
        width="${aspect * height}px" height="${aspect * height}px" viewBox="0 0 28 28" xml:space="preserve">
        <path d="M17.6,13.4c0-0.2-0.1-0.4-0.1-0.6c0-1.6,1.3-2.8,2.8-2.8s2.8,1.3,2.8,2.8s-1.3,2.8-2.8,2.8
        c-0.2,0-0.4,0-0.6-0.1l5.9,5.9c0.5-0.2,0.9-0.4,1.3-0.8
        c0.7-0.7,1.1-1.6,1.1-2.5V7.4c0-1-0.4-1.9-1.1-2.5c-0.7-0.7-1.6-1-2.5-1
        H8.1 L17.6,13.4z"/>
        <path d="M10.1,14.2c-0.5,0.9-1.4,1.4-2.4,1.4c-1.6,0-2.8-1.3-2.8-2.8c0-1.1,0.6-2,1.4-2.5
        L0.9,5.1 C0.3,5.7,0,6.6,0,7.5v10.7c0,1,0.4,1.8,1.1,2.5c0.7,0.7,1.6,1,2.5,1
        h5c0.7,0,1.3-0.1,1.8-0.5c0.6-0.3,1-0.8,1.3-1.4l1.3-2.6 L10.1,14.2z"/>
        <path d="M25.5,27.5l-25-25C-0.1,2-0.1,1,0.5,0.4l0,0C1-0.1,2-0.1,2.6,0.4l25,25c0.6,0.6,0.6,1.5
        ,0,2.1l0,0 C27,28.1,26,28.1,25.5,27.5z"/>
    </svg>`;
};

/**
 * Generate the CSS string to inject
 *
 * @param {Object} options
 * @param {Number} [fontSize=18]
 * @return {string}
 */
const generateCSS = (options, fontSize=18)=> {
  const height = options.height;
  const borderWidth = 2;
  const borderColor = options.background ? options.background : options.color;
  const cssPrefix = options.cssprefix;

  let borderRadius;
  if (options.corners == 'round') {
    borderRadius = options.height / 2;
  } else if (options.corners == 'square') {
    borderRadius = 2;
  } else {
    borderRadius = options.corners;
  }

  return (`
    @font-face {
        font-family: 'Karla';
        font-style: normal;
        font-weight: 400;
        src: local('Karla'), local('Karla-Regular'),
             url(https://fonts.gstatic.com/s/karla/v5/31P4mP32i98D9CEnGyeX9Q.woff2) format('woff2');
        unicode-range: U+0100-024F, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF;
    }
    @font-face {
        font-family: 'Karla';
        font-style: normal;
        font-weight: 400;
        src: local('Karla'), local('Karla-Regular'),
             url(https://fonts.gstatic.com/s/karla/v5/Zi_e6rBgGqv33BWF8WTq8g.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074,
                       U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
    }

    button.${cssPrefix}-button {
        font-family: 'Karla', sans-serif;

        border: ${borderColor} ${borderWidth}px solid;
        border-radius: ${borderRadius}px;
        box-sizing: border-box;
        background: ${options.background ? options.background : 'none'};

        height: ${height}px;
        min-width: ${fontSize * 9.6}px;
        display: inline-block;
        position: relative;

        cursor: pointer;
    }

    button.${cssPrefix}-button:focus {
      outline: none;
    }

    /*
    * Logo
    */

    .${cssPrefix}-logo {
        width: ${height}px;
        height: ${height}px;
        position: absolute;
        top:0px;
        left:0px;
        width: ${height - 4}px;
        height: ${height - 4}px;
    }
    .${cssPrefix}-svg {
        fill: ${options.color};
        margin-top: ${(height - fontSize * _LOGO_SCALE) / 2 - 2}px;
        margin-left: ${height / 3 }px;
    }
    .${cssPrefix}-svg-error {
        fill: ${options.color};
        display:none;
        margin-top: ${(height - 28 / 18 * fontSize * _LOGO_SCALE) / 2 - 2}px;
        margin-left: ${height / 3 }px;
    }


    /*
    * Title
    */

    .${cssPrefix}-title {
        color: ${options.color};
        position: relative;
        font-size: ${fontSize}px;
        padding-left: ${height * 1.05}px;
        padding-right: ${(borderRadius - 10 < 5) ? height / 3 : borderRadius - 10}px;
    }

    /*
    * disabled
    */

    button.${cssPrefix}-button[disabled=true] {
        opacity: ${options.disabledOpacity};
    }

    button.${cssPrefix}-button[disabled=true] > .${cssPrefix}-logo > .${cssPrefix}-svg {
        display:none;
    }

    button.${cssPrefix}-button[disabled=true] > .${cssPrefix}-logo > .${cssPrefix}-svg-error {
        display:initial;
    }
  `);
};

//
// Button class
//

class EnterXRButton {
  /**
   * Construct a new Enter XR Button
   * @constructor
   * @param {HTMLCanvasElement} sourceCanvas the canvas that you want to present with WebXR
   * @param {Object} [options] optional parameters
   * @param {HTMLElement} [options.domElement] provide your own domElement to bind to
   * @param {Boolean} [options.injectCSS=true] set to false if you want to write your own styles
   * @param {Function} [options.beforeEnter] should return a promise, opportunity to intercept request to enter
   * @param {Function} [options.beforeExit] should return a promise, opportunity to intercept request to exit
   * @param {Function} [options.onRequestStateChange] set to a function returning false to prevent default state changes
   * @param {string} [options.textEnterXRTitle] set the text for Enter XR
   * @param {string} [options.textXRNotFoundTitle] set the text for when a XR display is not found
   * @param {string} [options.textExitXRTitle] set the text for exiting XR
   * @param {string} [options.color] text and icon color
   * @param {string} [options.background] set to false for no brackground or a color
   * @param {string} [options.corners] set to 'round', 'square' or pixel value representing the corner radius
   * @param {string} [options.disabledOpacity] set opacity of button dom when disabled
   * @param {string} [options.cssprefix] set to change the css prefix from default 'webvr-ui'
   */
  constructor(options) {
    options = options || {};

    options.color = options.color || 'rgb(80,168,252)';
    options.background = options.background || false;
    options.disabledOpacity = options.disabledOpacity || 0.5;
    options.height = options.height || 55;
    options.corners = options.corners || 'square';
    options.cssprefix = options.cssprefix || 'webvr-ui';

    // This reads VR as none of the samples are designed for other formats as of yet.
    options.textEnterXRTitle = options.textEnterXRTitle || 'ENTER VR';
    options.textXRNotFoundTitle = options.textXRNotFoundTitle || 'VR NOT FOUND';
    options.textExitXRTitle = options.textExitXRTitle || 'EXIT VR';

    options.onRequestSession = options.onRequestSession || (function() {});
    options.onEndSession = options.onEndSession || (function() {});

    options.injectCSS = options.injectCSS !== false;

    this.options = options;

    this.device = null;
    this.session = null;

    // Pass in your own domElement if you really dont want to use ours
    this.domElement = options.domElement || createDefaultView(options);
    this.__defaultDisplayStyle = this.domElement.style.display || 'initial';

    // Bind button click events to __onClick
    this.domElement.addEventListener('click', ()=> this.__onXRButtonClick());

    this.__forceDisabled = false;
    this.__setDisabledAttribute(true);
    this.setTitle(this.options.textXRNotFoundTitle);
  }

  /**
   * Sets the XRDevice this button is associated with.
   * @param {XRDevice} device
   * @return {EnterXRButton}
   */
  setDevice(device) {
    this.device = device;
    this.__updateButtonState();
    return this;
  }

  /**
   * Indicate that there's an active XRSession. Switches the button to "Exit XR"
   * state if not null, or "Enter XR" state if null.
   * @param {XRSession} session
   * @return {EnterXRButton}
   */
  setSession(session) {
    this.session = session;
    this.__updateButtonState();
    return this;
  }

  /**
   * Set the title of the button
   * @param {string} text
   * @return {EnterXRButton}
   */
  setTitle(text) {
    this.domElement.title = text;
    ifChild(this.domElement, this.options.cssprefix, 'title', (title)=> {
      if (!text) {
        title.style.display = 'none';
      } else {
        title.innerText = text;
        title.style.display = 'initial';
      }
    });

    return this;
  }

  /**
   * Set the tooltip of the button
   * @param {string} tooltip
   * @return {EnterXRButton}
   */
  setTooltip(tooltip) {
    this.domElement.title = tooltip;
    return this;
  }

  /**
   * Show the button
   * @return {EnterXRButton}
   */
  show() {
    this.domElement.style.display = this.__defaultDisplayStyle;
    return this;
  }

  /**
   * Hide the button
   * @return {EnterXRButton}
   */
  hide() {
    this.domElement.style.display = 'none';
    return this;
  }

  /**
   * Enable the button
   * @return {EnterXRButton}
   */
  enable() {
    this.__setDisabledAttribute(false);
    this.__forceDisabled = false;
    return this;
  }

  /**
   * Disable the button from being clicked
   * @return {EnterXRButton}
   */
  disable() {
    this.__setDisabledAttribute(true);
    this.__forceDisabled = true;
    return this;
  }

  /**
   * clean up object for garbage collection
   */
  remove() {
    if (this.domElement.parentElement) {
      this.domElement.parentElement.removeChild(this.domElement);
    }
  }

  /**
   * Set the disabled attribute
   * @param {boolean} disabled
   * @private
   */
  __setDisabledAttribute(disabled) {
    if (disabled || this.__forceDisabled) {
      this.domElement.setAttribute('disabled', 'true');
    } else {
      this.domElement.removeAttribute('disabled');
    }
  }

  /**
   * Handling click event from button
   * @private
   */
  __onXRButtonClick() {
    if (this.session) {
      this.options.onEndSession(this.session);
    } else if (this.device) {
      this.options.onRequestSession(this.device);
    }
  }

  /**
   * Updates the display of the button based on it's current state
   * @private
   */
  __updateButtonState() {
    if (this.session) {
      this.setTitle(this.options.textExitXRTitle);
      this.setTooltip('Exit XR presentation');
      this.__setDisabledAttribute(false);
    } else if (this.device) {
      this.setTitle(this.options.textEnterXRTitle);
      this.setTooltip('Enter XR');
      this.__setDisabledAttribute(false);
    } else {
      this.setTitle(this.options.textXRNotFoundTitle);
      this.setTooltip('No XR headset found.');
      this.__setDisabledAttribute(true);
    }
  }
}

/**
 * Function checking if a specific css class exists as child of element.
 *
 * @param {HTMLElement} el element to find child in
 * @param {string} cssPrefix css prefix of button
 * @param {string} suffix class name
 * @param {function} fn function to call if child is found
 * @private
 */
const ifChild = (el, cssPrefix, suffix, fn)=> {
  const c = el.querySelector('.' + cssPrefix + '-' + suffix);
  c && fn(c);
};

return EnterXRButton;

})();

    </script>
</head>

<body>
    <header>
        <details open>
            <summary>Phone AR</summary>
            <p>
                This sample demonstrates use of a non-exclusive XRSession to present Augmented Reality content.
                <a class="back" href="./">Back</a>
            </p>
        </details>
    </header>
    <script>
    (function() {
        'use strict';
        // If requested, initialize the WebXR polyfill
        if (QueryArgs.getBool('allowPolyfill', false)) {
            var polyfill = new WebXRPolyfill();
        }
        // Apply the version shim after the polyfill is instantiated, to ensure
        // that the polyfill also gets patched if necessary.
        var versionShim = new WebXRVersionShim();
        // XR globals.
        let xrButton = null;
        let xrFrameOfRef = null;
        // AR sessions must have an outputContext, just like magic window
        // sessions.
        let outputCanvas = document.createElement('canvas');
        outputCanvas.setAttribute('id', 'output-canvas');
        let ctx = outputCanvas.getContext('xrpresent');
        // WebGL scene globals.
        let gl = null;
        let renderer = null;
        let scene = new Scene();
        let solarSystem = new Gltf2Node({ url: './webxr-samples/media/gltf/space/space.gltf' });
        // The solar system is big (citation needed). Scale it down so that users can
        // move around the planets more easily.
        solarSystem.scale = [0.1, 0.1, 0.1];
        scene.addNode(solarSystem);
        // No skybox is added to this scene, and we're not clearing the background to
        // black because we want the real world to show through.
        scene.clear = false;

        function initXR() {
            xrButton = new XRDeviceButton({
                onRequestSession: onRequestSession,
                onEndSession: onEndSession,
                textEnterXRTitle: "START AR",
                textXRNotFoundTitle: "AR NOT FOUND",
                textExitXRTitle: "EXIT  AR",
            });
            document.querySelector('header').appendChild(xrButton.domElement);
            if (navigator.xr) {
                navigator.xr.requestDevice().then((device) => {
                    // Checks to ensure that environment integration (AR) is available,
                    // and only enables the button if so.
                    device.supportsSession({ environmentIntegration: true, outputContext: ctx }).then(() => {
                        xrButton.setDevice(device);
                    });
                });
            }
        }

        function onRequestSession(device) {
            // Requests an inline (non-immersive) session with environment integration
            // to get AR via video passthrough.
            // Even though this is a non-immersive session, the fact that it's
            // using environment integration means it must be requested in a user
            // activation event so that appropriate permissions can be granted.
            // This will likely prompt the user to allow camera use, so the promise
            // may remain outstanding for a while.
            device.requestSession({ environmentIntegration: true, outputContext: ctx })
                .then((session) => {
                    // Add the canvas to the document once we know that it will be
                    // rendered to.
                    document.body.appendChild(outputCanvas);
                    xrButton.setSession(session);
                    onSessionStarted(session);
                });
        }

        function onSessionStarted(session) {
            session.addEventListener('end', onSessionEnded);
            if (!gl) {
                gl = createWebGLContext({
                    compatibleXRDevice: session.device
                });
                renderer = new Renderer(gl);
                scene.setRenderer(renderer);
            }
            session.baseLayer = new XRWebGLLayer(session, gl);
            session.requestFrameOfReference('eye-level').then((frameOfRef) => {
                xrFrameOfRef = frameOfRef;
                session.requestAnimationFrame(onXRFrame);
            });
        }

        function onEndSession(session) {
            session.end();
            // Remove the injected output canvas from the DOM.
            document.body.removeChild(document.querySelector('#output-canvas'));
        }

        function onSessionEnded(event) {
            xrButton.setSession(null);
        }
        // Called every time a XRSession requests that a new frame be drawn.
        function onXRFrame(t, frame) {
            let session = frame.session;
            let pose = frame.getDevicePose(xrFrameOfRef);
            scene.startFrame();
            session.requestAnimationFrame(onXRFrame);
            scene.drawXRFrame(frame, pose);
            scene.endFrame();
        }
        // Start the XR application.
        initXR();
    })();
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    var socket = io();
    </script>
</body>

</html>